<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
    PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN"
    "http://www.ibatis.com/dtd/sql-map-2.dtd">
<sqlMap namespace="edu.ProcesoEDUComercialSQL">

    <parameterMap id="updateHistoricoPedidosParams" class="map" >
		<parameter property="codigoPais"                jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoEmpresa"             jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoPeriodo"             jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="usuario.login"             jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
    </parameterMap>

  	<resultMap id="resultAptas" class="java.util.HashMap">
        <result property="codigoPais"              column="CODPAIS"/>
        <result property="codigoCliente"           column="CLIENTE"/>
		<result property="codigoPeriodo"           column="CAMPROC"/>
		<result property="codigoEmpresa"           column="CODEMP"/>
		<result property="nombreCliente"           column="NOMCON"/>
        <result property="codigoCurso"        	   column="CURSO"/>
        <result property="codigoMensajeEsp"        column="MSGESP"/>
        <result property="codigoMensajeGen"        column="MSGGEN"/>
        <result property="codigoClasificacion"     column="CODCLAS"/>
		<result property="codigoVenta"             column="CODVENT"/>
		<result property="codigoUsuario"           column="CODUSUA"/>	
		<result property="indicadorEnviaInvit"     column="INDENVI"/>	
    </resultMap>

  	<resultMap id="resultAptasCosto" class="java.util.HashMap">
        <result property="codigoPais"              column="CODPAIS"/>
        <result property="codigoEmpresa"           column="CODEMP"/>
        <result property="codigoCliente"           column="CLIENTE"/>
		<result property="codigoPeriodo"           column="CAMPROC"/>
		<result property="nombreCliente"           column="NOMCON"/>
        <result property="codigoCurso"        	   column="CURSO"/>
        <result property="campIni"           	   column="CAMPINI"/>
        <result property="campLim"        	       column="CAMPLIM"/>
        <result property="codigoMensajeEsp"        column="MSGESP"/>
        <result property="codigoMensajeGen"        column="MSGGEN"/>
        <result property="codigoClasificacion"     column="CODCLAS"/>
		<result property="codigoVenta"             column="CODVENT"/>
		<result property="codigoUsuario"           column="CODUSUA"/>	
		<result property="fechaProceso"            column="FECHPROC"/>	
		<result property="estadoCompra"       	    column="ESTCOMPRA"/>	
    </resultMap>

  	<resultMap id="resultCierreFacturacion" class="java.util.HashMap">
        <result property="codigoCliente"           column="CLIENTE"/>
        <result property="nivelCapacitacion"   	   column="NIV_CAPA"/>
        <result property="estadoCapacitacion"      column="EST_CAPA"/>
        <result property="valorCapacitacion"   	   column="VAL_CAPA"/>
    </resultMap>

    <resultMap id="resultTotalBeneficiosCapacitadas" class="java.util.HashMap">
        <result property="codigoPais"                column="CODPAIS"/>
        <result property="codigoClasificacion"       column="CLAS_COD_CLAS"/>
        <result property="codigoCliente" 	         column="CLIE_COD_CLIE"/>
        <result property="codigoCurso" 	   	         column="NIV_CAPA_ALCA"/>		
        <result property="codigoMensajeGral" 	 	 column="COD_MENS_GRAL"/>			
        <result property="codigoMensajeEspecifico" 	 column="COD_MENS_ESPE"/>		
    </resultMap>

	<resultMap id="resultHistoricoBloqueoConsultoraTemporal" class="java.util.HashMap">
		<result property="codigoPais"          column="COD_PAIS"/>
        <result property="codigoCliente"       column="COD_CLIE"/>
        <result property="codigoPeriodo"       column="CAM_PROC"/>
    </resultMap>

	<resultMap id="resultGenerarPlanillaProgramacion" class="java.util.HashMap">
		<result property="codigoPais"          column="PAIS_COD_PAIS"/>
        <result property="codigoEmpresa"       column="EMCO_COD_EMPR_COME"/>
        <result property="codigoPeriodo"       column="CAM_PROC"/>
		<result property="codigoRegion"        column="REGI_COD_REGI"/>
        <result property="codigoCurso"         column="CCAP_COD_CURS_CAPA"/>
		<result property="codigoCliente"       column="CLIE_COD_CLIE"/>
    </resultMap>

    <procedure id="updateHistoricoPedidos" 
   			  parameterMap="updateHistoricoPedidosParams" >
		{call EDU_PKG_PROCE_COMER.EDU_PR_RECEP_PEDID(?,?,?,?)}
    </procedure>  

    <procedure id="updateMaestroClientes" 
   			  parameterMap="updateHistoricoPedidosParams" >
		{call EDU_PKG_PROCE_COMER.EDU_PR_RECEP_MAEST_CLIEN(?,?,?,?)}
    </procedure>  

    <procedure id="updateHistoricoPedidosFacturados" 
   			  parameterMap="updateHistoricoPedidosParams" >
		{call EDU_PKG_PROCE_COMER.EDU_PR_RECEP_PEDID_FACTU(?,?,?,?)}
    </procedure>  

    <procedure id="updatePedidosCursosFacturados" 
   			  parameterMap="updateHistoricoPedidosParams" >
		{call EDU_PKG_PROCE_COMER.EDU_PR_ACTUA_COMPR_CURSO(?,?,?,?)}
    </procedure>  

    <procedure id="updatePedidosCursosNoFacturados" 
   			  parameterMap="updateHistoricoPedidosParams" >
		{call EDU_PKG_PROCE_COMER.EDU_PR_ACTUA_NO_COMPR_CURSO(?,?,?,?)}
    </procedure>  

	<delete id="deleteTemporalPedidos" parameterClass="java.util.Map">
		delete from EDU_TMP_PEDID_CONSU
		where COD_PAIS=#codigoPais#
			and COD_EMPR_COME= #codigoEmpresa#
    </delete>

	<delete id="deleteTemporalPedidosCursos">
		delete from EDU_TMP_CONFI_CURSO_COSTO
    </delete>

	<insert id="insertPedidosConsultora" parameterClass="java.util.Map">
		INSERT INTO EDU_TMP_PEDID_CONSU (
				COD_PAIS	,
				COD_EMPR_COME	,
				CAM_PROC	,
				COD_CLIE	,
				IND_FACT	,
				IND_PEDI	        ,
				FEC_RECE	,
				FEC_FACT	,
				COD_REGI	,
				COD_ZONA	,
				APE_PATE	,
				APE_MATE	,
				APE_CASA	,
				PRI_NOMB	,
				SEG_NOMB	,
				NUM_DOCU	,
				FEC_NACI	,
				NUM_TELE_PART	,
				IND_MORO	,
				SAL_CLIE	,
				COD_SECC	,
				COD_TERR	,
				NUM_CELU	,
			  	COD_DEPA	,
				COD_MUNI	,
				DES_POBL    ,
				CAM_INGR_COME						
					 ) 
				 VALUES 
				 (#codigoPais#,
				  #codigoEmpresa#,
				  #codigoPeriodo#,
				  #codigoCliente#,
				  #indicadorFacturacion#,
				  #indicadorPedido# ,
				  to_date(#fechaRecepcion#,'dd/mm/yyyy') ,
			  	  to_date(#fechafacturacion#,'dd/mm/yyyy') ,
				#codRegion#     ,                        
				#codZona#	,                        
				#codPra#        ,                        
				#codSea#        ,                        
				''		,                        
				#codPrn#        ,                        
				#codSen#        ,                        
				#codRocta#      ,                        
				to_date(#fecha#, 'dd/mm/yyyy')       , 
				#codCotel#      ,                        
				#codMor#        ,                        
				#codSac#        ,
				#codSeccion#        ,                        
				#codTerritorio#      ,
				#telefono#,
				#codigoDpto#,
				#codigoMuni#,
				#descPoblacion#,
				#campIngresoComercial#) 				 		
	</insert>


	<insert id="insertPedidosConsultoraNombreCompleto" parameterClass="java.util.Map">
		INSERT INTO EDU_TMP_PEDID_CONSU (
				COD_PAIS	,
				COD_EMPR_COME	,
				CAM_PROC	,
				COD_CLIE	,
				IND_FACT	,
				IND_PEDI	        ,
				FEC_RECE	,
				FEC_FACT	,
				COD_REGI	,
				COD_ZONA	,
				APE_NOMB_COMP,
				NUM_DOCU	,
				FEC_NACI	,
				NUM_TELE_PART	,
				IND_MORO	,
				SAL_CLIE	,
				COD_SECC	,
				COD_TERR	,
				NUM_CELU	,
			    CAM_INGR_COME			  								
				 ) 
			 VALUES 
				 (#codigoPais#,
				  #codigoEmpresa#,
				  #codigoPeriodo#,
				  #codigoCliente#,
				  #indicadorFacturacion#,
				  #indicadorPedido# ,
				  to_date(#fechaRecepcion#,'dd/mm/yyyy') ,
			  	  to_date(#fechafacturacion#,'dd/mm/yyyy') ,
				#codRegion#     ,                        
				#codZona#	,                        
				#nombreCompleto#,                       
				#codRocta#      ,                        
				to_date(#fecha#, 'dd/mm/yyyy')       , 
				#codCotel#      ,                        
				#codMor#        ,                        
				#codSac#        ,
				#codSeccion#        ,                        
				#codTerritorio#      ,
				#telefono#,
				#campIngresoComercial#
					) 				 		
	</insert>




	<insert id="insertPedidosConsultoraFacturadas" parameterClass="java.util.Map">
		INSERT INTO EDU_TMP_PEDID_CONSU (
				COD_PAIS	,
				COD_EMPR_COME	,
				CAM_PROC	,
				COD_CLIE	,
				IND_FACT	,
				IND_PEDI	    ,
				FEC_RECE	,
				FEC_FACT	 ) 
					 VALUES 
					 (#codigoPais#,
					  #codigoEmpresa#,
					  #codigoPeriodo#,
					  #codigoCliente#,
					  #indicadorFacturacion#,
					  #indicadorPedido# ,
					  to_date(#fechaRecepcion#,'dd/mm/yyyy') ,
				  	  to_date(#fechafacturacion#,'dd/mm/yyyy') 
					) 				 		
	</insert>

	<insert id="insertPedidosCursosFacturadas" parameterClass="java.util.Map">
		INSERT INTO EDU_TMP_CONFI_CURSO_COSTO (
				COD_PAIS	,
				COD_EMPR_COME	,
				CAM_ACEP	,
				COD_CLIE	,
				IND_COMP	,
				COD_CURS_CAPA	    ,
				FEC_FACT	 ) 
					 VALUES 
					 (#codigoPais#,
					  CASE WHEN #codigoEmpresa# IS NULL THEN 
					        (SELECT COD_EMPR_COME 
					         FROM EDU_EMPRE_COMER
					         WHERE PAIS_COD_PAIS = #codigoPais#)
					  ELSE
					     #codigoEmpresa#
					  END,
					  #codigoPeriodo#,
					  #codigoCliente#,
					  #indicadorCompra#,
					  #codigoCurso#,
				  	  to_date(#fechafacturacion#,'dd/mm/yyyy') 
					) 				 		
	</insert>


	<insert id="insertMaestroClientes" parameterClass="java.util.Map">
	  INSERT INTO  EDU_MAEST_CLIEN ( 
				PAIS_COD_PAIS		,
				EMCO_COD_EMPR_COME	,
				COD_CLIE		,
				COD_REGI		,
				COD_ZONA		,
				APE_PATE		,
				APE_MATE		,
				APE_CASA		,
				PRI_NOMB		,
				SEG_NOMB		,
				NUM_DOCU		,
				FEC_NACI		,
				NUM_TELE_PART		,
				IND_MORO		,
				SAL_CLIE		,
				USU_DIGI		,
				FEC_DIGI		,
				USU_MODI		,
				FEC_MODI		,
				EST_REGI		 

		) VALUES ( 
				#codigoPais#	,                        
				#codigoEmpresa# ,                        
				#nroCuenta#     ,                        
				#codRegion#     ,                        
				#codZona#	,                        
				#codPra#        ,                        
				#codSea#        ,                        
				''		,                        
				#codPrn#        ,                        
				#codSen#        ,                        
				#codRocta#      ,                        
				to_date(#fecha#, 'dd/mm/yyyy')       , 
				#codCotel#      ,                        
				#codMor#        ,                        
				#codSac#        ,                        
				#codusuario# ,                        
				sysdate ,                                
				'' ,                                     
				null ,                                   
				1                                        
		)
	</insert>

	<delete id="deleteTemporalControlFacturacion">
        <!--
		TRUNCATE TABLE EDU_TMP_CONTR_FACTU
		-->
		DELETE FROM EDU_TMP_CONTR_FACTU
    </delete>

	


	<insert id="insertTemporalControlFacturacion" parameterClass="java.util.Map">
		  INSERT INTO EDU_TMP_CONTR_FACTU (
   					COD_PAIS, 
   					COD_EMPR_COME, 
   					COD_PERI, 
   					FEC_PROC, 
   					EST_CAMP, 
   					IND_CAMP_ACTI )
		  VALUES ( 
					#codigoPais#	,                        
					#codigoEmpresa# ,                        
					#codigoPeriodo# ,                        
					to_Date(#fechafacturacion#,'yyyymmdd' ) ,                        
					#estado#	,                        
					#indicadorActivo# )
	</insert>

    <parameterMap id="updateControlFacturacionParams" class="map" >
		<parameter property="codigoPais"                jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoEmpresa"             jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="usuario.login"             jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
    </parameterMap>

    <procedure id="updateControlFacturacion" 
   			  parameterMap="updateControlFacturacionParams" >
		{call EDU_PKG_PROCE_COMER.EDU_PR_CARGA_CONTR_FACTU(?,?,?)}
    </procedure>  


    <parameterMap id="updateNumeroLoteParams" class="map" >
		<parameter property="codigoPais"                jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoEmpresa"             jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="tipoLote"		            jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codusuario"		            jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
    </parameterMap>


    <procedure id="updateNumeroLote" 
   			  parameterMap="updateNumeroLoteParams" >
		{call EDU_PKG_PROCE_COMER.EDU_PR_ACTUA_NUMER_LOTE_SGNTE(?,?,?,?)}
    </procedure>  

    <select id="getNumeroLoteEducacion" parameterClass="java.util.Map" resultClass="string">
       SELECT 
          EDU_PKG_PROCE_COMER.GEN_FN_NUMER_LOTE_SGNTE(#codigoPais#, #codigoEmpresa#,#tipoLote#)
	   FROM DUAL	
	</select>

	<delete id="deleteTemporalRegiones">
		<!--
        TRUNCATE TABLE EDU_TMP_REGIO
		-->
		DELETE FROM EDU_TMP_REGIO
    </delete>

	<insert id="insertTemporalRegiones" parameterClass="java.util.Map">

				INSERT INTO EDU_TMP_REGIO (
							COD_PAIS, 
							COD_EMPR_COME, 
		 					COD_REGI, 
							DES_REGI,
							NOM_GERE_REGI,
							EMA_GERE_REGI,
							COD_GERE_REGI,
							IND_ACTI) 
						VALUES ( 
							#codigoPais#	, 
							#codigoEmpresa# , 
							#codigoRegion#  ,
							#descRegion# ,
							#nomGerenteRegional#,
							#emailGerenteRegional#, 
							#codigoGerenteRegional#,
							#indicadorActividad#
							 )                      
	</insert>

    <parameterMap id="updateMaestroRegionesParams" class="map" >
		<parameter property="codigoPais"                jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoEmpresa"             jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="usuario.login"             jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
    </parameterMap>

    <procedure id="updateMaestroRegiones" 
   			  parameterMap="updateMaestroRegionesParams" >
		{call EDU_PKG_PROCE_COMER.EDU_PR_CARGA_REGIO(?,?,?)}
    </procedure>  

	<delete id="deleteTemporalZonas">
        <!--
		TRUNCATE TABLE TMP_ZONA
		-->
		DELETE FROM EDU_TMP_ZONA
    </delete>

	<delete id="deleteTemporalConsultorasAptasporProgramar">
        delete from EDU_TMP_PLANI_PROGR_CURSO
    </delete>

	<insert id="insertTemporalZonas" parameterClass="java.util.Map">
				INSERT INTO EDU_TMP_ZONA (
   							COD_PAIS, 
   							COD_EMPR_COME, 
   							COD_REGI, 
   							COD_ZONA, 
   							DES_ZONA ,
							EMA_GERE_ZONA,
							EST_ZONA) 
					    VALUES ( 
							#codigoPais#	, 
							#codigoEmpresa# , 
							#codigoRegion#  ,
							#codigoZona#  ,
							#descZona#  ,
							#correoGZ#,
							#status#  
							 )                      
	</insert>

    <parameterMap id="updateMaestroZonasParams" class="map" >
		<parameter property="codigoPais"                jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoEmpresa"             jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="usuario.login"             jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
    </parameterMap>

    <procedure id="updateMaestroZonas" 
   			  parameterMap="updateMaestroZonasParams" >
		{call EDU_PKG_PROCE_COMER.EDU_PR_CARGA_ZONAS(?,?,?)}
    </procedure>  

    <select id="getConsultorasAptas" parameterClass="java.util.Map" resultMap="resultAptas">
					SELECT aptas.pais_cod_pais as CODPAIS, 
						   APTAS.EMCO_COD_EMPR_COME as  CODEMP ,
						   #codigoPeriodo# AS CAMPROC,	
					       APTAS.CLIE_COD_CLIE CLIENTE,
						   EDU_PKG_PROCE_GENER.EDU_FN_DEVUE_NOMBR_CONSU(
								aptas.pais_cod_pais,
								aptas.emco_cod_empr_come,
								aptas.clie_cod_clie,
								#indicadorNombreCompleto#) as NOMCON,							
					       CAPAC.COD_CURS_CAPA CURSO ,
						   EDU_PKG_PROCE_GENER.EDU_FN_DEVUE_CODIG_MENSA(
								aptas.pais_cod_pais,
								aptas.emco_cod_empr_come,
								#indicadorEquivalenciaMensaje#,
								'2',
								aptas.ccap_cod_curs_capa,
								aptas.est_capa,
								aptas.num_invi,
								APTAS.CLIE_COD_CLIE) AS MSGESP,
						   EDU_PKG_PROCE_GENER.EDU_FN_DEVUE_CODIG_MENSA(
								aptas.pais_cod_pais,
								aptas.emco_cod_empr_come,
								#indicadorEquivalenciaMensaje#,
								'1',
								aptas.ccap_cod_curs_capa,
								aptas.est_capa,
								aptas.num_invi,
								APTAS.CLIE_COD_CLIE) AS MSGGEN,
						   NVL((select t.cod_clas from edu_param_clasi_benef_capac t where 
         							t.pais_cod_pais = aptas.pais_cod_pais and
         							t.emco_cod_empr_come = aptas.emco_cod_empr_come and
         							t.niv_capa_alca = aptas.ccap_cod_curs_capa and
         							t.tip_clas = 'I' and
         							t.tip_curs = 'S' and 
         							t.est_clas = 'A' and
         							t.est_regi != 9 ),' ') as CODCLAS,
						  ' ' as CODVENT,	
						  #codusuario# AS CODUSUA,
						 DECODE(aptas.num_invi,1,1,0) AS INDENVI
					FROM EDU_PARAM_CURSO_CAPAC CAPAC,
   		                 EDU_HISTO_APTAS APTAS,
						 EDU_TMP_PEDID_CONSU E	
					     WHERE 
							APTAS.PAIS_COD_PAIS =  #codigoPais# and
							APTAS.EMCO_COD_EMPR_COME =  #codigoEmpresa# and
							 CAPAC.PAIS_COD_PAIS=APTAS.PAIS_COD_PAIS
					         AND   CAPAC.EMCO_COD_EMPR_COME=APTAS.EMCO_COD_EMPR_COME
					         AND   CAPAC.COD_CURS_CAPA=APTAS.CCAP_COD_CURS_CAPA
							 AND APTAS.CAM_ULTI_CALI_APTA=#codigoPeriodo#
				         	 AND APTAS.IND_CURS_COST='N' 
						 <![CDATA[
							 AND aptas.num_invi <=CAPAC.NUM_INVI
						]]>
						<isEmpty prepend="AND" property="tipoProceso">
					         APTAS.EST_CAPA='PC'
					         AND   APTAS.IND_ENVI='N'
			            </isEmpty>	 
						<isNotEmpty prepend="AND" property="tipoProceso">
					         	   APTAS.EST_CAPA='PF'
					         AND   APTAS.IND_ENVI='N'
							 AND   APTAS.NUM_LOTE_DIAR=#numeroLote# 	
			            </isNotEmpty>	 
						AND E.COD_PAIS = APTAS.PAIS_COD_PAIS
					    AND E.COD_EMPR_COME = APTAS.EMCO_COD_EMPR_COME
						AND E.COD_CLIE = APTAS.CLIE_COD_CLIE 
						AND E.CAM_PROC = #codigoPeriodo#
	</select>	

    <select id="getConsultorasAptasCosto" parameterClass="java.util.Map" resultMap="resultAptasCosto">
					SELECT 
						   APTAS.PAIS_COD_PAIS as  CODPAIS ,
						   APTAS.EMCO_COD_EMPR_COME as  CODEMP ,
						   #codigoPeriodo# AS CAMPROC,		
					       APTAS.CLIE_COD_CLIE CLIENTE,
						   EDU_PKG_PROCE_GENER.EDU_FN_DEVUE_NOMBR_CONSU(
								aptas.pais_cod_pais,
								aptas.emco_cod_empr_come,
								aptas.clie_cod_clie,
								#indicadorNombreCompleto#) as NOMCON,							
					       CAPAC.COD_CURS_CAPA CURSO ,
						   APTAS.CAM_ULTI_CALI_APTA as CAMPINI ,
						   EDU_PKG_PROCE_COMER.GEN_FN_DEVUE_NSGTE_CAMPA(APTAS.CAM_ULTI_CALI_APTA, decode(1,NUM_CAMP_PREV_CALI,0,1) )
								 as CAMPLIM ,
						   EDU_PKG_PROCE_GENER.EDU_FN_DEVUE_CODIG_MENSA(
								aptas.pais_cod_pais,
								aptas.emco_cod_empr_come,
								#indicadorEquivalenciaMensaje#,
								'2',
								aptas.ccap_cod_curs_capa,
								aptas.est_capa,
								aptas.num_invi,	
								APTAS.CLIE_COD_CLIE) AS MSGESP,
						   EDU_PKG_PROCE_GENER.EDU_FN_DEVUE_CODIG_MENSA(
								aptas.pais_cod_pais,
								aptas.emco_cod_empr_come,
								#indicadorEquivalenciaMensaje#,
								'1',
								aptas.ccap_cod_curs_capa,
								aptas.est_capa,
								aptas.num_invi,
								APTAS.CLIE_COD_CLIE) AS MSGGEN,
						  NVL((select t.cod_clas from edu_param_clasi_benef_capac t where 
         							t.pais_cod_pais = aptas.pais_cod_pais and
         							t.emco_cod_empr_come = aptas.emco_cod_empr_come and
         							t.niv_capa_alca = aptas.ccap_cod_curs_capa and
         							t.tip_clas = 'I' and
         							t.tip_curs = 'C' and 
         							t.est_clas = 'A' and
         							t.est_regi != 9 ),' ') as CODCLAS,
						  ' ' as CODVENT,		
						  #codusuario# AS CODUSUA,
						  ( SELECT NVL(TO_CHAR(CF.FEC_PROC,'dd/MM/yyyy'),'')
							FROM EDU_CONTR_FACTU CF
							WHERE CF.PAIS_COD_PAIS=#codigoPais#
							 AND CF.EMCO_COD_EMPR_COME=#codigoEmpresa#
							 AND CF.EST_CAMP ='1'
							 AND CF.IND_CAMP_ACTI = '1'
							 AND CF.COD_PERI=	#codigoPeriodo#) as FECHPROC,
							DECODE(1,CAPAC.NUM_CAMP_PREV_CALI,'C','E')  AS ESTCOMPRA
					FROM EDU_PARAM_CURSO_CAPAC CAPAC,
   		                 EDU_HISTO_APTAS APTAS,
						 EDU_TMP_PEDID_CONSU E	
					     WHERE 
							APTAS.PAIS_COD_PAIS =  #codigoPais# and
							APTAS.EMCO_COD_EMPR_COME =  #codigoEmpresa# and
							 CAPAC.PAIS_COD_PAIS=APTAS.PAIS_COD_PAIS
					         AND   CAPAC.EMCO_COD_EMPR_COME=APTAS.EMCO_COD_EMPR_COME
					         AND   CAPAC.COD_CURS_CAPA=APTAS.CCAP_COD_CURS_CAPA
							 AND APTAS.CAM_ULTI_CALI_APTA=#codigoPeriodo#
							 AND APTAS.IND_CURS_COST='S' 
						<isEmpty prepend="AND" property="tipoProceso">
					         APTAS.EST_CAPA='PC'
					         AND   APTAS.IND_ENVI='N'
			            </isEmpty>	 
						<isNotEmpty prepend="AND" property="tipoProceso">
					         	   APTAS.EST_CAPA='FC'
					         AND   APTAS.IND_ENVI='N'
							 AND   APTAS.NUM_LOTE_DIAR=#numeroLote# 	
			            </isNotEmpty>	 
						AND E.COD_PAIS = APTAS.PAIS_COD_PAIS
					    AND E.COD_EMPR_COME = APTAS.EMCO_COD_EMPR_COME
						AND E.COD_CLIE = APTAS.CLIE_COD_CLIE 
						AND E.CAM_PROC = #codigoPeriodo#						
	</select>	


   <parameterMap id="executeProcesoConsultorasAptasMixtoBloqueoParams" class="map" >
		<parameter property="codigoPais"                   jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoEmpresa"                jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoPeriodo"                jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="indicadorEquivalenciaMensaje" jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="indicadorNombreCompleto"      jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="numeroLote"             	   jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="usuario.login"                jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
    </parameterMap>

    <procedure id="executeProcesoConsultorasAptasMixtoBloqueo" parameterMap="executeProcesoConsultorasAptasMixtoBloqueoParams" >
		{call EDU_PKG_CALIF.EDU_PR_PROCE_APTAS_MIXTO_BLOQU(?, ?, ?, ?, ?, ?, ? )}
    </procedure>  	

   <select id="getConsultorasAptasMixtoBloqueo" parameterClass="java.util.Map" resultMap="resultAptasCosto">
					SELECT 
						  COD_PAIS as CODPAIS ,
						  COD_EMPR_COME as CODEMP ,
						  CAM_PROC AS CAMPROC,		
					      COD_CLIE as CLIENTE,
						  NOM_CLIE as NOMCON,							
					      COD_CURS_CAPA as CURSO ,
						  CAM_INIC as CAMPINI ,
						  CAM_FINA as CAMPLIM ,
						  COD_MENS_ESPE as MSGESP,
						  COD_MENS_GENE as MSGGEN,
						  COD_CLAS as CODCLAS,
						  COD_VENT as CODVENT,		
						  COD_USUA as CODUSUA,
						  ( SELECT NVL(TO_CHAR(CF.FEC_PROC,'dd/MM/yyyy'),'')
							FROM EDU_CONTR_FACTU CF
							WHERE CF.PAIS_COD_PAIS=#codigoPais#
							 AND CF.EMCO_COD_EMPR_COME=#codigoEmpresa#
							 AND CF.EST_CAMP ='1'
							 AND CF.IND_CAMP_ACTI = '1'
							 AND CF.COD_PERI=	#codigoPeriodo# ) as FECHPROC,
						 	 EST_COMP AS ESTCOMPRA							
					FROM EDU_GTT_APTAS_MIXTO_BLOQU
	</select>


    <parameterMap id="updateEnvioHistoricoAptasParams" class="map" >
		<parameter property="codigoPais"                jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoEmpresa"             jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoPeriodo"             jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="numeroLote"             	jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="usuario.login"             jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
    </parameterMap>

    <procedure id="updateEnvioHistoricoAptas" 
   			  parameterMap="updateEnvioHistoricoAptasParams" >
		{call EDU_PKG_PROCE_COMER.EDU_PR_ACTUA_ENVIO_APTAS(?,?,?,?,?)}
    </procedure>  

    <procedure id="updateEnvioHistoricoAptasCosto" 
   			  parameterMap="updateEnvioHistoricoAptasParams" >
		{call EDU_PKG_PROCE_COMER.EDU_PR_ACTUA_ENVIO_APTAS_COSTO(?,?,?,?,?)}
    </procedure>  

    <parameterMap id="updateEnvioBeneficiosParams" class="map" >
		<parameter property="codigoPais"                jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoEmpresa"             jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoPeriodo"             	jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="usuario.login"             jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
    </parameterMap>

    <procedure id="updateEnvioBeneficios" 
   			  parameterMap="updateEnvioBeneficiosParams" >
		{call EDU_PKG_PROCE_COMER.EDU_PR_ACTUA_ENVIO_CLASI(?,?,?,?)}
    </procedure>  

    <parameterMap id="updateCargarBeneficiosParams" class="map" >
		<parameter property="codigoPais"                jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoEmpresa"             jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoPeriodo"             	jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="usuario.login"             jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
    </parameterMap>

    <procedure id="updateCargarBeneficios" 
   			  parameterMap="updateCargarBeneficiosParams" >
		{call EDU_PKG_PROCE_COMER.EDU_PR_ACTUA_BENEF_CLASI(?,?,?,?)}
    </procedure>  

    <parameterMap id="updateEnvioHistoricoAptasProgramadasParams" class="map" >
		<parameter property="codigoPais"                jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoEmpresa"             jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoPeriodo"             jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="numeroLote"             	jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="usuario.login"             jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
    </parameterMap>

    <procedure id="updateEnvioHistoricoAptasProgramadas" 
   			  parameterMap="updateEnvioHistoricoAptasProgramadasParams" >
		{call EDU_PKG_PROCE_COMER.EDU_PR_ACTUA_ENVIO_APTAS_PROGR(?,?,?,?,?)}
    </procedure>  

   <resultMap id="resultConsultorasAptasporProgramar" class="java.util.HashMap">
        <result property="codigoCliente"           column="CLIENTE"/>
        <result property="codigoCurso"        	   column="CURSO"/>
        <result property="codigoMensaje"        column="MENSAJE"/>
    </resultMap>

    <select id="getConsultorasAptasporProgramar" parameterClass="java.util.Map" resultMap="resultConsultorasAptasporProgramar">
					SELECT 
							APTAS.CCAP_COD_CURS_CAPA CURSO, 
							APTAS.CLIE_COD_CLIE      CLIENTE ,
							''			as MENSAJE
					FROM EDU_HISTO_APTAS APTAS
						WHERE 
							APTAS.PAIS_COD_PAIS =  #codigoPais# and
							APTAS.EMCO_COD_EMPR_COME =  #codigoEmpresa# 
						<isEmpty prepend="AND" property="tipoProceso">
							    APTAS.EST_CAPA='PP' 
							AND APTAS.IND_ENVI_PROG = 'N'
			            </isEmpty>	 
						<isNotEmpty prepend="AND" property="tipoProceso">
							    APTAS.EST_CAPA='PP' 
							AND APTAS.IND_ENVI_PROG = 'S'
    						AND APTAS.NUM_LOTE_REGI=#numeroLote# 	
			            </isNotEmpty>	 
					<isEmpty prepend="AND" property="tipoProceso">
				         (APTAS.IND_CURS_COST='N' OR (APTAS.IND_CURS_COST='S' AND APTAS.IND_CURS_FACT = 'F'))
				        AND ((APTAS.IND_CURS_COST='N' AND APTAS.CAM_ULTI_CALI_APTA=#codigoPeriodo#) OR (APTAS.IND_CURS_COST='S' AND APTAS.CAM_ACEP=#codigoPeriodo#)) 
  					</isEmpty>	
			<isEmpty prepend="AND" property="indicadorCierreCampana">
			      	    EXISTS (SELECT NULL FROM EDU_MAEST_CLIEN CL WHERE CL.PAIS_COD_PAIS = APTAS.PAIS_COD_PAIS AND 
                         CL.EMCO_COD_EMPR_COME = APTAS.EMCO_COD_EMPR_COME AND CL.COD_CLIE = APTAS.CLIE_COD_CLIE  
                      					<iterate prepend="AND" property="regionList" open="(" close=")" conjunction="OR">
                      							CL.COD_REGI=#regionList[]#
                      					</iterate>   )
            </isEmpty>	 
	</select>	

	<insert id="insertTemporalAptasporProgramar" parameterClass="java.util.Map">
		  INSERT INTO EDU_TMP_PLANI_PROGR_CURSO (
   					COD_PAIS, 
   					COD_EMPR_COME, 
   					COD_CURS_CAPA, 
   					COD_CLIE, 
   					COD_PLAN_PROG)
		  VALUES ( 
					#codigoPais#,	                        
					#codigoEmpresa#,                        
					#codigoCurso# ,                        
					#codigoCliente#,                      
					#codigoPlanilla#)
	</insert>

	<insert id="insertMaestroProgramacionCursos" parameterClass="java.util.Map">
		  INSERT INTO EDU_PLANI_PROGR_CURSO (
   					PAIS_COD_PAIS, 
   					EMCO_COD_EMPR_COME, 
   					CCAP_COD_CURS_CAPA, 
   					CLIE_COD_CLIE,
					CAM_PROC ,
					TIP_CALI_APTA ,
					IND_CURS_COST ,
					USU_DIGI		,
					FEC_DIGI		,
					EST_REGI )
				SELECT 
							APTAS.PAIS_COD_PAIS, 
							APTAS.EMCO_COD_EMPR_COME, 
							APTAS.CCAP_COD_CURS_CAPA, 
							APTAS.CLIE_COD_CLIE ,
							#codigoPeriodo# ,
							APTAS.TIP_CALI_APTA ,
							APTAS.IND_CURS_COST ,
							#codusuario# ,                        
							sysdate ,                                
							'P'
						FROM EDU_HISTO_APTAS APTAS
							WHERE 
							APTAS.PAIS_COD_PAIS =  #codigoPais# and
							APTAS.EMCO_COD_EMPR_COME =  #codigoEmpresa# and
							APTAS.EST_CAPA='PP' 
							and APTAS.IND_ENVI_PROG = 'N'
					        AND (APTAS.IND_CURS_COST='N' OR (APTAS.IND_CURS_COST='S' AND APTAS.IND_CURS_FACT = 'F'))
					        AND ((APTAS.IND_CURS_COST='N' AND APTAS.CAM_ULTI_CALI_APTA=#codigoPeriodo#) OR (APTAS.IND_CURS_COST='S' AND APTAS.CAM_ACEP=#codigoPeriodo#)) 
        			<isEmpty prepend="AND" property="indicadorCierreCampana">
				      	    EXISTS (SELECT NULL FROM EDU_MAEST_CLIEN CL WHERE CL.PAIS_COD_PAIS = APTAS.PAIS_COD_PAIS AND 
                	         CL.EMCO_COD_EMPR_COME = APTAS.EMCO_COD_EMPR_COME AND CL.COD_CLIE = APTAS.CLIE_COD_CLIE  
                    				<iterate prepend="AND" property="regionList" open="(" close=")" conjunction="OR">
                      							CL.COD_REGI=#regionList[]#
                    				</iterate>   )
                     </isEmpty>	 
	</insert>

    <select id="getResultCierreFacturacion" parameterClass="java.util.Map" resultMap="resultCierreFacturacion">
						SELECT 
						       CABEC.CLIE_COD_CLIE AS CLIENTE,
						       CABEC.NIV_CAPA_ALCA AS NIV_CAPA,
						       APTAS.EST_CAPA      AS EST_CAPA,
						       CABEC.NIV_CAPA_ALCA +
						       PARAM.VAL_INCR_CODI AS VAL_CAPA
						 FROM EDU_HISTO_CAPAC_CABEC CABEC, 
						              EDU_HISTO_APTAS APTAS,
						              EDU_PARAM_PROGR_CAPAC PARAM
						WHERE CABEC.PAIS_COD_PAIS=APTAS.PAIS_COD_PAIS AND
						      CABEC.EMCO_COD_EMPR_COME=APTAS.EMCO_COD_EMPR_COME AND
						      CABEC.CLIE_COD_CLIE=APTAS.CLIE_COD_CLIE AND
						      PARAM.PAIS_COD_PAIS=APTAS.PAIS_COD_PAIS AND
						      PARAM.EMCO_COD_EMPR_COME=APTAS.EMCO_COD_EMPR_COME AND
						      PARAM.COD_CURS_INIC=APTAS.CCAP_COD_CURS_CAPA
	</select>	

    <select id="getResultBeneficiosCapacitadas" parameterClass="java.util.Map" resultMap="resultTotalBeneficiosCapacitadas">
				    SELECT T.PAIS_COD_PAIS as CODPAIS,
						   T.CLAS_COD_CLAS, 
						   T.CLIE_COD_CLIE,
					       T.NIV_CAPA_ALCA,
						   EDU_PKG_PROCE_GENER.EDU_FN_DEVUE_CODIG_MENSA(
								T.PAIS_COD_PAIS,
								T.EMCO_COD_EMPR_COME,
								#indicadorEquivalenciaMensaje#,
								'1',
								T.NIV_CAPA_ALCA,
								A.est_capa,
								A.num_invi,
								A.CLIE_COD_CLIE) AS COD_MENS_GRAL,	
						  EDU_PKG_PROCE_GENER.EDU_FN_DEVUE_CODIG_MENSA(
								T.PAIS_COD_PAIS,
								T.EMCO_COD_EMPR_COME,
								#indicadorEquivalenciaMensaje#,
								'2',
								T.NIV_CAPA_ALCA,
								A.est_capa,
								A.num_invi,
								A.CLIE_COD_CLIE) AS COD_MENS_ESPE
					FROM EDU_HISTO_CLASI_BENEF_DETAL T ,
						 EDU_HISTO_APTAS A,
						 EDU_TMP_PEDID_CONSU E
					WHERE T.PAIS_COD_PAIS 	   =#codigoPais#    AND
  		      			  T.EMCO_COD_EMPR_COME =#codigoEmpresa# AND
		      			  T.HBEC_CAM_PROC      =#campanaProceso# AND
						  T.IND_DESP_CLAS		   = '0'
						  AND T.PAIS_COD_PAIS=A.PAIS_COD_PAIS
						  AND T.EMCO_COD_EMPR_COME=A.EMCO_COD_EMPR_COME
				  	      AND T.NIV_CAPA_ALCA=A.CCAP_COD_CURS_CAPA
                    	  AND T.CLIE_COD_CLIE=A.CLIE_COD_CLIE
						  AND E.COD_PAIS = A.PAIS_COD_PAIS
						  AND E.COD_EMPR_COME = A.EMCO_COD_EMPR_COME
						  AND E.COD_CLIE = A.CLIE_COD_CLIE 
						  AND E.CAM_PROC = #campanaProceso#						  
	</select>	

   <select id="getResultBeneficiosCapacitadasxDespacho" parameterClass="java.util.Map" resultMap="resultTotalBeneficiosCapacitadas">
				    SELECT T.PAIS_COD_PAIS as CODPAIS,
						   T.CLAS_COD_CLAS, 
						   T.CLIE_COD_CLIE,
					       T.NIV_CAPA_ALCA,
						   EDU_PKG_PROCE_GENER.EDU_FN_DEVUE_CODIG_MENSA(
								T.PAIS_COD_PAIS,
								T.EMCO_COD_EMPR_COME,
								#indicadorEquivalenciaMensaje#,
								'1',
								T.NIV_CAPA_ALCA,
								A.est_capa,
								A.num_invi,
								A.CLIE_COD_CLIE) AS COD_MENS_GRAL,	
						  EDU_PKG_PROCE_GENER.EDU_FN_DEVUE_CODIG_MENSA(
								T.PAIS_COD_PAIS,
								T.EMCO_COD_EMPR_COME,
								#indicadorEquivalenciaMensaje#,
								'2',
								T.NIV_CAPA_ALCA,
								A.est_capa,
								A.num_invi,
								A.CLIE_COD_CLIE) AS COD_MENS_ESPE
					FROM EDU_HISTO_CLASI_BENEF_DETAL T ,
						 EDU_HISTO_APTAS A
					WHERE T.PAIS_COD_PAIS  = #codigoPais#   
  		      			  AND T.EMCO_COD_EMPR_COME = #codigoEmpresa# 
						  AND T.IND_DESP_CLAS = '0'	
						  AND T.PAIS_COD_PAIS = A.PAIS_COD_PAIS
						  AND T.EMCO_COD_EMPR_COME = A.EMCO_COD_EMPR_COME
				  	      AND T.NIV_CAPA_ALCA = A.CCAP_COD_CURS_CAPA
                    	  AND T.CLIE_COD_CLIE = A.CLIE_COD_CLIE
	</select>	


	<delete id="deleteHistoricoBloqueoConsultoraTemporal" parameterClass="java.util.Map" >
				DELETE
				FROM EDU_GTT_HISTO_BLOQU_CONSU T
	</delete>


	<select id="getHistoricoBloqueoConsultoraTemporal" parameterClass="java.util.Map" resultMap="resultHistoricoBloqueoConsultoraTemporal">
				SELECT COD_PAIS,
					   COD_CLIE, 
                       CAM_PROC
				FROM EDU_GTT_HISTO_BLOQU_CONSU T 
				WHERE T.COD_PAIS  = #codigoPais#  AND
  		      		  T.COD_EMPR_COME = (CASE WHEN #codigoEmpresa# IS NULL THEN 
									        (SELECT COD_EMPR_COME 
									         FROM EDU_EMPRE_COMER
									         WHERE PAIS_COD_PAIS = #codigoPais#)
									    ELSE
									       #codigoEmpresa#
									    END)
	</select>	

    <select id="getGenerarPlanillaProgramacion" parameterClass="java.util.Map" resultMap="resultGenerarPlanillaProgramacion">
	  SELECT DISTINCT
    		A.PAIS_COD_PAIS,      
		    A.EMCO_COD_EMPR_COME, 
			A.CAM_PROC,	
		    E.REGI_COD_REGI,
		    A.CCAP_COD_CURS_CAPA, 
		    A.CLIE_COD_CLIE      
	  FROM           
	     	 EDU_PLANI_PROGR_CURSO A,
		     EDU_HISTO_PLANI_INSTR E
	  WHERE A.PAIS_COD_PAIS = #codigoPais#       
	    AND A.EMCO_COD_EMPR_COME = #codigoEmpresa#
		AND A.CAM_PROC = #campanhaProceso#
		<iterate prepend="AND" property="regionList" open="(" close=")" conjunction="OR">
              E.REGI_COD_REGI = #regionList[]#
		</iterate>   
		AND E.PAIS_COD_PAIS      = A.PAIS_COD_PAIS
	    AND E.EMCO_COD_EMPR_COME = A.EMCO_COD_EMPR_COME
	    AND E.CCAP_COD_CURS_CAPA = A.CCAP_COD_CURS_CAPA
	    AND E.COD_PLAN_PROG      = A.COD_PLAN_PROG
  
     ORDER BY
 	     A.CCAP_COD_CURS_CAPA,
         E.REGI_COD_REGI,
         A.CLIE_COD_CLIE
	</select>

   <parameterMap id="executeInsertaEquivalenciaClasificacionParams" class="java.util.Map" >
		<parameter property="codigoPais"                jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoEmpresa"             jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>		
		<parameter property="codigoPeriodo"             jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoCliente"             jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoCurso"               jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoClasificacion"       jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="indicadorEnviaInvit"       jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
   </parameterMap>

   <procedure id="executeInsertaEquivalenciaClasificacion" parameterMap="executeInsertaEquivalenciaClasificacionParams" >
		{call EDU_PKG_PROCE_COMER.EDU_PR_INSER_EQUIV_CLASI_TEMPO(?, ?, ?, ?, ?, ?,?)}
   </procedure>     


   <insert id="insertMigracionComercialConsultoraTemporal" parameterClass="java.util.Map">
		  INSERT INTO EDU_TMP_MIGRA_CLIEN (
   			COD_PAIS, COD_EMPR_COME, CAM_PROC, COD_CLIE, 
			APE_PATE, APE_MATE, PRI_NOMB, SEG_NOMB, 
			FEC_NACI, IND_MORO, COD_REGI, COD_ZONA, 
			COD_SECC, COD_TERR, NUM_TELE, NUM_CELU, 
			SAL_CLIE  )
		  VALUES ( 	
			#codigoPais#, #codigoEmpresa#, #codigoPeriodo#, #codigoCliente#,
			#apellidoPaterno#, #apellidoMaterno#, #primerNombre#, #segundoNombre#,                        
			#fechaNacimiento#, #indicadorMorosidad#, #codigoRegion#, #codigoZona#,                     
			#codigoSeccion#, #codigoTerritorio#, #telefono#, #telefonoCelular#,
			#saldoCliente#
		  )
	</insert>

	<select id="esCursoNoPrimerPedido" parameterClass="java.util.Map" resultClass="int">
		SELECT COUNT(1) 
		FROM EDU_PARAM_CURSO_CAPAC A
		WHERE A.PAIS_COD_PAIS  = #codigoPais# 
		  AND A.EMCO_COD_EMPR_COME = #codigoEmpresa#
		  AND A.COD_CURS_CAPA = #codigoCurso#
		  AND A.STA_CLIE != 'N'
	</select>

	<select id="getListaCursosByTipoCurso" parameterClass="java.util.Map" resultClass="java.lang.String">
		SELECT  A.COD_CURS_CAPA  
		FROM EDU_PARAM_CURSO_CAPAC A
		WHERE A.PAIS_COD_PAIS  = #codigoPais#  
		  AND A.EMCO_COD_EMPR_COME = #codigoEmpresa#
		  AND A.TICC_COD_TIPO_COST_CURS=#tipoCostoCurso#
	</select>


 <parameterMap id="executeProcesoConsultorasCompraCursoCostoParams" class="java.util.Map" >
		<parameter property="codigoPais"                jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoEmpresa"             jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>		
		<parameter property="codigoPeriodo"             jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
   </parameterMap>

   <procedure id="executeProcesoConsultorasCompraCursoCosto" parameterMap="executeProcesoConsultorasCompraCursoCostoParams" >
		{call EDU_PKG_PROCE_COMER.EDU_PR_ENVIO_CONSU_COMPR_CURSO(?, ?, ?)}
   </procedure>     


    <select id="getConsultorasConfirmCursoCosto" parameterClass="java.util.Map" resultMap="resultAptasCosto">
					SELECT 
						   APTAS.PAIS_COD_PAIS as  CODPAIS ,
						   APTAS.EMCO_COD_EMPR_COME as  CODEMP ,
						   #codigoPeriodo# AS CAMPROC,		
					       APTAS.CLIE_COD_CLIE CLIENTE,
						   EDU_PKG_PROCE_GENER.EDU_FN_DEVUE_NOMBR_CONSU(
								aptas.pais_cod_pais,
								aptas.emco_cod_empr_come,
								aptas.clie_cod_clie,
								#indicadorNombreCompleto#) as NOMCON,							
					       CAPAC.COD_CURS_CAPA CURSO ,
						   APTAS.CAM_ULTI_CALI_APTA as CAMPINI ,
						   EDU_PKG_PROCE_COMER.GEN_FN_DEVUE_NSGTE_CAMPA(APTAS.CAM_ULTI_CALI_APTA, decode(1,NUM_CAMP_PREV_CALI,0,1) ) as CAMPLIM ,
						   EDU_PKG_PROCE_GENER.EDU_FN_DEVUE_CODIG_MENSA(
								aptas.pais_cod_pais,
								aptas.emco_cod_empr_come,
								#indicadorEquivalenciaMensaje#,
								'2',
								aptas.ccap_cod_curs_capa,
								aptas.est_capa,
								aptas.num_invi,	
								APTAS.CLIE_COD_CLIE) AS MSGESP,
						   EDU_PKG_PROCE_GENER.EDU_FN_DEVUE_CODIG_MENSA(
								aptas.pais_cod_pais,
								aptas.emco_cod_empr_come,
								#indicadorEquivalenciaMensaje#,
								'1',
								aptas.ccap_cod_curs_capa,
								aptas.est_capa,
								aptas.num_invi,
								APTAS.CLIE_COD_CLIE) AS MSGGEN,
						  NVL((select t.cod_clas from edu_param_clasi_benef_capac t where 
         							t.pais_cod_pais = aptas.pais_cod_pais and
         							t.emco_cod_empr_come = aptas.emco_cod_empr_come and
         							t.niv_capa_alca = aptas.ccap_cod_curs_capa and
         							t.tip_clas = 'I' and
         							t.tip_curs = 'C' and 
         							t.est_clas = 'A' and
         							t.est_regi != 9 ),' ') as CODCLAS,
						  ' ' as CODVENT,		
						  #codusuario# AS CODUSUA,
						  ( SELECT NVL(TO_CHAR(CF.FEC_PROC,'dd/MM/yyyy'),'')
							FROM EDU_CONTR_FACTU CF
							WHERE CF.PAIS_COD_PAIS=#codigoPais#
							 AND CF.EMCO_COD_EMPR_COME=#codigoEmpresa#
							 AND CF.EST_CAMP ='1'
							 AND CF.IND_CAMP_ACTI = '1'
							AND CF.COD_PERI=	#codigoPeriodo# ) as FECHPROC,
							DECODE(1,CAPAC.NUM_CAMP_PREV_CALI,'C','E')  AS ESTCOMPRA
					     FROM  EDU_HISTO_APTAS APTAS , EDU_PARAM_CURSO_CAPAC CAPAC,
						 	   EDU_TMP_PEDID_CONSU E 				   
					     WHERE 
							APTAS.PAIS_COD_PAIS =  #codigoPais#
							AND APTAS.EMCO_COD_EMPR_COME =  #codigoEmpresa#
							AND (APTAS.EST_CAPA='PO' OR APTAS.EST_CAPA='FC')
							AND CAPAC.TICC_COD_TIPO_COST_CURS = '02'
							AND EDU_PKG_PROCE_COMER.GEN_FN_DEVUE_NSGTE_CAMPA(#codigoPeriodo#,DECODE(1,CAPAC.NUM_CAMP_PREV_CALI,0,-1))= 
									EDU_PKG_PROCE_COMER.GEN_FN_DEVUE_NSGTE_CAMPA(CAPAC.CAM_INIC,-1*TO_NUMBER(CAPAC.NUM_CAMP_PREV_CALI))
							AND APTAS.PAIS_COD_PAIS = CAPAC.PAIS_COD_PAIS
							AND APTAS.EMCO_COD_EMPR_COME = CAPAC.EMCO_COD_EMPR_COME
							AND CAPAC.COD_CURS_CAPA= APTAS.CCAP_COD_CURS_CAPA	
							AND APTAS.EST_REGI='1'
							AND E.COD_PAIS = APTAS.PAIS_COD_PAIS
						    AND E.COD_EMPR_COME = APTAS.EMCO_COD_EMPR_COME
							AND E.COD_CLIE = APTAS.CLIE_COD_CLIE 
							AND E.CAM_PROC = #codigoPeriodo#
	</select>	


    <resultMap id="resultPedidosCursosMap" class="java.util.HashMap">
        <result property="codigoPeriodo" column="EDCAMPRC"/>
        <result property="codigoCliente" column="EDCODCLI"/>
		<result property="codigoCurso" column="EDSCODCUR"/>
        <result property="indicadorCompra" column="EDSINDCMP"/>
        <result property="fechafacturacion" column="EDFECFAC"/>
    </resultMap>


	<select id="getPedidosCursosNoFacturadosMixtoYCosto" parameterClass="java.util.Map" resultMap="resultPedidosCursosMap">

					  SELECT #codigoPeriodo# AS EDCAMPRC, 
									 A.CLIE_COD_CLIE AS EDCODCLI, 
									 A.CCAP_COD_CURS_CAPA AS EDSCODCUR, 
									 '0' AS EDSINDCMP ,
									  NULL AS EDFECFAC
					  FROM  EDU_HISTO_APTAS A , EDU_PARAM_CURSO_CAPAC C 				   
					  WHERE	A.PAIS_COD_PAIS = #codigoPais#
								AND A.EMCO_COD_EMPR_COME =  #codigoEmpresa#
								AND A.EST_CAPA='PO' 
								AND C.TICC_COD_TIPO_COST_CURS = '02'
								AND EDU_PKG_PROCE_COMER.GEN_FN_DEVUE_NSGTE_CAMPA(#codigoPeriodo#,DECODE(1,C.NUM_CAMP_PREV_CALI,0,-1))= 
										EDU_PKG_PROCE_COMER.GEN_FN_DEVUE_NSGTE_CAMPA(C.CAM_INIC,-1*TO_NUMBER(C.NUM_CAMP_PREV_CALI))
								AND A.PAIS_COD_PAIS = C.PAIS_COD_PAIS
								AND A.EMCO_COD_EMPR_COME = C.EMCO_COD_EMPR_COME
								AND C.COD_CURS_CAPA= A.CCAP_COD_CURS_CAPA	
								AND A.EST_REGI='1'							
					  UNION
					  SELECT A.CAM_ULTI_CALI_APTA  AS EDCAMPRC, 
									 A.CLIE_COD_CLIE AS EDCODCLI, 
									 A.CCAP_COD_CURS_CAPA AS EDSCODCUR, 
									 '0' AS EDSINDCMP ,
									  NULL AS EDFECFAC
					  FROM  EDU_HISTO_APTAS A , EDU_PARAM_CURSO_CAPAC C 				   
					  WHERE A.PAIS_COD_PAIS =  #codigoPais#
								AND A.EMCO_COD_EMPR_COME =  #codigoEmpresa#
								AND A.EST_CAPA='PO' 
								AND C.TICC_COD_TIPO_COST_CURS = '03'
								AND A.CAM_ULTI_CALI_APTA=#codigoPeriodo#
								AND A.PAIS_COD_PAIS = C.PAIS_COD_PAIS
								AND A.EMCO_COD_EMPR_COME = C.EMCO_COD_EMPR_COME
								AND C.COD_CURS_CAPA= A.CCAP_COD_CURS_CAPA	
								AND A.EST_REGI='1'	
	</select>	


	<select id="getPedidosCursosNoFacturadosMixto" parameterClass="java.util.Map" resultMap="resultPedidosCursosMap">
					  SELECT A.CAM_ULTI_CALI_APTA  AS EDCAMPRC, 
									 A.CLIE_COD_CLIE AS EDCODCLI, 
									 A.CCAP_COD_CURS_CAPA AS EDSCODCUR, 
									 '0' AS EDSINDCMP ,
									  NULL AS EDFECFAC
					  FROM  EDU_HISTO_APTAS A , EDU_PARAM_CURSO_CAPAC C 				   
					  WHERE A.PAIS_COD_PAIS =  #codigoPais#
								AND A.EMCO_COD_EMPR_COME =  #codigoEmpresa#
								AND A.EST_CAPA='PO' 
								AND C.TICC_COD_TIPO_COST_CURS = '03'
								AND A.CAM_ULTI_CALI_APTA=#codigoPeriodo#
								AND A.PAIS_COD_PAIS = C.PAIS_COD_PAIS
								AND A.EMCO_COD_EMPR_COME = C.EMCO_COD_EMPR_COME
								AND C.COD_CURS_CAPA= A.CCAP_COD_CURS_CAPA	
								AND A.EST_REGI='1'	
	</select>	

	<delete id="deleteTemporalPedidosCUV" parameterClass="java.util.Map">
		delete from EDU_TMP_CONSU_SOLIC_CURSO 
		where COD_PAIS=#codigoPais#
			and COD_EMPR_COME= #codigoEmpresa#
    </delete>

	<insert id="insertPedidosConsultoraCUV" parameterClass="java.util.Map">
		INSERT INTO EDU_TMP_CONSU_SOLIC_CURSO (
				COD_PAIS	,
				COD_EMPR_COME	,
				CAM_PROC	,
				COD_CLIE	,
				IND_FACT	,
				IND_PEDI	        ,
				FEC_RECE	,
				FEC_FACT	,
				COD_REGI	,
				COD_ZONA	,
				APE_PATE	,
				APE_MATE	,
				APE_CASA	,
				PRI_NOMB	,
				SEG_NOMB	,
				NUM_DOCU	,
				FEC_NACI	,
				NUM_TELE_PART	,
				IND_MORO	,
				SAL_CLIE	,
				COD_SECC	,
				COD_TERR	,
				NUM_CELU	,
			  	COD_DEPA	,
				COD_MUNI	,
				DES_POBL    ,
				CAM_INGR_COME						
					 ) 
				 VALUES 
				 (#codigoPais#,
				  #codigoEmpresa#,
				  #codigoPeriodo#,
				  #codigoCliente#,
				  #indicadorFacturacion#,
				  #indicadorPedido# ,
				  to_date(#fechaRecepcion#,'dd/mm/yyyy') ,
			  	  to_date(#fechafacturacion#,'dd/mm/yyyy') ,
				#codRegion#     ,                        
				#codZona#	,                        
				#codPra#        ,                        
				#codSea#        ,                        
				''		,                        
				#codPrn#        ,                        
				#codSen#        ,                        
				#codRocta#      ,                        
				to_date(#fecha#, 'dd/mm/yyyy')       , 
				#codCotel#      ,                        
				#codMor#        ,                        
				#codSac#        ,
				#codSeccion#        ,                        
				#codTerritorio#      ,
				#telefono#,
				#codigoDpto#,
				#codigoMuni#,
				#descPoblacion#,
				#campIngresoComercial#) 				 		
	</insert>

	<insert id="insertPedidosConsultoraNombreCompletoCUV" parameterClass="java.util.Map">
		INSERT INTO EDU_TMP_CONSU_SOLIC_CURSO (
				COD_PAIS	,
				COD_EMPR_COME	,
				CAM_PROC	,
				COD_CLIE	,
				IND_FACT	,
				IND_PEDI	        ,
				FEC_RECE	,
				FEC_FACT	,
				COD_REGI	,
				COD_ZONA	,
				APE_NOMB_COMP,
				NUM_DOCU	,
				FEC_NACI	,
				NUM_TELE_PART	,
				IND_MORO	,
				SAL_CLIE	,
				COD_SECC	,
				COD_TERR	,
				NUM_CELU	,
			    CAM_INGR_COME			  								
				 ) 
			 VALUES 
				 (#codigoPais#,
				  #codigoEmpresa#,
				  #codigoPeriodo#,
				  #codigoCliente#,
				  #indicadorFacturacion#,
				  #indicadorPedido# ,
				  to_date(#fechaRecepcion#,'dd/mm/yyyy') ,
			  	  to_date(#fechafacturacion#,'dd/mm/yyyy') ,
				#codRegion#     ,                        
				#codZona#	,                        
				#nombreCompleto#,                       
				#codRocta#      ,                        
				to_date(#fecha#, 'dd/mm/yyyy')       , 
				#codCotel#      ,                        
				#codMor#        ,                        
				#codSac#        ,
				#codSeccion#        ,                        
				#codTerritorio#      ,
				#telefono#,
				#campIngresoComercial#
					) 				 		
	</insert>

    <select id="validaExecuteProcesoCalificacion" parameterClass="java.util.Map" resultClass="int">
	       SELECT COUNT(1) 
			FROM EDU_HISTO_APTAS A
			WHERE A.PAIS_COD_PAIS = #codigoPais#
			 AND A.EMCO_COD_EMPR_COME = #codigoEmpresa#
			 AND (A.EST_CAPA ='PF' OR A.EST_CAPA ='FC' OR A.EST_CAPA='PO')
			 AND A.CAM_ULTI_CALI_APTA = #codigoPeriodo#
	</select>

	<delete id="deleteRegionesACerrar" parameterClass="java.util.Map">
		DELETE FROM EDU_GTT_REGIO_CIERR
        WHERE COD_PAIS=#codigoPais#
 			AND COD_EMPR_COME = #codigoEmpresa#
   </delete>

 <insert id="insertarRegionesACerrar" parameterClass="java.util.Map">
	   INSERT INTO EDU_GTT_REGIO_CIERR
			(COD_PAIS,COD_EMPR_COME,COD_REGI)
		VALUES
			(#codigoPais#,#codigoEmpresa#,#codigoRegion#)
	</insert>

    <select id="getValidaCampanha" parameterClass="java.util.Map" resultClass="int">
			SELECT COUNT(1)
			FROM EDU_TMP_CONTR_FACTU A, EDU_CONTR_FACTU B
			WHERE A.COD_PAIS =#codigoPais#
			 AND A.COD_EMPR_COME = #codigoEmpresa# 
			 AND A.EST_CAMP ='1'
			 AND A.IND_CAMP_ACTI = '1'
			 AND A.COD_PAIS = B.PAIS_COD_PAIS
			 AND A.COD_EMPR_COME = B.EMCO_COD_EMPR_COME
			 AND A.COD_PERI = B.COD_PERI
			 AND A.EST_CAMP = B.EST_CAMP
			 AND A.IND_CAMP_ACTI = B.IND_CAMP_ACTI
	</select>

    <procedure id="updateToControlFacturacion" 
   			  parameterMap="updateControlFacturacionParams" >
		{call EDU_PKG_PROCE_COMER.EDU_PR_ACTUA_CONTR_FACTU(?,?,?)}
    </procedure> 

	<select id="getHistoricoBloqueoConsultora" parameterClass="java.util.Map" resultMap="resultHistoricoBloqueoConsultoraTemporal">
				SELECT T.PAIS_COD_PAIS COD_PAIS,
					   T.CLIE_COD_CLIE COD_CLIE, 
                       T.CAM_PROC
				FROM EDU_HISTO_BLOQU_CONSU T 
				WHERE T.PAIS_COD_PAIS  = #codigoPais#
  		      		  AND T.EMCO_COD_EMPR_COME = (CASE WHEN #codigoEmpresa# IS NULL THEN 
											        (SELECT COD_EMPR_COME 
											         FROM EDU_EMPRE_COMER
											         WHERE PAIS_COD_PAIS = #codigoPais#)
											     ELSE
											       #codigoEmpresa#
											     END)
  		      		  AND T.EST_BLOQ='B' 
	</select>	
</sqlMap>