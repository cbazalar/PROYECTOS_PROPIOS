<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
    PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN"
    "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="spusicc.MantenimientoPRESQL">

	<typeAlias alias="baseGenerico"    	type="biz.belcorp.ssicc.dao.sisicc.model.Base"/>
	<typeAlias alias="baseGenericoOid"    	type="biz.belcorp.ssicc.dao.sisicc.model.BaseOID"/>
	<typeAlias alias="codigoVentaMod" 	type="biz.belcorp.ssicc.dao.spusicc.model.CodigoVentaMod"/>
	<typeAlias alias="matrizRecuperacion" 	type="biz.belcorp.ssicc.dao.spusicc.pre.model.MatrizRecuperacion"/>
	<typeAlias alias="matrizRecuperacionAuditoria" 	type="biz.belcorp.ssicc.dao.spusicc.pre.model.MatrizRecuperacionAuditoria"/>
	<typeAlias alias="productoMatriz" 	type="biz.belcorp.ssicc.dao.spusicc.pre.model.ProductoMatriz"/>
	<typeAlias alias="matrizAlternativo" 	type="biz.belcorp.ssicc.dao.spusicc.pre.model.MatrizAlternativo"/>
	<typeAlias alias="matrizAlternativoAuditoria" 	type="biz.belcorp.ssicc.dao.spusicc.pre.model.MatrizAlternativoAuditoria"/>
	<typeAlias alias="tiposReemplazo" type="biz.belcorp.ssicc.dao.spusicc.model.TiposReemplazo"/>
	 
    <resultMap id="baseResult"          class="baseGenerico">
    	<result property="codigo" 		column="CODIGO" 	/>
    	<result property="descripcion" 	column="DESCRIPCION"/>
    </resultMap>
    
    <resultMap id="baseResultOid"       class="baseGenericoOid">
    	<result property="oid" 			column="OID" 	/>
    	<result property="descripcion" 	column="DESCRIPCION"/>
    </resultMap>
	
	<select id="getTipoOfertaList" parameterClass="java.util.Map" resultMap="baseResult">
	    SELECT a.cod_tipo_ofer as CODIGO,
	    	   b.val_i18n as DESCRIPCION
		  FROM pre_tipo_ofert a, 
       		   gen_i18n_sicc_comun b 
	     WHERE a.oid_tipo_ofer=b.val_oid 
           AND b.attr_enti='PRE_TIPO_OFERT'
	</select>
	
	<select id="getTipoVarianteList" parameterClass="java.util.Map" resultMap="baseResult">
	  SELECT cod_vari as CODIGO,
	  		 des_vari as DESCRIPCION 
	    FROM pre_varia
	</select>

	<select id="getFormaPagoList" parameterClass="java.util.Map" resultMap="baseResult">
		SELECT	pag.cod_form_pago as CODIGO, 
       			i18n.val_i18n     as DESCRIPCION
  		   FROM bel_forma_pago pag, 
       			v_gen_i18n_sicc i18n
 	      WHERE pag.oid_form_pago = i18n.val_oid
            AND i18n.idio_oid_idio = 1
   		    AND i18n.attr_enti = 'BEL_FORMA_PAGO'
   			AND pag.pais_oid_pais = GEN_PKG_GENER.GEN_FN_DEVUELVE_ID_PAIS(#codigoPais#)
	</select>
	
	<resultMap class="java.util.HashMap" id="tipoClienteResult">
		<result property="codigo" 			column="OID"/>
		<result property="descripcion" 		column="DESCRIPCION"/>
	</resultMap>
	<select id="getTipoClienteList" resultMap="baseResult">
		SELECT	a.oid_tipo_clie as CODIGO,
				b.val_i18n 		as DESCRIPCION
  		   FROM mae_tipo_clien a, 
       			gen_i18n_sicc_comun b
 	      WHERE a.oid_tipo_clie=b.val_oid 
   			AND b.attr_enti = 'MAE_TIPO_CLIEN'
	</select>
	
	<select id="getSubTipoClienteList" parameterClass="java.util.Map" resultMap="baseResult">
		SELECT	a.cod_subt_clie as CODIGO, 
       			b.val_i18n      as DESCRIPCION
  		   FROM mae_subti_clien a, 
       			gen_i18n_sicc_comun b
 	      WHERE a.oid_subt_clie=b.val_oid 
   			AND b.attr_enti ='MAE_SUBTI_CLIEN' 
   			AND a.ticl_oid_tipo_clie = #oidTipoCliente# 
	</select>
		
	<select id="getTipoClasificacionList" parameterClass="java.util.Map" resultMap="baseResult">
		SELECT	a.cod_tipo_clas as CODIGO, 
       			b.val_i18n      as DESCRIPCION
  		   FROM mae_tipo_clasi_clien a, 
       			gen_i18n_sicc_comun b
 	      WHERE a.oid_tipo_clas=b.val_oid 
   			AND b.attr_enti = 'MAE_TIPO_CLASI_CLIEN'
   			AND a.sbti_oid_subt_clie = #oidSubTipoCliente# 
	</select>
	
	<select id="getClasificacionList" parameterClass="java.util.Map" resultMap="baseResult">
		SELECT	a.cod_clas 		as CODIGO, 
       			b.val_i18n      as DESCRIPCION
  		   FROM mae_clasi a, 
       			gen_i18n_sicc_comun b
 	      WHERE a.oid_clas=b.val_oid 
   			AND b.attr_enti = 'MAE_CLASI' 
   			AND a.tccl_oid_tipo_clas = #oidTipoClasificacion# 
	</select>
	
	<resultMap class="java.util.HashMap" id="estatusClienteResult">
		<result property="codigo" 			column="OID"/>
		<result property="descripcion" 		column="DESCRIPCION"/>
	</resultMap>
	<select id="getEstatusClienteList" resultMap="baseResult">
		SELECT	a.oid_esta_clie as CODIGO, 
       			b.val_i18n      as DESCRIPCION
  		   FROM mae_estat_clien a, 
       			gen_i18n_sicc_comun b
 	      WHERE a.oid_esta_clie = b.val_oid 
   			AND b.attr_enti = 'MAE_ESTAT_CLIEN' 
	</select>
		
	<select id="getOidVariante" parameterClass="java.util.Map" resultClass="string">
		SELECT oid_vari 
		  FROM pre_varia 
		 WHERE cod_vari = #codigoVariante#
	</select>
	
	<select id="getCodFormaPago" parameterClass="java.util.Map" resultClass="string">
		SELECT cod_form_pago
		  FROM bel_forma_pago
		 WHERE oid_form_pago = #oidFormaPago#
	</select>
	
	<resultMap id="codigoVentaResult"  class="java.util.HashMap"  >                                                                       
    	<result property="oidOferta"			column="OID_OFERTA"/>                                                                 
    	<result property="oidDetaOferta" 		column="OID_DETA_OFERTA"/>                                                             
    	<result property="desEstrategia" 		column="DES_ESTRATEGIA"/>
    	<result property="numOferta" 		column="NUM_OFERTA"/>
    	<result property="codigoVenta" 			column="COD_VENTA"/>                                                                        
    	<result property="codSap" 				column="COD_SAP"/>                                                                      
	    <result property="desSap" 				column="DES_SAP"/>
	    <result property="oidCatalogo" 	   	    column="OID_CATALOGO"/>
	    <result property="codCatalogo" 	   	    column="COD_CATALOGO"/>
	    <result property="desCatalogo" 			column="DES_CATALOGO"/>
	    <result property="oidFormaPago" 	   	column="OID_FORMA_PAGO"/>
	    <result property="codTipoOferta" 		column="COD_TIPO_OFERTA"/>
	    <result property="desTipoOferta" 		column="DES_TIPO_OFERTA"/>
	    <result property="numPagina" 			column="NUM_PAGINA"/>
	    <result property="facRepeticion" 		column="FAC_REPETICION"/>
	    <result property="preCatalogo" 			column="PRE_CATALOGO"/>
	    <result property="preContable" 			column="PRE_CONTABLE"/>
	    <result property="oidGrupoOferta" 			column="OID_GRUPO_OFERTA"/>
	    <result property="numGrupo" 			column="NUM_GRUPO"/>
	    <result property="tipGrupo" 			column="TIPO_GRUPO"/>
	    <result property="oidTipoEstrategia" 			column="OID_TIPO_ESTRATEGIA"/>
	    <result property="valTextoBreve" 	   	column="VAL_TEXT_BREV"/>
	    <result property="indDigitable" 	   	column="IND_DIGI"/>
	    <result property="indImprimible" 	   	column="IND_IMPR_GP"/>
	    <result property="impCosteEsta" 	   	column="IMP_COST_ESTA"/>
	    <result property="numUnidEstim" 	   	column="NUM_UNID_ESTI"/>
	    <result property="impVenNetaEstim" 	   	column="IMP_VENT_NETA_ESTI"/>
	    <result property="estado"		 	   	column="ESTADO"/>
	</resultMap>
	
	<select id="getCodigoVentaList" parameterClass="java.util.Map" resultMap="codigoVentaResult">
		SELECT 
			oid_ofer OID_OFERTA, 
			oid_deta_ofer OID_DETA_OFERTA, 
			i.val_i18n DES_ESTRATEGIA,
			a.num_ofer NUM_OFERTA, 
			b.val_codi_vent COD_VENTA, 
			f.cod_sap COD_SAP, 
			g.val_i18n DES_SAP, 
			b.ocat_oid_catal OID_CATALOGO, 
			j.cod_cata COD_CATALOGO, 
			j.des_cata DES_CATALOGO, 
			a.fopa_oid_form_pago OID_FORMA_PAGO, 
			e.cod_tipo_ofer COD_TIPO_OFERTA,
			l.val_i18n DES_TIPO_OFERTA, 
			b.num_pagi_cata NUM_PAGINA, 
			b.val_fact_repe FAC_REPETICION, 
			b.imp_prec_cata PRE_CATALOGO, 
			b.imp_prec_posi PRE_CONTABLE, 
			b.gofe_oid_grup_ofer OID_GRUPO_OFERTA,  
			f.num_grup NUM_GRUPO, 
			CASE WHEN b.gofe_oid_grup_ofer is NULL THEN NULL WHEN f.ind_grup=1 THEN 'GRUPO' WHEN f.ind_cndo='1' THEN 'GRUPO CONDICIONADO' WHEN f.ind_cndt='1' THEN 'GRUPO CONDICIONANTE' ELSE 'PAQUETE' END TIPO_GRUPO, 
			h.ties_oid_tipo_estr OID_TIPO_ESTRATEGIA,
			b.VAL_TEXT_BREV,
	        b.IND_DIGI,
	        b.IND_IMPR_GP,
	        b.IMP_COST_ESTA,
	        b.NUM_UNID_ESTI,
	        b.IMP_VENT_NETA_ESTI,
	        '' ESTADO
		FROM 
			pre_ofert a, 
  		 	 pre_ofert_detal b, 
  		 	 pre_matri_factu_cabec c, 
  		 	 cra_perio d, 
  		 	 pre_tipo_ofert e, 
			pre_grupo_ofert f, 
			 mae_produ f, 
			 gen_i18n_sicc_pais g, 
			 pre_estra h, 
			 gen_i18n_sicc_pais i, 
			 pre_catal j, 
			seg_marca_produ k,
			gen_i18n_sicc_comun l 
		WHERE a.oid_ofer=b.ofer_oid_ofer 
			AND g.attr_enti='MAE_PRODU' 
			AND i.attr_enti='PRE_ESTRA'
			AND l.attr_enti = 'PRE_TIPO_OFERT'
         	AND l.val_oid = e.oid_tipo_ofer 
			AND b.gofe_oid_grup_ofer=f.oid_grup_ofer(+)
			AND mfca_oid_cabe=oid_cabe 
			AND perd_oid_peri=oid_peri
			AND b.tofe_oid_tipo_ofer=e.oid_tipo_ofer
			AND b.prod_oid_prod=f.oid_prod
			AND g.val_oid=f.oid_prod 
			AND a.coes_oid_estr=h.oid_estr
			AND i.val_oid=h.oid_estr
			AND b.ocat_oid_catal=j.oid_cata
			AND f.mapr_oid_marc_prod=k.oid_marc_prod
 	   	<isNotEmpty property="oidPeriodo">    
			AND  d.oid_peri=#oidPeriodo#
 	   	</isNotEmpty>
 	   	<isNotEmpty property="cuv">
			AND b.val_codi_vent = #cuv#
		</isNotEmpty>
 	   	<isNotEmpty property="codigoCatalogo">
			AND j.cod_cata = #codigoCatalogo#
		</isNotEmpty>
		
 	   	<isNotEmpty property="codigoTipoOferta">
			AND e.cod_tipo_ofer = #codigoTipoOferta#
		</isNotEmpty>
		
		<isNotEmpty property="codigoMarcaProducto">
			AND k.cod_marc_prod = #codigoMarcaProducto#
		</isNotEmpty>
		
		<isNotEmpty property="numeroPagina">
			AND b.num_pagi_cata = to_number(#numeroPagina#)
		</isNotEmpty>
		
		<isNotEmpty property="oidVariante">
			AND b.vari_oid_vari = to_number(#oidVariante#)
		</isNotEmpty>
		
		<isNotEmpty property="oidEstrategia">
			AND a.coes_oid_estr = to_number(#oidEstrategia#)
		</isNotEmpty>
		
		<isNotEmpty property="oidGrupoOferta">
			AND b.gofe_oid_grup_ofer = #oidGrupoOferta#
		</isNotEmpty>
		
		<isNotEmpty property="indProdPrin">
			AND b.ind_prod_prin = #indProdPrin#
		</isNotEmpty>
		
		<isNotEmpty property="oidOferta">
			AND b.ofer_oid_ofer = #oidOferta#
		</isNotEmpty>
		
		ORDER BY oid_ofer, oid_deta_ofer
	</select>
	
	<resultMap id="codigoVentaObjectResult"  class="codigoVentaMod"  >   
    	<result property="codigoVenta" 			column="COD_VENTA"/>                                                                        
    	<result property="numPagina" 			column="NUM_PAGINA"/>
    	<result property="preCatalogo" 			column="PRE_CATALOGO"/>
	    <result property="preContable" 			column="PRE_CONTABLE"/>
    	<result property="facRepeticion" 		column="FAC_REPETICION"/>
	    <result property="codCatalogo" 	   	    column="COD_CATALOGO"/>
	    <result property="oidFormaPago" 	   	column="OID_FORMA_PAGO"/>
	    <result property="valTextoBreve" 	   	column="VAL_TEXT_BREV"/>
	    <result property="indDigitable" 	   	column="IND_DIGI"/>
	    <result property="indImprimible" 	   	column="IND_IMPR_GP"/>
	    <result property="impCosteEsta" 	   	column="IMP_COST_ESTA"/>
	    <result property="numUnidEstim" 	   	column="NUM_UNID_ESTI"/>
	    <result property="impVenNetaEstim" 	   	column="IMP_VENT_NETA_ESTI"/>
	    <result property="tipoOferta" 	 	  	column="COD_TIPO_OFER"/>
	</resultMap>
	<select id="getCodigoVentaObject" parameterClass="java.util.Map" resultMap="codigoVentaObjectResult">
		SELECT	p.val_codi_vent       COD_VENTA,
       			p.num_pagi_cata       NUM_PAGINA,
			 	p.imp_prec_cata       PRE_CATALOGO, 
			 	p.imp_prec_posi       PRE_CONTABLE,
       			p.val_fact_repe       FAC_REPETICION, 
       			j.cod_cata            COD_CATALOGO,
       			p.fopa_oid_form_pago  OID_FORMA_PAGO,
       			p.val_text_brev		  VAL_TEXT_BREV,
       			p.ind_digi			  IND_DIGI,
       			p.ind_impr_gp		  IND_IMPR_GP,
       			p.imp_cost_esta		  IMP_COST_ESTA,
       			p.num_unid_esti		  NUM_UNID_ESTI,
       			p.imp_vent_neta_esti  IMP_VENT_NETA_ESTI,
       			o.cod_tipo_ofer       COD_TIPO_OFER
           FROM pre_ofert_detal p,
       			pre_catal j,
       			PRE_TIPO_OFERT o
 		  WHERE p.ofer_oid_ofer = #oidOferta#
   			AND p.ocat_oid_catal = #oidCatalogo#
   			AND p.oid_deta_ofer = #oidDetaOferta#
   			AND p.ocat_oid_catal = j.oid_cata
   			AND p.tofe_oid_tipo_ofer = o.oid_tipo_ofer
	</select>
	
	<parameterMap id="executeEliminarOfertaParams" class="map" >
		<parameter property="numSecUsuario"    jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoUsuario"	   jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
    </parameterMap>
	 
	<procedure id="executeEliminarOferta" parameterMap="executeEliminarOfertaParams" >
        {call PRE_PKG_PROCE.PRE_PR_ELIMI_OFERT(?,?) }
    </procedure>
    	
	<parameterMap id="executeEliminarCUVParams" class="map" >
		<parameter property="oidOferta"        jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>		
		<parameter property="oidDetaOferta"    jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="numSecUsuario"    jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
    </parameterMap>
	 
	<procedure id="executeEliminarCUV" parameterMap="executeEliminarCUVParams" >
        {call PRE_PKG_PROCE.PRE_PR_ELIMI_CODIG_VENTA(?,?,?) }
    </procedure>
    	
    <parameterMap id="executeModificarDatosCUVParams" class="map" >
		<parameter property="oidOferta"        		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>		
		<parameter property="oidDetaOferta"    		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="oidCatalogo"    		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="indicadorCUV"      	jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="indicadorPagina"       jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="indicadorCatalogo" 	jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="indicadorContable"     jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="indicadorFactor"       jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="indicadorRanking"      jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="valorCUV"      		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="valorPagina"      		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="valorPreCatalogo"  	jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="valorPreContable"  	jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="valorFactor"      		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="valorRanking"      	jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoUsuario"	   		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="numSecUsuario"    		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="indicadorValTextoBreve" 	jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="indicadorIndDigitable"  	jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="indicadorIndImprimible" 	jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="indicadorImpCosteEsta" 	jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="indicadorNumUnidEstim"    	jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="indicadorImpVenNetaEstim" 	jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="indicadorTipoOferta" 		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="valorValTextoBreve" 	jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="valorIndDigitable"  	jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="valorIndImprimible" 	jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="valorImpCosteEsta" 	jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="valorNumUnidEstim"    	jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="valorImpVenNetaEstim" 	jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="valorTipoOferta" 		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
    </parameterMap>
    <procedure id="executeModificarDatosCUV" parameterMap="executeModificarDatosCUVParams" >
        {call PRE_PKG_PROCE.PRE_PR_MODIF_CODIG_VENTA(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?,?,?,?,?,?,?,?,?,?,?,?,?,?) }
    </procedure>
    
    <resultMap id="getDatosOfertaResult"  class="java.util.HashMap"  >                                                                       
    	<result property="oidCatalogo" 			column="OID_CATALOGO"/>
    	<result property="codCatalogo" 			column="COD_CATALOGO"/>
    	<result property="oidFormaPago" 		column="OID_FORMA_PAGO"/>
    	<result property="codFormaPago" 		column="COD_FORMA_PAGO"/>
	</resultMap>
	<select id="getDatosOferta" parameterClass="java.util.Map" resultMap="getDatosOfertaResult">
		SELECT 	p.ocat_oid_cata 		OID_CATALOGO,
       			c.cod_cata 				COD_CATALOGO,
       			p.fopa_oid_form_pago 	OID_FORMA_PAGO,
       			f.cod_form_pago 		COD_FORMA_PAGO
           FROM pre_ofert p, 
       			pre_catal c,
       			bel_forma_pago f
          WHERE p.oid_ofer = #oidOferta#
            AND p.ocat_oid_cata = c.oid_cata
   			AND p.fopa_oid_form_pago = f.oid_form_pago(+)
	</select>
	
	<parameterMap id="executeModificarDatosOfertaParams" class="map" >
		<parameter property="codigoPais"        	jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="indicadorCatalogo" 	jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="indicadorFormaPago"    jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoCatalogo"  		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoFormaPago"  		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoUsuario"	   		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="numSecUsuario"    		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
    </parameterMap>
    <procedure id="executeModificarDatosOferta" parameterMap="executeModificarDatosOfertaParams" >
        {call PRE_PKG_PROCE.PRE_PR_MODIF_OFERT(?, ?, ?, ?, ?, ?, ?) }
    </procedure>
	
	<parameterMap id="executeInsertVentaExclusivaParams" class="map" >
		<parameter property="codigoPais"        	jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="oidTipoCliente"      	jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="oidSubTipoCliente"     jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="oidTipoClasificacion"  jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="oidClasificacion"      jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="oidEstatus"     		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoRegion"      	jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoZona"      		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="numSecUsuario"    		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
    </parameterMap>
    <procedure id="executeInsertVentaExclusiva" parameterMap="executeInsertVentaExclusivaParams" >
        {call PRE_PKG_PROCE.PRE_PR_ASIGN_VENTA_EXCLU(?, ?, ?, ?, ?, ?, ?, ?, ? ) }
    </procedure>
    
	<delete id="deleteVentaExclusiva" parameterClass="java.util.Map">
       DELETE FROM pre_venta_exclu 
         WHERE ofer_oid_ofer IN (SELECT p.oid_ofer 
                                   FROM pre_tmp_ofert_modif p
                                  WHERE p.num_secu_usua = #numSecUsuario#)
    </delete>
    
    <parameterMap id="executeCopiarOfertaParams" class="map" >
		<parameter property="codigoPeriodo"	   			jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="indicadorResecuenciar" 	jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="numSecUsuario"    			jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
	</parameterMap>
    <procedure id="executeCopiarOferta" parameterMap="executeCopiarOfertaParams" >
        {call PRE_PKG_PROCE.PRE_PR_COPIA_OFERT(?, ?, ?) }
    </procedure>
    
    <delete id="deleteCUVTemporal" parameterClass="java.util.Map">
       DELETE FROM pre_tmp_ofert_modif WHERE num_secu_usua = #numSecUsuario#
    </delete>
    
    <insert id="insertaCUVTemporal" parameterClass="java.util.Map">
    	INSERT INTO pre_tmp_ofert_modif
    	( 	oid_ofer,
			oid_deta_ofer,
			des_estr,
			cod_vent,
			cod_sap,
			des_sap,
			oid_cata,
			cod_cata,
			des_cata,
			oid_form_pago,
			cod_tipo_ofer,
			num_pagi_cata,
			val_fact_repe,
			imp_prec_cata,
			imp_prec_posi,
			num_posi_rank,
			num_secu_usua,
			VAL_TEXT_BREV,
		    IND_DIGI,
		    IND_IMPR_GP,
		    IMP_COST_ESTA,
		    NUM_UNID_ESTI,
		    IMP_VENT_NETA_ESTI
		) 
	  SELECT oid_ofer,
			 oid_deta_ofer,
			 i.val_i18n,
			 b.val_codi_vent,
			 f.cod_sap,
			 g.val_i18n,
			 b.ocat_oid_catal,
			 j.cod_cata,
			 j.des_cata,
			 a.fopa_oid_form_pago,
			 e.cod_tipo_ofer, 
			 b.num_pagi_cata,
			 b.val_fact_repe, 
			 b.imp_prec_cata, 
			 b.imp_prec_posi,
			 b.num_posi_rank,
			 #numSecUsuario#,
			 b.VAL_TEXT_BREV,
		     b.IND_DIGI,
		     b.IND_IMPR_GP,
		     b.IMP_COST_ESTA,
		     b.NUM_UNID_ESTI,
		     b.IMP_VENT_NETA_ESTI
  	    FROM pre_ofert a, 
  		 	 pre_ofert_detal b, 
  		 	 pre_matri_factu_cabec c, 
  		 	 cra_perio d, 
  		 	 pre_tipo_ofert e, 
			 mae_produ f, 
			 gen_i18n_sicc_pais g, 
			 pre_estra h, 
			 gen_i18n_sicc_pais i, 
			 pre_catal j, 
			 seg_marca_produ k   
 	  WHERE  oid_peri=#oidPeriodo#
   	    AND  g.attr_enti='MAE_PRODU'
	 	AND  i.attr_enti='PRE_ESTRA'
        AND  oid_ofer=ofer_oid_ofer 
	 	AND  mfca_oid_cabe=oid_cabe 
	    AND  perd_oid_peri=oid_peri 
        AND  b.tofe_oid_tipo_ofer=e.oid_tipo_ofer
	    AND  b.prod_oid_prod=f.oid_prod
	 	AND  g.val_oid=f.oid_prod 
	 	AND  a.coes_oid_estr=h.oid_estr
   	    AND  i.val_oid=h.oid_estr
	 	AND  b.ocat_oid_catal=j.oid_cata
   		AND  f.mapr_oid_marc_prod=k.oid_marc_prod 
   		AND  NOT EXISTS ( SELECT p.oid_ofer
                            FROM pre_tmp_ofert_modif p 
                           WHERE p.oid_ofer = a.oid_ofer
                       	     AND p.oid_deta_ofer = b.oid_deta_ofer
                             AND p.oid_cata = j.oid_cata 
                             AND p.num_secu_usua = #numSecUsuario#)
                       	         
 	   	<isNotEmpty property="cuv">
			AND b.val_codi_vent = #cuv#
		</isNotEmpty>
 	         
 	   	<isNotEmpty property="codigoCatalogo">
			AND j.cod_cata = #codigoCatalogo#
		</isNotEmpty>
		
 	   	<isNotEmpty property="codigoTipoOferta">
			AND e.cod_tipo_ofer = #codigoTipoOferta#
		</isNotEmpty>
		
		<isNotEmpty property="codigoMarcaProducto">
			AND k.cod_marc_prod = #codigoMarcaProducto#
		</isNotEmpty>
		
		<isNotEmpty property="numeroPagina">
			AND b.num_pagi_cata = to_number(#numeroPagina#)
		</isNotEmpty>
		
		<isNotEmpty property="oidVariante">
			AND b.vari_oid_vari = to_number(#oidVariante#)
		</isNotEmpty>
		
		<isNotEmpty property="oidEstrategia">
			AND a.coes_oid_estr = to_number(#oidEstrategia#)
		</isNotEmpty>
	</insert>

	<select id="getCodigoVentaModificarList" parameterClass="java.util.Map" resultMap="codigoVentaResult">
		  SELECT a.oid_ofer          		OID_OFERTA,
				 a.oid_deta_ofer     		OID_DETA_OFERTA,
				 a.des_estr        		DES_ESTRATEGIA,
	             b.num_ofer           NUM_OFERTA,
				 a.cod_vent   			COD_VENTA,
				 a.cod_sap         		COD_SAP,
				 a.des_sap        		DES_SAP,
				 a.oid_cata  			    OID_CATALOGO,
				 a.cod_cata        		COD_CATALOGO,
				 a.des_cata        		DES_CATALOGO,
				 a.oid_form_pago  		OID_FORMA_PAGO,
				 a.cod_tipo_ofer   		COD_TIPO_OFERTA,
				 l.val_i18n 			DES_TIPO_OFERTA, 
				 a.num_pagi_cata   		NUM_PAGINA,
				 a.val_fact_repe           FAC_REPETICION, 
	             a.imp_prec_cata           PRE_CATALOGO, 
	             a.imp_prec_posi           PRE_CONTABLE,
	             c.gofe_oid_grup_ofer OID_GRUPO_OFERTA, 
	             b.num_grup				 NUM_GRUPO, 
	             CASE WHEN c.gofe_oid_grup_ofer is NULL THEN NULL WHEN f.ind_grup=1 THEN 'GRUPO' WHEN f.ind_cndo='1' THEN 'GRUPO CONDICIONADO' WHEN f.ind_cndt='1' THEN 'GRUPO CONDICIONANTE' ELSE 'PAQUETE' END TIPO_GRUPO, 
	             null OID_TIPO_ESTRATEGIA,
	             c.VAL_TEXT_BREV,
		         c.IND_DIGI,
		         c.IND_IMPR_GP,
		         c.IMP_COST_ESTA,
		         c.NUM_UNID_ESTI,
		         c.IMP_VENT_NETA_ESTI,
		         '' ESTADO
	          FROM pre_tmp_ofert_modif a, 
	                    pre_ofert b, 
	                    pre_ofert_detal c, 
	                    pre_grupo_ofert f, 
	                    mae_produ f,
	                    gen_i18n_sicc_comun l,
	                    pre_tipo_ofert m 
	  	   WHERE a.oid_ofer = b.oid_ofer 
	            AND b.oid_ofer = c.ofer_oid_ofer 
	            AND c.gofe_oid_grup_ofer = f.oid_grup_ofer(+) 
	            AND c.prod_oid_prod = f.oid_prod
	            AND l.attr_enti = 'PRE_TIPO_OFERT'
         		AND l.val_oid = m.oid_tipo_ofer
	            AND a.num_secu_usua = #numSecUsuario# 
	    ORDER BY a.oid_ofer, a.oid_deta_ofer 
	</select>
	
	<select id="getExisteCUV" parameterClass="java.util.Map" resultClass="int">
        SELECT count(1) 
		  FROM pre_tmp_ofert_modif p 
		 WHERE p.oid_ofer = #oidOferta#
           AND p.oid_deta_ofer = #oidDetaOferta#
   		   AND p.oid_cata = #oidCatalogo# 
    </select>
    
    
    <select id="getExisteCUVFacturado" parameterClass="java.util.Map" resultClass="int">
		SELECT COUNT(1)
		  FROM int_solic_conso_detal a,
		       sto_docum_digit       b
		 WHERE a.sec_nume_docu = b.sec_nume_docu
		   AND b.ind_envi = '1'
		   <isNotEmpty property="oidDetaOferta">
		   AND a.ofde_oid_deta_ofer = #oidDetaOferta#
		   </isNotEmpty>
		   <isNotEmpty property="codigoPeriodoMatriz">
		   AND b.cod_peri = #codigoPeriodoMatriz#
		   </isNotEmpty>
    </select>
      
    <select id="getNumeroSecuenciaUsuario" resultClass="string">
   		 SELECT SEQ_PRE_OFERT_MODIF.NEXTVAL FROM DUAL
    </select>
    
    <select id="getEstrategiaList" parameterClass="java.util.Map" resultMap="baseResult">
	    SELECT 	oid_estr as CODIGO,
	    	   	val_i18n as DESCRIPCION
		  FROM 	pre_estra, 
       			gen_i18n_sicc_pais 
	     WHERE 	oid_estr = val_oid 
           AND attr_enti = 'PRE_ESTRA'
	</select>
	
	<select id="getPeriodoActivo" parameterClass="java.util.Map" resultClass="string">
        SELECT c.cod_peri
		  FROM bas_ctrl_fact c
		 WHERE c.cod_pais = #codigoPais#
   		   AND c.ind_camp_act = 1
   		   AND c.sta_camp = '0' 
    </select>
    
    <parameterMap id="getExisteOfertasFacturadosParams" class="map" >
		<parameter property="numSecUsuario"    jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="valError"     	   jdbcType="VARCHAR" javaType="java.lang.String"  mode="OUT"/>
    </parameterMap>
	 
	<procedure id="getExisteOfertasFacturados" parameterMap="getExisteOfertasFacturadosParams" >
        {call PRE_PKG_PROCE.pre_pr_valid_ofert_factu(?, ?) }
    </procedure>

	<resultMap id="listValidacionMatrizResult" class="java.util.HashMap">
	    <result property="oid" 						column="OID_VALI_MATR" javaType="java.lang.String"/>
	    <result property="descripcion" 	  			column="DES_VALI"/>
	    <result property="indActividad"			    column="IND_ACTI" javaType="java.lang.String"/>
	    <result property="mensaje"					column="DES_MENS"/>
	    <result property="activo"					column="DES_ACTI"/>
    </resultMap>
	
	<select id="getListValidacionMatriz" parameterClass="java.util.Map" resultMap="listValidacionMatrizResult">
		SELECT OID_VALI_MATR,
		       DES_VALI,
		       IND_ACTI,
		       DES_MENS,
		       DECODE(IND_ACTI,1,'SI','NO') DES_ACTI
		  FROM PRE_VALID_MATRI 
		ORDER BY 1
	</select>

    <update id="updateValidacionMatriz" parameterClass="java.util.Map">
		UPDATE PRE_VALID_MATRI
           SET DES_VALI = #descripcion#,
               IND_ACTI = #indActividad#,
			   DES_MENS = #mensaje#
		WHERE OID_VALI_MATR = #oid#
    </update>
    
    <resultMap id="listGrupoResult" class="java.util.HashMap">
	    <result property="oid" 						column="CUES_OID_IND_CUAD_TIPO_ESTR"/>
	    <result property="factorCuadre" 	  		column="COD_FACT_CUAD"/>
	    <result property="descripcion"			    column="descripcion_IC"/>
    </resultMap>
	
	<select id="getListGrupo" parameterClass="java.util.Map" resultMap="listGrupoResult">
		SELECT CUES_OID_IND_CUAD_TIPO_ESTR,
		       COD_FACT_CUAD,
		       C.VAL_I18N descripcion_IC
		  FROM PRE_GRUPO_OFERT A, 
		       PRE_INDIC_CUADR_TIPO_ESTRA B, 
		       GEN_I18N_SICC_COMUN C
		 WHERE A.OID_GRUP_OFER = #oidGrupoOferta#
		   AND A.CUES_OID_IND_CUAD_TIPO_ESTR = B.OID_IND_CUAD_TIPO_ESTR
		   AND B.INDC_OID_INDI_CUAD = C.VAL_OID
		   AND C.ATTR_ENTI = 'PRE_INDIC_CUADR'
	</select>
	
	<select id="getIndicadorCuadreList" parameterClass="java.util.Map" resultMap="baseResult">
		SELECT OID_IND_CUAD_TIPO_ESTR as CODIGO, 
		       VAL_I18N as DESCRIPCION
		  FROM PRE_INDIC_CUADR            A,
		       GEN_I18N_SICC_COMUN        B,
		       PRE_INDIC_CUADR_TIPO_ESTRA C
		 WHERE A.OID_IND_CUAD = B.VAL_OID
		   AND B.ATTR_ENTI = 'PRE_INDIC_CUADR'
		   AND C.INDC_OID_INDI_CUAD = A.OID_IND_CUAD
		   AND C.IND_OFER_MONO_GRUP = 0
		   AND C.TIES_OID_TIPO_ESTR = #oidTipoEstrategia#
	</select>
    
    <update id="updateFactorCuadre" parameterClass="java.util.Map">
		Update pre_grupo_ofert
		   set COD_FACT_CUAD = #factorCuadre#
		 where oid_grup_ofer = #oidGrupoOferta#
    </update>
    
    <update id="updateFactorIndicadorCuadre" parameterClass="java.util.Map">
		Update pre_grupo_ofert
		   set COD_FACT_CUAD               = #factorCuadre#,
		       CUES_OID_IND_CUAD_TIPO_ESTR = #indicadorEstrategia#
		 where oid_grup_ofer = #oidGrupoOferta#
    </update>
    <resultMap id="seccionesListResult" class="java.util.HashMap">
	    <result property="oid" 						column="oid_prom"/>
	    <result property="idCuadrePromocion"	    column="ICPR_OID_INDI_CUAD_PROM"/>
	    <result property="factorCuadre" 	  		column="VAL_FACT_CUAD"/>
	    <result property="descripcion"			    column="descripcion_IC"/>
    </resultMap>
    <select id="getSeccionesList" parameterClass="java.util.Map" resultMap="seccionesListResult">
		SELECT A.OID_PROM,
		       ICPR_OID_INDI_CUAD_PROM,
		       A.VAL_FACT_CUAD,
		       C.VAL_I18N descripcion_IC
		  FROM PRE_PROMO A, 
		       PRE_INDIC_CUADR_PROMO B, 
		       GEN_I18N_SICC_COMUN C
		 WHERE A.OFER_OID_OFER = #oidOferta#
		   AND A.ICPR_OID_INDI_CUAD_PROM = B.OID_INDI_CUAD_PROM
		   AND B.OID_INDI_CUAD_PROM = C.VAL_OID
		   AND C.ATTR_ENTI = 'PRE_INDIC_CUADR_PROMO'
	</select>
	<select id="getTipoCuadreList" parameterClass="java.util.Map" resultMap="baseResult">
	   SELECT A.OID_INDI_CUAD_PROM as codigo, 
	          VAL_I18N as descripcion
	   FROM PRE_INDIC_CUADR_PROMO A, GEN_I18N_SICC_COMUN B
		 WHERE A.OID_INDI_CUAD_PROM = B.VAL_OID
		   AND B.ATTR_ENTI = 'PRE_INDIC_CUADR_PROMO'
	</select>
	<select id="getCatalogoList" parameterClass="java.util.Map" resultMap="baseResult">
	    select pc.oid_cata as codigo, pc.des_cata as descripcion
		  from pre_catal pc, seg_pais sp
		 where pc.pais_oid_pais = sp.oid_pais
		   and sp.cod_pais = #codigoPais#
	</select>
	<resultMap id="criteriosListResult" class="java.util.HashMap">
	    <result property="oid"					column="oid_rang_prom"/>
	    <result property="catalogo" 			column="des_cata"/>
	    <result property="tipoRango" 			column="TIPO_RANGO"/>
	    <result property="paginaInicial"	    column="PAGINA_DESDE"/>
	    <result property="paginaFinal"	    	column="PAGINA_HASTA"/>
	    <result property="producto" 	  		column="PRODUCTO"/>
	    <result property="exclusion"			column="INDICADOR_EXCLUSION"/>
    </resultMap>
    <select id="getCriteriosList" parameterClass="java.util.Map" resultMap="criteriosListResult">
		SELECT A.OID_RANG_PROM,
                  B.DES_CATA,
                  DECODE(COD_TIPO_RANG, 'R', 'Rango', 'Producto') TIPO_RANGO,
                  DECODE(COD_TIPO_RANG, 'P', NULL, VAL_DESD) PAGINA_DESDE,
                  VAL_HAST PAGINA_HASTA,
                  DECODE(COD_TIPO_RANG, 'P', C.COD_SAP, NULL) PRODUCTO,
                  IND_EXCL INDICADOR_EXCLUSION
             FROM PRE_RANGO_PROMO A, PRE_CATAL B, MAE_PRODU C
            WHERE A.POMO_OID_PROM = #oidProm#
              AND A.OCAT_OID_CATA = B.OID_CATA
              AND A.VAL_DESD = C.OID_PROD(+)
            ORDER BY NUM_RANG_INTE
	</select>
	
	<resultMap id="criterioByIdResult" class="java.util.HashMap">
		<result property="tipoRango" 				column="TIPO_RANGO"/>
    	<result property="paginaInicial" 			column="PAGINA_DESDE"/>
    	<result property="paginaFinal" 	 			column="PAGINA_HASTA"/>
    	<result property="producto"					column="PRODUCTO"/>
    
    </resultMap>     	
   	<select id="getCriterioById" parameterClass="map" resultMap="criterioByIdResult">
		select decode(cod_tipo_rang, 'R', 'Rango', 'Producto') TIPO_RANGO,
		       decode(cod_tipo_rang, 'P', null, val_desd) PAGINA_DESDE,
		       val_hast PAGINA_HASTA,
		       decode(cod_tipo_rang, 'P', c.cod_sap, NULL) PRODUCTO
		  from pre_rango_promo a, pre_catal b, mae_produ c, seg_pais s
		 where a.OID_RANG_PROM = #oidRango#
		   and a.ocat_oid_cata = b.oid_cata
		   and a.val_desd = c.oid_prod(+)
		   and b.pais_oid_pais = c.pais_oid_pais
		   and s.oid_pais = b.pais_oid_pais
		   and s.cod_pais = #codigoPais#       
   	</select>
	
	<insert id="insertaCriterio" parameterClass="java.util.Map">
	Insert into PRE_RANGO_PROMO
	  (OID_RANG_PROM,
	   OCAT_OID_CATA,
	   POMO_OID_PROM,
	   COD_TIPO_RANG,
	   NUM_RANG_INTE,
	   VAL_DESD,
	   VAL_HAST,
	   IND_EXCL)
	Values
	  (pre_rapr_seq.nextval,
	   #oidCata#,
	   #oidProm#,
	   #tipoRango#,
	   (select max(num_rang_inte)+1 from PRE_RANGO_PROMO),
	   #valorDesde#,
	   #valorHasta#,
	   #exclusion#)
	</insert>
	<delete id="deleteCriterio" parameterClass="java.util.Map">
       Delete from pre_rango_promo where oid_rang_prom = #oidRango#
    </delete>
    <delete id="deletePromo" parameterClass="java.util.Map">
       Delete from PRE_PROMO_PRODU where oid_ofer= #oidPromo#
    </delete>
    <insert id="insertaPromo" parameterClass="java.util.Map">
	Insert into PRE_PROMO_PRODU
	  (OID_OFER, 
       OID_DETA_OFER)
	Values
	  (#oidOferta#,
	   #oidDetalle#)
	</insert>
	
	<resultMap id="componentesListResult" class="java.util.HashMap">
	    <result property="oid"					column="oid_deta_ofer"/>
	    <result property="codigoCUV" 			column="CUV_APOYADO"/>
	    <result property="codigoSAP" 			column="cod_sap"/>
	    <result property="descripcionProducto"	column="desc_prod"/>
	    <result property="descripcionCatalogo"	column="des_cata"/>
	    <result property="numeroPagina" 	  	column="num_pagi_cata"/>
	    <result property="tipoOferta"			column="TIPO_OFERTA"/>
    </resultMap>
    <select id="getComponentesList" parameterClass="java.util.Map" resultMap="componentesListResult">
    <![CDATA[
		select proXrango.oid_deta_ofer,
		       proXrango.val_codi_vent CUV_APOYADO,
		       proXrango.cod_sap,
		       int_pkg_recla.GEN_FN_DESC_PROD(proXrango.OID_PROD) desc_prod,
		       proXrango.des_cata,
		       proXrango.num_pagi_cata,
		       proXrango.TIPO_OFERTA
		  from pre_ofert_detal a,
		       pre_ofert b,
		       pre_matri_factu_cabec c,
		       cra_perio d,
		       seg_perio_corpo e,
		       pre_estra f,
		       pre_promo g,
		       gen_i18n_sicc_pais gestr,
		       mae_produ prod,
		       pre_tipo_ofert tof,
		       pre_catal pcata,
		       seg_pais sp,
		       (select h.oid_ofer,
		               l.oid_deta_ofer,
		               j.OID_RANG_PROM,
		               l.VAL_CODI_VENT,
		               k.COD_SAP,
		               k.oid_prod,
		               int_pkg_recla.GEN_FN_DESC_PROD(k.OID_PROD) DESCRIPCION,
		               cat.des_cata,
		               l.NUM_PAGI_CATA,
		               v.COD_TIPO_OFER TIPO_OFERTA
		          from pre_ofert             h,
		               pre_promo             i,
		               pre_rango_promo       j,
		               mae_produ             k,
		               pre_ofert_detal       l,
		               pre_ofert             ll,
		               pre_catal             cat,
		               pre_matri_factu_cabec pmfc,
		               cra_perio             crap,
		               seg_perio_corpo       spcorp,
		               pre_tipo_ofert        v,
		               seg_pais              sp
		         where k.pais_oid_pais = cat.pais_oid_pais
		           and crap.pais_oid_pais = sp.oid_pais
		           and sp.cod_pais = #codigoPais#
		           and h.OID_OFER = i.OFER_OID_OFER
		           and i.OID_PROM = j.POMO_OID_PROM
		           and j.OCAT_OID_CATA = ll.OCAT_OID_CATA
		           and ll.OCAT_OID_CATA = cat.oid_cata
		           and l.NUM_PAGI_CATA >= j.VAL_DESD
		           and l.NUM_PAGI_CATA <= j.VAL_HAST
		           and j.COD_TIPO_RANG = 'R'
		           and ll.MFCA_OID_CABE = pmfc.OID_CABE
		           and pmfc.PERD_OID_PERI = crap.OID_PERI
		           and crap.PERI_OID_PERI = spcorp.OID_PERI
		           and spcorp.COD_PERI = #codigoPeriodo#
		           and l.PROD_OID_PROD = k.OID_PROD
		           and j.IND_EXCL = 0
		           and h.MFCA_OID_CABE = ll.MFCA_OID_CABE
		           and ll.OID_OFER = l.OFER_OID_OFER
		           and l.TOFE_OID_TIPO_OFER = v.OID_TIPO_OFER
		           and k.cod_sap not in
		               (select p.COD_SAP
		                  from pre_ofert       m,
		                       pre_promo       n,
		                       pre_rango_promo o,
		                       mae_produ       p,
		                       pre_ofert_detal q
		                 where m.OID_OFER = n.OFER_OID_OFER
		                   and n.OID_PROM = o.POMO_OID_PROM
		                   and o.OCAT_OID_CATA = q.OCAT_OID_CATAL
		                   and q.NUM_PAGI_CATA >= o.VAL_DESD
		                   and q.NUM_PAGI_CATA <= o.VAL_HAST
		                   and o.COD_TIPO_RANG = 'R'
		                   and q.PROD_OID_PROD = p.OID_PROD
		                   and o.IND_EXCL = 1
		                   and o.pomo_oid_prom = j.pomo_oid_prom)
		           and k.oid_prod not in
		               (select x.VAL_DESD
		                  from pre_rango_promo x
		                 where x.COD_TIPO_RANG = 'P'
		                   and x.IND_EXCL = 1
		                   and x.POMO_OID_PROM = i.OID_PROM)
		        union
		        select h.oid_ofer,
		               l.oid_deta_ofer,
		               j.OID_RANG_PROM,
		               l.VAL_CODI_VENT,
		               k.COD_SAP,
		               k.oid_prod,
		               int_pkg_recla.GEN_FN_DESC_PROD(k.OID_PROD) DESCRIPCION,
		               cat.des_cata,
		               l.num_pagi_cata,
		               v.cod_tipo_ofer
		          from pre_ofert             h,
		               pre_promo             i,
		               pre_rango_promo       j,
		               mae_produ             k,
		               pre_ofert_detal       l,
		               pre_ofert             ll,
		               pre_catal             cat,
		               pre_matri_factu_cabec pmfc,
		               cra_perio             crap,
		               seg_perio_corpo       spcorp,
		               pre_tipo_ofert        v,
		               seg_pais              sp
		         where h.OID_OFER = i.OFER_OID_OFER
		           and i.OID_PROM = j.POMO_OID_PROM
		           and j.OCAT_OID_CATA = ll.OCAT_OID_CATA
		           and ll.OCAT_OID_CATA = cat.oid_cata
		           and j.COD_TIPO_RANG = 'P'
		           and ll.MFCA_OID_CABE = pmfc.OID_CABE
		           and pmfc.PERD_OID_PERI = crap.OID_PERI
		           and crap.PERI_OID_PERI = spcorp.OID_PERI
		           and spcorp.COD_PERI = #codigoPeriodo#
		           and j.val_desd = k.OID_PROD
		           and k.oid_prod = l.prod_oid_prod
		           and j.IND_EXCL = 0
		           and h.MFCA_OID_CABE = ll.MFCA_OID_CABE
		           and ll.OID_OFER = l.OFER_OID_OFER
		           and l.TOFE_OID_TIPO_OFER = v.OID_TIPO_OFER
		           and k.pais_oid_pais = cat.pais_oid_pais
		           and crap.pais_oid_pais = cat.pais_oid_pais
		           and crap.pais_oid_pais = sp.oid_pais
		           and sp.cod_pais = #codigoPais#
		         order by 1, 2, 3, 4) proXrango
		 where a.OFER_OID_OFER = b.OID_OFER
		   and b.MFCA_OID_CABE = c.oid_cabe
		   and c.PERD_OID_PERI = d.OID_PERI
		   and d.PERI_OID_PERI = e.OID_PERI
		   and b.COES_OID_ESTR = f.OID_ESTR
		   and b.OID_OFER = g.OFER_OID_OFER
		   and proXrango.oid_ofer = b.oid_ofer
		   and gestr.val_oid = f.OID_ESTR
		   and a.prod_oid_prod = prod.oid_prod
		   and a.tofe_oid_tipo_ofer = tof.oid_tipo_ofer
		   and b.OCAT_OID_CATA = pcata.oid_cata
		   and (f.OID_ESTR = 2005 OR f.OID_ESTR = 2006 OR f.OID_ESTR = 2007 OR
		       f.OID_ESTR = 2022)
		   and e.COD_PERI = #codigoPeriodo#
		   and gestr.attr_enti = 'PRE_ESTRA'
		   ]]>
		   <isNotEmpty property="oidOferta">
				and a.ofer_oid_ofer = #oidOferta#
		   </isNotEmpty>
		   and d.pais_oid_pais = f.pais_oid_pais
		   and pcata.pais_oid_pais = f.pais_oid_pais
		   and prod.pais_oid_pais = pcata.pais_oid_pais
		   and sp.oid_pais = prod.pais_oid_pais
		   and sp.cod_pais = #codigoPais#
		   <isNotEmpty property="paginaInicialCompo">
				<![CDATA[
				and proXrango.num_pagi_cata >= #paginaInicialCompo#
				]]>
		   </isNotEmpty>
		   <isNotEmpty property="paginaFinalCompo">
				<![CDATA[
				and proXrango.num_pagi_cata <= #paginaFinalCompo#
				]]>
		   </isNotEmpty>
		   <isNotEmpty property="oidCatalogoCompo">
				and b.OCAT_OID_CATA = #oidCatalogoCompo#
		   </isNotEmpty>
		 group by proXrango.oid_deta_ofer,
               proXrango.val_codi_vent,
               proXrango.cod_sap,
               int_pkg_recla.GEN_FN_DESC_PROD(proXrango.OID_PROD),
               proXrango.des_cata,
               proXrango.num_pagi_cata,
               proXrango.TIPO_OFERTA
	</select>
	<select id="getProductoBySAP" parameterClass="java.util.Map" resultClass="string">
    SELECT PRODUCTO.OID_PROD
	  FROM MAE_PRODU PRODUCTO, SEG_PAIS PAIS
	 WHERE PRODUCTO.COD_SAP = #codigoSAP#
	   and PRODUCTO.PAIS_OID_PAIS = PAIS.OID_PAIS
	   and PAIS.COD_PAIS = #codigoPais#
    </select>
    
    <resultMap id="recuperacionesMapResult" class="java.util.HashMap">
    	<result property="oid" 					column="OID_MATR_RECU" 	/>
    	<result property="cuvOriginal" 			column="CUV_ORIGINAL"/>
    	<result property="producto" 			column="PRODUCTO"/>
    	<result property="descripcion" 			column="DESCRIPCION"/>
    	<result property="precioCatalogoOriginal" 	column="PRECIO_CATALOGO_ORIGINAL"/>
    	<result property="factorRepeticion" 		column="FACTOR_REPETICION"/>
    	<result property="tipofertaOriginal" 		column="TIPO_OFERTA_ORIGINAL"/>
    	<result property="periodoRecuperacion" 		column="PERIODO_RECUPERACION"/>
    	<result property="cuvARecuperar" 			column="CUV_A_RECUPERAR"/>
    	<result property="producto1" 				column="PRODUCTO1"/>
    	<result property="descripcion1" 			column="DESCRIPCION1"/>
    	<result property="precioCatalogoReemplazo" 	column="PRECIO_CATALOGO_REEMPLAZO"/>
    	<result property="factorRepeticion1" 		column="FACTOR_REPETICION1"/>
    	<result property="tipofertaReemplazo" 		column="TIPO_OFERTA_REEMPLAZO"/>
    	<result property="zona" 	column="ZONA"/>
    	<result property="region" 	column="REGION"/>
    	<result property="tipoCliente" 		column="TIPO_CLIEN"/>
    	<result property="subtipoCliente" 	column="SUBTIPO_CLIEN"/>
    	<result property="tipoClasificacion" 	column="TIPO_CLASI"/>
    	<result property="activo" 	column="ACTIVO"/>
     	<result property="numeroUnidadMaximo" 	column="NUM_UNID_MAXI_RECU"/>
    </resultMap>    
 <select id="getRecuperaciones" parameterClass="java.util.Map" resultMap="recuperacionesMapResult">
		SELECT 
		I.OID_MATR_RECU, 
		C.VAL_CODI_VENT CUV_ORIGINAL, 
		J.COD_SAP PRODUCTO, 
		L.VAL_I18N DESCRIPCION, 
		C.IMP_PREC_CATA PRECIO_CATALOGO_ORIGINAL, 
		C.VAL_FACT_REPE FACTOR_REPETICION, 
		U.COD_TIPO_OFER TIPO_OFERTA_ORIGINAL,
		W.COD_PERI PERIODO_RECUPERACION, 
		G.VAL_CODI_VENT CUV_A_RECUPERAR, 
		K.COD_SAP PRODUCTO1, 
		M.VAL_I18N DESCRIPCION1, 
		G.IMP_PREC_CATA PRECIO_CATALOGO_REEMPLAZO, 
		G.VAL_FACT_REPE FACTOR_REPETICION1, 
		T.COD_TIPO_OFER TIPO_OFERTA_REEMPLAZO, 
		N.COD_ZONA ZONA, 
		O.COD_REGI REGION, 
		(SELECT VAL_I18N FROM GEN_I18N_SICC_COMUN WHERE ATTR_ENTI='MAE_TIPO_CLIEN' AND VAL_OID=R.OID_TIPO_CLIE) TIPO_CLIEN, 
		(SELECT VAL_I18N FROM GEN_I18N_SICC_COMUN WHERE ATTR_ENTI='MAE_SUBTI_CLIEN' AND VAL_OID=S.OID_SUBT_CLIE) SUBTIPO_CLIEN, 
		(SELECT VAL_I18N FROM GEN_I18N_SICC_COMUN WHERE ATTR_ENTI='MAE_TIPO_CLASI_CLIEN' AND VAL_OID=P.OID_TIPO_CLAS) TIPO_CLASI , 
		(SELECT VAL_I18N FROM GEN_I18N_SICC_COMUN WHERE ATTR_ENTI='MAE_CLASI' AND VAL_OID=Q.OID_CLAS) CLASI, 
		I.IND_ACTI ACTIVO,
		I.NUM_UNID_MAXI_RECU
		FROM PRE_MATRI_FACTU_CABEC A, 
		     PRE_OFERT B, 
		     PRE_OFERT_DETAL C, 
		     PRE_MATRI_FACTU D, 
		     CRA_PERIO E, 
		     SEG_PERIO_CORPO F, 
		     PRE_OFERT_DETAL G, 
		     PRE_MATRI_FACTU H, 
		     PRE_MATRI_RECUP I, 
		     MAE_PRODU J, 
		     MAE_PRODU K, 
		     GEN_I18N_SICC_PAIS L, 
		     GEN_I18N_SICC_PAIS M, 
		     ZON_ZONA N, 
		     ZON_REGIO O, 
		     MAE_TIPO_CLASI_CLIEN P, 
		     MAE_CLASI Q, 
		     MAE_TIPO_CLIEN R, 
		     MAE_SUBTI_CLIEN S, 
		     PRE_TIPO_OFERT T, 
		     PRE_TIPO_OFERT U, 
		     CRA_PERIO V, 
		     SEG_PERIO_CORPO W, 
		     PRE_MATRI_FACTU_CABEC X
		WHERE A.OID_CABE=B.MFCA_OID_CABE 
		AND B.OID_OFER=C.OFER_OID_OFER
		AND C.OID_DETA_OFER=D.OFDE_OID_DETA_OFER 
		AND A.PERD_OID_PERI=E.OID_PERI
		AND I.MAFA_OID_COD_PPAL=D.OID_MATR_FACT 
		AND I.MAFA_OID_COD_RECU=H.OID_MATR_FACT
		AND H.OFDE_OID_DETA_OFER=G.OID_DETA_OFER 
		AND F.OID_PERI=E.PERI_OID_PERI 
		AND F.COD_PERI = #codigoPeriodo#
		AND H.MFCA_OID_CABE=X.OID_CABE 
		AND X.PERD_OID_PERI=V.OID_PERI 
		AND V.PERI_OID_PERI=W.OID_PERI
		AND C.PROD_OID_PROD=J.OID_PROD 
		AND J.OID_PROD=L.VAL_OID 
		AND L.ATTR_ENTI='MAE_PRODU'
		AND G.PROD_OID_PROD=K.OID_PROD 
		AND K.OID_PROD=M.VAL_OID 
		AND M.ATTR_ENTI='MAE_PRODU'
		AND G.TOFE_OID_TIPO_OFER=T.OID_TIPO_OFER 
		AND C.TOFE_OID_TIPO_OFER=U.OID_TIPO_OFER
		AND I.ZZON_OID_ZONA=N.OID_ZONA(+)
		AND I.ZORG_OID_REGI=O.OID_REGI(+)
		AND I.TCCL_OID_TIPO_CLAS=P.OID_TIPO_CLAS(+)
		AND I.CLAS_OID_CLAS=Q.OID_CLAS(+)
		AND I.TICL_OID_TIPO_CLIE=R.OID_TIPO_CLIE(+)
		AND I.SBTI_OID_SUBTI_CLIEN=S.OID_SUBT_CLIE(+)
		
		<isNotEmpty property="indicadorActivo" prepend="AND">
			I.IND_ACTI = #indicadorActivo#
		</isNotEmpty>
		
		<isNotEmpty property="codigoVentaPrincipal" prepend="AND">
			C.VAL_CODI_VENT = #codigoVentaPrincipal#
		</isNotEmpty>
		
		<isNotEmpty property="codigoVentaRecuperar" prepend="AND">
			G.VAL_CODI_VENT = #codigoVentaRecuperar#
		</isNotEmpty>
		
		<isNotEmpty property="numUnidMaxRecu" prepend="AND">
			I.NUM_UNID_MAXI_RECU = #numUnidMaxRecu#
		</isNotEmpty>
		
    </select>
    
    <update id="updateRecuperacion" parameterClass="matrizRecuperacion">    
		update pre_matri_recup 
		set ind_acti = #indicadorActivo#
		where oid_matr_recu = #oid#    
    </update>
    
    <insert id="insertRecuperacionAuditoria" parameterClass="matrizRecuperacionAuditoria">
    	INSERT INTO pre_matri_recup_audit (
    		oid_matr_recu,
    		tip_acci,
    		usu_crea,
    		fec_crea)
    	VALUES(
    		#oid#,
    		#accion#,
        	#auditInfo.createdBy#, 
        	#auditInfo.created#)
    </insert>
    
    <resultMap id="productoMatrizMapResult" class="productoMatriz">
    	<result property="cuv" 		column="CUV" 	/>
    	<result property="codigoSAP" 	column="PRODUCTO"/>
    	<result property="descripcion" 	column="DESCRIPCION"/>
    	<result property="oidMatriz" 	column="OID_MATR_FACT"/>
    </resultMap>
    
    <select id="getProductoPREMatrizRecuperaciones" parameterClass="map" resultMap="productoMatrizMapResult">    
		SELECT 
		C.VAL_CODI_VENT CUV, 
		J.COD_SAP PRODUCTO, 
		L.VAL_I18N DESCRIPCION, 
		D.OID_MATR_FACT
		FROM PRE_MATRI_FACTU_CABEC A, PRE_OFERT B, PRE_OFERT_DETAL C, PRE_MATRI_FACTU D, CRA_PERIO E, SEG_PERIO_CORPO F , MAE_PRODU J, GEN_I18N_SICC_PAIS L 
		WHERE A.OID_CABE=B.MFCA_OID_CABE 
		AND B.OID_OFER=C.OFER_OID_OFER
		AND C.OID_DETA_OFER=D.OFDE_OID_DETA_OFER 
		AND A.PERD_OID_PERI=E.OID_PERI
		AND F.OID_PERI=E.PERI_OID_PERI 
		AND F.COD_PERI = #codigoPeriodo#
		AND C.PROD_OID_PROD=J.OID_PROD 
		AND L.ATTR_ENTI='MAE_PRODU' 
		AND L.VAL_OID=J.OID_PROD 
		AND C.VAL_CODI_VENT = #cuv#    
    </select>
    
    <select id="getProductoPREMatrizRecuperacionesValida" parameterClass="map" resultMap="productoMatrizMapResult">    
		SELECT 
		C.VAL_CODI_VENT CUV, 
		J.COD_SAP PRODUCTO, 
		L.VAL_I18N DESCRIPCION,
		'' OID_MATR_FACT
		FROM PRE_MATRI_FACTU_CABEC A, PRE_OFERT B, PRE_OFERT_DETAL C, PRE_MATRI_FACTU D, CRA_PERIO E, SEG_PERIO_CORPO F, MAE_PRODU J, GEN_I18N_SICC_PAIS L, PRE_MATRI_RECUP I 
		WHERE A.OID_CABE=B.MFCA_OID_CABE 
		AND B.OID_OFER=C.OFER_OID_OFER
		AND C.OID_DETA_OFER=D.OFDE_OID_DETA_OFER 
		AND A.PERD_OID_PERI=E.OID_PERI
		AND F.OID_PERI=E.PERI_OID_PERI 
		AND F.COD_PERI = #codigoPeriodo#
		AND C.PROD_OID_PROD=J.OID_PROD 
		AND L.ATTR_ENTI='MAE_PRODU' 
		AND L.VAL_OID=J.OID_PROD 
		AND I.MAFA_OID_COD_RECU=D.OID_MATR_FACT
		AND C.VAL_CODI_VENT = #cuv# 
    </select>
    
    <select id="getRecuperacionList" parameterClass="matrizRecuperacion" resultClass="string">    
		SELECT 
		OID_MATR_RECU
		FROM PRE_MATRI_RECUP
		WHERE MAFA_OID_COD_PPAL = #oidMatrizRecuperacion#
		AND MAFA_OID_COD_RECU = #oidMatrizReemplazo#		

 	   	<isNotEmpty property="codigoRegion" prepend="AND">
			ZORG_OID_REGI = (select oid_regi from zon_regio where cod_Regi = #codigoRegion#)	
		</isNotEmpty>
		
 	   	<isNotEmpty property="codigoZona" prepend="AND">
			ZZON_OID_ZONA = (select oid_zona from zon_zona where cod_zona = #codigoZona#)	
		</isNotEmpty>
		
 	   	<isNotEmpty property="oidTipoCliente" prepend="AND">
			TICL_OID_TIPO_CLIE = #oidTipoCliente#	
		</isNotEmpty>
		
 	   	<isNotEmpty property="oidSubTipoCliente" prepend="AND">
			SBTI_OID_SUBTI_CLIEN = #oidSubTipoCliente#	
		</isNotEmpty>
		 
 	   	<isNotEmpty property="oidTipoClasificacion" prepend="AND">
			TCCL_OID_TIPO_CLAS = #oidTipoClasificacion#	
		</isNotEmpty>
		
 	   	<isNotEmpty property="oidClasificacion" prepend="AND">
			CLAS_OID_CLAS = #oidClasificacion#	
		</isNotEmpty>
    
    </select>
    
  <insert id="insertRecuperacion" parameterClass="matrizRecuperacion">
		INSERT INTO PRE_MATRI_RECUP (
		       OID_MATR_RECU, 
		       MAFA_OID_COD_PPAL, 
		       MAFA_OID_COD_RECU, 
		       IND_MENS, 
		       IND_RECU_AUTO, 
		       ZORG_OID_REGI, 
		       ZZON_OID_ZONA, 
		       TICL_OID_TIPO_CLIE, 
		       SBTI_OID_SUBTI_CLIEN, 
		       TCCL_OID_TIPO_CLAS, 
		       CLAS_OID_CLAS,
		       IND_ACTI,
		       NUM_UNID_MAXI_RECU,
		       USU_CREA,
		       FEC_CREA)       
		VALUES (
		       pre_mtre_seq.nextval, 
		       #oidMatrizRecuperacion#,
		       #oidMatrizReemplazo#, 
		       #indicadorMensaje#, 
		       '1', 
		       (select oid_regi from zon_regio where cod_Regi = #codigoRegion#), 
		       (select oid_zona from zon_zona where cod_zona = #codigoZona#), 
		       #oidTipoCliente#, 
		       #oidSubTipoCliente#, 
		       #oidTipoClasificacion#, 
		       #oidClasificacion#,
		       1,
		       #numeroUnidadRecuperacion#,
		       #auditInfo.createdBy#, 
		       #auditInfo.created#)    
    </insert>
    
    <resultMap id="alternativosMapResult" class="java.util.HashMap">
    	<result property="oid" 					column="OID_MATR_ATER" 	/>
    	<result property="cuvOriginal" 			column="CUV_ORIGINAL"/>
    	<result property="producto" 			column="PRODUCTO"/>
    	<result property="descripcion" 			column="DESCRIPCION"/>
    	<result property="precioCatalogoOriginal" 	column="PRECIO_CATALOGO_ORIGINAL"/>
    	<result property="factorRepeticion" 		column="FACTOR_REPETICION"/>
    	<result property="tipofertaOriginal" 		column="TIPO_OFERTA_ORIGINAL"/>
    	<result property="cuvAlternativo" 			column="CUV_ALTERNATIVO"/>
    	<result property="producto1" 				column="PRODUCTO1"/>
    	<result property="descripcion1" 			column="DESCRIPCION1"/>
    	<result property="precioCatalogoAlternativo" 	column="PRECIO_CATALOGO_ALTERNATIVO"/>
    	<result property="factorRepeticion1" 		column="FACTOR_REPETICION1"/>
    	<result property="tipofertaAlternativo" 		column="TIPO_OFERTA_ALTERNATIVO"/>
    	<result property="activo" 	column="ACTIVO"/>
    	<result property="numOrde" 	column="NUM_ORDE"/>
    </resultMap>
    
    <select id="getAlternativos" parameterClass="java.util.Map" resultMap="alternativosMapResult">
		SELECT 
			I.OID_MATR_ATER, 
			C.VAL_CODI_VENT CUV_ORIGINAL, 
			J.COD_SAP PRODUCTO, 
			L.VAL_I18N DESCRIPCION, 
			C.IMP_PREC_CATA PRECIO_CATALOGO_ORIGINAL, 
			C.VAL_FACT_REPE FACTOR_REPETICION, 
			U.COD_TIPO_OFER TIPO_OFERTA_ORIGINAL, 
			G.VAL_CODI_VENT CUV_ALTERNATIVO, 
			K.COD_SAP PRODUCTO1, 
			M.VAL_I18N DESCRIPCION1, 
			G.IMP_PREC_CATA PRECIO_CATALOGO_ALTERNATIVO, 
			G.VAL_FACT_REPE FACTOR_REPETICION1, 
			T.COD_TIPO_OFER TIPO_OFERTA_ALTERNATIVO, 
			I.IND_ACTI ACTIVO, 
			I.NUM_ORDE
		FROM 
			PRE_MATRI_FACTU_CABEC A, 
			PRE_OFERT B, 
			PRE_OFERT_DETAL C, 
			PRE_MATRI_FACTU D, 
			CRA_PERIO E, 
			SEG_PERIO_CORPO F, 
			PRE_OFERT_DETAL G, 
			PRE_MATRI_FACTU H, 
			PRE_MATRI_CODIG_ALTER I, 
			MAE_PRODU J, 
			MAE_PRODU K, 
			GEN_I18N_SICC_PAIS L, 
			GEN_I18N_SICC_PAIS M, 
			PRE_TIPO_OFERT T, 
			PRE_TIPO_OFERT U
		WHERE 
			A.OID_CABE=B.MFCA_OID_CABE 
			AND B.OID_OFER=C.OFER_OID_OFER
			AND C.OID_DETA_OFER=D.OFDE_OID_DETA_OFER 
			AND A.PERD_OID_PERI=E.OID_PERI
			AND I.MAFA_OID_COD_PPAL=D.OID_MATR_FACT 
			AND I.MAFA_OID_COD_ALTE=H.OID_MATR_FACT
			AND H.OFDE_OID_DETA_OFER=G.OID_DETA_OFER 
			AND F.OID_PERI=E.PERI_OID_PERI 
			AND F.COD_PERI=#codigoPeriodo#
			AND C.PROD_OID_PROD=J.OID_PROD 
			AND J.OID_PROD=L.VAL_OID 
			AND L.ATTR_ENTI='MAE_PRODU'
			AND G.PROD_OID_PROD=K.OID_PROD 
			AND K.OID_PROD=M.VAL_OID 
			AND M.ATTR_ENTI='MAE_PRODU'
			AND G.TOFE_OID_TIPO_OFER=T.OID_TIPO_OFER 
			AND C.TOFE_OID_TIPO_OFER=U.OID_TIPO_OFER
			

		<isNotEmpty property="indicadorActivo" prepend="AND">
			I.IND_ACTI = #indicadorActivo#
		</isNotEmpty>
		
		<isNotEmpty property="codigoVentaPrincipal" prepend="AND">
			C.VAL_CODI_VENT = #codigoVentaPrincipal#
		</isNotEmpty>
		
		<isNotEmpty property="codigoVentaAlternativo" prepend="AND">
			G.VAL_CODI_VENT = #codigoVentaAlternativo#
		</isNotEmpty>		
    </select>
    
     <update id="updateAlternativo" parameterClass="matrizAlternativo">    
		update pre_matri_codig_alter 
		set ind_acti = #indicadorActivo#
		where oid_matr_ater = #oid#    
    </update>
    
    <insert id="insertAlternativoAuditoria" parameterClass="matrizAlternativoAuditoria">
    	INSERT INTO pre_matri_alternativo_audit (
    		oid_matr_ater,
    		tip_acci,
    		usu_crea,
    		fec_crea)
    	VALUES(
    		#oid#,
    		#accion#,
        	#auditInfo.createdBy#, 
        	#auditInfo.created#)
    </insert>
    
    <select id="getProductoPREMatrizAlternativo" parameterClass="map" resultMap="productoMatrizMapResult">    
		SELECT 
			C.VAL_CODI_VENT CUV, 
			J.COD_SAP PRODUCTO, 
			L.VAL_I18N DESCRIPCION, 
			D.OID_MATR_FACT
		FROM 
			PRE_MATRI_FACTU_CABEC A, 
			PRE_OFERT B, 
			PRE_OFERT_DETAL C, 
			PRE_MATRI_FACTU D, 
			CRA_PERIO E, 
			SEG_PERIO_CORPO F, 
			MAE_PRODU J, 
			GEN_I18N_SICC_PAIS L 
		WHERE 
			A.OID_CABE=B.MFCA_OID_CABE 
			AND B.OID_OFER=C.OFER_OID_OFER
			AND C.OID_DETA_OFER=D.OFDE_OID_DETA_OFER 
			AND A.PERD_OID_PERI=E.OID_PERI
			AND F.OID_PERI=E.PERI_OID_PERI 
			AND F.COD_PERI=#codigoPeriodo#
			AND C.PROD_OID_PROD=J.OID_PROD 
			AND L.ATTR_ENTI='MAE_PRODU' 
			AND L.VAL_OID=J.OID_PROD 
			AND C.VAL_CODI_VENT=#cuv#  
    </select>
    
    <select id="getAlternativosList" parameterClass="matrizAlternativo" resultClass="string">    
		SELECT 
			OID_MATR_ATER
		FROM
			PRE_MATRI_CODIG_ALTER
		WHERE
			MAFA_OID_COD_PPAL = #oidMatrizPrincipal#
			AND MAFA_OID_COD_ALTE = #oidMatrizAlternativo#
    </select>
    
    <insert id="insertAlternativo" parameterClass="matrizAlternativo">
		INSERT INTO PRE_MATRI_CODIG_ALTER 
			(OID_MATR_ATER, 
			MAFA_OID_COD_PPAL, 
			MAFA_OID_COD_ALTE, 
			IND_MENS, 
			NUM_ORDE, 
			IND_ACTI, 
			USU_CREA, 
			FEC_CREA) 
		VALUES 
			(PRE_MTCA_SEQ.NEXTVAL, 
			#oidMatrizPrincipal#,
			#oidMatrizAlternativo#, 
			#indicadorMensaje#, 
			#numeroOrden#,
			1,
			#auditInfo.createdBy#, 
		    #auditInfo.created#)
    </insert>
    
      
    <insert id="insertHistoricoCUV" parameterClass="java.util.Map">
	insert into PRE_HISTO_ACTUA_CODIG_VENTA
	  (OID_OFER,
	   OID_DETA_OFER,
	   NOM_CAMP_MODI,
	   VAL_CAMP_ANTE,
	   VAL_CAMP_NUEV,
	   USU_MODI,
	   FEC_MODI)
	values
	  (#oidOferta#, #oidDetaOferta#, #nombreCampoModificado#, #valorAnterior#, #valorNuevo#, #codigoUsuario#, SYSDATE)
	</insert>
	
	<update id="updateFactorCuadreCondicion" parameterClass="java.util.Map">
		Update pre_promo
	   set ICPR_OID_INDI_CUAD_PROM = #tipoCuadreSecc#,
	       VAL_FACT_CUAD           = #factorCuadreSecc#
	 where ofer_oid_ofer = #oidOferta#
    </update>
    
    <resultMap id="tiposReemplazoList" class="java.util.HashMap">
	    <result property="oid" 			column="oid_tipo_reem"/>
    	<result property="codigo" 		column="cod_tipo_reem"/>
    	<result property="descripcion" 	column="des_tipo_reem"/>
    </resultMap>
	
	<select id="getTiposReemplazoList" parameterClass="java.util.Map" resultMap="tiposReemplazoList">
		select ptr.oid_tipo_reem, 
		       ptr.cod_tipo_reem, 
		       ptr.des_tipo_reem
		  from PRE_TIPO_REEMP ptr
		 where 1=1
		<isNotEmpty prepend="AND" property="codigo">
	 	   ptr.cod_tipo_reem = #codigo#
	 	</isNotEmpty>
		<isNotEmpty prepend="AND" property="descripcion">
	 	   ptr.des_tipo_reem like '%'||#descripcion#||'%'
	 	</isNotEmpty>
	 	 order by ptr.oid_tipo_reem
	</select>
	
	<resultMap id="tiposReemplazoResult" class="tiposReemplazo">
    	<result property="oid" 			column="oid_tipo_reem"/>
    	<result property="codigo" 		column="cod_tipo_reem"/>
    	<result property="descripcion" 	column="des_tipo_reem"/>
    </resultMap>
	
	
	<select id="getTiposReemplazo"  parameterClass="string" resultMap="tiposReemplazoResult">
		select ptr.oid_tipo_reem, 
		       ptr.cod_tipo_reem, 
		       ptr.des_tipo_reem
		  from PRE_TIPO_REEMP ptr
		 where ptr.oid_tipo_reem = #oid#  
	</select>
	
	<insert id="insertTiposReemplazo" parameterClass="tiposReemplazo">
	<![CDATA[ 
    	Insert into PRE_TIPO_REEMP	(
    	         	oid_tipo_reem,
               		cod_tipo_reem,
               		des_tipo_reem,
               		usu_crea,
       		   		fec_crea
       		   		)
 				Values(
 				#oid#,
 				#codigo#,
 				#descripcion#,
 				#auditInfo.createdBy#,
 				#auditInfo.created#
 				)
 				]]>	
	</insert>
	
	<update id="updateTiposReemplazo" parameterClass="tiposReemplazo">
   	<![CDATA[ 
    	update PRE_TIPO_REEMP set
               cod_tipo_reem = #codigo#,
               usu_modi = #auditInfo.updatedBy#,
               fec_modi = #auditInfo.lastUpdated#
		 WHERE oid_tipo_reem = #oid# 
		 ]]>					
	</update>
	
	<delete id="deleteTiposReemplazo" parameterClass="string" >
        DELETE FROM PRE_TIPO_REEMP
    	WHERE  oid_tipo_reem = #oid# 
    </delete>
    
    <select id="getNextOidTiposReemplazo" resultClass="java.lang.Integer">
		SELECT PRE_TIPO_REEMP_SEQ.nextval
		  FROM dual
	</select>
	
	<resultMap id="getPanelgruposResult"  class="java.util.HashMap"  >                                                                       
    	<result property="oidGrupoOferta"	column="OID_GRUP_OFER"/>
    	<result property="oidOferta" 		column="OFER_OID_OFER"/>
    	<result property="numGrupo" 		column="NUM_GRUP"/>
    	<result property="tipoGrupo" 		column="TIPO_GRUPO"/>
    	<result property="indCuadre" 		column="CUES_OID_IND_CUAD_TIPO_ESTR"/>
    	<result property="factorCuadre"		column="COD_FACT_CUAD"/>
	</resultMap>
	<select id="getPanelGrupos" parameterClass="java.util.Map" resultMap="getPanelgruposResult">
		SELECT PGO.OID_GRUP_OFER, 
		       PGO.OFER_OID_OFER,
		       PGO.NUM_GRUP,
		       CASE 
		        WHEN B.GOFE_OID_GRUP_OFER IS NULL THEN 
		            NULL 
		        WHEN PGO.IND_GRUP = 1 THEN 
		            'GRUPO' 
		        WHEN PGO.IND_CNDO = '1' THEN 
		            'GRUPO CONDICIONADO' 
		        WHEN PGO.IND_CNDT = '1' THEN 
		            'GRUPO CONDICIONANTE' 
		        ELSE 
		            'PAQUETE' 
		        END TIPO_GRUPO,
		       CUES_OID_IND_CUAD_TIPO_ESTR,
		       COD_FACT_CUAD
		  FROM PRE_OFERT PO, PRE_OFERT_DETAL B, PRE_GRUPO_OFERT PGO 
		 WHERE PO.OID_OFER = B.OFER_OID_OFER
		   AND B.GOFE_OID_GRUP_OFER = PGO.OID_GRUP_OFER 
		   AND PGO.OFER_OID_OFER = #oidOferta#
		 GROUP BY PGO.OID_GRUP_OFER, PGO.OFER_OID_OFER, PGO.NUM_GRUP, 
		          B.GOFE_OID_GRUP_OFER, PGO.IND_GRUP, PGO.IND_CNDO, 
		          PGO.IND_CNDT, CUES_OID_IND_CUAD_TIPO_ESTR, COD_FACT_CUAD
		 ORDER BY PGO.NUM_GRUP
	</select>
	
	<delete id="deleteProductoGrupoOfertaDetalle" parameterClass="java.util.Map">
		DELETE PRE_OFERT_DETAL
		 WHERE OID_DETA_OFER = #oidDetaOferta#
		   AND OFER_OID_OFER = #oidOferta#
	</delete>
	
	<delete id="deleteProductoGrupoMatrizFacturacion" parameterClass="java.util.Map">
		DELETE PRE_MATRI_FACTU
 		 WHERE OFDE_OID_DETA_OFER = #oidDetaOferta#
	</delete>
	
	<insert id="insertProductoGrupoOfertaDetalle" parameterClass="java.util.Map">
		INSERT INTO PRE_OFERT_DETAL(
				OID_DETA_OFER, 
				OFER_OID_OFER, 
				PROD_OID_PROD, 
				NUM_LINE_OFER, 
				VAL_TEXT_BREV, 
				NUM_UNID_ESTI, 
				COD_ORIG, 
				VAL_FACT_REPE, 
				NUM_POSI_RANK, 
				IND_PROD_PRIN, 
				IMP_PREC_CATA, 
				IMP_PREC_POSI, 
				IMP_COST_ESTA, 
				IMP_VENT_NETA_ESTI, 
				NUM_PAGI_CATA, 
				OCAT_OID_CATAL, 
				TOFE_OID_TIPO_OFER, 
				CIVI_OID_CICLO_VIDA, 
				CNDP_OID_COND_PROM, 
				FOPA_OID_FORM_PAGO, 
				GOFE_OID_GRUP_OFER, 
				IND_DIGI, 
				IND_IMPR_GP, 
				IND_CODI_VENT_GENE, 
				IND_MATR_FACT_GENE, 
				VAL_POSI_PAGI, 
				VAL_CODI_VENT, 
				VAL_CENT, 
				FEC_ULTI_ACTU, 
				PRECIO_UNITARIO, 
				NUM_PUNT_FIJO, 
				VARI_OID_VARI, 
				PRFI_OID_PROG_FIDE, 
				NUM_ORDE_DETA, 
				IMP_PREC_PUBL, 
				FEC_DIGI)
			VALUES(
				PRE_OFDE_SEQ.NEXTVAL, 
				#oidOferta#,
				#oidProducto#,
				#numeroLineaOferta#,
				#valTextoBreve#,
				#numUnidEstim#,
				'MF', 
				#facRepeticion#,
				0,
				#flagPrincipal#,
				TO_NUMBER(#preCatalogo#, '9999999999.99'),
				TO_NUMBER(#preContable#, '9999999999.99'),
				TO_NUMBER(#impCosteEsta#, '9999999999.99'),
				TO_NUMBER(#impVenNetaEstim#, '9999999999.99'),
				#numPagina#,
				#oidCatalogo#,
				#oidTipoOferta#,
				4,
				2005,
				#oidFormaPago#,
				#oidGrupoOferta#,
				#indDigitable#,
				#indImprimible#,
				0,
				0,
				NULL, 
				#codigoVenta#, 
				NULL, 
				SYSDATE, 
				TO_NUMBER(#precioUnitario#, '99999999.99'),
				NULL, 
				NULL, 
				NULL, 
				NULL, 
				0,
				SYSDATE)
	</insert>
	
	<select id="getNextNumeroLineaOferta" parameterClass="java.util.Map" resultClass="string">
		SELECT MAX(NUM_LINE_OFER) + 1 
		  FROM PRE_OFERT_DETAL 
		 WHERE OFER_OID_OFER = #oidOferta#
	</select>
	
	<update id="updateProductoGrupoOfertaDetalle" parameterClass="java.util.Map">
		UPDATE PRE_OFERT_DETAL
		   SET VAL_TEXT_BREV = #valTextoBreve#,
		       VAL_FACT_REPE = #facRepeticion#,
		       IND_DIGI = #indDigitable#, 
		       IND_IMPR_GP = #indImprimible#,
		       IMP_PREC_CATA = TO_NUMBER(#preCatalogo#, '9999999999.99'),
		       IMP_PREC_POSI = TO_NUMBER(#preContable#, '9999999999.99'),
		       IMP_COST_ESTA = TO_NUMBER(#impCosteEsta#, '9999999999.99'),
		       NUM_UNID_ESTI = #numUnidEstim#,
		       IMP_VENT_NETA_ESTI = TO_NUMBER(#impVenNetaEstim#, '9999999999.99'),
		       NUM_PAGI_CATA = #numPagina#,
		       TOFE_OID_TIPO_OFER = #oidTipoOferta#,
		       VAL_CODI_VENT = #codigoVenta#
		 WHERE OID_DETA_OFER = #oidDetaOferta#
		   AND OFER_OID_OFER = #oidOferta#
	</update>
	
	<select id="getOidTipoOferta" parameterClass="java.util.Map" resultMap="baseResultOid">
		SELECT a.oid_tipo_ofer as OID,
		       b.val_i18n as DESCRIPCION
		  FROM pre_tipo_ofert a, 
		       gen_i18n_sicc_comun b 
		 WHERE a.oid_tipo_ofer=b.val_oid 
		   AND b.attr_enti = 'PRE_TIPO_OFERT'
		   AND a.cod_tipo_ofer = #codTipoOferta#
	</select>
	
	<update id="updateProductoPrincipalAsociadoOferta" parameterClass="java.util.Map">
		UPDATE PRE_OFERT_DETAL
		   SET VAL_TEXT_BREV = #valTextoBreve#,
		       VAL_FACT_REPE = #facRepeticion#,
		       IND_DIGI = #indDigitable#, 
		       IND_IMPR_GP = #indImprimible#,
		       IMP_PREC_CATA = TO_NUMBER(#preCatalogo#, '9999999999.99'),
		       IMP_PREC_POSI = TO_NUMBER(#preContable#, '9999999999.99'),
		       IMP_COST_ESTA = TO_NUMBER(#impCosteEsta#, '9999999999.99'),
		       NUM_UNID_ESTI = #numUnidEstim#,
		       IMP_VENT_NETA_ESTI = TO_NUMBER(#impVenNetaEstim#, '9999999999.99'),
		       NUM_PAGI_CATA = #numPagina#,
		       TOFE_OID_TIPO_OFER = #oidTipoOferta#,
		       IND_PROD_PRIN = #indProdPrin#,
		       VAL_CODI_VENT = #codigoVenta#
		 WHERE OID_DETA_OFER = #oidDetaOferta#
		   AND OFER_OID_OFER = #oidOferta#
		   AND IND_PROD_PRIN = #indProdPrin#
	</update>
	
	<insert id="insertProductoPrincipalAsociadoOferta" parameterClass="java.util.Map">
		INSERT INTO PRE_OFERT_DETAL(
				OID_DETA_OFER, 
				OFER_OID_OFER, 
				PROD_OID_PROD, 
				NUM_LINE_OFER, 
				VAL_TEXT_BREV, 
				NUM_UNID_ESTI, 
				COD_ORIG, 
				VAL_FACT_REPE, 
				NUM_POSI_RANK, 
				IND_PROD_PRIN, 
				IMP_PREC_CATA, 
				IMP_PREC_POSI, 
				IMP_COST_ESTA, 
				IMP_VENT_NETA_ESTI, 
				NUM_PAGI_CATA, 
				OCAT_OID_CATAL, 
				TOFE_OID_TIPO_OFER, 
				CIVI_OID_CICLO_VIDA, 
				CNDP_OID_COND_PROM, 
				FOPA_OID_FORM_PAGO, 
				GOFE_OID_GRUP_OFER, 
				IND_DIGI, 
				IND_IMPR_GP, 
				IND_CODI_VENT_GENE, 
				IND_MATR_FACT_GENE, 
				VAL_POSI_PAGI, 
				VAL_CODI_VENT, 
				VAL_CENT, 
				FEC_ULTI_ACTU, 
				PRECIO_UNITARIO, 
				NUM_PUNT_FIJO, 
				VARI_OID_VARI, 
				PRFI_OID_PROG_FIDE, 
				NUM_ORDE_DETA, 
				IMP_PREC_PUBL, 
				FEC_DIGI)
			VALUES(
				PRE_OFDE_SEQ.NEXTVAL, 
				#oidOferta#,
				#oidProducto#,
				#numeroLineaOferta#,
				#valTextoBreve#,
				#numUnidEstim#,
				'MF', 
				#facRepeticion#,
				0,
				#indProdPrin#,
				TO_NUMBER(#preCatalogo#, '9999999999.99'),
				TO_NUMBER(#preContable#, '9999999999.99'),
				TO_NUMBER(#impCosteEsta#, '9999999999.99'),
				TO_NUMBER(#impVenNetaEstim#, '9999999999.99'),
				#numPagina#,
				#oidCatalogo#,
				#oidTipoOferta#,
				4,
				2005,
				#oidFormaPago#,
				#oidGrupoOferta#,
				#indDigitable#,
				#indImprimible#,
				0,
				0,
				NULL, 
				#codigoVenta#, 
				NULL, 
				SYSDATE, 
				TO_NUMBER(#precioUnitario#, '99999999.99'),
				NULL, 
				NULL, 
				NULL, 
				NULL, 
				0,
				SYSDATE)
	</insert>
	
	<parameterMap id="executeRegistroAutomaticoParams" class="map" >
		<parameter property="oidPeriodo"        	jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="oidCatalogo"      		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="oidMatriz"      		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoUsuario"    		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
    </parameterMap>
    
    <procedure id="executeRegistroAutomatico" parameterMap="executeRegistroAutomaticoParams" >
        {call PRE_PKG_PROCE.PRE_PR_REGIS_AUTOM(?, ?, ?, ?) }
    </procedure>
    
    <resultMap id="getVentaExclusivaOfertaResult"  class="java.util.HashMap"  >                                                                       
    	<result property="oidVentaExclusiva"		column="OID_VENT_EXCL"/>
    	<result property="oidOferta" 				column="OFER_OID_OFER"/>
    	<result property="oidTipoCliente" 			column="TICL_OID_TIPO_CLIE"/>
    	<result property="oidSubTipoCliente"		column="SBTI_OID_SUBT_CLIE"/>
    	<result property="oidTipoClasificacion" 	column="TCCL_OID_TIPO_CLAS"/>
    	<result property="oidClasificacion" 		column="CLAS_OID_CLAS"/>
    	<result property="oidEstatus"				column="ESTA_OID_ESTA_CLIE"/>
    	<result property="oidRegion"				column="ZORG_OID_REGI"/>
    	<result property="oidZona"					column="ZZON_OID_ZONA"/>
    	<result property="desTipoCliente" 			column="DES_TIPO_CLIEN"/>
    	<result property="desSubTipoCliente"		column="DES_SUB_TIPO_CLIEN"/>
    	<result property="desTipoClasificacion" 	column="DES_TIPO_CLASI"/>
    	<result property="desClasificacion" 		column="DES_CLASI"/>
    	<result property="desEstatus"				column="DES_ESTAT"/>
    	<result property="codigoRegion"				column="COD_REGIO"/>
    	<result property="desRegion"				column="DES_REGIO"/>
    	<result property="codigoZona"				column="COD_ZONA"/>
    	<result property="desZona"					column="DES_ZONA"/>
    	<result property="estado"					column="ESTADO"/>
	</resultMap>
	<select id="getVentaExclusivaOferta" parameterClass="java.util.Map" resultMap="getVentaExclusivaOfertaResult">
		SELECT ve.*,
		       (SELECT b.val_i18n
		          FROM mae_tipo_clien a, 
		               gen_i18n_sicc_comun b
		         WHERE a.oid_tipo_clie = b.val_oid 
		           AND b.attr_enti = 'MAE_TIPO_CLIEN'
		           AND ve.TICL_OID_TIPO_CLIE = a.oid_tipo_clie) DES_TIPO_CLIEN,
		       (SELECT b.val_i18n
		          FROM mae_subti_clien a, 
		               gen_i18n_sicc_comun b
		         WHERE a.oid_subt_clie = b.val_oid 
		           AND b.attr_enti ='MAE_SUBTI_CLIEN'
		           AND ve.SBTI_OID_SUBT_CLIE = a.oid_subt_clie) DES_SUB_TIPO_CLIEN,
		       (SELECT b.val_i18n
		          FROM mae_tipo_clasi_clien a, 
		               gen_i18n_sicc_comun b
		         WHERE a.oid_tipo_clas=b.val_oid 
		           AND b.attr_enti = 'MAE_TIPO_CLASI_CLIEN'
		           AND ve.TCCL_OID_TIPO_CLAS = a.oid_tipo_clas) DES_TIPO_CLASI,
		       (SELECT b.val_i18n
		          FROM mae_clasi a, 
		               gen_i18n_sicc_comun b
		         WHERE a.oid_clas=b.val_oid 
		           AND b.attr_enti = 'MAE_CLASI'
		           AND ve.CLAS_OID_CLAS = a.oid_clas) DES_CLASI,
		       (SELECT b.val_i18n
		          FROM mae_estat_clien a, 
		               gen_i18n_sicc_comun b
		         WHERE a.oid_esta_clie = b.val_oid 
		           AND b.attr_enti = 'MAE_ESTAT_CLIEN'
		           AND ve.ESTA_OID_ESTA_CLIE = a.oid_esta_clie) DES_ESTAT,
		       (SELECT cod_regi
		          FROM zon_regio zr
		         WHERE zr.oid_regi = ve.ZORG_OID_REGI) COD_REGIO,
		       (SELECT des_regi
		          FROM zon_regio zr
		         WHERE zr.oid_regi = ve.ZORG_OID_REGI) DES_REGIO,
		       (SELECT cod_zona
		          FROM zon_zona zz
		         WHERE zz.oid_zona = ve.ZZON_OID_ZONA) COD_ZONA,
		       (SELECT des_zona
		          FROM zon_zona zz
		         WHERE zz.oid_zona = ve.ZZON_OID_ZONA) DES_ZONA,
		       '' ESTADO
		  FROM PRE_VENTA_EXCLU ve
		 WHERE OFER_OID_OFER = #oidOferta#
	</select>
	
	<delete id="deleteVentaExclusivaPorOidVentaExclusiva" parameterClass="java.util.Map">
       DELETE FROM pre_venta_exclu 
         WHERE OID_VENT_EXCL = #oidVentaExclusiva#
    </delete>
    
    <parameterMap id="executeRenombrarMatrizFacturacionParams" class="map" >
		<parameter property="codigoPeriodoOrigen"   jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoPeriodoDestino" 	jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoUsuario"    		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
    </parameterMap>
    <procedure id="executeRenombrarMatrizFacturacion" parameterMap="executeRenombrarMatrizFacturacionParams" >
        {call PRE_PKG_PROCE.PRE_PR_RENOM_MATRI_FACTU(?, ?, ?) }
    </procedure>
    
    <select id="getOidCabeceraCampanaDestino" parameterClass="string" resultClass="string">
		SELECT OID_CABE
		  FROM PRE_MATRI_FACTU_CABEC
		 WHERE PERD_OID_PERI = GEN_PKG_GENER.GEN_FN_DEVUELVE_ID_CRA_PERIO2(#value#)
	</select>
	
	<select id="getExisteOfertaEnMatrizFacturacionDestino" parameterClass="string" resultClass="int">
		SELECT COUNT(1) 
		  FROM PRE_OFERT
		 WHERE MFCA_OID_CABE = #value#
	</select>
	
	<parameterMap id="executeEliminarMatrizFacturacionParams" class="map" >
		<parameter property="codigoPeriodo"   	jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoUsuario"   	jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoCatalogo" 	jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
    </parameterMap>
    <procedure id="executeEliminarMatrizFacturacion" parameterMap="executeEliminarMatrizFacturacionParams" >
        {call PRE_PKG_PROCE.PRE_PR_ELIMI_MATRI_FACTU(?, ?, ?) }
    </procedure>
    
    
    <resultMap id="getManPRETipoOfertaResult"  class="java.util.HashMap"  >
    
                  <result property="oidTipoOferta" column="oid_tipo_ofer" />
                  <result property="codigoCanal" column="cod_cana" />
                  <result property="codigoTipoOferta" column="cod_tipo_ofer" />
                  <result property="descripcion" column="DESCRIPCION" />
                  <result property="indComisionable" column="ind_comi" />
                  <result property="indOtorgaPuntaje" column="ind_punt" />
                  <result property="indEstadisticable" column="ind_esta" />
                  <result property="indAportaMontoMinimo" column="ind_mont_mini" />
                  <result property="indAportaEscalaDesc" column="ind_apor_mont_esca" />
                  <result property="indGrat" column="ind_grat" />
                  <result property="codMedioVenta" column="val_form_vent" />
                  <result property="codSeccionPaquete" column="num_secc_deta_fact" />
 
	</resultMap>
	
    <select id="getManPRETipoOfertaList" parameterClass="java.util.Map" resultMap="getManPRETipoOfertaResult">
	 select a.oid_tipo_ofer,
       b.cod_cana,
       a.cod_tipo_ofer,
       c.val_i18n DESCRIPCION,
       ind_comi,
       ind_punt,
       ind_esta,
       ind_mont_mini,
       ind_apor_mont_esca,
       ind_grat,
       val_form_vent,
       num_secc_deta_fact
       from pre_tipo_ofert a, seg_canal b, gen_i18n_sicc_comun c
       where a.cana_oid_cana = b.oid_cana
       and a.oid_tipo_ofer = c.val_oid
       and c.attr_enti = 'PRE_TIPO_OFERT' 
       AND( IND_ELIM =0 or IND_ELIM is null)
       
       <isNotEmpty prepend="AND" property="codigoTipoOferta">
				a.cod_tipo_ofer =#codigoTipoOferta#
	   </isNotEmpty>
	   
	   <isNotEmpty prepend="AND" property="descripcion">
               c.val_i18n like '%'||#descripcion#||'%'
	   </isNotEmpty>
	</select>	
	
	
	<select id="getManPRETipoOferta" parameterClass="java.util.Map" resultMap="getManPRETipoOfertaResult">
	select a.oid_tipo_ofer,
	       b.cod_cana,
	       a.cod_tipo_ofer,
	       c.val_i18n DESCRIPCION,
	       ind_comi,
	       ind_punt,
	       ind_esta,
	       ind_mont_mini,
	       ind_apor_mont_esca,
	       ind_grat,
	       val_form_vent,
	       num_secc_deta_fact
	       from pre_tipo_ofert a, seg_canal b, gen_i18n_sicc_comun c
	       where a.cana_oid_cana = b.oid_cana
	       and a.oid_tipo_ofer = c.val_oid
	       and c.attr_enti = 'PRE_TIPO_OFERT' 
	       and oid_tipo_ofer = #oidTipoOferta#
	</select>
		
	   
   <insert id="insertManPRETipoOferta" parameterClass="java.util.Map" >
	Insert into PRE_TIPO_OFERT
		(OID_TIPO_OFER,
		cana_oid_cana,
		COD_TIPO_OFER,
		IND_COMI,
	    IND_PUNT,
		IND_ESTA,
		IND_MONT_MINI,
		IND_APOR_MONT_ESCA,
		IND_GRAT,
		VAL_FORM_VENT,
		NUM_SECC_DETA_FACT,
		IND_ELIM,		
	    USU_CREA,		
	    FEC_CREA )
		Values
		(pre_tofe_seq.nextval,
		 '2001',
		 #codigoTipoOferta#,
		 #indComisionable#,
		 #indOtorgaPuntaje#,
		 #indEstadisticable#,
		 #indAportaMontoMinimo#,
		 #indAportaEscalaDesc#,
		 '0',
		 #codMedioVenta#,
		 #codSeccionPaquete#,
		 '0',
		 #codUsuario#,
		 SYSDATE)
	</insert>
	
	
	<insert id="insertManPRETipoOfertaDetalle" parameterClass="java.util.Map">
      Insert into GEN_I18N_SICC_COMUN
	      (OID_I18N, 
	       ATTR_ENTI, 
	       ATTR_NUM_ATRI, 
	       IDIO_OID_IDIO, 
	       VAL_I18N, 
	       VAL_OID)
	       Values
	       (
	         gen_i18c_seq.nextval,
	        'PRE_TIPO_OFERT',
	         1,
	         1,#codigoTipoOferta#||' - '||#descripcion#, 
	         pre_tofe_seq.currval
         )
	</insert>
	
	<update id="updateManPRETipoOferta" parameterClass="java.util.Map">
		UPDATE PRE_TIPO_OFERT  SET 	       
	       IND_COMI = #indComisionable#,
           IND_PUNT = #indOtorgaPuntaje#,
	       IND_ESTA = #indEstadisticable#,
	       IND_MONT_MINI = #indAportaMontoMinimo#,
	       IND_APOR_MONT_ESCA =	 #indAportaEscalaDesc#,
	       IND_GRAT = #indGrat#,
	       VAL_FORM_VENT = #codMedioVenta#,
	       NUM_SECC_DETA_FACT =	 #codSeccionPaquete#,
	       USU_MODI	= #codUsuario#,
           FEC_MODI = SYSDATE
	       WHERE OID_TIPO_OFER = #oidTipoOferta#
	</update>
	
	<update id="updateManPRETipoOfertaDetalle" parameterClass="java.util.Map">
      	Update GEN_I18N_SICC_COMUN       	
      	set val_i18n =#codigoTipoOferta#||' - ' ||#descripcion#      	
      	where val_oid =#oidTipoOferta# 
      	and attr_enti ='PRE_TIPO_OFERT'
	</update>
	
	<update id="deleteManPRETipoOferta" parameterClass="java.util.Map">
          update pre_tipo_ofert set 
          ind_elim = 1 ,
          USU_MODI =#codigoUsuario#,	
          FEC_MODI	=SYSDATE		
          where oid_tipo_ofer = #oidTipoOferta# 
	</update>
    
    <select id="validaManPRETipoOferta" resultClass="int" parameterClass="java.lang.String">
        SELECT COUNT(1) FROM PRE_TIPO_OFERT
        WHERE COD_TIPO_OFER = #codigoTipoOferta#
    </select> 
    
    
     <resultMap id="getManPREEstimadosResult"  class="java.util.HashMap"  >    
         <result property="oidEstimados" 	column="oid_estim_vent" />
         <result property="sap" 			column="cod_sap" />
         <result property="campana" 		column="cod_peri" />
         <result property="estrategia" 		column="val_i18n" />
         <result property="tipoOferta" 		column="cod_tipo_ofer" />
         <result property="catalogo" 		column="des_cata" />
         <result property="pagina" 			column="num_pagi_cata" />
         <result property="precioCatalogo" 	column="imp_prec_cata" />
         <result property="ventaEstimada" 	column="imp_vent_neta_esti" />
         <result property="precioPosicionamiento" column="imp_prec_posi" />
         <result property="indOfertaGenerada" 	column="ind_ofer_gene" />         
 
	</resultMap>
	
    <select id="getManPREEstimadosList" parameterClass="java.util.Map" resultMap="getManPREEstimadosResult">
	select a.oid_estim_vent,
       b.cod_sap,
       e.cod_peri,
       f.val_i18n,
       c.cod_tipo_ofer,
       g.des_cata,
       a.num_pagi_cata,
       a.imp_prec_cata,
       a.imp_vent_neta_esti,
       a.imp_prec_posi,
       a.ind_ofer_gene
       from pre_estim_venta    a,
       mae_produ          b,
       pre_tipo_ofert     c,
       cra_perio          d,
       seg_perio_corpo    e,
       gen_i18n_sicc_pais f,
       pre_catal          g
       where a.prod_oid_prod = b.oid_prod
       and a.tofe_oid_tipo_ofer = c.oid_tipo_ofer
       and a.perd_oid_peri = d.oid_peri
       and d.peri_oid_peri = e.oid_peri
       and a.coes_oid_estr = f.val_oid
       and f.attr_enti = 'PRE_ESTRA'
       and a.ocat_oid_cata = g.oid_cata    
       and e.cod_peri = #codigoPeriodo#  	   
	   <isNotEmpty prepend="AND" property="codigoCatalago">
             cod_cata  = #codigoCatalago#
	   </isNotEmpty>  
	   
	</select>
	
    
    <delete id="deleteManPREEstimados" parameterClass="java.util.Map">
           Delete from pre_estim_venta where oid_estim_vent = #oidEstimados#
    </delete>
    
    
   <select id="getManPREEstimadosCatalogoList" parameterClass="java.util.Map" resultMap="baseResult">
            Select oid_cata,
            cod_cata as CODIGO, 
            des_cata as DESCRIPCION
            from pre_catal
	</select>
	
	<delete id="deleteOfertaIndividual" parameterClass="java.util.Map">
		DELETE PRE_OFERT
		 WHERE OID_OFER = #oidOferta#
	</delete>

	<insert id="insertPromoProduCompoTemporal" parameterClass="java.util.Map">
		<![CDATA[
		INSERT INTO PRE_PROMO_PRODU_COMPO_TEMP (
			OID_DETA_OFER, 
			VAL_CODI_VENT, 
			COD_SAP, 
			DES_PROD, 
			DES_CATA, 
			NUM_PAGI_CATA, 
			COD_TIPO_OFER)
		select proXrango.oid_deta_ofer,
		       proXrango.val_codi_vent CUV_APOYADO,
		       proXrango.cod_sap,
		       int_pkg_recla.GEN_FN_DESC_PROD(proXrango.OID_PROD) desc_prod,
		       proXrango.des_cata,
		       proXrango.num_pagi_cata,
		       proXrango.TIPO_OFERTA
		  from pre_ofert_detal a,
		       pre_ofert b,
		       pre_matri_factu_cabec c,
		       cra_perio d,
		       seg_perio_corpo e,
		       pre_estra f,
		       pre_promo g,
		       gen_i18n_sicc_pais gestr,
		       mae_produ prod,
		       pre_tipo_ofert tof,
		       pre_catal pcata,
		       seg_pais sp,
		       (select h.oid_ofer,
		               l.oid_deta_ofer,
		               j.OID_RANG_PROM,
		               l.VAL_CODI_VENT,
		               k.COD_SAP,
		               k.oid_prod,
		               int_pkg_recla.GEN_FN_DESC_PROD(k.OID_PROD) DESCRIPCION,
		               cat.des_cata,
		               l.NUM_PAGI_CATA,
		               v.COD_TIPO_OFER TIPO_OFERTA
		          from pre_ofert             h,
		               pre_promo             i,
		               pre_rango_promo       j,
		               mae_produ             k,
		               pre_ofert_detal       l,
		               pre_ofert             ll,
		               pre_catal             cat,
		               pre_matri_factu_cabec pmfc,
		               cra_perio             crap,
		               seg_perio_corpo       spcorp,
		               pre_tipo_ofert        v,
		               seg_pais              sp
		         where k.pais_oid_pais = cat.pais_oid_pais
		           and crap.pais_oid_pais = sp.oid_pais
		           and sp.cod_pais = #codigoPais#
		           and h.OID_OFER = i.OFER_OID_OFER
		           and i.OID_PROM = j.POMO_OID_PROM
		           and j.OCAT_OID_CATA = ll.OCAT_OID_CATA
		           and ll.OCAT_OID_CATA = cat.oid_cata
		           and l.NUM_PAGI_CATA >= j.VAL_DESD
		           and l.NUM_PAGI_CATA <= j.VAL_HAST
		           and j.COD_TIPO_RANG = 'R'
		           and ll.MFCA_OID_CABE = pmfc.OID_CABE
		           and pmfc.PERD_OID_PERI = crap.OID_PERI
		           and crap.PERI_OID_PERI = spcorp.OID_PERI
		           and spcorp.COD_PERI = #codigoPeriodo#
		           and l.PROD_OID_PROD = k.OID_PROD
		           and j.IND_EXCL = 0
		           and h.MFCA_OID_CABE = ll.MFCA_OID_CABE
		           and ll.OID_OFER = l.OFER_OID_OFER
		           and l.TOFE_OID_TIPO_OFER = v.OID_TIPO_OFER
		           and k.cod_sap not in
		               (select p.COD_SAP
		                  from pre_ofert       m,
		                       pre_promo       n,
		                       pre_rango_promo o,
		                       mae_produ       p,
		                       pre_ofert_detal q
		                 where m.OID_OFER = n.OFER_OID_OFER
		                   and n.OID_PROM = o.POMO_OID_PROM
		                   and o.OCAT_OID_CATA = q.OCAT_OID_CATAL
		                   and q.NUM_PAGI_CATA >= o.VAL_DESD
		                   and q.NUM_PAGI_CATA <= o.VAL_HAST
		                   and o.COD_TIPO_RANG = 'R'
		                   and q.PROD_OID_PROD = p.OID_PROD
		                   and o.IND_EXCL = 1
		                   and o.pomo_oid_prom = j.pomo_oid_prom)
		           and k.oid_prod not in
		               (select x.VAL_DESD
		                  from pre_rango_promo x
		                 where x.COD_TIPO_RANG = 'P'
		                   and x.IND_EXCL = 1
		                   and x.POMO_OID_PROM = i.OID_PROM)
		        union
		        select h.oid_ofer,
		               l.oid_deta_ofer,
		               j.OID_RANG_PROM,
		               l.VAL_CODI_VENT,
		               k.COD_SAP,
		               k.oid_prod,
		               int_pkg_recla.GEN_FN_DESC_PROD(k.OID_PROD) DESCRIPCION,
		               cat.des_cata,
		               l.num_pagi_cata,
		               v.cod_tipo_ofer
		          from pre_ofert             h,
		               pre_promo             i,
		               pre_rango_promo       j,
		               mae_produ             k,
		               pre_ofert_detal       l,
		               pre_ofert             ll,
		               pre_catal             cat,
		               pre_matri_factu_cabec pmfc,
		               cra_perio             crap,
		               seg_perio_corpo       spcorp,
		               pre_tipo_ofert        v,
		               seg_pais              sp
		         where h.OID_OFER = i.OFER_OID_OFER
		           and i.OID_PROM = j.POMO_OID_PROM
		           and j.OCAT_OID_CATA = ll.OCAT_OID_CATA
		           and ll.OCAT_OID_CATA = cat.oid_cata
		           and j.COD_TIPO_RANG = 'P'
		           and ll.MFCA_OID_CABE = pmfc.OID_CABE
		           and pmfc.PERD_OID_PERI = crap.OID_PERI
		           and crap.PERI_OID_PERI = spcorp.OID_PERI
		           and spcorp.COD_PERI = #codigoPeriodo#
		           and j.val_desd = k.OID_PROD
		           and k.oid_prod = l.prod_oid_prod
		           and j.IND_EXCL = 0
		           and h.MFCA_OID_CABE = ll.MFCA_OID_CABE
		           and ll.OID_OFER = l.OFER_OID_OFER
		           and l.TOFE_OID_TIPO_OFER = v.OID_TIPO_OFER
		           and k.pais_oid_pais = cat.pais_oid_pais
		           and crap.pais_oid_pais = cat.pais_oid_pais
		           and crap.pais_oid_pais = sp.oid_pais
		           and sp.cod_pais = #codigoPais#
		         order by 1, 2, 3, 4) proXrango
		 where a.OFER_OID_OFER = b.OID_OFER
		   and b.MFCA_OID_CABE = c.oid_cabe
		   and c.PERD_OID_PERI = d.OID_PERI
		   and d.PERI_OID_PERI = e.OID_PERI
		   and b.COES_OID_ESTR = f.OID_ESTR
		   and b.OID_OFER = g.OFER_OID_OFER
		   and proXrango.oid_ofer = b.oid_ofer
		   and gestr.val_oid = f.OID_ESTR
		   and a.prod_oid_prod = prod.oid_prod
		   and a.tofe_oid_tipo_ofer = tof.oid_tipo_ofer
		   and b.OCAT_OID_CATA = pcata.oid_cata
		   and (f.OID_ESTR = 2005 OR f.OID_ESTR = 2006 OR f.OID_ESTR = 2007 OR
		       f.OID_ESTR = 2022)
		   and e.COD_PERI = #codigoPeriodo#
		   and gestr.attr_enti = 'PRE_ESTRA'
		   and d.pais_oid_pais = f.pais_oid_pais
		   and pcata.pais_oid_pais = f.pais_oid_pais
		   and prod.pais_oid_pais = pcata.pais_oid_pais
		   and sp.oid_pais = prod.pais_oid_pais
		   and sp.cod_pais = #codigoPais#
		   ]]>
		   <isNotEmpty property="paginaInicialCompo">
				<![CDATA[
				and proXrango.num_pagi_cata >= #paginaInicialCompo#
				]]>
		   </isNotEmpty>
		   <isNotEmpty property="paginaFinalCompo">
				<![CDATA[
				and proXrango.num_pagi_cata <= #paginaFinalCompo#
				]]>
		   </isNotEmpty>
		   <isNotEmpty property="oidCatalogoCompo">
				and b.OCAT_OID_CATA = #oidCatalogoCompo#
		   </isNotEmpty>
		 group by proXrango.oid_deta_ofer,
               proXrango.val_codi_vent,
               proXrango.cod_sap,
               int_pkg_recla.GEN_FN_DESC_PROD(proXrango.OID_PROD),
               proXrango.des_cata,
               proXrango.num_pagi_cata,
               proXrango.TIPO_OFERTA
	</insert>
	
	<delete id="deletePromoProduCompoTemporal" parameterClass="java.util.Map">
		DELETE PRE_PROMO_PRODU_COMPO_TEMP
		 <isNotEmpty property="oid">
		 WHERE OID_DETA_OFER = #oid#
		 </isNotEmpty>
		 <isNotEmpty property="codSapCompo">
		 WHERE COD_SAP = #codSapCompo#
		 </isNotEmpty>
	</delete>
	
	<resultMap id="getPromoProduCompoTemporalListResult" class="java.util.HashMap">
	    <result property="oid"					column="OID_DETA_OFER"/>
	    <result property="codigoCUV" 			column="VAL_CODI_VENT"/>
	    <result property="codigoSAP" 			column="COD_SAP"/>
	    <result property="descripcionProducto"	column="DES_PROD"/>
	    <result property="descripcionCatalogo"	column="DES_CATA"/>
	    <result property="numeroPagina" 	  	column="NUM_PAGI_CATA"/>
	    <result property="tipoOferta"			column="COD_TIPO_OFER"/>
    </resultMap>
	<select id="getPromoProduCompoTemporalList" parameterClass="java.util.Map" resultMap="getPromoProduCompoTemporalListResult">
		SELECT OID_DETA_OFER,
			   VAL_CODI_VENT,
			   COD_SAP,
			   DES_PROD,
			   DES_CATA,
			   NUM_PAGI_CATA,
			   COD_TIPO_OFER
		  FROM PRE_PROMO_PRODU_COMPO_TEMP PPPC
		 <isNotEmpty property="oid">
		 WHERE COD_SAP = #codSapCompo#
		 </isNotEmpty>
	</select>
 
</sqlMap>