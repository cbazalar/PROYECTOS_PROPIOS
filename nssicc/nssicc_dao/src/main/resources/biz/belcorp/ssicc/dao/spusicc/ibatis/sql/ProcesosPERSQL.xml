<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
    PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN"
    "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="spusicc.ProcesosPERSQL">

    <typeAlias alias="concursoDuplaCyzone" type="biz.belcorp.ssicc.dao.sisicc.model.InterfazSICConcursoDuplaCyzone"/>
    <typeAlias alias="cabecera" type="biz.belcorp.ssicc.dao.sisicc.model.MovimientosBancariosCabecera"/>
	<typeAlias alias="detalle"  type="biz.belcorp.ssicc.dao.sisicc.model.MovimientosBancariosDetalle"/>
	<typeAlias alias="consolidados"    type="biz.belcorp.ssicc.dao.sisicc.model.InterfazPERActualizarPercepcionesConsolidado"/>
	<typeAlias alias="estructuraPercepcionesPagosBancariosMasivos"  	    	    type="biz.belcorp.ssicc.dao.spusicc.percepciones.model.EstructuraPercepcionesPagosBancariosMasivos" />

	<resultMap id="cabeceraResult" class="cabecera">
		<result property="codigoPais" 				column="PAIS_COD_PAIS"/>
		<result property="codigoTipoOrigenDatos" 	column="TIOR_TIPO_ORIG_DATO"/>		
		<result property="numeroLoteInterno" 		column="NUM_LOTE_INTE"/>
		<result property="fechaProceso" 			column="FEC_PROC"/>
		<result property="codigoBancoSicc" 			column="COD_CCBA"/>
		<result property="codigoSociedad" 			column="COD_SOCI"/>		
		<result property="statusLote" 				column="STA_LOTE"/>
    	<result property="estado" 					column="EST_MOCA"/>    	
    </resultMap>
    
    <resultMap id="detalleResult" class="detalle">
	    <result property="codigoPais" 				column="PAIS_COD_PAIS"/>
		<result property="codigoTipoOrigenDatos" 	column="TIOR_TIPO_ORIG_DATO"/>		    
		<result property="numeroLoteInterno" 		column="MOCA_NUM_LOTE_INTE"/>
		<result property="consecutivo" 				column="CON_TRAN" javaType="long" nullValue="0"/>
		<result property="numeroFacturaBoleta" 		column="NUM_FABO" javaType="long" nullValue="0"/>
		<result property="fechaPago" 				column="FEC_PAGO"/>
		<result property="importePago" 				column="VAL_PAGO"/>
		<result property="numeroCupon" 				column="NUM_CUPO"/>
		<result property="codigoConsultora" 		column="COD_CONS"/>
		<result property="digitoChequeo" 			column="DIG_CHEQ"/>
		<result property="oficinaRecaudadora" 		column="OFI_RECA"/>
		<result property="nombreOficina" 			column="NOM_OFIC"/>
		<result property="tipoTransaccion" 			column="TIP_TRAN"/>
		<result property="numeroDocumento" 			column="NUM_DOCU"/>
		<result property="horario" 					column="VAL_HORA"/>
		<result property="usuarioProceso" 			column="USU_PROC"/>
		<result property="fechaProceso" 			column="FEC_PROC"/>
		<result property="horaProceso" 				column="HOR_PROC"/>
		<result property="estado" 					column="EST_MODE"/>	
		<result property="observacion" 				column="DES_OBSE"/>
		<result property="importePagoAplicado" 		column="IMP_PAGO_APLI" javaType="double" nullValue="0"/>
		<result property="importePagoPendiente"		column="IMP_PAGO_PEND" javaType="double" nullValue="0"/>
		<result property="importeRecaudoGenerado"	column="IMP_RECA_GENE" javaType="double" nullValue="0"/>
		<result property="importePercepcion"		column="IMP_PERC" 	   javaType="double" nullValue="0"/>
		<result property="statusMovimiento"			column="STA_MOVI"/>
    </resultMap>

	<resultMap id="movimientosBancariosMapResult" class="java.util.HashMap">
		<result property="numeroLoteInterno" 	 	column="NUMERO_LOTE_INTERNO"/>
		<result property="sociedad"					column="SOCIEDAD"/>
		<result property="cuentaCorriente"			column="CTA_CTE_BANCARIA"/>
		<result property="fechaProceso"				column="FECHA_PROCESO"/>
		<result property="status"					column="STATUS"/>
		<result property="codigoTipoOrigenDatos"	column="CODIGO_TIPO_ORIGEN"/>
		<result property="tipoOrigenDatos"			column="TIPO_ORIGEN_DATOS"/>
		<result property="importeTotal"				column="IMPORTE_TOTAL"/>
		<result property="importeRecaudo"			column="IMPORTE_RECAUDO"/>
		<result property="numeroTransacciones"		column="NUMERO_TRANSACCIONES" javaType="long" nullValue="0"/>
    </resultMap>
    
    <!-- CONSOLIDADO OTROS CANALES -->
	<resultMap id="consolidadosResult" class="consolidados">    
	    <result property="codigoPais" column="PAIS_COD_PAIS"/>
		<result property="codigoSociedad" column="COD_SOCI"/>
		<result property="codigoCanal" column="COD_CANA"/>
		<result property="codigoAcceso" column="COD_ACCE"/>
		<result property="codigoSubacceso" column="COD_SBAC"/>
		<result property="tipoCliente" column="TIP_CLIE"/>
		<result property="codigoCliente" column="COD_CLIE"/>
		<result property="serieComprobantePercepcion" column="SER_COPE"/>
		<result property="numeroComprobantePercepcion" column="NUM_COPE"/>
		<result property="secuenciaComprobantePercepcion" column="SEC_COPE"/>
		<result property="correlativoComprobantePercepcion" column="COR_PECO"/>
		<result property="tipoDocumentoIdentidad" column="TIP_DOID"/>
		<result property="numeroDocumentoIdentidad" column="NUM_DOID"/>
		<result property="tipoDocumentoLegal" column="TIP_DOLE"/>
		<result property="fechaEmisionDocumentoLegal" column="FEC_DOLE"/>
		<result property="serieDocumentoLegal" column="SER_DOLE"/>
		<result property="numeroDocumentoLegal" column="NUM_DOLE"/>
		<result property="montoPago" column="MON_PAGO"/>
		<result property="montoPercepcion" column="MON_PERC"/>
		<result property="porcentajePercepcion" column="POR_PERC"/>
		<result property="montoTotalDocumentoLegal" column="MON_TODL"/>
		<result property="fechaEmisionComprobantePercepcion" column="FEC_COPE"/>
		<result property="flagProceso" column="FLA_PROC"/>
		<result property="flagCancelacion" column="FLA_CANC"/>
		<result property="estado" column="EST_PECO"/>
		<result property="apellidoPaterno" column="APE_PATE"/>
		<result property="apellidoMaterno" column="APE_MATE"/>
		<result property="nombres" column="VAL_NOMB"/>
	</resultMap>	
	
	
	<resultMap id="consolidadosMapResult" class="java.util.HashMap">    
	    <result property="pais" column="PAIS"/>
		<result property="correlativo" column="COR_PECO"/>
		<result property="serieComproPercepcion" column="SER_COPE"/>
		<result property="numeroComproPercepcion" column="NUM_COPE"/>
		<result property="secuenciaComprobante" column="SEC_COPE"/>
		<result property="codigoCliente" column="CODIGOCLIENTE"/>		
		<result property="tipoComprobantePago" column="TIP_DOLE"/>
		<result property="serieComprobantePago" column="SER_DOLE"/>
		<result property="numeroComprobantePago" column="NUM_DOLE"/>		
		<result property="montoPago" column="MON_PAGO"/>
		<result property="montoPercepcion" column="MON_PERC"/>
        <result property="sociedad" column="SOCIEDAD"/>
		<result property="canal" column="CANAL"/>
		<result property="acceso" column="ACCESO"/>
		<result property="subacceso" column="SUBACCESO"/>
		<result property="tipoCliente" column="TIPOCLIENTE"/>
		<result property="codigoCanal" column="COD_CANA"/>
		<result property="codigoAcceso" column="COD_ACCE"/>
		<result property="fechaEmisionComprobantePercepcion" column="FEC_COPE"/>
	</resultMap>	
    
	<resultMap id="consolidadoAcumuladoMapResult" class="java.util.HashMap">    
	    <result property="sociedad" column="SOCIEDAD"/>
	    <result property="descripcionCanal" column="DES_CANAL"/>	   	     
	    <result property="codigo" column="CODIGO"/>
	    <result property="descripcion" column="DESCRIPCION"/>
	     <result property="codigoSubAcceso"     column="CODIGO_SUB"/>
	    <result property="descripcionSubAcceso" column="DESCRIPCION_SUB"/>
	    <result property="montoPago" column="MONTO_PAGO"/>
	    <result property="montoPercepcion" column="MONTO_PERCEPCION"/>
	</resultMap>
   
	<resultMap id="busquedaConcursosMantenerDuplaCyzoneMapResult" class="java.util.HashMap">    
	
	    <result property="idConcurso" column="ID_CONCURSO"/>
	    <result property="codigoConcurso" column="CODIGO_CONCURSO"/>
	    <result property="nombreConcurso" column="NOMBRE_CONCURSO"/>
	    <result property="codigoPlantilla" column="CODIGO_PLANTILLA"/>	    
	    <result property="nombrePlantilla" column="DESC_PLANTILLA"/>
	    <result property="version" column="VERSION"/>
	    <result property="nombreMarca" column="NOMBRE_MARCA"/>
	    <result property="nombreCanal" column="NOMBRE_CANAL"/>
	    <result property="nombreAccesoConcurso" column="ACCESO_CONCURSO"/>
	</resultMap>

	<resultMap id="concursoDuplaCyzoneMapResult" class="concursoDuplaCyzone">    
	    <result property="idConcurso" column="ID_CONCURSO"/>
	    <result property="codigoConcurso" column="CODIGO_CONCURSO"/>
	    <result property="nombreConcurso" column="NOMBRE_CONCURSO"/>
	    <result property="idConcursoDuplaCyzone" column="ID_CONCUDUPLA"/>
	    <result property="indicadorDupla" column="INDICADOR_DUPLA"/>
	</resultMap>


   <select id="getMovimientosBancarios" parameterClass="cabecera"
    		resultMap="movimientosBancariosMapResult">
	    SELECT 
         A.NUM_LOTE_INTE NUMERO_LOTE_INTERNO,
		 (SELECT VAL_DENO FROM SEG_SOCIE WHERE COD_SOCI = A.COD_SOCI AND ROWNUM=1) SOCIEDAD,
		 (SELECT DES_CC FROM CCC_CUENT_CORRI_BANCA WHERE	COD_CC = A.COD_CCBA AND ROWNUM=1) CTA_CTE_BANCARIA,
		 A.FEC_PROC FECHA_PROCESO,
		 A.STA_LOTE STATUS,
		 A.TIOR_TIPO_ORIG_DATO CODIGO_TIPO_ORIGEN,
		 (SELECT DES_TIPO_ORIG_DATO FROM PER_TIPO_ORIGE_DATOS WHERE COD_TIPO_ORIG_DATO = A.TIOR_TIPO_ORIG_DATO AND ROWNUM=1) TIPO_ORIGEN_DATOS,
         (SELECT SUM(B.VAL_PAGO)
          FROM PER_MOVIM_BANCA_DETAL B 
          WHERE B.PAIS_COD_PAIS =  A.PAIS_COD_PAIS AND
                B.TIOR_TIPO_ORIG_DATO = A.TIOR_TIPO_ORIG_DATO AND
                B.MOCA_NUM_LOTE_INTE  = A.NUM_LOTE_INTE) IMPORTE_TOTAL,
		  (SELECT SUM(B.IMP_RECA_GENE)
          FROM PER_MOVIM_BANCA_DETAL B 
          WHERE B.PAIS_COD_PAIS =  A.PAIS_COD_PAIS AND
                B.TIOR_TIPO_ORIG_DATO = A.TIOR_TIPO_ORIG_DATO AND
                B.MOCA_NUM_LOTE_INTE  = A.NUM_LOTE_INTE) IMPORTE_RECAUDO,		
				
         (SELECT COUNT(B.MOCA_NUM_LOTE_INTE)
          FROM PER_MOVIM_BANCA_DETAL B 
          WHERE B.PAIS_COD_PAIS =  A.PAIS_COD_PAIS AND
                B.TIOR_TIPO_ORIG_DATO = A.TIOR_TIPO_ORIG_DATO AND
                B.MOCA_NUM_LOTE_INTE  = A.NUM_LOTE_INTE) AS NUMERO_TRANSACCIONES 
		 FROM PER_MOVIM_BANCA_CABEC A
		 WHERE A.EST_MOCA != 9
		<isNotEmpty prepend="AND" property="codigoPais">
		(A.PAIS_COD_PAIS = #codigoPais#)
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="codigoTipoOrigenDatos">
		(A.TIOR_TIPO_ORIG_DATO = #codigoTipoOrigenDatos#)
		</isNotEmpty>
        <isNotEmpty prepend="AND" property="numeroLoteInterno">
		(A.NUM_LOTE_INTE = #numeroLoteInterno#)
		</isNotEmpty>
        <isNotEmpty prepend="AND" property="fechaProceso">
		(A.FEC_PROC = #fechaProceso#)
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="codigoSociedad">
		(A.COD_SOCI = #codigoSociedad#)
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="codigoBancoSicc">
		(A.COD_CCBA = #codigoBancoSicc#)
        </isNotEmpty>
		<isNotEmpty prepend="AND" property="statusLote">
		(A.STA_LOTE = #statusLote#)
		</isNotEmpty>
		ORDER BY A.NUM_LOTE_INTE, A.TIOR_TIPO_ORIG_DATO
	</select>

   <select id="getMovimientosBancariosCabecera" parameterClass="cabecera"
    		resultMap="cabeceraResult">
    	SELECT
    	PAIS_COD_PAIS,
		TIOR_TIPO_ORIG_DATO,    	
		NUM_LOTE_INTE,
		FEC_PROC,
		COD_SOCI,
		COD_CCBA,
		STA_LOTE,
		EST_MOCA
		FROM PER_MOVIM_BANCA_CABEC
		WHERE PAIS_COD_PAIS = #codigoPais#
        <isNotEmpty prepend="AND" property="codigoTipoOrigenDatos">
		TIOR_TIPO_ORIG_DATO = #codigoTipoOrigenDatos#
		</isNotEmpty>		
        <isNotEmpty prepend="AND" property="numeroLoteInterno">
		NUM_LOTE_INTE = #numeroLoteInterno#
		</isNotEmpty>
        <isNotEmpty prepend="AND" property="numeroLoteExterno">
		  NUM_LOTE_EXTE = #numeroLoteExterno#
		</isNotEmpty>
       <isNotEmpty prepend="AND" property="fechaProceso">
		FEC_PROC = #fechaProceso#
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="codigoSociedad">
		COD_SOCI = #codigoSociedad#
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="codigoBancoSicc">
		COD_CCBA = #codigoBancoSicc#
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="estado">
   		EST_MOCA = #estado#
        </isNotEmpty>
        ORDER BY PAIS_COD_PAIS,	TIOR_TIPO_ORIG_DATO, NUM_LOTE_INTE
	</select>
	
	<select id="getMovimientosBancariosDetalle" parameterClass="detalle"
			resultMap="detalleResult">
    	SELECT
		PAIS_COD_PAIS,
		TIOR_TIPO_ORIG_DATO,
		MOCA_NUM_LOTE_INTE,
		CON_TRAN,
		NUM_FABO,
		FEC_PAGO,
		VAL_PAGO,
		NUM_CUPO,
		COD_CONS,
		DIG_CHEQ,
		OFI_RECA,
		NOM_OFIC,
		TIP_TRAN,
		NUM_DOCU,
		VAL_HORA,
		USU_PROC,
		FEC_PROC,
		HOR_PROC,
		EST_MODE,
		DES_OBSE,
		IMP_PAGO_APLI,
		IMP_PAGO_PEND,
		IMP_RECA_GENE,
		IMP_PERC,
		STA_MOVI
		FROM PER_MOVIM_BANCA_DETAL
		WHERE PAIS_COD_PAIS = #codigoPais#
		AND EST_MODE != 9
		<isNotEmpty prepend="AND" property="codigoTipoOrigenDatos">
			TIOR_TIPO_ORIG_DATO=#codigoTipoOrigenDatos#
		</isNotEmpty>
        <isNotEmpty prepend="AND" property="numeroLoteInterno">
			MOCA_NUM_LOTE_INTE=#numeroLoteInterno#
		</isNotEmpty>
        <isGreaterThan prepend="AND" property="consecutivo" compareValue="0">
			CON_TRAN=#consecutivo#
		</isGreaterThan>
		<isGreaterThan prepend="AND" property="numeroFacturaBoleta" compareValue="0">
			NUM_FABO=#numeroFacturaBoleta#
		</isGreaterThan>
		<isNotEmpty prepend="AND" property="fechaPago">
			FEC_PAGO=#fechaPago#
		</isNotEmpty>
		<isGreaterThan prepend="AND" property="importePago" compareValue="0.0">
			VAL_PAGO=#importePago#
		</isGreaterThan>
		<isNotEmpty prepend="AND" property="numeroCupon">
			NUM_CUPO=#numeroCupon#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="codigoConsultora">
			COD_CONS=#codigoConsultora#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="digitoChequeo">
			DIG_CHEQ=#digitoChequeo#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="oficinaRecaudadora">
			OFI_RECA=#oficinaRecaudadora#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="nombreOficina">
			NOM_OFIC=#nombreOficina#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="tipoTransaccion">
			TIP_TRAN=#tipoTransaccion#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="numeroDocumento">
			NUM_DOCU=#numeroDocumento#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="horario">
			VAL_HORA=#horario#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="usuarioProceso">
			USU_PROC=#usuarioProceso#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="fechaProceso">
			FEC_PROC=#fechaProceso#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="horaProceso">
			HOR_PROC=#horaProceso#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="estado">
			EST_MODE=#estado#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="observacion">
			DES_OBSE=#observacion#
		</isNotEmpty>
		<isGreaterThan prepend="AND" property="importePagoAplicado" compareValue="0.0">
			IMP_PAGO_APLI=#importePagoAplicado#
		</isGreaterThan>
		<isGreaterThan prepend="AND" property="importePagoPendiente" compareValue="0.0">
			IMP_PAGO_PEND=#importePagoPendiente#
		</isGreaterThan>
		<isGreaterThan prepend="AND" property="importeRecaudoGenerado" compareValue="0.0">
			IMP_RECA_GENE=#importeRecaudoGenerado#
		</isGreaterThan>
		<isGreaterThan prepend="AND" property="importePercepcion" compareValue="0.0">
			IMP_PERC=#importePercepcion#
		</isGreaterThan>
		<isNotEmpty prepend="AND" property="statusMovimiento">
			STA_MOVI=#statusMovimiento#
		</isNotEmpty>
		ORDER BY PAIS_COD_PAIS,	TIOR_TIPO_ORIG_DATO, MOCA_NUM_LOTE_INTE, CON_TRAN
	</select>

	<select id="getConsolidadoPercepcion" parameterClass="consolidados"
			resultMap="consolidadosResult">
		SELECT
		PAIS_COD_PAIS,
		COD_SOCI,
		COD_CANA,
		COD_ACCE,
		COD_SBAC,
		TIP_CLIE,
		COD_CLIE,
		SER_COPE,
		NUM_COPE,
		SEC_COPE,
		COR_PECO,
		TIP_DOID,
		NUM_DOID,
		TIP_DOLE,
		FEC_DOLE,
		SER_DOLE,
		NUM_DOLE,
		MON_PAGO,
		MON_PERC,
		POR_PERC,
		MON_TODL,
		FEC_COPE,
		FLA_PROC,
		FLA_CANC,
		EST_PECO,
		APE_PATE,
		APE_MATE,
		VAL_NOMB
		FROM PER_PERCE_CONSO
		WHERE EST_PECO != '9'
		<isNotEmpty prepend="AND" property="codigoPais">
			PAIS_COD_PAIS=#codigoPais#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="codigoSociedad">
			COD_SOCI=#codigoSociedad#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="codigoCanal">
			COD_CANA=#codigoCanal#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="codigoAcceso">
			COD_ACCE=#codigoAcceso#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="codigoSubacceso">
			COD_SBAC=#codigoSubacceso#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="tipoCliente">
			TIP_CLIE=#tipoCliente#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="codigoCliente">
			COD_CLIE=#codigoCliente#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="serieComprobantePercepcion">
			SER_COPE=#serieComprobantePercepcion#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="numeroComprobantePercepcion">
			NUM_COPE=#numeroComprobantePercepcion#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="secuenciaComprobantePercepcion">
			SEC_COPE=#secuenciaComprobantePercepcion#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="correlativoComprobantePercepcion">
			COR_PECO=#correlativoComprobantePercepcion#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="tipoDocumentoIdentidad">
			TIP_DOID=#tipoDocumentoIdentidad#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="numeroDocumentoIdentidad">
			NUM_DOID=#numeroDocumentoIdentidad#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="tipoDocumentoLegal">
			TIP_DOLE=#tipoDocumentoLegal#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="fechaEmisionDocumentoLegal">
			FEC_DOLE=#fechaEmisionDocumentoLegal#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="serieDocumentoLegal">
			SER_DOLE=#serieDocumentoLegal#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="numeroDocumentoLegal">
			NUM_DOLE=#numeroDocumentoLegal#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="montoPago">
			MON_PAGO=#montoPago#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="montoPercepcion">
			MON_PERC=#montoPercepcion#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="porcentajePercepcion">
			POR_PERC=#porcentajePercepcion#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="montoTotalDocumentoLegal">
			MON_TODL=#montoTotalDocumentoLegal#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="fechaEmisionComprobantePercepcion">
			FEC_COPE=#fechaEmisionComprobantePercepcion#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="flagProceso">
			FLA_PROC=#flagProceso#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="flagCancelacion">
			FLA_CANC=#flagCancelacion#
		</isNotEmpty>		
	</select>


	<select id="getPercepcionesOtrosCanales" parameterClass="java.util.Map"
			resultMap="consolidadosMapResult">
	    SELECT
		  A.PAIS_COD_PAIS PAIS,
	      A.COR_PECO,
          A.SER_COPE,
          A.NUM_COPE,
          A.SEC_COPE,
		  A.COD_CLIE CODIGOCLIENTE,
          A.TIP_DOLE,
          A.SER_DOLE,
          A.NUM_DOLE,
          A.MON_PAGO,
          A.MON_PERC,
		  (SELECT B.VAL_DENO FROM SEG_SOCIE B WHERE B.COD_SOCI = A.COD_SOCI AND ROWNUM = 1) SOCIEDAD,
		  (SELECT VAL_I18N FROM GEN_I18N_SICC_COMUN P, 
		        SEG_CANAL C, 
		        SEG_IDIOM I  
		   WHERE    P.VAL_OID = C.OID_CANA
		        AND P.IDIO_OID_IDIO = I.OID_IDIO
		        AND P.ATTR_ENTI = 'SEG_CANAL'
			    AND C.COD_CANA = A.COD_CANA
		        AND I.COD_ISO_IDIO = #codigoIdioma#) CANAL,
   		  (SELECT GEN_I18N_SICC_COMUN.VAL_I18N  
	       FROM    SEG_CANAL,
	               SEG_ACCES,
	              GEN_I18N_SICC_COMUN,
	              SEG_IDIOM
  	 	   WHERE (    (GEN_I18N_SICC_COMUN.ATTR_ENTI = 'SEG_ACCES')
	           AND (SEG_IDIOM.COD_ISO_IDIO = #codigoIdioma#)
			   AND (SEG_CANAL.COD_CANA = A.COD_CANA)
			   AND (SEG_ACCES.COD_ACCE = A.COD_ACCE)
	           AND (SEG_CANAL.OID_CANA = SEG_ACCES.CANA_OID_CANA)
	           AND (SEG_IDIOM.OID_IDIO = GEN_I18N_SICC_COMUN.IDIO_OID_IDIO)
	           AND (GEN_I18N_SICC_COMUN.VAL_OID = SEG_ACCES.OID_ACCE)
	          )) ACCESO,
		  (SELECT VAL_I18N
		   FROM    GEN_I18N_SICC_COMUN P, 
		        SEG_SUBAC S, 
		        SEG_ACCES C, 
		        SEG_IDIOM I 
		   WHERE      C.OID_ACCE = S.ACCE_OID_ACCE 
	           AND P.VAL_OID = S.OID_SBAC
	           AND P.IDIO_OID_IDIO = I.OID_IDIO
			   AND S.COD_SBAC = A.COD_SBAC
			   AND C.COD_ACCE = A.COD_ACCE
	           AND P.ATTR_ENTI = 'SEG_SUBAC'
	           AND I.COD_ISO_IDIO = #codigoIdioma#
		   ) SUBACCESO,
		  (SELECT VAL_I18N
		   FROM   GEN_I18N_SICC_COMUN P, 
		       MAE_TIPO_CLIEN C, 
		       SEG_IDIOM I
		   WHERE  P.VAL_OID = C.OID_TIPO_CLIE
	          AND P.IDIO_OID_IDIO = I.OID_IDIO
		      AND C.COD_TIPO_CLIE = A.TIP_CLIE 
	          AND P.ATTR_ENTI = 'MAE_TIPO_CLIEN'
	          AND I.COD_ISO_IDIO = #codigoIdioma#) TIPOCLIENTE,
			A.COD_CANA,
			A.COD_ACCE,
			TO_CHAR(A.FEC_COPE,'dd/MM/yyyy') FEC_COPE
		FROM PER_PERCE_CONSO A
		WHERE EST_PECO != '9'
		AND PAIS_COD_PAIS = #codigoPais#
		<isNotEmpty prepend="AND" property="codigoSociedad">
			COD_SOCI=#codigoSociedad#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="codigoCanal">
			COD_CANA=#codigoCanal#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="codigoAcceso">
			COD_ACCE=#codigoAcceso#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="codigoSubacceso">
			COD_SBAC=#codigoSubacceso#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="tipoCliente">
			TIP_CLIE=#tipoCliente#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="codigoCliente">
			COD_CLIE=#codigoCliente#
		</isNotEmpty>		
		<isNotEmpty prepend="AND" property="serieComproPercepcion">
			SER_COPE=#serieComproPercepcion#
		</isNotEmpty>		
		<isNotEmpty prepend="AND" property="numeroComproPercepcion">
			NUM_COPE=#numeroComproPercepcion#
		</isNotEmpty>		
		<isNotEmpty prepend="AND" property="fechaEmisionComprobantePercepcion">			
			TRUNC(A.FEC_COPE)= TO_DATE(#fechaEmisionComprobantePercepcion#,'DD/MM/YYYY') 			
		</isNotEmpty>		
	</select>
	
    <update id="updateMovimientosBancariosCabecera" parameterClass="cabecera">
		UPDATE PER_MOVIM_BANCA_CABEC
		SET USU_MODI = #auditInfo.updatedBy#,
        	FEC_MODI = #auditInfo.lastUpdated#
        <isNotEmpty prepend="," property="fechaProceso">
			FEC_PROC = #fechaProceso#
        </isNotEmpty>
        <isNotEmpty prepend="," property="codigoSociedad">
			COD_SOCI = #codigoSociedad#
        </isNotEmpty>
        <isNotEmpty prepend="," property="codigoBancoSicc">
			COD_CCBA = #codigoBancoSicc#
        </isNotEmpty>
		<isNotEmpty prepend="," property="statusLote">
			STA_LOTE = #statusLote#
        </isNotEmpty>
		<isNotEmpty prepend="," property="codigoTipoOrigenDatos">
			TIOR_TIPO_ORIG_DATO = #codigoTipoOrigenDatos#
        </isNotEmpty>        
   		<isNotEmpty prepend="," property="estado">
			EST_MOCA = #estado#
        </isNotEmpty>        
        WHERE PAIS_COD_PAIS = #codigoPais#
		<isNotEmpty prepend="AND" property="codigoTipoOrigenDatos">
			TIOR_TIPO_ORIG_DATO = #codigoTipoOrigenDatos#
        </isNotEmpty>          
        <isNotEmpty prepend="AND" property="numeroLoteInterno">
			NUM_LOTE_INTE = #numeroLoteInterno#
		</isNotEmpty>
    </update>   
    
    <update id="updateMovimientosBancariosDetalle" parameterClass="detalle">
		UPDATE PER_MOVIM_BANCA_DETAL
		SET USU_MODI = #auditInfo.updatedBy#,
			FEC_MODI = #auditInfo.lastUpdated#
    	<isGreaterThan prepend="," property="numeroFacturaBoleta" compareValue="0">
			NUM_FABO=#numeroFacturaBoleta#
		</isGreaterThan>
		<isNotEmpty prepend="," property="fechaPago">
			FEC_PAGO=#fechaPago#
		</isNotEmpty>
		<isGreaterThan prepend="," property="importePago" compareValue="0.0">
			VAL_PAGO=#importePago#
		</isGreaterThan>
		<isNotEmpty prepend="," property="numeroCupon">
			NUM_CUPO=#numeroCupon#
		</isNotEmpty>
		<isNotEmpty prepend="," property="codigoConsultora">
			COD_CONS=#codigoConsultora#
		</isNotEmpty>
		<isNotEmpty prepend="," property="digitoChequeo">
			DIG_CHEQ=#digitoChequeo#
		</isNotEmpty>
		<isNotEmpty prepend="," property="oficinaRecaudadora">
			OFI_RECA=#oficinaRecaudadora#
		</isNotEmpty>
		<isNotEmpty prepend="," property="nombreOficina">
			NOM_OFIC=#nombreOficina#
		</isNotEmpty>
		<isNotEmpty prepend="," property="tipoTransaccion">
			TIP_TRAN=#tipoTransaccion#
		</isNotEmpty>
		<isNotEmpty prepend="," property="numeroDocumento">
			NUM_DOCU=#numeroDocumento#
		</isNotEmpty>
		<isNotEmpty prepend="," property="horario">
			VAL_HORA=#horario#
		</isNotEmpty>
		<isNotEmpty prepend="," property="usuarioProceso">
			USU_PROC=#usuarioProceso#
		</isNotEmpty>
		<isNotEmpty prepend="," property="fechaProceso">
			FEC_PROC=#fechaProceso#
		</isNotEmpty>
		<isNotEmpty prepend="," property="horaProceso">
			HOR_PROC=#horaProceso#
		</isNotEmpty>
		<isNotEmpty prepend="," property="estado">
			EST_MODE=#estado#
		</isNotEmpty>
		<isNotEmpty prepend="," property="observacion">
			DES_OBSE=#observacion#
		</isNotEmpty>
		<isGreaterThan prepend="," property="importePagoAplicado" compareValue="0.0">
			IMP_PAGO_APLI=#importePagoAplicado#
		</isGreaterThan>
		<isGreaterThan prepend="," property="importePagoPendiente" compareValue="0.0">
			IMP_PAGO_PEND=#importePagoPendiente#
		</isGreaterThan>
		<isGreaterThan prepend="," property="importeRecaudoGenerado" compareValue="0.0">
			IMP_RECA_GENE=#importeRecaudoGenerado#
		</isGreaterThan>
		<isGreaterThan prepend="," property="importePercepcion" compareValue="0.0">
			IMP_PERC=#importePercepcion#
		</isGreaterThan>
		<isNotEmpty prepend="," property="statusMovimiento">
			STA_MOVI=#statusMovimiento#
		</isNotEmpty>		
        WHERE  
        PAIS_COD_PAIS=#codigoPais#
    	<isNotEmpty prepend="AND" property="codigoTipoOrigenDatos">
			TIOR_TIPO_ORIG_DATO = #codigoTipoOrigenDatos#
        </isNotEmpty>          
        <isNotEmpty prepend="AND" property="numeroLoteInterno">
			MOCA_NUM_LOTE_INTE = #numeroLoteInterno#
		</isNotEmpty>
        <isGreaterThan prepend="AND" property="consecutivo" compareValue="0">
			CON_TRAN=#consecutivo#
		</isGreaterThan>
	</update>
	
	<update id="updatePercepcionesOtrosCanales" parameterClass="consolidados">
		UPDATE PER_PERCE_CONSO
		SET USU_MODI = #auditInfo.updatedBy#,
			FEC_MODI = #auditInfo.lastUpdated#
		<isNotEmpty prepend="," property="tipoDocumentoIdentidad">
			TIP_DOID=#tipoDocumentoIdentidad#
		</isNotEmpty>
		<isNotEmpty prepend="," property="numeroDocumentoIdentidad">
			NUM_DOID=#numeroDocumentoIdentidad#
		</isNotEmpty>
		<isNotEmpty prepend="," property="tipoDocumentoLegal">
			TIP_DOLE=#tipoDocumentoLegal#
		</isNotEmpty>
		<isNotEmpty prepend="," property="fechaEmisionDocumentoLegal">
			FEC_DOLE=#fechaEmisionDocumentoLegal#
		</isNotEmpty>
		<isNotEmpty prepend="," property="serieDocumentoLegal">
			SER_DOLE=#serieDocumentoLegal#
		</isNotEmpty>
		<isNotEmpty prepend="," property="numeroDocumentoLegal">
			NUM_DOLE=#numeroDocumentoLegal#
		</isNotEmpty>
		<isNotEmpty prepend="," property="montoPago">
			MON_PAGO=#montoPago#
		</isNotEmpty>
		<isNotEmpty prepend="," property="montoPercepcion">
			MON_PERC=#montoPercepcion#
		</isNotEmpty>
		<isNotEmpty prepend="," property="porcentajePercepcion">
			POR_PERC=#porcentajePercepcion#
		</isNotEmpty>
		<isNotEmpty prepend="," property="montoTotalDocumentoLegal">
			MON_TODL=#montoTotalDocumentoLegal#
		</isNotEmpty>
		<isNotEmpty prepend="," property="fechaEmisionComprobantePercepcion">
			FEC_COPE=#fechaEmisionComprobantePercepcion#
		</isNotEmpty>
		<isNotEmpty prepend="," property="flagProceso">
			FLA_PROC=#flagProceso#
		</isNotEmpty>
		<isNotEmpty prepend="," property="flagCancelacion">
			FLA_CANC=#flagCancelacion#
		</isNotEmpty>
		<isNotEmpty prepend="," property="estado">
			EST_PECO=#estado#
		</isNotEmpty>	
		<isNotEmpty prepend="," property="apellidoPaterno">
			APE_PATE=#apellidoPaterno#
		</isNotEmpty>	
		<isNotEmpty prepend="," property="apellidoMaterno">
			APE_MATE=#apellidoMaterno#
		</isNotEmpty>	
		<isNotEmpty prepend="," property="nombres">
			VAL_NOMB=#nombres#
		</isNotEmpty>	

		WHERE PAIS_COD_PAIS=#codigoPais#
		<isNotEmpty prepend="AND" property="codigoSociedad">
			COD_SOCI=#codigoSociedad#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="codigoCanal">
			COD_CANA=#codigoCanal#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="codigoAcceso">
			COD_ACCE=#codigoAcceso#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="codigoSubacceso">
			COD_SBAC=#codigoSubacceso#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="tipoCliente">
			TIP_CLIE=#tipoCliente#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="codigoCliente">
			COD_CLIE=#codigoCliente#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="serieComprobantePercepcion">
			SER_COPE=#serieComprobantePercepcion#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="numeroComprobantePercepcion">
			NUM_COPE=#numeroComprobantePercepcion#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="secuenciaComprobantePercepcion">
			SEC_COPE=#secuenciaComprobantePercepcion#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="correlativoComprobantePercepcion">
			COR_PECO=#correlativoComprobantePercepcion#
		</isNotEmpty>
	</update>
	
	<delete id="removePercepcionesOtrosCanales" parameterClass="consolidados">
        DELETE FROM PER_PERCE_CONSO
        WHERE PAIS_COD_PAIS=#codigoPais#
		<isNotEmpty prepend="AND" property="codigoSociedad">
			COD_SOCI=#codigoSociedad#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="codigoCanal">
			COD_CANA=#codigoCanal#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="codigoAcceso">
			COD_ACCE=#codigoAcceso#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="codigoSubacceso">
			COD_SBAC=#codigoSubacceso#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="tipoCliente">
			TIP_CLIE=#tipoCliente#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="codigoCliente">
			COD_CLIE=#codigoCliente#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="serieComprobantePercepcion">
			SER_COPE=#serieComprobantePercepcion#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="numeroComprobantePercepcion">
			NUM_COPE=#numeroComprobantePercepcion#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="secuenciaComprobantePercepcion">
			SEC_COPE=#secuenciaComprobantePercepcion#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="correlativoComprobantePercepcion">
			COR_PECO=#correlativoComprobantePercepcion#
		</isNotEmpty>
    </delete>
    
    <delete id="removeMovimientosBancariosDetalle" parameterClass="detalle">
        DELETE FROM PER_MOVIM_BANCA_DETAL
        WHERE PAIS_COD_PAIS=#codigoPais#
		<isNotEmpty prepend="AND" property="codigoTipoOrigenDatos">
			TIOR_TIPO_ORIG_DATO = #codigoTipoOrigenDatos# 
		</isNotEmpty>
    	<isNotEmpty prepend="AND" property="numeroLoteInterno">
			MOCA_NUM_LOTE_INTE = #numeroLoteInterno#
		</isNotEmpty>
		<isGreaterThan prepend="AND" property="consecutivo" compareValue="0">
			CON_TRAN = #consecutivo#
		</isGreaterThan>
    </delete>
    
    <delete id="removeMovimientosBancariosCabecera" parameterClass="cabecera">
        DELETE FROM PER_MOVIM_BANCA_CABEC
        WHERE PAIS_COD_PAIS=#codigoPais#
		<isNotEmpty prepend="AND" property="codigoTipoOrigenDatos">
			TIOR_TIPO_ORIG_DATO = #codigoTipoOrigenDatos#
        </isNotEmpty>          
        <isNotEmpty prepend="AND" property="numeroLoteInterno">
			NUM_LOTE_INTE = #numeroLoteInterno#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="numeroLoteExterno">
			NUM_LOTE_EXTE = #numeroLoteExterno#
		</isNotEmpty>
    </delete>
	
	<select id="getNextNumeroLote" parameterClass="java.util.Map"
    		resultClass="string">
    	SELECT DECODE( SUBSTR(MAX(NUM_LOTE_INTE),1,8) ,
    					TO_CHAR(SYSDATE, 'YYYYMMDD') , 
    					MAX(NUM_LOTE_INTE)+1, 
    					TO_CHAR(SYSDATE, 'YYYYMMDD')||'0001' 
    				  ) LOTE
		FROM PER_MOVIM_BANCA_CABEC
		WHERE PAIS_COD_PAIS = #codigoPais#		
	</select>
	
	<select id="getNextCorrelativo" parameterClass="string"
    		resultClass="string">
		SELECT NVL(MAX(COR_PECO)+1,1) NUMERO_LOTE FROM PER_PERCE_CONSO WHERE PAIS_COD_PAIS = #value#
	</select>
	
	<parameterMap id="parametros" class="map" >
		<parameter property="codigoPais" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
		<parameter property="fechaInicial" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
		<parameter property="fechaFinal" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
		<parameter property="fechaCorte" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
		<parameter property="usuarioDigitacion" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>	
		<parameter property="totalRegistros" jdbcType="VARCHAR" javaType="java.lang.String" mode="OUT"/>
	</parameterMap>
	
	<procedure id="procesoPERCargaVentaDirecta" parameterMap="parametros" >
		{call PER_PR_CARGA_PERCE_VTADI(?, ?, ?, ?, ?, ?)}
	</procedure>	

	<parameterMap id="paramProcesoPERCargoAbonoDirecto" class="map" >
		<parameter property="codigoPais" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
		<parameter property="codigoTipoOrigenDatos" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
		<parameter property="numeroLote" jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
	</parameterMap>

	<procedure id="procesoPERCargoAbonoDirecto" parameterMap="paramProcesoPERCargoAbonoDirecto" >
		{call PER_PKG_PROCE_PERCE.PER_PR_PROCE_CARGO_ABONO_MENU(? ,?, ? )}
	</procedure>

	<parameterMap id="paramProcesoPERCruceSaldoPositivoNegatico" class="map" >
		<parameter property="codigoPais" jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="numeroLote" jdbcType="VARCHAR" javaType="java.lang.String"  mode="INOUT"/>
	</parameterMap>

	<procedure id="procesoPERCruceSaldoPositivoNegativo" parameterMap="paramProcesoPERCruceSaldoPositivoNegatico" >
		{call PER_PKG_PROCE_PERCE.PER_PR_CRUCE_SALDO_POSI_NEGA(? , ? )}
	</procedure>


	<parameterMap id="paramProcesoPERProcesarMovimiento" class="map" >
		<parameter property="codigoPais" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
		<parameter property="codigoTipoOrigenDatos" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
		<parameter property="numeroLote" jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="numeroLoteExterno" jdbcType="VARCHAR" javaType="java.lang.String"  mode="OUT"/>
	</parameterMap>

	<procedure id="procesoPERProcesarMovimiento" parameterMap="paramProcesoPERProcesarMovimiento" >
		{call PER_PKG_PROCE_PERCE.PER_PE_PROCE_MOVIM(? ,?, ?, ? )}
	</procedure>

   <parameterMap id="executePrevioReporteControlClienteParams" class="map" >
		<parameter property="codigoPais"      jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="fechaDesde"      jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="fechaHasta"      jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="tipoDocumento"   jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="numeroDocumento" jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
	</parameterMap>

	<procedure id="executePrevioReporteControlCliente" parameterMap="executePrevioReporteControlClienteParams" >
		{call PER_PKG_REPOR_PERCE.PER_PR_GENER_CONTR_CLIEN(? ,?, ?, ?, ? )}
	</procedure>

	
	<select id="getConsolidadoPercepcionesAcumulado" parameterClass="java.util.Map"
			resultMap="consolidadoAcumuladoMapResult">
		SELECT COD_SOCI,
		       SOCIEDAD,
			   COD_CANA,
			   DES_CANAL,
			   CODIGO,
			   DESCRIPCION,
			   CODIGO_SUB,
               DESCRIPCION_SUB,
			   NVL(SUM(MON_PAGO), 0) MONTO_PAGO,
			   NVL(SUM(MON_PERC), 0) MONTO_PERCEPCION
		FROM   (SELECT
		 	   		COD_SOCI,
					(SELECT B.VAL_DENO FROM SEG_SOCIE B WHERE B.COD_SOCI = A.COD_SOCI AND ROWNUM = 1) SOCIEDAD,
					A.COD_CANA,
					 (SELECT GEN_I18N_SICC_COMUN.VAL_I18N  
                       FROM    SEG_CANAL,                           
                               GEN_I18N_SICC_COMUN,
                               SEG_IDIOM
                        WHERE  (GEN_I18N_SICC_COMUN.ATTR_ENTI = 'SEG_CANAL')
                              AND (SEG_IDIOM.COD_ISO_IDIO = 'es')
                           AND (SEG_CANAL.COD_CANA = A.COD_CANA)                                                         
                              AND (SEG_IDIOM.OID_IDIO = GEN_I18N_SICC_COMUN.IDIO_OID_IDIO)
                              AND (GEN_I18N_SICC_COMUN.VAL_OID = SEG_CANAL.OID_CANA)) DES_CANAL,
					A.COD_ACCE CODIGO,
					(SELECT GEN_I18N_SICC_COMUN.VAL_I18N  
					   FROM    SEG_CANAL,
							   SEG_ACCES,
							   GEN_I18N_SICC_COMUN,
							   SEG_IDIOM
						WHERE (    (GEN_I18N_SICC_COMUN.ATTR_ENTI = 'SEG_ACCES')
							  AND (SEG_IDIOM.COD_ISO_IDIO = #codigoIdioma#)
						   AND (SEG_CANAL.COD_CANA = A.COD_CANA)
						   AND (SEG_ACCES.COD_ACCE = A.COD_ACCE)
							  AND (SEG_CANAL.OID_CANA = SEG_ACCES.CANA_OID_CANA)
							  AND (SEG_IDIOM.OID_IDIO = GEN_I18N_SICC_COMUN.IDIO_OID_IDIO)
							  AND (GEN_I18N_SICC_COMUN.VAL_OID = SEG_ACCES.OID_ACCE)
							 )) DESCRIPCION,
 					A.COD_SBAC CODIGO_SUB,
                    (SELECT GEN_I18N_SICC_COMUN.VAL_I18N  
                       FROM    SEG_CANAL,
                               SEG_ACCES,
                               SEG_SUBAC,
                               GEN_I18N_SICC_COMUN,
                               SEG_IDIOM
                        WHERE  (GEN_I18N_SICC_COMUN.ATTR_ENTI = 'SEG_SUBAC')
                           AND (SEG_IDIOM.COD_ISO_IDIO = 'es')
                           AND (SEG_CANAL.COD_CANA = A.COD_CANA)
                           AND (SEG_ACCES.COD_ACCE = A.COD_ACCE)
                              AND (SEG_CANAL.OID_CANA = SEG_ACCES.CANA_OID_CANA)
                              AND (SEG_SUBAC.ACCE_OID_ACCE = SEG_ACCES.OID_ACCE)
                              AND (A.COD_SBAC = SEG_SUBAC.COD_SBAC)
                              AND (SEG_IDIOM.OID_IDIO = GEN_I18N_SICC_COMUN.IDIO_OID_IDIO)
                              AND (GEN_I18N_SICC_COMUN.VAL_OID = SEG_SUBAC.OID_SBAC)) DESCRIPCION_SUB,  							 
					MON_PAGO,
					MON_PERC
				FROM PER_PERCE_CONSO A
				WHERE FEC_COPE IS NOT NULL
					AND PAIS_COD_PAIS = #codigoPais#
					AND EXTRACT(YEAR FROM FEC_COPE) = TO_NUMBER(#anho#)
					AND EXTRACT(MONTH FROM FEC_COPE) = TO_NUMBER(#mes#)
			 UNION ALL				
		      SELECT
		 	   		COD_SOCI,		      
					(SELECT B.VAL_DENO FROM SEG_SOCIE_LBEL B WHERE B.COD_SOCI = A.COD_SOCI AND ROWNUM = 1) SOCIEDAD,
					A.COD_CANA,			
					(SELECT GEN_I18N_SICC_COMUN.VAL_I18N  
                       FROM    SEG_CANAL,                           
                               GEN_I18N_SICC_COMUN,
                               SEG_IDIOM
                        WHERE  (GEN_I18N_SICC_COMUN.ATTR_ENTI = 'SEG_CANAL')
                              AND (SEG_IDIOM.COD_ISO_IDIO = 'es')
                           AND (SEG_CANAL.COD_CANA = A.COD_CANA)                                                         
                              AND (SEG_IDIOM.OID_IDIO = GEN_I18N_SICC_COMUN.IDIO_OID_IDIO)
                              AND (GEN_I18N_SICC_COMUN.VAL_OID = SEG_CANAL.OID_CANA)) DES_CANAL,		
					A.COD_ACCE CODIGO,
					(SELECT GEN_I18N_SICC_COMUN.VAL_I18N  
					   FROM    SEG_CANAL,
							   SEG_ACCES,
							   GEN_I18N_SICC_COMUN,
							   SEG_IDIOM
						WHERE (    (GEN_I18N_SICC_COMUN.ATTR_ENTI = 'SEG_ACCES')
							  AND (SEG_IDIOM.COD_ISO_IDIO = #codigoIdioma#)
						   AND (SEG_CANAL.COD_CANA = A.COD_CANA)
						   AND (SEG_ACCES.COD_ACCE = A.COD_ACCE)
							  AND (SEG_CANAL.OID_CANA = SEG_ACCES.CANA_OID_CANA)
							  AND (SEG_IDIOM.OID_IDIO = GEN_I18N_SICC_COMUN.IDIO_OID_IDIO)
							  AND (GEN_I18N_SICC_COMUN.VAL_OID = SEG_ACCES.OID_ACCE)
							 )) DESCRIPCION,
 					 A.COD_SBAC CODIGO_SUB,
                    (SELECT GEN_I18N_SICC_COMUN.VAL_I18N  
                       FROM    SEG_CANAL,
                               SEG_ACCES,
                               SEG_SUBAC,
                               GEN_I18N_SICC_COMUN,
                               SEG_IDIOM
                        WHERE  (GEN_I18N_SICC_COMUN.ATTR_ENTI = 'SEG_SUBAC')
                           AND (SEG_IDIOM.COD_ISO_IDIO = 'es')
                           AND (SEG_CANAL.COD_CANA = A.COD_CANA)
                           AND (SEG_ACCES.COD_ACCE = A.COD_ACCE)
                              AND (SEG_CANAL.OID_CANA = SEG_ACCES.CANA_OID_CANA)
                              AND (SEG_SUBAC.ACCE_OID_ACCE = SEG_ACCES.OID_ACCE)
                              AND (A.COD_SBAC = SEG_SUBAC.COD_SBAC)
                              AND (SEG_IDIOM.OID_IDIO = GEN_I18N_SICC_COMUN.IDIO_OID_IDIO)
                              AND (GEN_I18N_SICC_COMUN.VAL_OID = SEG_SUBAC.OID_SBAC)) DESCRIPCION_SUB,  							 
					MON_PAGO,
					MON_PERC
				FROM PER_PERCE_CONSO_LBEL A
				WHERE FEC_COPE IS NOT NULL
					AND PAIS_COD_PAIS = #codigoPaisLbel#
					AND EXTRACT(YEAR FROM FEC_COPE) = TO_NUMBER(#anho#)
					AND EXTRACT(MONTH FROM FEC_COPE) = TO_NUMBER(#mes#)		
		)			
		 GROUP BY COD_SOCI, SOCIEDAD, COD_CANA,DES_CANAL, CODIGO, DESCRIPCION,CODIGO_SUB, DESCRIPCION_SUB
        ORDER BY COD_SOCI, SOCIEDAD, COD_CANA,DES_CANAL, CODIGO, DESCRIPCION,CODIGO_SUB, DESCRIPCION_SUB
	</select>
	
	<update id="updateNumeroConsolidadoPercepciones" parameterClass="java.util.Map">
	<![CDATA[
		UPDATE PER_CUENT_CORRI_DOCLE B
		SET    (B.COD_CANA_PERC,
				B.COD_ACCE_PERC,
				B.COD_SUBA_PERC,
				B.NUM_SOLI_CONS_PERC,
				USU_MODI,
				FEC_MODI
 			   ) =
 			   (
				SELECT #codigoCanal# 		 COD_CANA_PERC,
					   #codigoAcceso# 		 COD_ACCE_PERC,
					   #codigoSubacceso#	 COD_SUBA_PERC,
					   A.VAL_NUME_SOLI		 NUM_SOLI_CONS_PERC,				   
					   #auditInfo.updatedBy# USU_MODI,
					   SYSDATE 				 FEC_MODI
				FROM  PED_SOLIC_CABEC A,
					  SEG_SUBAC C,
					  SEG_ACCES D,
					  SEG_CANAL E,
					  PED_GRUPO_PROCE F,
					  PER_SOLIC_MONET G	 
				WHERE 
					  A.SBAC_OID_SBAC = C.OID_SBAC 
				AND   G.PAIS_COD_PAIS =	B.PAIS_COD_PAIS
                AND   G.COR_AGRU  = A.NUM_DOCU_ORIG  
		        AND   G.COR_SOLI_MONE = A.NUM_DOCU_ORIG
			    AND   G.COR_CUEN_CORR_DOLE = B.COR_CUEN_CORR_DOLE
                AND   G.COD_PERI = B.COD_PERI 
                AND   G.COD_CLIE = B.COD_CLIE
                AND   G.FEC_FACT = B.FEC_FACT
                AND   G.VAL_IMPO = B.IMP_PERC_PERC
                AND   G.VAL_CANT = 1 
                AND   G.COD_TIPO_SOLI = 'SP01'

				AND	  C.COD_SBAC = #codigoSubacceso#
				AND   C.ACCE_OID_ACCE = D.OID_ACCE
				AND	  D.COD_ACCE = #codigoAcceso#
				AND	  D.CANA_OID_CANA = E.OID_CANA
				AND	  E.COD_CANA = #codigoCanal#
				AND	  A.IND_TS_NO_CONSO = 0
				AND   A.IND_GENE_CC = 1
				AND	  A.GRPR_OID_GRUP_PROC = F.OID_GRUP_PROC
				AND	  F.COD_GRUP_PROC = #codigoGrupoProceso#
			  )
		WHERE B.PAIS_COD_PAIS = #codigoPais#
        AND   B.IMP_CUOT > 0
		AND   B.NUM_SOLI_CONS_PERC IS NULL
		AND   B.IND_AFEC = 'S'
		AND	  B.COD_CANA_PERC IS NULL
		AND	  B.COD_ACCE_PERC IS NULL
		AND	  B.COD_SUBA_PERC IS NULL
		]]>		
	</update>  
  
	  <select id="getConcursosMantenenimientoDuplaCyzoneList" parameterClass="java.util.Map"
			resultMap="busquedaConcursosMantenerDuplaCyzoneMapResult">

		SELECT DISTINCT    
				 INC_CONCU_PARAM_GENER.OID_PARA_GRAL AS ID_CONCURSO,
				 INC_CONCU_PARAM_GENER.NUM_CONC AS CODIGO_CONCURSO,
			   INC_CONCU_PARAM_GENER.VAL_NOMB AS NOMBRE_CONCURSO,
			   plantilla.OID_PLAN_CONC AS CODIGO_PLANTILLA,
			   plantilla.DESC_PLANTILLA AS DESC_PLANTILLA,
			   INC_VERSI_CONCU.VAL_VERS_NUEV AS VERSION,
			   SEG_MARCA.DES_MARC AS NOMBRE_MARCA,
			   canal.DESC_CANAL AS NOMBRE_CANAL,
			   acceso.DESC_ACCESO AS ACCESO_CONCURSO
			   	    
		  FROM INC_CONCU_PARAM_GENER,
		  	   	(
						select
							GEN_I18N_SICC_COMUN.VAL_I18N AS DESC_CANAL,
							SEG_CANAL.OID_CANA, SEG_CANAL.COD_CANA 
						from
							SEG_CANAL,
					        SEG_IDIOM,   
							GEN_I18N_SICC_COMUN 
						where
							 (GEN_I18N_SICC_COMUN.VAL_OID = SEG_CANAL.OID_CANA )
							 AND (ATTR_ENTI = 'SEG_CANAL' )
							 AND (GEN_I18N_SICC_COMUN.IDIO_OID_IDIO = SEG_IDIOM.OID_IDIO)
							 AND SEG_IDIOM.COD_ISO_IDIO = #codigoIdiomaISO#
					<isNotEmpty prepend="AND" property="codigoCanal">
							  SEG_CANAL.COD_CANA = #codigoCanal#
					</isNotEmpty>
							 
					) canal,
		  	   		(
						select
							GEN_I18N_SICC_COMUN.VAL_I18N AS DESC_PLANTILLA,
							INC_PLANT_CONCU.OID_PLAN_CONC,
							INC_PLANT_CONCU.CANA_OID_CANA  
						from
							INC_PLANT_CONCU,
					        SEG_IDIOM,
							SEG_CANAL,   
							GEN_I18N_SICC_COMUN 
						where
							 (GEN_I18N_SICC_COMUN.VAL_OID = INC_PLANT_CONCU.OID_PLAN_CONC )
							 AND (ATTR_ENTI ='INC_PLANT_CONCU' )
							 AND (GEN_I18N_SICC_COMUN.IDIO_OID_IDIO = SEG_IDIOM.OID_IDIO)
							 AND (SEG_IDIOM.COD_ISO_IDIO = #codigoIdiomaISO#)
							 AND (SEG_CANAL.OID_CANA = INC_PLANT_CONCU.CANA_OID_CANA)
					<isNotEmpty prepend="AND" property="nombrePlantilla">
							  (GEN_I18N_SICC_COMUN.VAL_I18N LIKE #nombrePlantilla#)
					</isNotEmpty>
					<isNotEmpty prepend="AND" property="codigoPlantilla">
							  (INC_PLANT_CONCU.OID_PLAN_CONC = #codigoPlantilla#)
					</isNotEmpty>
					<isNotEmpty prepend="AND" property="codigoCanal">
							  (SEG_CANAL.COD_CANA = #codigoCanal#)
					</isNotEmpty>							 
					) plantilla,			
		  	   		(
						select
							GEN_I18N_SICC_COMUN.VAL_I18N AS DESC_ACCESO,
							SEG_ACCES.COD_ACCE,					
							SEG_ACCES.CANA_OID_CANA,
							SEG_ACCES.OID_ACCE
						from
							SEG_ACCES,
					        SEG_IDIOM,
							SEG_CANAL,   
							GEN_I18N_SICC_COMUN 
						where
							 (GEN_I18N_SICC_COMUN.VAL_OID = SEG_ACCES.OID_ACCE )
							 AND (ATTR_ENTI ='SEG_ACCES' )
							 AND (GEN_I18N_SICC_COMUN.IDIO_OID_IDIO = SEG_IDIOM.OID_IDIO)
							 AND (SEG_IDIOM.COD_ISO_IDIO = #codigoIdiomaISO#)
							 AND (SEG_CANAL.OID_CANA = SEG_ACCES.CANA_OID_CANA)
						<isNotEmpty prepend="AND" property="codigoCanal">
							  (SEG_CANAL.COD_CANA = #codigoCanal#)
						</isNotEmpty>
							 
					) acceso,			
			   SEG_MARCA,
			   SEG_PAIS,
			   INC_ACCES_CONCU,    
		       INC_VERSI_CONCU
		
		 WHERE (    
		 	   		(SEG_MARCA.OID_MARC = INC_CONCU_PARAM_GENER.MARC_OID_MARC)
		 	   AND (INC_ACCES_CONCU.COPA_OID_PARA_GRAL = INC_CONCU_PARAM_GENER.OID_PARA_GRAL)
			   AND (INC_ACCES_CONCU.ACCE_OID_ACCE = acceso.OID_ACCE)   
		 	   AND (canal.OID_CANA = INC_CONCU_PARAM_GENER.CANA_OID_CANA)
		       AND (INC_CONCU_PARAM_GENER.OID_PARA_GRAL = INC_VERSI_CONCU.COPA_OID_PARA_GRAL_ORIG(+) )
 			   AND (INC_CONCU_PARAM_GENER.IND_DUPL_CYZO = 1)
		       AND (canal.OID_CANA = plantilla.CANA_OID_CANA)
		       AND (plantilla.OID_PLAN_CONC = INC_CONCU_PARAM_GENER.PLC2_OID_PLAN_CONC )
			   AND (SEG_PAIS.OID_PAIS = INC_CONCU_PARAM_GENER.PAIS_OID_PAIS)
			   AND (SEG_PAIS.COD_PAIS = #codigoPais#)
			<isNotEmpty prepend="AND" property="codigoMarca">
			   	 	(SEG_MARCA.COD_MARC = #codigoMarca#)
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="version">
			   	 	(INC_VERSI_CONCU.VAL_VERS_NUEV = #version#)
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="codigoConcurso">
					 (INC_CONCU_PARAM_GENER.NUM_CONC = #codigoConcurso# )
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="nombreConcurso">
					 (INC_CONCU_PARAM_GENER.VAL_NOMB LIKE #nombreConcurso# )
			</isNotEmpty>
		       ) order by INC_CONCU_PARAM_GENER.NUM_CONC
	</select>		

	<select id="getNextConcursoDuplaCyzone" parameterClass="string"
    		resultClass="string">
    	SELECT NVL(MAX(OID_CONC_DUPL)+1,1) OID_CONC_DUPL FROM INT_INC_CONCU_DUPLA
	</select>

		
    <select id="getConcursoDuplaCyzone" parameterClass="string"
    		resultMap="concursoDuplaCyzoneMapResult">
		SELECT 
			OID_PARA_GRAL AS ID_CONCURSO, 
			NUM_CONC AS CODIGO_CONCURSO, 
			VAL_NOMB AS NOMBRE_CONCURSO,
			OID_CONC_DUPL AS ID_CONCUDUPLA, 
			IND_DUPL AS INDICADOR_DUPLA 
		FROM
 			INC_CONCU_PARAM_GENER, INT_INC_CONCU_DUPLA
		WHERE 
		 INC_CONCU_PARAM_GENER.OID_PARA_GRAL = INT_INC_CONCU_DUPLA.COPA_OID_PARA_GRAL(+)
		 AND OID_PARA_GRAL = #idConcurso#
	</select>		

    <update id="updateConcursoDuplaCyzone" parameterClass="concursoDuplaCyzone">
		UPDATE INT_INC_CONCU_DUPLA
		SET IND_DUPL = #indicadorDupla# 
		WHERE  OID_CONC_DUPL = #idConcursoDuplaCyzone#
	</update>		

    <insert id="insertConcursoDuplaCyzone" parameterClass="concursoDuplaCyzone">
	    INSERT INTO INT_INC_CONCU_DUPLA
	    (
		OID_CONC_DUPL,
		COPA_OID_PARA_GRAL,
		IND_DUPL
		) 
	    VALUES 
	    (
		#idConcursoDuplaCyzone#,
		#idConcurso#,
		#indicadorDupla#
		)
	</insert>
	
	<select id="getVerificaBloqueoControlAnual" parameterClass="java.util.Map"  resultClass="string">
		SELECT EST_COAN
		FROM   PER_CONTR_ANUAL_COPER
		WHERE  ANO_CONT = #anioBloqueo#
    </select>

    <update id="updateBloqueoControlAnual" parameterClass="java.util.Map">
		UPDATE PER_CONTR_ANUAL_COPER
		   SET EST_COAN = #estadoControlAnual#
		 WHERE ANO_CONT = #anioBloqueo#
 	</update>		

   <parameterMap id="executePrevioReporteControlClienteLbelParams" class="map" >
		<parameter property="codigoPaisLbel"      jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="fechaDesde"      jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="fechaHasta"      jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="tipoDocumento"   jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="numeroDocumento" jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
	</parameterMap>

	<procedure id="executePrevioReporteControlClienteLbel" parameterMap="executePrevioReporteControlClienteLbelParams" >
		{call PER_PKG_REPOR_PERCE_LBEL.PER_PR_GENER_CONTR_CLIEN(? ,?, ?, ?, ? )}
	</procedure>    	
	
	
	<delete id="deletePercepcionesSistemasExternos" parameterClass="java.util.Map">
        DELETE FROM PER_PERCE_CONSO
        WHERE PAIS_COD_PAIS=#codigoPais#
		<isNotEmpty prepend="AND" property="codigoCanal">
			COD_CANA=#codigoCanal#
		</isNotEmpty>
		<isNotEmpty property="codigoAcceso">
		  <iterate prepend="AND" property="codigoAcceso" open=" COD_ACCE IN (" close=")" conjunction=",">
        	 	#codigoAcceso[]#
        	</iterate>    						
		</isNotEmpty>
		<isNotEmpty  property="codigoSubacceso">
		    <iterate prepend="AND" property="codigoSubacceso" open=" COD_SBAC IN (" close=")" conjunction=",">
        	 	#codigoSubacceso[]#
        	</iterate>						
		</isNotEmpty>
		<![CDATA[
		  AND FEC_COPE >= to_date(#fechaInicio#,'dd/MM/yyyy') and 
		  		FEC_COPE <= to_date(#fechaFinal#,'dd/MM/yyyy')
		  		]]>		  
    </delete>
	

	<resultMap id="consolidadoPercepcionesAcumuladoDiaResult" class="java.util.HashMap">    
	    <result property="canal" 				column="COD_CANA"/>
	    <result property="descripcionCanal" 	column="DES_CANA"/>
	    <result property="acceso" 			 	column="COD_ACCE"/>
	    <result property="descripcionAcceso" 	column="DES_ACCE"/>	    
	     <result property="codigoSubAcceso"     column="COD_SUBA"/>
	    <result property="descripcionSubAcceso" column="DES_SUBA"/>
	    <result property="fechaComprobante" 	column="FEC_COPE"/>
	    <result property="montoPago" 			column="MONTO_PAGO"/>
	    <result property="montoPercepcion" 		column="MONTO_PERCEPCION"/>
	</resultMap>

	<select id="getConsolidadoPercepcionesAcumuladoDia" parameterClass="java.util.Map"
															resultMap="consolidadoPercepcionesAcumuladoDiaResult">
		SELECT COD_CANA,
		       DES_CANA,
			   COD_ACCE,
			   DES_ACCE,
			   COD_SUBA,
			   DES_SUBA,
			   FEC_COPE,
			   NVL(SUM(MON_PAGO), 0) MONTO_PAGO,
			   NVL(SUM(MON_PERC), 0) MONTO_PERCEPCION
		FROM   (SELECT		 	   		
					A.COD_CANA,
					 (SELECT GEN_I18N_SICC_COMUN.VAL_I18N  
                       FROM    SEG_CANAL,                           
                               GEN_I18N_SICC_COMUN,
                               SEG_IDIOM
                        WHERE  (GEN_I18N_SICC_COMUN.ATTR_ENTI = 'SEG_CANAL')
                              AND (SEG_IDIOM.COD_ISO_IDIO = #codigoIdioma#)
                           AND (SEG_CANAL.COD_CANA = A.COD_CANA)                                                         
                              AND (SEG_IDIOM.OID_IDIO = GEN_I18N_SICC_COMUN.IDIO_OID_IDIO)
                              AND (GEN_I18N_SICC_COMUN.VAL_OID = SEG_CANAL.OID_CANA)) DES_CANA,
					A.COD_ACCE COD_ACCE,
					(SELECT GEN_I18N_SICC_COMUN.VAL_I18N  
					   FROM    SEG_CANAL,
							   SEG_ACCES,
							   GEN_I18N_SICC_COMUN,
							   SEG_IDIOM
						WHERE (    (GEN_I18N_SICC_COMUN.ATTR_ENTI = 'SEG_ACCES')
							  AND (SEG_IDIOM.COD_ISO_IDIO = #codigoIdioma#)
						   AND (SEG_CANAL.COD_CANA = A.COD_CANA)
						   AND (SEG_ACCES.COD_ACCE = A.COD_ACCE)
							  AND (SEG_CANAL.OID_CANA = SEG_ACCES.CANA_OID_CANA)
							  AND (SEG_IDIOM.OID_IDIO = GEN_I18N_SICC_COMUN.IDIO_OID_IDIO)
							  AND (GEN_I18N_SICC_COMUN.VAL_OID = SEG_ACCES.OID_ACCE)
							 )) DES_ACCE,
 					A.COD_SBAC COD_SUBA,
                    (SELECT GEN_I18N_SICC_COMUN.VAL_I18N  
                       FROM    SEG_CANAL,
                               SEG_ACCES,
                               SEG_SUBAC,
                               GEN_I18N_SICC_COMUN,
                               SEG_IDIOM
                        WHERE  (GEN_I18N_SICC_COMUN.ATTR_ENTI = 'SEG_SUBAC')
                           AND (SEG_IDIOM.COD_ISO_IDIO = #codigoIdioma#)
                           AND (SEG_CANAL.COD_CANA = A.COD_CANA)
                           AND (SEG_ACCES.COD_ACCE = A.COD_ACCE)
                              AND (SEG_CANAL.OID_CANA = SEG_ACCES.CANA_OID_CANA)
                              AND (SEG_SUBAC.ACCE_OID_ACCE = SEG_ACCES.OID_ACCE)
                              AND (A.COD_SBAC = SEG_SUBAC.COD_SBAC)
                              AND (SEG_IDIOM.OID_IDIO = GEN_I18N_SICC_COMUN.IDIO_OID_IDIO)
                              AND (GEN_I18N_SICC_COMUN.VAL_OID = SEG_SUBAC.OID_SBAC)) DES_SUBA, 
				    TO_CHAR(FEC_COPE,'dd/MM/yyyy') FEC_COPE,                               							 
					MON_PAGO,
					MON_PERC
				FROM PER_PERCE_CONSO A
				WHERE PAIS_COD_PAIS = #codigoPais#
					<isNotEmpty property="codigoCanal">
		              <iterate prepend="AND" property="codigoCanal" open=" COD_CANA IN (" close=")" conjunction=",">
                  			#codigoCanal[]#
            			</iterate>                                     
            		</isNotEmpty>
					<isNotEmpty property="codigoAcceso">
		              <iterate prepend="AND" property="codigoAcceso" open=" COD_ACCE IN (" close=")" conjunction=",">
                  			#codigoAcceso[]#
            			</iterate>                                     
            		</isNotEmpty>
					<isNotEmpty property="codigoSubAcceso">
		              <iterate prepend="AND" property="codigoSubAcceso" open=" COD_SBAC IN (" close=")" conjunction=",">
                  			#codigoSubAcceso[]#
            			</iterate>                                     
            		</isNotEmpty>
            		<![CDATA[
		  			AND FEC_COPE >= to_date(#fechaDesde#,'dd/MM/yyyy') and 
		  				FEC_COPE <= to_date(#fechaHasta#,'dd/MM/yyyy')
		  		    ]]>
		  UNION	ALL				
		      SELECT
					A.COD_CANA,			
					(SELECT GEN_I18N_SICC_COMUN.VAL_I18N  
                       FROM    SEG_CANAL,                           
                               GEN_I18N_SICC_COMUN,
                               SEG_IDIOM
                        WHERE  (GEN_I18N_SICC_COMUN.ATTR_ENTI = 'SEG_CANAL')
                              AND (SEG_IDIOM.COD_ISO_IDIO = #codigoIdioma#)
                           AND (SEG_CANAL.COD_CANA = A.COD_CANA)                                                         
                              AND (SEG_IDIOM.OID_IDIO = GEN_I18N_SICC_COMUN.IDIO_OID_IDIO)
                              AND (GEN_I18N_SICC_COMUN.VAL_OID = SEG_CANAL.OID_CANA)) DES_CANA,		
					A.COD_ACCE COD_ACCE,
					(SELECT GEN_I18N_SICC_COMUN.VAL_I18N  
					   FROM    SEG_CANAL,
							   SEG_ACCES,
							   GEN_I18N_SICC_COMUN,
							   SEG_IDIOM
						WHERE (    (GEN_I18N_SICC_COMUN.ATTR_ENTI = 'SEG_ACCES')
							  AND (SEG_IDIOM.COD_ISO_IDIO = #codigoIdioma#)
						   AND (SEG_CANAL.COD_CANA = A.COD_CANA)
						   AND (SEG_ACCES.COD_ACCE = A.COD_ACCE)
							  AND (SEG_CANAL.OID_CANA = SEG_ACCES.CANA_OID_CANA)
							  AND (SEG_IDIOM.OID_IDIO = GEN_I18N_SICC_COMUN.IDIO_OID_IDIO)
							  AND (GEN_I18N_SICC_COMUN.VAL_OID = SEG_ACCES.OID_ACCE)
							 )) DES_ACCE,
 					 A.COD_SBAC COD_SUBA,
                    (SELECT GEN_I18N_SICC_COMUN.VAL_I18N  
                       FROM    SEG_CANAL,
                               SEG_ACCES,
                               SEG_SUBAC,
                               GEN_I18N_SICC_COMUN,
                               SEG_IDIOM
                        WHERE  (GEN_I18N_SICC_COMUN.ATTR_ENTI = 'SEG_SUBAC')
                           AND (SEG_IDIOM.COD_ISO_IDIO = #codigoIdioma#)
                           AND (SEG_CANAL.COD_CANA = A.COD_CANA)
                           AND (SEG_ACCES.COD_ACCE = A.COD_ACCE)
                              AND (SEG_CANAL.OID_CANA = SEG_ACCES.CANA_OID_CANA)
                              AND (SEG_SUBAC.ACCE_OID_ACCE = SEG_ACCES.OID_ACCE)
                              AND (A.COD_SBAC = SEG_SUBAC.COD_SBAC)
                              AND (SEG_IDIOM.OID_IDIO = GEN_I18N_SICC_COMUN.IDIO_OID_IDIO)
                              AND (GEN_I18N_SICC_COMUN.VAL_OID = SEG_SUBAC.OID_SBAC)) DES_SUBA,
					TO_CHAR(FEC_COPE,'dd/MM/yyyy') FEC_COPE,                                              							 
					MON_PAGO,
					MON_PERC
				FROM PER_PERCE_CONSO_LBEL A
				WHERE PAIS_COD_PAIS = #codigoPaisLbel#
					<isNotEmpty property="codigoCanal">
		              <iterate prepend="AND" property="codigoCanal" open=" COD_CANA IN (" close=")" conjunction=",">
                  			#codigoCanal[]#
            			</iterate>                                     
            		</isNotEmpty>
					<isNotEmpty property="codigoAcceso">
		              <iterate prepend="AND" property="codigoAcceso" open=" COD_ACCE IN (" close=")" conjunction=",">
                  			#codigoAcceso[]#
            			</iterate>                                     
            		</isNotEmpty>
					<isNotEmpty property="codigoSubAcceso">
		              <iterate prepend="AND" property="codigoSubAcceso" open=" COD_SBAC IN (" close=")" conjunction=",">
                  			#codigoSubAcceso[]#
            			</iterate>                                     
            		</isNotEmpty>					 
					 <![CDATA[
 						AND FEC_COPE >= to_date(#fechaDesde#,'dd/MM/yyyy') and 
 								FEC_COPE <= to_date(#fechaHasta#,'dd/MM/yyyy')
					]]>											
		)			
		 GROUP BY COD_CANA,DES_CANA, COD_ACCE, DES_ACCE, COD_SUBA, DES_SUBA, FEC_COPE
         ORDER BY COD_CANA,DES_CANA, COD_ACCE, DES_ACCE, COD_SUBA, DES_SUBA, FEC_COPE
	</select>

	<resultMap id="numeracionComprobantesSunatResult" class="java.util.HashMap">   	 
		<result property="correlativoAutorizacion" 		column="COR_AUSU"/>
	    <result property="codigoAutorizacion" 			column="COD_AUTO"/>
	    <result property="numeroAutorizacion" 			column="NUM_AUSU"/>
	    <result property="serieDocumento" 				column="SER_DOCU"/>	    
	    <result property="numeroComprobanteInicial" 	column="NUM_INAU"/>	    
	    <result property="numeroComprobanteFinal"       column="NUM_FIAU"/>
	    <result property="fechaAutorizacion"       		column="FEC_AUTO"/>
	    <result property="codigoVigencia"       		column="COD_VIGE"/>
		<result property="vigencia"       			    column="DES_VIGE"/>
		<result property="estadoAutorizacion"       	column="EST_AUSU"/>	    	    
	</resultMap>
	
	<select id="getNumeracionComprobantesSunatList" parameterClass="java.util.Map"  resultMap="numeracionComprobantesSunatResult">
		SELECT  COR_AUSU,
				COD_AUTO,
				NUM_AUSU,
				SER_DOCU,
				NUM_INAU,
				NUM_FIAU,
				TO_CHAR(FEC_AUTO,'dd/MM/yyyy') FEC_AUTO,
				COD_VIGE,
			    DECODE(COD_VIGE,4,'SI','NO') DES_VIGE,
			  	EST_AUSU
		FROM PER_AUTOR_SUNAT_COPER
		WHERE  (1=1)
		<isNotEmpty prepend="AND" property="codigoAutorizacion">
		  COD_AUTO = #codigoAutorizacion#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="numeroAutorizacion">
		  NUM_AUSU = #numeroAutorizacion#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="serieDocumento">
		  SER_DOCU = #serieDocumento#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="numeroComprobanteInicial">
		  NUM_INAU = #numeroComprobanteInicial#
		</isNotEmpty>				
		<isNotEmpty prepend="AND" property="numeroComprobanteFinal">
		  NUM_FIAU = #numeroComprobanteFinal#
		</isNotEmpty>		
		AND EST_AUSU != '9'
    </select>	
	
   <insert id="insertNumeracionComprobantesSunat" parameterClass="java.util.Map">
		INSERT INTO PER_AUTOR_SUNAT_COPER (
		   COR_AUSU, COD_AUTO, FEC_AUTO, 
		   SER_DOCU, NUM_INAU, NUM_FIAU, 
		   NUM_AUSU, COD_VIGE, USU_DIGI, 
		   FEC_DIGI, 
		   EST_AUSU) 
		VALUES (#correlativoAutorizacion# ,#codigoAutorizacion# ,TO_DATE(#fechaAutorizacion#,'dd/MM/yyyy'),
		    #serieDocumento# , #numeroComprobanteInicial#,#numeroComprobanteFinal#,
		    #numeroAutorizacion#,#codigoVigencia#,#login#,SYSDATE,'1')
	</insert>	

  <update id="updateNumeracionComprobantesSunat" parameterClass="java.util.Map">
		UPDATE PER_AUTOR_SUNAT_COPER
		SET   COD_AUTO=#codigoAutorizacion#, 
			  FEC_AUTO=TO_DATE(#fechaAutorizacion#,'dd/MM/yyyy'), 
			  SER_DOCU=#serieDocumento#, 
			  NUM_INAU=#numeroComprobanteInicial#, 
			  NUM_FIAU=#numeroComprobanteFinal#,
			  NUM_AUSU=#numeroAutorizacion#,
			  COD_VIGE=#codigoVigencia#, 
		      EST_AUSU = #estadoAutorizacion#,
		      USU_MODI=#login#,
		      FEC_MODI=SYSDATE
		WHERE  COR_AUSU = #correlativoAutorizacion# 
  </update>
  
 <update id="updateVigenciaCerradoComprobantesSunat" parameterClass="java.util.Map">
		UPDATE PER_AUTOR_SUNAT_COPER
		SET   COD_VIGE='2',		
			  USU_MODI=#login#,
		      FEC_MODI=SYSDATE      
		WHERE  COR_AUSU != #correlativoAutorizacion# 
  </update>
  
  	<select id="getCorrelativoAutorizacion" parameterClass="java.util.Map"	resultClass="string">
     		SELECT NVL(MAX(COR_AUSU)+1,1) 
			FROM PER_AUTOR_SUNAT_COPER	
	</select>

   <procedure id="deleteTablasCargaPagosBancariosMasivos">
		{call PER_PKG_PROCE.PER_PR_ELIMI_PAGOS_BANCA_MASIV }
	</procedure>
		       
	<!-- INSERTA EN TABLA TEMPORAL -->
	<insert id="insertEstructuraPagosBancariosMasivos" parameterClass="estructuraPercepcionesPagosBancariosMasivos">
		<![CDATA[
	      	INSERT INTO PER_CARGA_PAGOS_BANCA_MASIV(
	      	   VAL_FILA,
	           COD_CLIE,
	           FEC_PAGO,     
			   IMP_PAGO,
			   IMP_PAGO_VALI)						
	        VALUES ( 
			#fila#,
			#codigoConsultora#,
			TO_DATE(#fechaPago#,'DD/MM/YYYY'),
			#importePago#,
			#importePagoValidacion#			
	        )
	    ]]>
	</insert>
	
	<resultMap id="ErrorCargaPagosBancariosMasivos" class="java.util.HashMap">      
		<result property="fila" 							 column="VAL_FILA" />              
		<result property="codigoError" 						 column="COD_ERRO" />       
		<result property="descripcionError" 				 column="DES_ERRO" />  
   </resultMap>
   
	<!-- OBTIENE EL LISTADO DE ERRORES -->
	<select id="getErroresCargaPagosBancariosMasivos" resultMap="ErrorCargaPagosBancariosMasivos">		   
	SELECT VAL_FILA as "VAL_FILA",
          COD_ERRO  as "COD_ERRO",
          DES_ERRO  as "DES_ERRO"
     FROM PER_ERROR_PAGOS_BANCA_MASIV
	</select>
	
	<parameterMap id="paramExecuteValidarPagosBancariosMasivos" class="java.util.Map">		
		<parameter property="error"      jdbcType="VARCHAR" javaType="java.lang.String" mode="OUT" />
	</parameterMap>
	
	<procedure id="executeValidarPagosBancariosMasivos" parameterMap="paramExecuteValidarPagosBancariosMasivos">
		{call PER_PKG_PROCE.PER_PR_VALID_PAGOS_BANCA_MASIV(?) }
	</procedure>
		
	<parameterMap id="paramExecuteProcesarPagosBancariosMasivos" class="java.util.Map" >
		<parameter property="codigoPais"                	    jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoSociedad"            	    jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>		
		<parameter property="codigoCuentaCorrienteBancaria"     jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoUsuario"             	    jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>	        
    </parameterMap>
    
	<procedure id="executeProcesarPagosBancariosMasivos" parameterMap="paramExecuteProcesarPagosBancariosMasivos">
		{call PER_PKG_PROCE.PER_PR_PROCE_PAGOS_BANCO_MASIV(?,?,?,?)}
	</procedure>
	
	<parameterMap id="parametros" class="map" >
		<parameter property="codigoPais" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
		<parameter property="usuDigi" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>		
		<parameter property="tipOrigenDatos" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>				
		<parameter property="codigoInterfaz" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
		<parameter property="numeroLote" jdbcType="VARCHAR" javaType="java.lang.String" mode="OUT"/>				
	</parameterMap>
	
	
	<procedure id="executeGenerarCuentaCorrienteDocumentoLegal" parameterMap="parametros" >
		{call PER_PKG_PROCE_PERCE.PER_PR_CABEC_DETAL_DOLSO(?, ?, ?, ?, ?)}
	</procedure>	
	
	
    <parameterMap id="generarResumenDiarioPercepcionesSunatParam" class="map" >
		<parameter property="codigoPais" 	jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
		<parameter property="fechaGenerar" 	jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>		
		<parameter property="usuario" 		jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>							
	</parameterMap>	
	
	<procedure id="executeGenerarResumenDiarioPercepcionesSunat" parameterMap="generarResumenDiarioPercepcionesSunatParam" >
		{call PER_PKG_PROCE_PERCE.PER_PR_GENER_RESUM_PERCE(?, ?, ?)}
	</procedure>	
	
	
</sqlMap>