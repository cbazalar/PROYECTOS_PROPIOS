<?xml version="1.0" encoding="UTF-8"?>                                                      
<!DOCTYPE sqlMap                                                        
    PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN"                                                     
    "http://www.ibatis.com/dtd/sql-map-2.dtd">                                                      

<sqlMap namespace="sisicc.InterfazFLXSQL">

	 <typeAlias alias="consultoraFlexipago" type="biz.belcorp.ssicc.dao.spusicc.flx.model.ConsultoraFlexipago"/>
	 <typeAlias alias="consultoraFlexipagoAuditoria" type="biz.belcorp.ssicc.dao.spusicc.flx.model.ConsultoraFlexipagoAuditoria"/>
	 <typeAlias alias="consultoraFlexipagoPK" type="biz.belcorp.ssicc.dao.spusicc.flx.model.ConsultoraFlexipagoPK"/>
	 <typeAlias alias="base" type="biz.belcorp.ssicc.dao.sisicc.model.Base"/>
	 <typeAlias alias="consultoraFlexipagoObjetada" type="biz.belcorp.ssicc.dao.spusicc.flx.model.ConsultoraFlexipagoObjetada"/>
	 <typeAlias alias="interesFlexipago" type="biz.belcorp.ssicc.dao.spusicc.flx.model.InteresFlexipago"/>
	 
  	 <resultMap id="consultoraResult" class="consultoraFlexipago">														
		<result property="codigoPais" 					column="COD_PAIS"/>								
		<result property="codigoCliente" 				column="COD_CLIE"/>
		<result property="codigoCampanyaFacturacion" 	column="CAM_FACT"/>
		<result property="nombreConsultora" 			column="NOM_CLIE"/>
		<result property="lineaCredito" 				column="LIN_CRED"/>
		<result property="pedidoBase" 					column="PED_BASE"/>
		<result property="campanyaComunicacion" 		column="CAM_COMU"/>
		<result property="calificacionExperiencia"		column="CAL_EXPE"/>
		<result property="calificacionComportamiento"	column="CAL_COMP"/>
		<result property="flagHabilitado" 				column="IND_HABI"/>
		<result property="flagActivo" 					column="IND_ACTI"/>
		<result property="flagComunicado"				column="IND_COMU"/>
		<result property="flagEnviado" 					column="IND_ENVI"/>
		<result property="flagCancelado"				column="IND_CANC"/>
	 </resultMap>
	 	 
	 <resultMap id="baseMap" class="base">
		<result property="codigo"		column="COD_CALI"/>								
		<result property="descripcion" 	column="DES_CALI"/>
	 </resultMap>
	 
	 <resultMap id="consultoraFlexipagoAuditoriaResult" class="consultoraFlexipagoAuditoria">
		<result property="codigoPais"		column="COD_PAIS"/>								
		<result property="codigoCliente" 	column="COD_CLIE"/>
		<result property="codigoAccion" 	column="COD_ACCI"/>
		<result property="usuarioAccion" 	column="USU_ACCI"/>
		<result property="fechaAccion" 		column="FEC_ACCI"/>
		<result property="campanyaFacturacion" 		column="COD_PERI_FACT"/>
	 </resultMap>
	
	<resultMap id="consultoraFlexipagoResult" class="java.util.HashMap">														
		<result property="codigoPais" 					column="COD_PAIS"/>								
		<result property="codigoCliente" 				column="COD_CLIE"/>
		<result property="codigoCampanyaFacturacion" 	column="CAM_FACT"/>
		<result property="nombreConsultora" 			column="NOM_CLIE"/>
		<result property="lineaCredito" 				column="LIN_CRED"/>
		<result property="pedidoBase" 					column="PED_BASE"/>
		<result property="campanyaComunicacion" 		column="CAM_COMU"/>
		<result property="calificacionExperiencia"		column="CAL_EXPE"/>
		<result property="calificacionComportamiento"	column="CAL_COMP"/>
		<result property="flagHabilitado" 				column="IND_HABI"/>
		<result property="flagActivo" 					column="IND_ACTI"/>
		<result property="flagComunicado"				column="IND_COMU"/>
		<result property="flagEnviado" 					column="IND_ENVI"/>
		<result property="flagCancelado"				column="IND_CANC"/>
		<result property="estatus"					    column="ESTATUS"/>
		<result property="fecha_activacion"				column="FECHA_ACTIVACION"/>
		<result property="origen"						column="ORIGEN"/>
		<result property="fecha_cancelacion"			column="FECHA_CANCELACION"/>
		<result property="usuario_cancelacion"			column="USUARIO_CANCELACION"/>
		<result property="motivo_cancelacion"			column="MOTIVO_CANCELACION"/>
		<result property="numero_documento"			column="NUM_DOCU"/>
	 </resultMap>
	 
	  <resultMap id="interesFlexipagoResult" 		class="interesFlexipago">														
		<result property="periodoInicio" 			column="COD_PERI_INIC"/>								
		<result property="periodoFin" 				column="COD_PERI_FIN"/>
		<result property="rangoImpoDesde" 			column="VAL_IMPO_FINA_DESD"/>
		<result property="rangoImpoHasta" 			column="VAL_IMPO_FINA_HAST"/>
		<result property="valorCosto" 				column="VAL_COST_UTIL_FLEX"/>		
	 </resultMap>
	
	<select id="getConsultorasByCriteria" parameterClass="java.util.Map" resultMap="consultoraFlexipagoResult">
	  SELECT COD_PAIS,							
			COD_CLIE,
			CAM_FACT,
			NOM_CLIE,
			LIN_CRED,
			PED_BASE,
			CAM_COMU,
			CAL_EXPE,
			CAL_COMP,
			IND_HABI,
			IND_ACTI,
			IND_COMU,
			IND_ENVI,
			IND_CANC,
			ESTATUS,
			FECHA_ACTIVACION,
			ORIGEN,
			FECHA_CANCELACION,
			USUARIO_CANCELACION,
			MOTIVO_CANCELACION,
			NUM_DOCU
	  FROM (
        SELECT ROWNUM,
        FC.COD_PAIS, 
        CL.COD_CLIE,
        FC.COD_PERI_FACT CAM_FACT,
        CL.COD_CLIE CODIGO, TRIM(CL.VAL_APE1) || ' ' || TRIM(CL.VAL_APE2)  || ', ' || TRIM(CL.VAL_NOM1) || ' ' || TRIM(CL.VAL_NOM2)  AS NOM_CLIE,
        FC.VAL_LINE_CRED LIN_CRED,
        FC.VAL_PEDI_BASE PED_BASE,
        FC.COD_PERI_COMU CAM_COMU,
        CE.DES_CALI CAL_EXPE,
        CC.DES_CALI CAL_COMP,
        FC.IND_HABI,
        FC.IND_ACTI,
        FC.IND_COMU,
        FC.IND_ENVI,
        FC.IND_CANC,
        case 
           when fc.ind_acti = '0' and fc.ind_canc = '0' then 'Inactivo'
           when fc.ind_acti = '0' and fc.ind_canc = '1' then 'Cancelado'
           when fc.ind_acti = '1' and fc.ind_canc = '0' then 'Activo'  
        end estatus,
        (select max(a.fec_acci)
            from flx_audit_consu_habil a
           where a.cod_clie = fc.cod_clie
             and a.cod_acci = '02')  fecha_activacion,
        case
          when fc.num_docu is null then (select a.usu_acci 
                                          from flx_audit_consu_habil a
                                         where a.cod_clie = fc.cod_clie
                                           and a.cod_acci = '02'
                                           and rownum = 1)
          when fc.num_docu is not null then 'OCR'
        end origen,
        case
          when fc.ind_acti = '0' and fc.ind_canc = '1' then (select max(a.fec_acci) 
                                                             from flx_audit_consu_habil a
                                                            where a.cod_clie = fc.cod_clie
                                                              and a.cod_acci = '01') 
        end fecha_cancelacion,
        case
          when fc.ind_acti = '0' and fc.ind_canc = '1' then (select a.usu_acci 
                                                             from flx_audit_consu_habil a
                                                            where a.cod_clie = fc.cod_clie
                                                              and a.cod_acci = '01'
                                                              and rownum = 1) 
        end usuario_cancelacion,
        case
          when fc.ind_acti = '0' and fc.ind_canc = '1' then (select m.des_moti
                                                             from flx_audit_consu_habil a,
                                                                  flx_motiv_cance m
                                                            where a.cod_clie = fc.cod_clie
                                                              and a.cod_acci = '01'
                                                              and a.cod_moti = m.cod_moti
                                                              and rownum = 1) 
		        end motivo_cancelacion, 
		        fc.num_docu
        FROM FLX_CONSU_HABIL_FLEXI FC, MAE_CLIEN CL, FLX_CALIF_EXPER_FLEXI CE, FLX_CALIF_COMPO CC
        WHERE FC.COD_CLIE = CL.COD_CLIE 
        AND FC.IND_CALI_EXPE_FLEX = CE.COD_CALI
        AND FC.IND_CALI_COMP = CC.COD_CALI
		AND FC.COD_PAIS = #codigoPais#
		<isNotEmpty prepend="AND" property="campanyaComunicacion">
			FC.COD_PERI_COMU = #campanyaComunicacion#
		</isNotEmpty>
		
		<isNotEmpty prepend="AND" property="campanyaFacturacion">
			FC.COD_PERI_FACT = #campanyaFacturacion#
		</isNotEmpty>
		
		<isNotEmpty prepend="AND" property="codigoCliente">
			FC.COD_CLIE = #codigoCliente#
		</isNotEmpty>
		
		<isNotEmpty prepend="AND" property="codigoCalificacionComportamiento">
			FC.IND_CALI_COMP = #codigoCalificacionComportamiento#
		</isNotEmpty>
		
		<isNotEmpty prepend="AND" property="codigoCalificacionExperiencia">
			FC.IND_CALI_EXPE_FLEX = #codigoCalificacionExperiencia#
		</isNotEmpty>
		)<![CDATA[
		WHERE ROWNUM < 501
	    ]]>
	</select>
	
	<select id="getConsultora" parameterClass="consultoraFlexipagoPK" resultMap="consultoraResult">
        SELECT
        FC.COD_PAIS, 
        CL.COD_CLIE,
        FC.COD_PERI_FACT CAM_FACT,
        CL.COD_CLIE CODIGO, TRIM(CL.VAL_APE1) || ' ' || TRIM(CL.VAL_APE2)  || ', ' || TRIM(CL.VAL_NOM1) || ' ' || TRIM(CL.VAL_NOM2)  AS NOM_CLIE,
        FC.VAL_LINE_CRED LIN_CRED,
        FC.VAL_PEDI_BASE PED_BASE,
        FC.COD_PERI_COMU CAM_COMU,
        CE.DES_CALI CAL_EXPE,
        CC.DES_CALI CAL_COMP,
        FC.IND_HABI,
        FC.IND_ACTI,
        FC.IND_COMU,
        FC.IND_ENVI,
        FC.IND_CANC
        FROM FLX_CONSU_HABIL_FLEXI FC, MAE_CLIEN CL, FLX_CALIF_EXPER_FLEXI CE, FLX_CALIF_COMPO CC
        WHERE FC.COD_CLIE = CL.COD_CLIE 
        AND FC.IND_CALI_EXPE_FLEX = CE.COD_CALI
        AND FC.IND_CALI_COMP = CC.COD_CALI
		AND FC.COD_PAIS = #codigoPais#
		AND FC.COD_CLIE = #codigoCliente#
		AND FC.COD_PERI_FACT = #codigoCampanyaFacturacion#
	</select>
	
	<update id="updateConsultora" parameterClass="consultoraFlexipago">
		UPDATE FLX_CONSU_HABIL_FLEXI
		SET IND_HABI = #flagHabilitado#,
			IND_ACTI = #flagActivo# ,
			IND_CANC = #flagCancelado#
		WHERE COD_PAIS = #codigoPais#
		AND COD_CLIE = #codigoCliente#
		 <![CDATA[
		AND COD_PERI_FACT >= #codigoCampanyaFacturacion#
		]]>		
	</update>
	
	<insert id="insertAuditoriaConsultora" parameterClass="consultoraFlexipagoAuditoria">
		INSERT INTO FLX_AUDIT_CONSU_HABIL
		(
			COD_PAIS,
			COD_CLIE,
			FEC_ACCI,
			COD_ACCI,
			USU_ACCI,
			COD_PERI_FACT,
			COD_MOTI
			)
		VALUES(
			#codigoPais#,
			#codigoCliente#,
			#fechaAccion#,
			#codigoAccion#,
			#usuarioAccion#,
			#campanyaFacturacion#,
			#codigoMotivo#
		)
	</insert>
	
	<select id="getCalificacionesComportamiento" resultMap="baseMap">
		SELECT 
		COD_CALI,
		DES_CALI
		FROM FLX_CALIF_COMPO  
	</select>
	
	<select id="getCalificacionesExperiencia" resultMap="baseMap">
		SELECT 
		COD_CALI,
		DES_CALI 
		FROM FLX_CALIF_EXPER_FLEXI
	</select>
	
	<select id="getConsultoraAuditoriaByCodigosAccion" parameterClass="java.util.Map" resultMap="consultoraFlexipagoAuditoriaResult">
		SELECT 
		    COD_PAIS, 
		    COD_CLIE, 
		    COD_ACCI, 
		    USU_ACCI, 
		    FEC_ACCI,
		    COD_PERI_FACT 
		FROM (
		    SELECT COD_PAIS, COD_CLIE, COD_ACCI, USU_ACCI, FEC_ACCI, COD_PERI_FACT 
		    FROM FLX_AUDIT_CONSU_HABIL
		    WHERE COD_PAIS = #codigoPais#
		    AND COD_CLIE = #codigoCliente#
		    AND (COD_ACCI = #codigoAccion1# OR COD_ACCI = #codigoAccion2#)
		    ORDER BY FEC_ACCI DESC)
		WHERE ROWNUM = 1
	</select>
	
    <select id="getCodigoConsultora" parameterClass="string"  resultClass="string">
    	Select val_nom1 || ' ' || val_nom2 || ' ' || val_ape1 || ' ' || val_ape2  NOMBRE 
		from mae_clien 
		where cod_clie =  #value#
    </select>
    
    <select id="getCodigoConsultoraHabil" parameterClass="string"  resultClass="string">
    	Select distinct(cod_clie)   
		from flx_consu_habil_flexi 
		where cod_clie =  #value#
    </select>
    
    <select id="getContratoConsultoraHabil" parameterClass="java.util.Map"  resultClass="string">   	
		select distinct(xx.cod_clie) from 
		(
		select * from int_solic_conso_carta_flexi dd
		union
		select * from int_histo_conso_carta_flexi de
		) xx
		where xx.cod_clie = #codigoCliente#
		and xx.num_docu = #numeroContrato#
    </select>
    
      <!-- GENERACION DE INTERFACES SALIDA -->														
  <parameterMap id="executeEnviarConsultorasObjetadasParams" class="map">														
    <parameter property="codigoPais" 		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
    <parameter property="codigoPeriodo" 	jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
	<parameter property="codigoSistema"	    jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
	<parameter property="codigoInterfaz"    jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>													
	<parameter property="nombreArchivo"		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
	<parameter property="codigoUsuario"		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>    
	<parameter property="numeroLote"		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
  </parameterMap>														
  														
  <procedure id="executeEnviarConsultorasObjetadas" parameterMap="executeEnviarConsultorasObjetadasParams">														
	  {call INT_PKG_FLEX.INT_PR_FLX_ENVIO_CONSU_OBJET(?,?,?,?,?,?,?)}											
  </procedure>

 <parameterMap id="executeEnviarResultadoProgramasParams" class="map">														
    <parameter property="codigoPais" 		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
    <parameter property="codigoPeriodo" 	jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
	<parameter property="codigoSistema"	    jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
	<parameter property="codigoInterfaz"    jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>													
	<parameter property="nombreArchivo"		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
	<parameter property="codigoUsuario"		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>    
	<parameter property="numeroLote"		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
  </parameterMap>

  <procedure id="executeEnviarResultadoProgramas" parameterMap="executeEnviarResultadoProgramasParams">														
	  {call INT_PKG_FLEX.INT_PR_FLX_ENVIO_RESUL_PROGR(?,?,?,?,?,?,?)}											
  </procedure>	
  
  <procedure id="executeEnviarInformacionConsultorasHabiles" parameterMap="executeEnviarConsultorasObjetadasParams">														
	  {call INT_PKG_FLEX.INT_PR_FLX_ENVIO_INFOR_HABIL(?,?,?,?,?,?,?)}											
  </procedure>   
  
  <parameterMap id="executeInterfazAVIRecepcionarConsultorasHabilesParams" class="map">														
    <parameter property="codigoPais" 		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>    
	<parameter property="codigoSistema"	    jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
	<parameter property="codigoInterfaz"    jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>													
	<parameter property="nombreArchivo"		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
	<parameter property="codigoUsuario"		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>    
  </parameterMap>	
  
  <procedure id="executeInterfazAVIRecepcionarConsultorasHabiles" 
   		parameterMap="executeInterfazAVIRecepcionarConsultorasHabilesParams">														
	  {call INT_PKG_FLEX.INT_PR_FLX_RECEP_CONSU_HABIL(?,?,?,?,?)}											
  </procedure>
  
  <parameterMap id="executeInterfazAVIRecepcionarConsultorasComunicacionParams" class="map">														
    <parameter property="codigoPais" 		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>    
	<parameter property="codigoSistema"	    jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
	<parameter property="codigoInterfaz"    jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>													
	<parameter property="nombreArchivo"		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
	<parameter property="codigoUsuario"		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>    
  </parameterMap>
  
  <procedure id="executeInterfazAVIRecepcionarConsultorasComunicacion" 
   		parameterMap="executeInterfazAVIRecepcionarConsultorasComunicacionParams">														
	  {call INT_PKG_FLEX.INT_PR_FLX_RECEP_CONSU_COMU(?,?,?,?,?)}											
  </procedure>
  
  <resultMap id="consultoraObjetadaResult" class="consultoraFlexipagoObjetada">														
		<result property="codigoPais" 					column="COD_PAIS"/>								
		<result property="codigoCliente" 				column="COD_CLIE"/>
		<result property="nombreConsultora" 			column="NOM_CLIE"/>
		<result property="codigoCampanyaFacturacion" 	column="CAM_FACT"/>
  </resultMap>
  <select id="getConsultorasObjetadaByCriteria" parameterClass="java.util.Map" resultMap="consultoraObjetadaResult">
        SELECT FC.COD_PAIS, CL.COD_CLIE COD_CLIE, 
        	   TRIM(CL.VAL_APE1) || ' ' || TRIM(CL.VAL_APE2)  || ', ' || TRIM(CL.VAL_NOM1) || ' ' || TRIM(CL.VAL_NOM2)  AS NOM_CLIE,
       		   FC.COD_PERI_FACT CAM_FACT
        FROM FLX_OBJEC_COMUN_FLEXI FC, MAE_CLIEN CL 
        WHERE FC.COD_CLIE = CL.COD_CLIE 
		AND FC.COD_PAIS = #codigoPais#
		<isNotEmpty prepend="AND" property="campanyaFacturacion">
			FC.COD_PERI_FACT = #campanyaFacturacion#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="codigoCliente">
			FC.COD_CLIE = #codigoCliente#
		</isNotEmpty>
	</select>
	
    <insert id="insertConsultoraObjetada" parameterClass="consultoraFlexipagoObjetada">
    	INSERT INTO FLX_OBJEC_COMUN_FLEXI(
			COD_PAIS,
			COD_CLIE,
			COD_PERI_FACT,
			USU_DIGI,
			FEC_DIGI)
		VALUES(
			#codigoPais#,
			#codigoCliente#,
			#codigoCampanyaFacturacion#,
			#auditInfo.createdBy#,
			#auditInfo.created#)
	</insert>
	
	<select id="getConsultoraObjetada" parameterClass="consultoraFlexipagoPK" resultMap="consultoraObjetadaResult">
		SELECT 
			COD_PAIS,
			COD_CLIE,
			'' NOM_CLIE,
			COD_PERI_FACT CAM_FACT
		FROM FLX_OBJEC_COMUN_FLEXI
		WHERE COD_PAIS = #codigoPais#
		AND COD_CLIE = #codigoCliente#
		AND COD_PERI_FACT = #codigoCampanyaFacturacion#
	</select>
	
	<update id="updateConsultoraObjetada" parameterClass="consultoraFlexipagoObjetada">
		UPDATE FLX_OBJEC_COMUN_FLEXI
		SET
		USU_DIGI = #auditInfo.updatedBy#,
		FEC_DIGI = #auditInfo.lastUpdated#
		WHERE COD_PAIS = #codigoPais#
		AND COD_CLIE = #codigoCliente#
		AND COD_PERI_FACT = #codigoCampanyaFacturacion#
	</update>
	
	<delete id="deleteConsultoraObjetada" parameterClass="consultoraFlexipagoPK">
		DELETE FROM FLX_OBJEC_COMUN_FLEXI
		WHERE COD_PAIS = #codigoPais#
		AND COD_CLIE = #codigoCliente#
		AND COD_PERI_FACT = #codigoCampanyaFacturacion#
	</delete>
	
    <resultMap id="datosConsultoraResult"     class="java.util.HashMap">																					
		<result property="codigoCliente" 				column="CODIGO"/>
		<result property="nombreCliente"    			column="NOM_CLIE"/>
		<result property="desRegion"		 			column="DES_REGI"/>
		<result property="desZona"		 				column="DES_ZONA"/>
		<result property="desSeccion"  					column="DES_SECC"/>
		<result property="periodoMin"    		 		column="MIN_FLEXI"/>
		<result property="periodoMax"					column="MAX_FLEXI"/>
		<result property="periodoActivacion"			column="CAM_ACTI"/>
		<result property="fechaActivacion"	 			column="FEC_ACTI"/>
		<result property="calificacion"					column="DES_CALI"/>
		<result property="estadoContrato"				column="EST_CONT"/>
		<result property="estadoConsultora"				column="ESTATUS"/>
		<result property="motivoRechazo"				column="motivo_cancelacion"/>
		<result property="fechaRechazo"					column="fecha_cancelacion"/>
		<result property="numeroContrato"				column="NUM_CONT"/>
		
	 </resultMap>
	 
	 <select id="getDatosConsultora" parameterClass="java.util.Map" resultMap="datosConsultoraResult">
	      SELECT
              CL.COD_CLIE CODIGO,
              TRIM(CL.VAL_APE1) || ' ' || TRIM(CL.VAL_APE2) || ', ' ||
              TRIM(CL.VAL_NOM1) || ' ' || TRIM(CL.VAL_NOM2) AS NOM_CLIE,
              GEN_PKG_GENER.GEN_FN_CLIEN_DATOS(CL.COD_CLIE, 'DES_REGI') DES_REGI,
		      GEN_PKG_GENER.GEN_FN_CLIEN_DATOS(CL.COD_CLIE, 'DES_ZONA') DES_ZONA,
              GEN_PKG_GENER.GEN_FN_CLIEN_DATOS(CL.COD_CLIE, 'DES_SECC') DES_SECC,
              PERI_FLEXI.MIN_FLEXI,
              PERI_FLEXI.MAX_FLEXI,
		      (SELECT MIN(CHF.COD_PERI_COMU)
		          FROM FLX_CONSU_HABIL_FLEXI CHF
		         WHERE CHF.COD_CLIE = #codigoCliente#) PERI_COMU,
		       (SELECT TO_CHAR(MIN(CA.FEC_PROG_FACT),'dd/mm/yyyy') 
		          FROM PED_TIPO_SOLIC_PAIS TSP,
		               PED_TIPO_SOLIC      TS,
		               PED_SOLIC_CABEC     CA,
		               CRA_PERIO           CRA,
		               SEG_PERIO_CORPO     SPC,
		               MAE_CLIEN           MC
		         WHERE CA.TSPA_OID_TIPO_SOLI_PAIS = TSP.OID_TIPO_SOLI_PAIS
		           AND TS.OID_TIPO_SOLI = TSP.TSOL_OID_TIPO_SOLI
		           AND CRA.OID_PERI = CA.PERD_OID_PERI
		           AND CRA.PERI_OID_PERI = SPC.OID_PERI
		           AND SPC.COD_PERI =
		               (SELECT MIN(CHF.COD_PERI_COMU)
		                  FROM FLX_CONSU_HABIL_FLEXI CHF
		                 WHERE CHF.COD_CLIE = #codigoCliente#)
		           AND MC.OID_CLIE = CA.CLIE_OID_CLIE
		           AND MC.COD_CLIE = #codigoCliente#
		           AND CA.GRPR_OID_GRUP_PROC = 5
		           AND TS.COD_TIPO_SOLI = 'SOC') FEC_COMU,
              ACTI.CAM_ACTI,
              TO_CHAR(ACTI.FEC_ACTI,'dd/mm/yyyy') FEC_ACTI,
              PERI.VAL_LINE_CRED,
              PERI.ESTATUS,
              PERI.motivo_cancelacion,
              TO_CHAR(PERI.fecha_cancelacion,'dd/mm/yyyy') fecha_cancelacion,
              (select xx.num_docu
              from (select *
		                  from int_solic_conso_carta_flexi dd
                      union
		                select * from int_histo_conso_carta_flexi de) xx, sto_docum_digit dd
		        where dd.sec_nume_docu= xx.sec_nume_docu
		        and dd.cod_tipo_docu = 'CIF'
		        and dd.ind_envi = '1'
		        and  xx.cod_clie = #codigoCliente#) NUM_CONT,
              PERI.DES_CALI,
              (
                SELECT decode(fc.ind_acti,
                              '1',
                              'Enviado',
                              '0',
                              (decode((select count(1)
                                        from flx_audit_consu_habil a
                                       where a.cod_acci = '01'
                                         and a. cod_clie = fc.cod_clie),
                                      0,
                                      'No Enviado',
                                      'Cancelado'))) estado_consultora_flx
                  FROM FLX_CONSU_HABIL_FLEXI FC
                 WHERE FC.COD_PERI_FACT =
                       (select max(fc.cod_peri_fact)
                          from FLX_CONSU_HABIL_FLEXI FC
                         where FC.COD_CLIE = #codigoCliente#)
                   AND FC.COD_CLIE =  #codigoCliente#
                ) EST_CONT
         FROM MAE_CLIEN CL,
              (SELECT CFC.COD_CLIE,
                      NVL(MIN(CFC.COD_PERI), '') MIN_FLEXI,
                      NVL(MAX(CFC.COD_PERI), '') MAX_FLEXI
                 FROM FLX_CUOTA_FLEXI_FACTU_CABEC CFC
                WHERE CFC.COD_CLIE = #codigoCliente#
                GROUP BY CFC.COD_CLIE) PERI_FLEXI,
              (SELECT ACH.COD_CLIE,
                      NVL(MIN(ACH.FEC_ACCI), '') FEC_ACTI,
                      NVL(MIN(ACH.COD_PERI_FACT), '') CAM_ACTI
                 FROM FLX_AUDIT_CONSU_HABIL ACH
                WHERE ACH.COD_ACCI = '02'
                  AND ACH.COD_CLIE = #codigoCliente#
                GROUP BY ACH.COD_CLIE) ACTI,
              (SELECT FC.COD_CLIE,                      
                      case
                      when FC.ind_acti = 0 and FC.ind_canc = 0 then 'Inactiva'
                      when FC.ind_acti = 1 and FC.ind_canc = 0 then 'Activa'   
                      when FC.ind_acti = 0 and FC.ind_canc = 1 then 'Cancelada' 
                      end estatus,
                      case  when fc.ind_acti = '0' and fc.ind_canc = '1' then (select m.des_moti
                                                             from flx_audit_consu_habil a,
                                                                  flx_motiv_cance m
                                                            where a.cod_clie = fc.cod_clie
                                                              and a.cod_acci = '01'
                                                              and a.cod_moti = m.cod_moti
                                                              and rownum = 1)  end motivo_cancelacion,
                      case
                        when fc.ind_acti = '0' and fc.ind_canc = '1' then (select max(a.fec_acci) 
                                                                           from flx_audit_consu_habil a
                                                                          where a.cod_clie = fc.cod_clie
                                                                            and a.cod_acci = '01')end fecha_cancelacion,
                      TO_CHAR(FC.VAL_LINE_CRED,'9999999999.99') VAL_LINE_CRED,
                      FCC.DES_CALI
                 FROM FLX_CONSU_HABIL_FLEXI       FC,
                      FLX_CALIF_COMPO FCC
                WHERE FC.COD_CLIE =  #codigoCliente#
                  AND FC.COD_PERI_FACT = #codigoPeriodo#
                  AND FC.IND_CALI_COMP = FCC.COD_CALI) PERI
        WHERE CL.COD_CLIE = #codigoCliente#
          AND ACTI.COD_CLIE(+) = CL.COD_CLIE
          AND PERI_FLEXI.COD_CLIE(+) = CL.COD_CLIE
          AND PERI.COD_CLIE(+) = CL.COD_CLIE			
	</select>  
	
	<resultMap id="datosConsultoraDetalleResult"     class="java.util.HashMap">																					
		<result property="codigoPeriodo" 				column="COD_PERI_FACT"/>
		<result property="lineaCredito"    			    column="VAL_LINE_CRED"/>
		<result property="pedidoBase"		 			column="VAL_PEDI_BASE"/>
		<result property="indicadorHabilitado"			column="IND_HABI"/>
		<result property="indicadorActivo"				column="IND_ACTI"/>	
	 </resultMap>
	 
	 <select id="getDatosConsultoraDetalle" parameterClass="java.util.Map" resultMap="datosConsultoraDetalleResult">
       SELECT FC.COD_PERI_FACT,
              TO_CHAR(FC.VAL_LINE_CRED,'9999999999.99') VAL_LINE_CRED,
              TO_CHAR(FC.VAL_PEDI_BASE,'9999999999.99') VAL_PEDI_BASE,
              FC.IND_HABI,
              FC.IND_ACTI
         FROM FLX_CONSU_HABIL_FLEXI FC, FLX_CALIF_COMPO FCC
        WHERE FC.COD_CLIE = #codigoCliente#
          AND FC.COD_PERI_FACT =
              CUP_PKG_PROG_NUEVAS.GEN_FN_DEV_NSGTE_CAMPA(#codigoPeriodo#, -1)
          AND FC.IND_CALI_COMP = FCC.COD_CALI
       UNION
       SELECT FC.COD_PERI_FACT,
              TO_CHAR(FC.VAL_LINE_CRED,'9999999999.99') VAL_LINE_CRED,
              TO_CHAR(FC.VAL_PEDI_BASE,'9999999999.99') VAL_PEDI_BASE,
              FC.IND_HABI,
              FC.IND_ACTI
         FROM FLX_CONSU_HABIL_FLEXI FC, FLX_CALIF_COMPO FCC
        WHERE FC.COD_CLIE = #codigoCliente#
          AND FC.COD_PERI_FACT = #codigoPeriodo#
          AND FC.IND_CALI_COMP = FCC.COD_CALI
       UNION
       SELECT FC.COD_PERI_FACT,
              TO_CHAR(FC.VAL_LINE_CRED,'9999999999.99') VAL_LINE_CRED,
              TO_CHAR(FC.VAL_PEDI_BASE,'9999999999.99') VAL_PEDI_BASE,
              FC.IND_HABI,
              FC.IND_ACTI
         FROM FLX_CONSU_HABIL_FLEXI FC, FLX_CALIF_COMPO FCC
        WHERE FC.COD_CLIE = #codigoCliente#
          AND FC.COD_PERI_FACT =
              CUP_PKG_PROG_NUEVAS.GEN_FN_DEV_NSGTE_CAMPA(#codigoPeriodo#, 1)
          AND FC.IND_CALI_COMP = FCC.COD_CALI
	</select>  

	<procedure id="executeProcesarFlexipagoGP3">
		{call flx_pkg_proce.flx_pr_proce_flexi_gp3()}											
	</procedure>	
		
  	<parameterMap id="executeRecepcionarConsultorasRechazadasWEBParams" class="map">														
   		<parameter property="codigoPais" 		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>    
		<parameter property="codigoSistema"	    jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoInterfaz"    jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>													
		<parameter property="nombreArchivo"		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoUsuario"		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>    
  	</parameterMap>
  
  	<procedure id="executeRecepcionarConsultorasRechazadasWEB" parameterMap="executeRecepcionarConsultorasRechazadasWEBParams">														
		{call INT_PKG_FLEX.INT_PR_FLX_RECEP_CONSU_RECHW(?,?,?,?,?)}											
  	</procedure>

  	<parameterMap id="executeRecepcionarConsultorasRecomendadasWEBParams" class="map">														
   		<parameter property="codigoPais" 		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>    
		<parameter property="codigoSistema"	    jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoInterfaz"    jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>													
		<parameter property="nombreArchivo"		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoUsuario"		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>    
  	</parameterMap>
  
  	<procedure id="executeRecepcionarConsultorasRecomendadasWEB" parameterMap="executeRecepcionarConsultorasRecomendadasWEBParams">														
		{call INT_PKG_FLEX.INT_PR_FLX_RECEP_CONSU_RECOW(?,?,?,?,?)}
  	</procedure>
	  
  	<parameterMap id="executeEnvioInformacionProcesosComercialesParams" class="map">														
   		<parameter property="codigoPais" 		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>    
		<parameter property="codigoSistema"	    jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoPeriodo"	    jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoUsuario"		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>    
  	</parameterMap>
  
  	<procedure id="executeEnvioInformacionProcesosComerciales" parameterMap="executeEnvioInformacionProcesosComercialesParams">														
		{call INT_PKG_FLEX.INT_PR_FLX_ENVIO_PROCE_COMER(?,?,?,?)}											
  	</procedure>
	  
  	<parameterMap id="executeRecepcionarVariablesModeloParams" class="map">														
   		<parameter property="codigoPais" 		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>    
		<parameter property="codigoSistema"	    jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoInterfaz"    jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>													
		<parameter property="nombreArchivo"		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoPeriodo"		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoUsuario"		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>    
  	</parameterMap>
  	
  	<procedure id="executeRecepcionarVariablesModelo" parameterMap="executeRecepcionarVariablesModeloParams">														
		{call INT_PKG_FLEX.INT_PR_FLX_RECEP_VARIA_MODEL(?,?,?,?,?,?)}
  	</procedure>

  	<parameterMap id="executeCalculoVariablesModeloParams" class="map">														
   		<parameter property="codigoPais" 		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>    
		<parameter property="codigoPeriodo"	    jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoUsuario"		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>    
  	</parameterMap>
  	
  	<procedure id="executeCalculoVariablesModelo" parameterMap="executeCalculoVariablesModeloParams">														
		{call FLX_PKG_PROCE_SELEC.FLX_PR_EVALU_CONSU(?,?,?)}
  	</procedure>

  	<parameterMap id="executeCalculoVariablesCuentaCorrienteParams" class="map">														
   		<parameter property="codigoPais" 		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>    
		<parameter property="codigoPeriodo"	    jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="campanyasAtras"	jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
  	</parameterMap>
  	
  	<procedure id="executeCalculoVariablesCuentaCorriente" parameterMap="executeCalculoVariablesCuentaCorrienteParams">														
		{call FLX_PKG_PROCE_SELEC.FLX_PR_CALCU_VARIA_CTACT_CANCA(?,?,?)}
  	</procedure>
  	
  	<parameterMap id="executeEnviarVariablesCuentaCorrienteParams" class="map">						
    	<parameter property="codigoPais" 			jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoSistema"	    jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoInterfaz"    	jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>							
		<parameter property="nombreArchivo"		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
    	<parameter property="codigoPeriodo" 		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoUsuario"		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
  	</parameterMap>														
  														
  	<procedure id="executeEnviarVariablesCuentaCorriente" parameterMap="executeEnviarVariablesCuentaCorrienteParams">									
	  	{call INT_PKG_FLEX.INT_PR_FLX_ENVIO_VARIA_CTACTE(?,?,?,?,?,?)}		
  	</procedure>
  	
  	<parameterMap id="executeRecepcionarVariablesVentaParams" class="map">
   		<parameter property="codigoPais" 		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>    
		<parameter property="codigoSistema"	    jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoInterfaz"    jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>													
		<parameter property="nombreArchivo"		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoPeriodo"		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoUsuario"		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>    
  	</parameterMap>
  	
  	<procedure id="executeRecepcionarVariablesVenta" parameterMap="executeRecepcionarVariablesVentaParams">														
		{call INT_PKG_FLEX.INT_PR_FLX_RECEP_VARIA_DATAM(?,?,?,?,?,?)}
  	</procedure>
  	
  	<parameterMap id="executeEnviarResultadosProgramaParams" class="map">														
    	<parameter property="codigoPais" 		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoSistema"	    jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoInterfaz"    jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>													
		<parameter property="nombreArchivo"		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
    	<parameter property="codigoPeriodo" 	jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoUsuario"		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>    
  	</parameterMap>														
  														
  	<procedure id="executeEnviarResultadosPrograma" parameterMap="executeEnviarResultadosProgramaParams">														
	  	{call INT_PKG_FLEX.INT_PR_FLX_ENVIO_REPRO(?,?,?,?,?,?)}											
  	</procedure>

		<resultMap id="getDatosUsosFlexipagoResult"     class="java.util.HashMap">																					
		<result property="codigoPeriodo" 				column="cod_peri"/>
		<result property="montoTotal"    			    column="monto_total"/>
		<result property="montoPagado"		 			column="monto_pagado"/>
		<result property="montoFinCuota"					    column="cuota"/>
		<result property="montoInteCuota"				        column="interes"/>
		<result property="cuota1"				        column="cuota1"/>	
		<result property="cuota2"				        column="cuota2"/>		
	 </resultMap>
			
	 <select id="getDatosUsosFlexipago" parameterClass="java.util.Map" resultMap="getDatosUsosFlexipagoResult">
      select ca.cod_peri,
       psc.val_tota_paga_loca monto_total,
       psc.val_tota_paga_loca -
       NVL((select sum(mcc.imp_paga)
             from ccc_movim_cuent_corri mcc, flx_cuota_flexi_factu_detal de
            where mcc.oid_movi_cc = de.oid_movi_carg_flex
              and de.cod_peri = ca.cod_peri
              and de.cod_clie = ca.cod_clie), 0) -
       NVL((select SUM(mcc.imp_paga)
             from ccc_movim_cuent_corri mcc, flx_cuota_flexi_factu_detal de
            where mcc.oid_movi_cc = de.oid_movi_carg_uso
              and de.cod_peri = ca.cod_peri
              and de.cod_clie = ca.cod_clie), 0) monto_pagado,
       ca.val_mont_fina / 2 cuota,
       (select sum(de.val_mont_carg_uso)
          from flx_cuota_flexi_factu_detal de
         where de.cod_peri = ca.cod_peri
           and de.oid_peri_cuot_flex =
               GEN_PKG_GENER.GEN_FN_DEVUELVE_ID_CRA_PERIO(CUP_PKG_PROG_NUEVAS.gen_fn_dev_nsgte_campa(ca.cod_peri,
                                                                                                     1),
                                                          gen_pkg_gener.gen_fn_devuelve_id_marca('T'),
                                                          gen_pkg_gener.gen_fn_devuelve_id_canal('VD'))
           and de.cod_clie = ca.cod_clie) interes,
       (select sum(de.val_mont_cuot_flex) + sum(de.val_mont_carg_uso)
          from flx_cuota_flexi_factu_detal de
         where de.cod_peri = ca.cod_peri
           and de.oid_peri_cuot_flex =
               GEN_PKG_GENER.GEN_FN_DEVUELVE_ID_CRA_PERIO(CUP_PKG_PROG_NUEVAS.gen_fn_dev_nsgte_campa(ca.cod_peri,
                                                                                                     1),
                                                          gen_pkg_gener.gen_fn_devuelve_id_marca('T'),
                                                          gen_pkg_gener.gen_fn_devuelve_id_canal('VD'))
           and de.cod_clie = ca.cod_clie) cuota1,
       (select sum(de.val_mont_cuot_flex) + sum(de.val_mont_carg_uso)
          from flx_cuota_flexi_factu_detal de
         where de.cod_peri = ca.cod_peri
           and de.oid_peri_cuot_flex =
               GEN_PKG_GENER.GEN_FN_DEVUELVE_ID_CRA_PERIO(CUP_PKG_PROG_NUEVAS.gen_fn_dev_nsgte_campa(ca.cod_peri,
                                                                                                     2),
                                                          gen_pkg_gener.gen_fn_devuelve_id_marca('T'),
                                                          gen_pkg_gener.gen_fn_devuelve_id_canal('VD'))
           and de.cod_clie = ca.cod_clie) cuota2
  from flx_cuota_flexi_factu_cabec ca, ped_solic_cabec psc
 where ca.soca_oid_soli_cabe = psc.oid_soli_cabe
   and ca.cod_clie = #codigoCliente#
 order by 1 desc			
	</select>  
	
	<parameterMap id="executeReporteDetalleSaldoParams" class="map">														
    	<parameter property="codigoCampana" 		jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>
		<parameter property="codigoPais"	    	jdbcType="VARCHAR" javaType="java.lang.String"  mode="IN"/>  
		<parameter property="oid"	    			jdbcType="VARCHAR" javaType="java.lang.String"  mode="OUT"/>
  	</parameterMap>														
  														
  	<procedure id="executeReporteDetalleSaldo" parameterMap="executeReporteDetalleSaldoParams">														
	  	{call FLX_PKG_PROCE.FLX_PR_GENER_REPOR_SALDO(?,?,?)}											
  	</procedure>
  	
  	<select id="getMotivos" resultMap="baseMap">
		SELECT 
		COD_MOTI cod_cali,
		DES_MOTI des_cali
		FROM FLX_MOTIV_CANCE  
	</select>
  	
  	<select id="getPasoPedido" parameterClass="java.util.Map" resultClass="java.lang.String">
		  SELECT COUNT(1)
			  FROM ped_solic_cabec     a,
			       ped_tipo_solic_pais b,
			       ped_tipo_solic      c,
			       ped_solic_cabec     d,
			       cra_perio           e,
			       seg_perio_corpo     f,
			       mae_clien           m
			 WHERE a.tspa_oid_tipo_soli_pais = b.oid_tipo_soli_pais
			   AND b.tsol_oid_tipo_soli = c.oid_tipo_soli
			   AND c.cod_tipo_soli = 'SOC'
			   AND a.soca_oid_soli_cabe = d.oid_soli_cabe
			   AND d.esso_oid_esta_soli != 4
			   AND a.perd_oid_peri = e.oid_peri
			   AND e.peri_oid_peri = f.oid_peri
			   AND f.cod_peri = #codigoCampanyaFacturacion#
			   AND a.clie_oid_clie = m.oid_clie
			   and m.cod_clie = #codigoCliente#
  	</select>
  	
  	<select id="getCerroRegion" parameterClass="java.util.Map" resultClass="java.lang.String">
		  select count(1)
			  from mae_clien clie,
			       mae_clien_unida_admin cuad,
			       zon_terri_admin ztad,
			       zon_secci zscc,
			       zon_zona zzon,
			       zon_regio zorg,
			       (SELECT zorg.cod_regi, TRUNC(coci.fec_cier) fec_cier
			          FROM fac_contr_cierr           coci,
			               own_comun.fac_tipos_cierr tcie,
			               zon_regio                 zorg
			         WHERE coci.tcie_oid_tipo_cier = tcie.oid_tipo_cier
			           AND coci.zorg_oid_regi = zorg.oid_regi
			           AND coci.perd_oid_peri =
			               (SELECT oid_peri
			                  FROM cra_perio
			                 WHERE val_nomb_peri LIKE '%' || #codigoCampanyaFacturacion# || '%')
			           AND tcie.oid_tipo_cier = 1
			         GROUP BY zorg.cod_regi, TRUNC(coci.fec_cier)) cier
			 where clie.oid_clie = cuad.clie_oid_clie
			   and cuad.ztad_oid_terr_admi = ztad.oid_terr_admi
			   and ztad.zscc_oid_secc = zscc.oid_secc
			   and zscc.zzon_oid_zona = zzon.oid_zona
			   and zzon.zorg_oid_regi = zorg.oid_regi
			   and zorg.cod_regi = cier.cod_regi(+)
			   and clie.cod_clie = #codigoCliente#
			   and cuad.ind_acti = 1
  	</select>
  	
  	<select id="getConsultoraActiva" parameterClass="consultoraFlexipago"  resultClass="string">   	
		select ch.cod_clie
		  from flx_consu_habil_flexi ch
		 where ch.cod_pais = #codigoPais#
		   and ch.cod_clie =  #codigoCliente#
		   and ch.cod_peri_fact = #codigoCampanyaFacturacion#
		   and ch.ind_acti = '1'
    </select>
  	
  	<update id="updateEnvioContrato" parameterClass="consultoraFlexipago">
		UPDATE FLX_CONSU_HABIL_FLEXI
		SET IND_ENVI = '1'
		WHERE COD_PAIS = #codigoPais#
		AND COD_CLIE = #codigoCliente#
		<![CDATA[
		AND COD_PERI_FACT >= #codigoCampanyaFacturacion#
		]]>		
	</update>	
	 
	 <select id="getInteresFlexipagoList" parameterClass="interesFlexipago" resultMap="interesFlexipagoResult">
		SELECT COD_PERI_INIC, 
			COD_PERI_FIN, 
			VAL_IMPO_FINA_DESD,
			VAL_IMPO_FINA_HAST,
			VAL_COST_UTIL_FLEX 
		FROM flx_costo_utili_flexi order by 3 asc
	</select>
	
	<select id="getInteresFlexipago" parameterClass="interesFlexipago" resultMap="interesFlexipagoResult">
		SELECT COD_PERI_INIC, 
			COD_PERI_FIN, 
			VAL_IMPO_FINA_DESD,
			VAL_IMPO_FINA_HAST,
			VAL_COST_UTIL_FLEX 
		FROM flx_costo_utili_flexi
		WHERE COD_PERI_INIC = #periodoInicio#
		AND Val_Impo_Fina_Desd = #rangoImpoDesde#
		AND Val_Impo_Fina_Hast = #rangoImpoHasta#	
		AND Val_Cost_Util_Flex = #valorCosto#	
	</select>
	
	 <insert id="insertInteresFlexipago" parameterClass="interesFlexipago" >
	 	INSERT INTO flx_costo_utili_flexi(
			COD_PERI_INIC,
			cod_peri_fin,
			Val_Impo_Fina_Desd,
			Val_Impo_Fina_Hast,
			Val_Cost_Util_Flex,
			Usu_Digi,
			Fec_Digi)
		VALUES		
	        (#periodoInicio#,
	         #periodoFin#,
	         #rangoImpoDesde#,
	         #rangoImpoHasta#,	        
	         #valorCosto#, 
	         #auditInfo.createdBy#,
			 #auditInfo.created#)
	</insert>	
	
	<update id="deleteInteresesFlexipago" parameterClass="interesFlexipago">		 
 		DELETE flx_costo_utili_flexi
		WHERE COD_PERI_INIC = #periodoInicio#
		AND Val_Impo_Fina_Desd = #rangoImpoDesde#
		AND Val_Impo_Fina_Hast = #rangoImpoHasta#	
		AND Val_Cost_Util_Flex = #valorCosto#					               		
	</update>
	
	<select id="getRangoMaxHasta" parameterClass="interesFlexipago"  resultClass="string">   	
		SELECT MAX(Val_Impo_Fina_Hast)
		FROM flx_costo_utili_flexi
    </select>
    
    <update id="deleteTotalInteresesFlexipago" parameterClass="interesFlexipago">		 
 		DELETE FROM flx_costo_utili_flexi							               		
	</update>
	
  	<select id="getCantDecimalesxPais" parameterClass="java.util.Map"  resultClass="int">   	
		select SM.NUM_DECI 
		from seg_moned SM 
		WHERE OID_MONE=(SELECT MONE_OID_MONE 
						FROM seg_pais SP 
						WHERE SP.OID_PAIS=#oidPais#)
    </select>
    
</sqlMap>