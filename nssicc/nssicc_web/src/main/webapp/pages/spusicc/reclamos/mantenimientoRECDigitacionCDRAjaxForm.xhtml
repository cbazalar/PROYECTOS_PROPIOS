<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:ssicc="http://java.sun.com/jsf/composite/componentes/ssicc">

<body>
	<ui:composition template="/templates/templateMantenimientoSearch.xhtml">
		<ui:param name="mAlias"
			value="#{mantenimientoRECDigitacionCDRAjaxAction}" />
		<ui:param name="titulo" value="#{i18n['mantenimientoRECDigitacionCDRForm.title']}"/>
		<ui:param name="titulo_extension" value="#{i18n['mantenimientoRECDigitacionCDRForm.callCenter']}"/>	
		
		<ui:define name="body_busqueda_popup">
				
		   <ssicc:linkPopupCrearAjax id="busquedaRECDocumentoReferencia"
				managePopup="#{mAlias.busquedaRECDocumentoReferenciaSearchAction}"
				accionAceptar="#{mantenimientoRECDigitacionCDRAjaxAction.aceptarPopup}"
				accionSalir="#{mantenimientoRECDigitacionCDRAjaxAction.salirPopup}"
				parametroAccion="RECDOCREF"
				visible="true"
				update=":principalForm:numeroBoletaDespacho"
				paginaxhtml="/pages/popup/popupBusquedaRECDocumentoReferenciaForm.xhtml"
				title="#{i18n['busquedaRECDocumentoReferenciaSearchForm.heading']}" />
			
	    </ui:define>

	    <ui:define name="body_toolbar_adicionales">

			<h:commandLink 
				id="botonGrabar" 
				title="#{msg['botonSave.tooltip']}"
				onclick="return guardar();"
				actionListener="#{mantenimientoRECDigitacionCDRAjaxAction.guardar}" 
				inmediate="true"
				ajax="false">
				
				<p:graphicImage value="#{resource['images:saveForm.png']}" width="34" height="34" 
					             id="linkImagen"
					             styleClass="clsImagenLinkNoTexto"  
					             style="vertical-align:middle"/>
			</h:commandLink>
			
			<ssicc:linkAjax value="#{msg['botonSalir.titulo']}"
				title="#{msg['botonSalir.tooltip']}"
				icon="#{resource['images:salirForm.png']}"
                width="30"
                height="30" 
				process="@this"
				accion="#{mantenimientoRECDigitacionCDRAjaxAction.salirAPantallaPadre}"
				update=":principalForm:messagesPrincipalForm" 
				rendered="#{mAlias.paginaPadre!=''}"/>
				
		</ui:define>
	 
		<ui:define name="titulo_Pantalla">
			<h:outputText value="#{mAlias.formBusqueda.indicadorOnline eq 'S' ? titulo.concat(titulo_extension) : titulo}" 
							styleClass="clsEncabezadoPantalla" escape="false"/>
		</ui:define>

		<ui:define name="body_final_busqueda">
		
			<p:fieldset legend="Datos Cabecera" toggleable="false">
			
			<h:inputHidden id="listaOperacion" />
			<h:inputHidden id="listaCUVCambia" />
			<h:inputHidden id="listaDescripcionCambia" />
			<h:inputHidden id="listaPrecioCambia" />
			<h:inputHidden id="listaCantidadCambia" />
			<h:inputHidden id="listaMotivo" />
			<h:inputHidden id="listaIgualEnvio" />
			<h:inputHidden id="listaCUVDesea" />
			<h:inputHidden id="listaCantidadDesea" />
			<h:inputHidden id="listaIdentSolicPos" />
			<h:inputHidden id="listaIdentFila" />
			<h:inputHidden id="listaIdentFilaPadre" />
			
			<h:inputHidden id="listaPrecioDesea" />
			<h:inputHidden id="listaDescripcionDesea" />
			<h:inputHidden id="listaPopupCuvCambia" />
			<h:inputHidden id="listaPopupCuvDesea" />
			<h:inputHidden id="indicadorExcluirValidacionDevolucion" value="N" />
			<h:inputHidden id="indicadorExcluirValidaciones" value="N" />
			<h:inputHidden id="indicadorPrimerIngreso" value="N" />
			
			<h:inputHidden id="alistaOperacion" value="__" />
			<h:inputHidden id="alistaCUVCambia" value="__" />
			<h:inputHidden id="alistaCantidadCambia" value="__" />
			<h:inputHidden id="alistaMotivo" value="__" />
			<h:inputHidden id="alistaCUVDesea" value="__" />
			<h:inputHidden id="alistaCantidadDesea" value="__" />

			<h:inputHidden id="usuario" value="#{mAlias.formBusqueda.usuario}" />
			<h:inputHidden id="indicadorLinea18" value="#{mAlias.formBusqueda.indicadorLinea18}" />
			<h:inputHidden id="valorDesviacionPrecioUnitarioTrueque" value="#{mAlias.formBusqueda.valorDesviacionPrecioUnitarioTrueque}" />
			<h:inputHidden id="indicadorDesviacionPrecioUnitarioTruequeValorAbsoluto" 
				value="#{mAlias.formBusqueda.indicadorDesviacionPrecioUnitarioTruequeValorAbsoluto}" />
			
			<h:inputHidden id="indicadorProductoCambiaIgualDesea" value="#{mAlias.formBusqueda.indicadorProductoCambiaIgualDesea}" />
			<h:inputHidden id="indicadorValorAceptaCDR" value="#{mAlias.formBusqueda.indicadorValorAceptaCDR}" />
			
			<h:inputHidden id="devolucionEspecial" value="#{mAlias.devolucionEspecial}" />
			<h:inputHidden id="strComboMotivo" value="#{mAlias.formBusqueda.strComboMotivo}" />
			<h:inputHidden id="strComboOperacion" value="#{mAlias.formBusqueda.strComboOperacion}" />
			<h:inputHidden id="strComboOperacionDeuda" value="#{mAlias.formBusqueda.strComboOperacionDeuda}" />
			<h:inputHidden id="strComboMotivoDeuda" value="#{mAlias.formBusqueda.strComboMotivoDeuda}" />
			<h:inputHidden id="periodoActivo" value="#{mAlias.formBusqueda.periodoActivo}" />
			
			<h:inputHidden id="indicadorModifica" value="#{mAlias.formBusqueda.indicadorModifica}" />
			<h:inputHidden id="indicadorHayRegistros" value="#{mAlias.formBusqueda.indicadorHayRegistros}" />
			<h:inputHidden id="indicadorDevolucionOferta" value="#{mAlias.formBusqueda.indicadorDevolucionOferta}" />
			<h:inputHidden id="codigoOperacionCorrecto" value="#{mAlias.formBusqueda.codigoOperacionCorrecto}" />
			<h:inputHidden id="excedeDias" value="#{mAlias.formBusqueda.excedeDias}" />
			
			<h:inputHidden id="indicadorExpressHidden" value="#{mAlias.formBusqueda.indicadorExpressHidden}" />
			<h:inputHidden id="indicadorValidaDevolucion" value="#{mAlias.formBusqueda.indicadorValidaDevolucion}" />
			<h:inputHidden id="indicadorValidaFaltantes" value="#{mAlias.formBusqueda.indicadorValidaFaltantes}" />
			<h:inputHidden id="indicadorValidaCambios" value="#{mAlias.formBusqueda.indicadorValidaCambios}" />
			<h:inputHidden id="indicadorOnline" value="#{mAlias.formBusqueda.indicadorOnline}" />
			
			<h:inputHidden id="indicadorValCDRLinea" value="#{mAlias.formBusqueda.indicadorValCDRLinea}" />
			<h:inputHidden id="codigoClienteDocumentoReferencia" value="#{mAlias.formBusqueda.codigoClienteDocumentoReferencia}" />
			<h:inputHidden id="codigoPais" value="#{mPantallaPrincipalBean.currentUser.pais.codigo}" />
								
			<h:inputHidden id="numeroCruce" />					
        
			<h:panelGroup>
				<div style="margin: 4px; margin-top: 10px;">
				<table class="detail" >
					<tr>
						<th><ssicc:label key="#{i18n['mantenimientoMAVConfiguracionSearchForm.codigoPais']}"
									required="true" /></th>
						<td>
							<ssicc:label value="#{mPantallaPrincipalBean.currentUser.pais.descripcion}" />
						</td>
					</tr>
					<tr>
						<th><ssicc:label key="#{i18n['mantenimientoRECDigitacionCDRForm.numeroCDR']}" required="true"/></th>
						<td>
						  <c:if test="${not mAlias.rellenarCeroConsultoraSoloconEnter}">
							<p:inputText value="#{mAlias.formBusqueda.numeroCDR}"
						            	   id="numeroCDR" 
					                       size="8"
					                       onkeypress="if (event.keyCode &lt; 48 || event.keyCode &gt; 57) {
					                       				event.returnValue = false;
					                       				this.value = leftpad(this.value, '0', this.maxLength, '');
					                       				}
					                       			   if(event.keyCode == 13)
					                       			   { 
					                       			   }"
					                       onkeyup="return seteaFocoNumeroCDR(this, event);"			   	                       
										   onchange="this.value = leftpad(this.value, '0', this.maxLength, '');"
					                       maxlength="8"/>	
					       </c:if>
					       <c:if test="${mAlias.rellenarCeroConsultoraSoloconEnter}">
							<p:inputText value="#{mAlias.formBusqueda.numeroCDR}"
						            	   id="numeroCDR" 
					                       size="8"
					                       onkeypress="if (event.keyCode &lt; 48 || event.keyCode &gt; 57) {
					                       				event.returnValue = false;
					                       				this.value = leftpad(this.value, '0', this.maxLength, '');
					                       				}
					                       			   if(event.keyCode == 13)
					                       			   { 
					                       			   }"
					                       onkeyup="return seteaFocoNumeroCDR(this, event);"			   	                       
										   maxlength="8"/>	
					       </c:if>
					        	
						</td>
						<td colspan="4" rowspan="4" class="buttonBar"  valign="bottom" align="left">
								<table width="100%" cellpadding="0" >
								<tr>
								
											<th style="text-align: left" >
												<ssicc:label key="#{i18n['mantenimientoRECDigitacionCDRForm.fechaPedido']}" style="float: left;"/>
												&nbsp;&nbsp;
												 <span id="fechaPedido" style="border: 0; background-color: transparent;
														  font-family: Tahoma; font-size: 10px;
														  font-weight: bold; color: #355A8F"></span>
											</th>
								
										
												  							   	
										
										<th colspan="2"></th>
											<th colspan="2" style="text-align: left">
												<ssicc:label key="#{i18n['mantenimientoRECDigitacionCDRForm.campana']}" style="float: left;"/>
											&nbsp;&nbsp;									   
											   <span id="campana" style="border: 0; background-color: transparent;
													  font-family: Tahoma; font-size: 10px;
													  font-weight: bold; color: #355A8F"></span>
										
										</th>
						
						
								</tr>
									<tr>
										<th colspan="2" style="text-align: left">
											<ssicc:label key="#{i18n['mantenimientoRECDigitacionCDRForm.direccion']}" style="float: left;"/>
										</th >
										<td></td>
										<th colspan="2" style="text-align: left">
											<ssicc:label key="#{i18n['mantenimientoRECDigitacionCDRForm.ubicacion']}" style="float: left;"/>
										</th>
									</tr>
									<tr>
										<td colspan="2" align="left" width="350px">
											
				   							 <span id="direccionDomicilio" style="border: 0; background-color: transparent;
													  font-family: Tahoma; font-size: 10px;
													  font-weight: bold; color: #355A8F"></span>
										</td>
										<td></td>
										<td colspan="2" width="300px">
																			   
											   <span id="ubicacionGeografica" style="border: 0; background-color: transparent;
													  font-family: Tahoma; font-size: 10px;
													  font-weight: bold; color: #355A8F"></span>
										</td>
										
									</tr>
								<tr>
										<th colspan="2" style="text-align: left">
											<ssicc:label key="#{i18n['mantenimientoRECDigitacionCDRForm.saldoUnico']}" style="float: left;"/>
										</th >
										<td></td>
										
									</tr>
									<tr>
										<td colspan="2" align="left" width="350px">
											
				   							 <span id="saldoUnico" style="border: 0; background-color: transparent;
													  font-family: Tahoma; font-size: 10px;
													  font-weight: bold; color: #355A8F"></span>
										</td>
										<td></td>
										
										
									</tr>
							    </table>
			
				        </td>			
					</tr>	
					
					<tr>
						<th><ssicc:label key="#{i18n['mantenimientoRECDigitacionCDRForm.numeroBoletaDespacho']}" required="true"/></th>
						<td>
							<p:inputText value="#{mAlias.formBusqueda.numeroBoletaDespacho}"
						       id="numeroBoletaDespacho"
		                       size="10"
		                       onkeypress="if (event.keyCode &lt; 48 || event.keyCode &gt; 57) {
		                       				event.returnValue = false;
		                       				this.value = leftpad(this.value, '0', this.maxLength, '');
		                       				}
		                       			   if(event.keyCode == 13)
		                       			   { 
		                       			   }"	
		                       onkeyup="return seteaFocoNumeroBoletaDespacho(this, event);"		                       
							   onchange="this.value = leftpad(this.value, '0', this.maxLength, '');"
		                       maxlength="10" />
		                       
		                    <ssicc:linkPopupInvocarAjax id="idRecDocRefPopup" accion="#{mantenimientoRECDigitacionCDRAjaxAction.invocarPopup}"
		                    	process=":principalForm:codigoClienteDocumentoReferencia" parametroAccion="RECDOCREF"/>   
                   		
						</td>	
						
					</tr>   				
					
					<tr>
						<th width="120px"><ssicc:label key="#{i18n['mantenimientoRECDigitacionCDRForm.codigoConsejera']}" required="true"/></th>
						<td width="380px">
							<h:inputText style="border: 0; background-color: transparent;
													  font-family: Tahoma; font-size: 10px;
													  font-weight: bold; color: #355A8F"
											   value="#{mAlias.formBusqueda.codigoConsejera}"	  							            				         
									           size="10" 
									           maxlength="10"
									           onkeydown="return false;"
											   id="codigoConsejera" />
											   
							<h:inputText style="border: 0; background-color: transparent;
													  font-family: Tahoma; font-size: 10px;
													  font-weight: bold; color: #355A8F"
											   value="#{mAlias.formBusqueda.nombreConsejera}"			  						            				         
									           size="40" 
									           maxlength="50"
									           readonly="true"
											   id="nombreConsejera" />			
						</td>
					</tr>
					
					<tr>
						<th><ssicc:label key="#{i18n['mantenimientoRECDigitacionCDRForm.periodo']}" required="true"/></th>
						<td>
							<h:inputText style="border: 0; background-color: transparent;
													  font-family: Tahoma; font-size: 10px;
													  font-weight: bold; color: #355A8F"
											   value="#{mAlias.formBusqueda.periodo}"	
											   onkeydown="return false;"	  					            				         
									           size="6" 
									           maxlength="6"
											   id="periodo" />										   	
						</td>
					</tr> 
					<tr>
						<th><ssicc:label key="#{i18n['mantenimientoRECDigitacionCDRForm.zona']}"/></th>
						<td>
							<h:inputText  style="border: 0; background-color: transparent;
													  font-family: Tahoma; font-size: 10px;
													  font-weight: bold; color: #355A8F"
										      value="#{mAlias.formBusqueda.zona}"	  					            				         
									           size="30" 
									           maxlength="30"
									           readonly="true"
											   id="zona" />										   	
						</td>
						
					</tr>
					
					<tr>
						<th>
							<ssicc:label key="#{i18n['mantenimientoRECDigitacionCDRForm.indicadorExpress']}"/>
						</th>
				    	<td>
				    		<p:selectBooleanCheckbox value="#{mAlias.formBusqueda.indicadorExpress}" 
			    						id="indicadorExpress" onchange="cambiarPeriodo();"/>
		                               &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		                               &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			                         
			             	<c:if test='${mAlias.formBusqueda.indicadorOnline eq "S" and mAlias.formBusqueda.indicadorValCDRLinea eq  "1"}'>
			             		<ssicc:label key="#{i18n['mantenimientoRECDigitacionCDRForm.periodoCDR']}" style="float: none;"/>
							
								<h:inputText style="border: 0; background-color: transparent;
														  font-family: Tahoma; font-size: 10px;
														  font-weight: bold; color: #355A8F"			
												   value="#{mAlias.formBusqueda.periodoCDR}"			            				         
										           size="10"
										           maxlength="10" 
										           readonly="true"
												   id="periodoCDR" />										   	
					      	</c:if>
			                               
				    	</td>
				    	
				    	
				    	<c:if test='${mAlias.formBusqueda.muestraIndicador eq 1}'>
				    		<th style="text-align: left;">
								<ssicc:label key="#{i18n['mantenimientoRECDigitacionCDRForm.indicadorCDRRechazo']}" style="float: left;"/>
								<p:selectBooleanCheckbox value="#{mAlias.formBusqueda.indicadorCDRRechazo}" 
												  onchange="inicializaIndicadorRechazo();"
												  id="indicadorCDRRechazo"/>
							</th>
			    	
							<th style="text-align: left;"  colspan="3">
								<ssicc:label key="#{i18n['mantenimientoRECDigitacionCDRForm.codigoMotivoRechazoDef']}" style="float: left;"/>
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
								<p:selectOneMenu value="#{mAlias.formBusqueda.codigoMotivoRechazoDef}" id="codigoMotivoRechazoDef"> 
									<f:selectItem itemLabel="" itemValue="" />
									<f:selectItems value="#{mAlias.lstCodMotRechazo}"
										var="lista" itemLabel="#{lista.descripcion}"
										itemValue="#{lista.codigo}" />
								</p:selectOneMenu>								   	
							</th>
			        	</c:if>
				    </tr>					
							
					<tr>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						  <c:if test='${mAlias.formBusqueda.muestraIndicador eq 1}'>
						  	
						  	<th style="text-align: left;" >
			    	        	<ssicc:label key="#{i18n['mantenimientoRECDigitacionCDRForm.observacionCDR']}"  style="float: left;"/>
			        		</th>

			        		<td> 
			        		    <h:inputTextarea value="#{mAlias.formBusqueda.observacionCDR}"
				      							rows="3"
				      							cols="48"
				      							onkeypress="return changeKey(this, event, cancelDigits);"
				      							id="observacionCDR"/>
			        		</td>
        				</c:if>
					</tr>
									
				</table>
				</div>
			</h:panelGroup>	
			
			</p:fieldset>
			
			<br/>
			
			<p:fieldset legend="Datos Detalle" toggleable="false">
			
				<h:panelGrid id="dialogPopup">
					<p:dialog id="idCodigoVenta"
						title="#{i18n['busquedaRECCodigoVentaPedidoForm.title']}"
						widgetVar="viewCodigoVenta"
						header="#{i18n['busquedaRECCodigoVentaPedidoForm.title']}"
						modal="false" height="500" width="950">
						<ui:include
							src="/pages/spusicc/reclamos/busquedaRECCodigoVentaPedidoForm.xhtml" />
					</p:dialog>
					
					<p:dialog id="idCodigoMatriz"
						title="#{i18n['busquedaRECCodigoVentaMatrizForm.title']}"
						widgetVar="viewCodigoMatriz"
						header="#{i18n['busquedaRECCodigoVentaMatrizForm.title']}"
						modal="false" height="500" width="800">
						<ui:include
							src="/pages/spusicc/reclamos/busquedaRECCodigoVentaMatrizForm.xhtml" />
					</p:dialog>
				</h:panelGrid>
					
				<table width="100%">
				<tr>
					<td valign="top">	
				    <table id="prodList" 
				       	   cellspacing="0" 
				           cellpadding="0"
				           border="1"
				           style="border: 1px solid #dddddd;border-collapse: collapse;margin: 10px;margin-top: 0px;"
				           width="95%">
					    <thead>  
					        <tr>
					        	<th colspan="2" class="ui-state-default ui-resizable-column clsNroFilaDatatable ui-draggable ui-draggable-handle ui-droppable" >
					        	
					        	</th>
						    	<th colspan="6" align="center" class="ui-state-default ui-resizable-column clsNroFilaDatatable ui-draggable ui-draggable-handle ui-droppable" >		
						    		<h:outputText value="#{i18n['mantenimientoRECDigitacionCDRForm.productoCambia']}"/>    		                
						        </th>
						        <th colspan="7" align="center" class="ui-state-default ui-resizable-column clsNroFilaDatatable ui-draggable ui-draggable-handle ui-droppable" >		   
						        	<h:outputText value="#{i18n['mantenimientoRECDigitacionCDRForm.productoDesea']}"/> 		                
						        </th>
						    </tr>
					        <tr>
					            <th style="width: 2%" class="ui-state-default ui-resizable-column clsNroFilaDatatable ui-draggable ui-draggable-handle ui-droppable" >		    		                
					            </th>
					            <th class="ui-state-default ui-resizable-column clsNroFilaDatatable ui-draggable ui-draggable-handle ui-droppable" >
					            	<h:outputText value="#{i18n['mantenimientoRECDigitacionCDRForm.operacion']}"/>
					            </th>
					            <th style="width: 4%" class="ui-state-default ui-resizable-column clsNroFilaDatatable ui-draggable ui-draggable-handle ui-droppable" >
					            	<h:outputText value="#{i18n['mantenimientoRECDigitacionCDRForm.cuvCambia']}"/>
					            </th>
					            <th class="ui-state-default ui-resizable-column clsNroFilaDatatable ui-draggable ui-draggable-handle ui-droppable" >
					            	<h:outputText value="#{i18n['mantenimientoRECDigitacionCDRForm.descripcionCuvCambia']}"/>
					            </th>
					            <th class="ui-state-default ui-resizable-column clsNroFilaDatatable ui-draggable ui-draggable-handle ui-droppable" >
					            	<h:outputText value="#{i18n['mantenimientoRECDigitacionCDRForm.precioCuvCambia']}"/>
					            </th>
					            <th class="ui-state-default ui-resizable-column clsNroFilaDatatable ui-draggable ui-draggable-handle ui-droppable" >
					            	<h:outputText value="#{i18n['mantenimientoRECDigitacionCDRForm.cantidadCambia']}"/>
					            </th>	        
					            <th class="ui-state-default ui-resizable-column clsNroFilaDatatable ui-draggable ui-draggable-handle ui-droppable" >
					            	<h:outputText value="#{i18n['mantenimientoRECDigitacionCDRForm.motivo']}"/>
					            </th>
					            <th style="width: 3%" class="ui-state-default ui-resizable-column clsNroFilaDatatable ui-draggable ui-draggable-handle ui-droppable" >
					            	<h:outputText value="#{i18n['mantenimientoRECDigitacionCDRForm.igualEnvio']}"/>
					            </th>
					            <th style="width: 4%" class="ui-state-default ui-resizable-column clsNroFilaDatatable ui-draggable ui-draggable-handle ui-droppable" >
					            	<h:outputText value="#{i18n['mantenimientoRECDigitacionCDRForm.cuvDesea']}"/>
					            </th>
					            <th class="ui-state-default ui-resizable-column clsNroFilaDatatable ui-draggable ui-draggable-handle ui-droppable" >
					            	<h:outputText value="#{i18n['mantenimientoRECDigitacionCDRForm.descripcionCuvDesea']}"/>
					            </th>
					            <th class="ui-state-default ui-resizable-column clsNroFilaDatatable ui-draggable ui-draggable-handle ui-droppable" >
					            	<h:outputText id="label" value="Precio"/>
					            </th>
					            <th class="ui-state-default ui-resizable-column clsNroFilaDatatable ui-draggable ui-draggable-handle ui-droppable" >
					            	<h:outputText value="#{i18n['mantenimientoRECDigitacionCDRForm.cantidadDesea']}"/>
					            </th>
					            <th class="ui-state-default ui-resizable-column clsNroFilaDatatable ui-draggable ui-draggable-handle ui-droppable" >            
					            </th>
					            <th class="ui-state-default ui-resizable-column clsNroFilaDatatable ui-draggable ui-draggable-handle ui-droppable" >            
					            </th>
					            <th class="ui-state-default ui-resizable-column clsNroFilaDatatable ui-draggable ui-draggable-handle ui-droppable" >          
					            </th>
					        </tr>
					    </thead>
				        <tbody id="xxx">
				        </tbody>	               
					</table>	
					</td>
					<td align="left" valign="top" width="5%">
						<ssicc:linkAjaxNoAction 
				              value="#{msg['button.delete']}" 
				              icon="/resources/images/delete24_n.gif"
				              onclick="deleteX();"
				              type="button"  />
				                
				        <ssicc:linkAjax value="Buscar" 
			      		     title="Buscar"
			                 accion="#{mantenimientoRECDigitacionCDRAjaxAction.showHistoricoSolicitudAprobados}"
			                 icon="#{resource['images:search24_n.gif']}"
			                 process="@this :principalForm:codigoConsejera"
		           			 oncomplete="openSearchHistoricoSolicitudPopup()" />     
		           		  
		           		<ssicc:linkAjax value="Buscar" 
		           		     id="botonDocumentoReferenciaSTO"
			      		     title="Buscar"
			      		     width="0"
			      		     height="0"
			                 accion="#{mantenimientoRECDigitacionCDRAjaxAction.showDocumentoReferenciaSTO}"
			                 icon="#{resource['images:search24_n.gif']}"
			                 process="@this :principalForm:codigoConsejera"
		           			 oncomplete="openSearchDocumentosReferenciaSTOPopup()" />    
		           		
		           		<ssicc:linkAjax value="Buscar" 
		           		     id="botonCodigoVentaPopup"
			      		     title="Buscar"
			      		     width="0"
			      		     height="0"
			                 accion="#{mantenimientoRECDigitacionCDRAjaxAction.showCodigoVentaPedido}"
			                 icon="#{resource['images:search24_n.gif']}"
			                 process="@this :principalForm:numeroCruce"
			                 update=":principalForm:dialogPopup"
		           			 oncomplete="PF('viewCodigoVenta').show()" /> 
		           			 
		           		<ssicc:linkAjax value="Buscar" 
		           		     id="botonCodigoMatrizPopup"
			      		     title="Buscar"
			      		     width="0"
			      		     height="0"
			                 accion="#{mantenimientoRECDigitacionCDRAjaxAction.showCodigoVentaMatriz}"
			                 icon="#{resource['images:search24_n.gif']}"
			                 process="@this :principalForm:numeroCruce"
			                 update=":principalForm:dialogPopup"
		           			 oncomplete="PF('viewCodigoMatriz').show()" /> 	 
		           			  	 
					</td>
					</tr>
				</table>
							
			</p:fieldset>
		
		<script type="text/javascript">
		
		    var campanaCDR = "";
			var onFocusOperacion = false;
			var onFocusOperacionInicio = false;
			var onFocusCUV = false;
			var onFocusCantidad = false;
			var onFocusMotivo = false;
			
			var onFocusCUVDesea = false;
			var onFocusCantidadDesea = false;
			var opcion = '';
			var varOidPeriCDR = '';
			var indicadorExpress = '';
			var varCodOperSICC = '';
			
		    var codigoResultadoChequeo = '';
		    var validaCodigoResultado = false;
			var montoDevolucion;
			var montoPedido;
			var porcentajeDevolucion;

			//---------para faltantes y cambios RCR COL-SiCC-2014-0115
			var montoFaltantes;
			var porcentajeFaltantes;
			var montoCambios;
			var porcentajeCambios;


			var indicadorOnline = document.getElementById('indicadorOnline').value;
			var indicadorValCDRLinea = document.getElementById('indicadorValCDRLinea').value;
			
			
			var arrCodigoOperacion = new Array();	                 
			var arrIndicadorCUVCambiaObligatorio = new Array();
			var arrIndicadorCUVDeseaObligatorio = new Array();
			var arrIndicadorValidacionCUVCambia = new Array();
			var arrIndicadorValidacionCUVDesea = new Array();
			var arrPopupCambia = new Array();
			var arrPopupDesea = new Array();
			var arrIndicadorValidarCentroServicio = new Array();

			var arrPrecioDevuelve = new Array();
			
			var arrCodigoVenta = new Array();
			
			var arrOperacion = new Array();
			var arrUnidades = new Array();
			var unidades = '';
			var codigoVentaGlobal = '';
			var codigoOperacionGlobal = '';
			var codigoMotivoGlobal = '';
			var posicionMotivo = 0;
			var precioCambia  = '';
			var voperacion = '';
			var montoT = '';
			var voidSoliPosi = '';
			var oidSoliPosis = '';
			var agregarFilasOferta = false;
			var valoresOfertaPOSBUSC;  
			var valoresOfertaPOSOFER;
			var valoresOfertaCUV;  
			var valoresOfertaUNI;
			var valoresOfertaDESPRO;
			var valoresOfertaPREPRO;
			var mantenerFocoIgualEnvio = false;
			var flagOperacionTrueque = false;
			var esEnterEnCantidadProductoCambia = false;
			var esEnterEnCantidadProductoCambiaOnChange = false; //Usado para controlar que ya no valide en el onchange si ya le dio ENTER
			var errorValidacionMotivoCdr = false;

			<ui:repeat value="#{mAlias.recOperacionParametrosList}" var="item"> 
				arrCodigoOperacion.push("#{item.codigoOperacion}");
				arrIndicadorCUVCambiaObligatorio.push("#{item.indicadorCUVCambiaObligatorio}");
				arrIndicadorCUVDeseaObligatorio.push("#{item.indicadorCUVDeseaObligatorio}");
				arrIndicadorValidacionCUVCambia.push("#{item.indicadorValidacionCUVCambia}");
				arrIndicadorValidacionCUVDesea.push("#{item.indicadorValidacionCUVDesea}");
				arrPopupCambia.push("#{item.popupCambia}");
				arrPopupDesea.push("#{item.popupDesea}");
				arrIndicadorValidarCentroServicio.push("#{item.indicadorValidarCentroServicio}");
			</ui:repeat>	
		  	
			//seteaFocoInicial();	
			
		    var arr = new Array(); 
		    var arrCuvs = new Array();   
			var arrDesc = new Array();
			var arrPrec = new Array();  	
			var arrPosic = new Array();
			var arrPrecCata = new Array();
		    var textCodVenta;
			var bCancel = false;  
			var validacionCambia = '';
			var validacionDesea = '';
			var cargo = '';
			var visualizaRechazo = '';
			var vOidSoliPosi = '';
		  	var listaCampos = new Array();  	
			listaCampos[0] = "&lt;input type='checkbox' style='border: none;' class='selectedItemsOferta' name='selectedItems' id='selectedItems' onKeyDown='return deshabilitarTab(event, this);'/>";
			listaCampos[1] = $('#strComboOperacion').val();
			listaCampos[2] = "&lt;input type='text' size='4' maxlength='5' style='font-family: Tahoma; font-size: 11px;' onkeyup='seteaFocoCUVCambia(this, event);' onchange='completarCUV(this, 1);' onFocus='enfocar(2);' onkeypress='return jsEsNumero(event); ' name='listaCUVCambia' id='listaCUVCambia' onKeyDown='return deshabilitarTab(event, this);'/> &lt;img id='listaPopupCuvCambia' name='listaPopupCuvCambia' src='#{facesContext.externalContext.requestContextPath}/resources/images/lupa_16.png' title='Buscar' style='cursor: pointer; cursor: hand' onclick='javascript:openCodigoVentaPopupCambia(); return false;'/>"	
			listaCampos[3] = "&lt;input type='text' size='26' maxlength='30' style='border: 0; background-color: transparent; font-family: Tahoma; font-size: 10px; color: #355A8F' readonly='true' name='listaDescripcionCambia' id='listaDescripcionCambia' onFocus='enfocar(3);' onKeyDown='return deshabilitarTab(event, this);'/>"
			listaCampos[4] = "&lt;input type='text' size='3' maxlength='4' style='border: 0; background-color: transparent; font-family: Tahoma; font-size: 10px; color: #355A8F; text-align:right' readonly='true' name='listaPrecioCambia' id='listaPrecioCambia' onFocus='enfocar(4);' onKeyDown='return deshabilitarTab(event, this);'/>"	
			listaCampos[5] = "&lt;input type='text' size='3' maxlength='4' style='font-family: Tahoma; font-size: 11px;' onkeyup='seteaFocoUnidadesCambia(this, event)' onchange='forzarENTER(this);' onFocus='enfocar(5);'  onkeypress='return jsEsNumero(event);' name='listaCantidadCambia' id='listaCantidadCambia' onKeyDown='return deshabilitarTab(event, this);'/>"
			listaCampos[6] = $('#strComboMotivo').val();
			listaCampos[7] = "&lt;input type='checkbox' onclick='copiaTexto(this);' onkeyup='seteaFocoIgualEnvio(this, event)' style='border: none;' name='listaIgualEnvio' id='listaIgualEnvio'  />";
			listaCampos[8] = "&lt;input type='text' size='4' maxlength='5' style='font-family: Tahoma; font-size: 11px;' onkeyup='seteaFocoCUVDesea(this, event)' onchange='completarCUV(this, 2);' onkeypress='return jsEsNumero(event); ' name='listaCUVDesea' id='listaCUVDesea' onFocus='enfocar(8);' onKeyDown='return deshabilitarTab(event, this);'/> &lt;img id='listaPopupCuvDesea' name='listaPopupCuvDesea' src='#{facesContext.externalContext.requestContextPath}/resources/images/lupa_16.png' title='Buscar' style='cursor: pointer; cursor: hand' onclick='javascript:openCodigoVentaPopupDesea(); return false;'/>"
			listaCampos[9] = "&lt;input type='text' size='26' maxlength='30' style='border: 0; background-color: transparent; font-family: Tahoma; font-size: 10px; color: #355A8F' readonly='true' name='listaDescripcionDesea' id='listaDescripcionDesea' onKeyDown='return deshabilitarTab(event, this);'/>"	
			listaCampos[10] = "&lt;input type='text' size='3' maxlength='4' style='border: 0; background-color: transparent; font-family: Tahoma; font-size: 10px; color: #355A8F; text-align:right' readonly='true' name='listaPrecioDesea' id='listaPrecioDesea' onKeyDown='return deshabilitarTab(event, this);'/>"
			listaCampos[11] = "&lt;input type='text' size='3' maxlength='4' style='font-family: Tahoma; font-size: 11px;' name='listaCantidadDesea' id='listaCantidadDesea' onkeypress='return jsEsNumero(event); ' onkeyup='agregarDetalle(this,this.value,event,this.parentNode.parentNode.rowIndex);' onFocus='enfocar(9);' onKeyDown='return deshabilitarTab(event, this);'/>"	
			listaCampos[12]= "&lt;input type='hidden' name='listaIdentSolicPos' id='listaIdentSolicPos' />";

			//TENER CUIDADO AL MODIFICAR ESTAS LINEAS, SOBRE TODO LOS INDICES
			listaCampos[13]= "&lt;input type='hidden' name='listaIdentFilaPadre' id='listaIdentFilaPadre' value=''/>";
			listaCampos[14]= "&lt;input type='hidden' name='listaIdentFila' id='listaIdentFila' value=''/>";
			//

			var copiaCampos = listaCampos;		
		  	addRow('prodList',listaCampos);

		  	esEnterEnCantidadProductoCambia = false;
		  	esEnterEnCantidadProductoCambiaOnChange = false;

			//ocultarMenu();	
			limpiarChecksDelete();

			$(document).bind('keydown', function(event){
				if (event.keyCode == 113) //F2 
				{
					openCodigoVentaMatrizPopup();
				}
				else if (event.keyCode == 119) //F8
				{
					openCodigoVentaPedidoPopup();
				}
				else if (event.keyCode == 120) //F9
				{
					var botonDocumentoReferenciaSTO = document.getElementById("botonDocumentoReferenciaSTO:linkAjax");
					botonDocumentoReferenciaSTO.click();
				}
				else if (event.keyCode == 121) //F10
				{
					var botonGrabar = document.getElementById("botonGrabar");
		    	    botonGrabar.click();
				}
			});		

		 	marcarChecks();	    
			function marcarChecks(){
				if($('#indicadorExpressHidden').val() != '1') 
					document.getElementById('indicadorExpress_input').checked = false;
				else
					document.getElementById('indicadorExpress_input').checked = true;		
			}	

			
			function seteaFocoInicial(){				
				if($('#indicadorModifica').val() == '0'){					
					$('#numeroCDR').focus();	
					//document.write("--------------->  "+$('indicadorModifica').value);					
				}		
				if($('#indicadorModifica').val() == '2'){			
					var form =document.forms[0];
					x1=form.listaOperacion;
			 		//x1[1].focus();
				}
			}

			function cambiarPeriodo(){
				if ($('#periodo').val() != ''){		
					
					if (!document.getElementById('indicadorExpress_input').checked){
						setearPeriodo($('#codigoConsejera').val());				
					}	
					else{
						
						$('#periodo').val($('#periodoActivo').val());
					}
				}
			}

			function inicializa(){
				if($('#numeroBoletaDespacho').val() != ''){
					cargo = '1';
					setearConsultora();
				}
				else{
					cargo = '0';
				}
			}
			
			function setearConsultora(){
				var param = $('#numeroBoletaDespacho').val();
				ajax.getConsultoraReclamoByCodigo( param, $('#codigoPais').val(), $('#periodoActivo').val(), loadConsultoraCallBack);
			}

			function loadConsultoraCallBack(data){
				var indicadorOnline = $('#indicadorOnline').val();
				if(data != null) {

					if(data.label != null)
					$('#codigoConsejera').val(data.label);
					
					if(data.value != null)
					$('#nombreConsejera').val(data.value);
					
					if(data.zona != null)
					$('#zona').val(data.zona);
					//Ini PER-SiCC-2012-0642 
					if(data.nuevoNumeroBoleta != null)
					$('#numeroBoletaDespacho').val(data.nuevoNumeroBoleta);
					//Fin PER-SiCC-2012-0642
					
					if(data.direccionDomicilio != null)
					document.getElementById('direccionDomicilio').innerText = data.direccionDomicilio;
					
					if(data.ubicacionGeografica != null)
					document.getElementById('ubicacionGeografica').innerText = data.ubicacionGeografica;
					//ini PER-SiCC-2012-0558
					if(data.campana!=null)
					document.getElementById('campana').innerText = data.campana;
					
					campanaCDR = data.campana;
					if(data.fechaFactura!=null)
					document.getElementById('fechaPedido').innerText = data.fechaFactura;
					if(data.saldoUnico!=null)
					document.getElementById('saldoUnico').innerText = data.saldoUnico;
					//validar

					if(indicadorOnline == 'S' &amp;&amp;  indicadorValCDRLinea ==  '1'){
					setearPeriodoCDR($('#codigoConsejera').val());
					}
					//fin PER-SiCC-2012-0558
					
					setearPeriodo($('#codigoConsejera').val());
					arr = data.lista;	
					
					//doliva			
					montoDevolucion = Math.abs(parseFloat(data.montoDevolucion.replace(',','.')));						
					montoPedido = parseFloat(data.montoPedido.replace(',','.'));
					porcentajeDevolucion = parseFloat(data.porcentajeDevolucion.replace(',','.'));

					//obtenemos el monto de faltantes y cambios, ademas de los porcentajes
					montoFaltantes = Math.abs(parseFloat(data.montoFaltantes.replace(',','.')));
					porcentajeFaltantes = parseFloat(data.porcentajeFaltantes.replace(',','.'));
					montoCambios = Math.abs(parseFloat(data.montoCambios.replace(',','.')));
					porcentajeCambios = parseFloat(data.porcentajeCambios.replace(',','.'));
					
					for(var i=0; i&lt;arr.length; i++) {
						arrCuvs.push(arr[i].codigoVta);
						arrDesc.push(arr[i].descripcion);
						arrPrec.push(arr[i].precioCat);
						arrPosic.push(arr[i].posicion);
						arrPrecCata.push(arr[i].precioCatalogo);
					} 
					//doliva
					//alert('aca seria el bloqueo');
					
					bloquear();
					
					//se obtiene el indicador de pedido chequeado
					var indicadorOnline = '#{mAlias.formBusqueda.indicadorOnline}';
					if (indicadorOnline == 'S' &amp;&amp; indicadorValCDRLinea == '1'){
						var indicadorPedidoChequeado = '#{mAlias.formBusqueda.indicadorPedidoChequeado}';
						if(indicadorPedidoChequeado == '1'){
							obtenerCodigoResultadoChequeo();
						}
					}

					//poner el foco en lista operaciones
					var form = document.forms[0];
					form.listaOperacion[form.listaOperacion.length-1].focus();

				}	
				else{
					alert('#{i18n["mensaje.noExisteBoleta"]}');
					$('#numeroCDR').val('');
					$('#numeroBoletaDespacho').val('');
					$('#numeroCDR').focus();
				}
			}	

			function bloquear(){		
				document.getElementById('numeroBoletaDespacho').style = {backgroundColor: 'transparent',
												    border : '0',
												    fontSize: '20px',
												    fontFamily: 'Tahoma',
												    fontWeight: 'bold',
												    color: '#355A8F'};
				document.getElementById('idRecDocRefPopup:linkPopupInvocarAjax:linkImagen').style.visibility = 'hidden';
				$('#numeroBoletaDespacho').attr("readonly",'true');		
			}

			function obtenerCodigoResultadoChequeo(){
				var param = $('#numeroBoletaDespacho').val();
				ajax.getCodigoResultadoChequeo( param, loadCodigoResultadoChequeoCallBack);
			}

			function loadCodigoResultadoChequeoCallBack(data){
				if(data != null) {
					codigoResultadoChequeo = data;
				}
				else{
					codigoResultadoChequeo = '';
				}	
			}

			
			function setearPeriodo(param1){
				//var param1 = $('codigoConsejera').value;
				var param2 = $('#periodoActivo').val();
				//alert(param1+' - '+param2);
				ajax.getPeriodoReclamo( param1,param2, loadPeriodoCallBack);
			}

			
			function loadPeriodoCallBack(data){
				if(data != null) {
					var form =document.forms[0];
					form.periodo.value= data;	
						existeReclamo(form.periodo.value);
				}	
			}	

			function existeReclamo(periodo){
				var param1 = $('#codigoPais').val();
				var param2 = $('#numeroCDR').val();
				var param3 = periodo;
				var param4 = $('#codigoConsejera').val();
				//alert(param1+'-'+param2+'-'+periodo+'-'+param4);
				if(cargo != '1')
					ajax.getExisteReclamo(param1,param2,param3,param4, loadExisteReclamoCallback);
			}

			function loadExisteReclamoCallback(data){		
				if(data != 'N') {
					if (!confirm('#{i18n["confirm.existeCDR"]}'))  {
						//$('codigoPais').value = '';
						$('#numeroCDR').val('');
						$('#numeroBoletaDespacho').val('');
						$('#periodo').val('');
						$('#codigoConsejera').val('');
						$('#nombreConsejera').val('');
						$('#numeroCDR').focus();	
						return false;
					}	
					else{
						//alert(data);
						$('#numeroBoletaDespacho').val(data);
						var form =document.forms[0];
						form.action='findMantenimientoRECDigitacionCDR.do';
					   	form.submit(); 
					}
				}			
			}

			//doliva--------
			function validarMontoDevolucion(){

				var indicadorExcluirValidacionDevolucion= document.getElementById("indicadorExcluirValidacionDevolucion");
				var indicadorExcluirValidaciones= document.getElementById("indicadorExcluirValidaciones");
				if(indicadorExcluirValidacionDevolucion.value== 'N'){
					if(indicadorExcluirValidaciones.value== 'N'){
						var indicadorOnline = '#{mAlias.formBusqueda.indicadorOnline}';
				
						//Solo aplica la logica para la pantalla de callcenter
						if (indicadorOnline != 'S')
							return true;
						//Solo aplica la logica si esta encendido el indicador
						if ($('#indicadorValidaDevolucion').val() == '0')
							return true;
						//alert('va a validar');
						var form =document.forms[0];
						var dato=form.listaOperacion[form.listaOperacion.length-1].value.split("|");   
				  		var operacion = dato[0]; 
						//var operacion=form.listaOperacion[form.listaOperacion.length-1].value;
				
						//Solo se realiza la validacion si la opercacione es de devolucion
						if (operacion != 'D')
							return true;
				
						var monto = calcularMontoDevolucionActual();
						var aux = ((monto + montoDevolucion)/montoPedido)*100;
						
						if (aux > porcentajeDevolucion)
							return false;
						else
							return true;
					}else{
						return true;
					}
				}else{
					return true;
				}
			}

			function validarMontoFaltantes(){

				var indicadorExcluirValidaciones= document.getElementById("indicadorExcluirValidaciones");
				if(indicadorExcluirValidaciones.value=='N'){
					var indicadorOnline = '#{mAlias.formBusqueda.indicadorOnline}';
			
					//Solo aplica la logica para la pantalla de callcenter
					if (indicadorOnline != 'S')
						return true;
					//Solo aplica la logica si esta encendido el indicador
					if ($('#indicadorValidaFaltantes').val() == '0')
						return true;
					//alert('va a validar');
					var form =document.forms[0];
					var dato=form.listaOperacion[form.listaOperacion.length-1].value.split("|");   
			  		var operacion = dato[0]; 
					//var operacion=form.listaOperacion[form.listaOperacion.length-1].value;
			
					//Solo se realiza la validacion si la opercacione es de devolucion
					if (operacion != 'G' &amp;&amp; operacion != 'G3' &amp;&amp; operacion != 'G4' &amp;&amp; operacion != 'G5' &amp;&amp; operacion != 'F' &amp;&amp; operacion != 'F3' &amp;&amp; operacion != 'F4')
						return true;
			
					var monto = calcularMontoFaltantesActual();
					var aux = ((monto + montoFaltantes)/montoPedido)*100;
					
					if (aux > porcentajeFaltantes)
						return false;
					else
						return true;
				}else{
					return true;
				}
			}

			function calcularMontoFaltantesActual()
			{
				var dat;
				var operacionLinea;
				var monto = 0;
				var form = document.forms[0];
				
				for (t=1; t&lt;form.listaCUVCambia.length; t++){
					dat = form.listaOperacion[t].value.split("|"); 
					operacionLinea = dat[0];
					if (operacionLinea == 'G' || operacionLinea == 'G3' || operacionLinea == 'G4' || operacionLinea == 'G5' || operacionLinea == 'F' || operacionLinea == 'F3' || operacionLinea == 'F4'){
						monto = monto + (form.listaCantidadCambia[t].value * form.listaPrecioCambia[t].value);
					}
		        }
				montoT = monto;
				
				return monto;
			}

			function validarMontoCambios(){
				var indicadorExcluirValidaciones= document.getElementById("indicadorExcluirValidaciones");
				if(indicadorExcluirValidaciones.value=='N'){
					var indicadorOnline = '{mAlias.formBusqueda.indicadorOnline}';
			
					//Solo aplica la logica para la pantalla de callcenter
					if (indicadorOnline != 'S')
						return true;
					//Solo aplica la logica si esta encendido el indicador
					if ($('#indicadorValidaCambios').val() == '0')
						return true;
					//alert('va a validar');
					var form =document.forms[0];
					var dato=form.listaOperacion[form.listaOperacion.length-1].value.split("|");   
			  		var operacion = dato[0]; 
					//var operacion=form.listaOperacion[form.listaOperacion.length-1].value;
			
					//Solo se realiza la validacion si la opercacione es de devolucion
					if (operacion != 'C' &amp;&amp; operacion != 'T')
						return true;
			
					var monto = calcularMontoCambiosActual();
					var aux = ((monto + montoCambios)/montoPedido)*100;
					
					if (aux > porcentajeCambios)
						return false;
					else
						return true;
				}else{
					return true;
				}	
			}

			function calcularMontoCambiosActual()
			{
				var dat;
				var operacionLinea;
				var monto = 0;
				var form = document.forms[0];
				
				for (t=1; t&lt;form.listaCUVCambia.length; t++){
					dat = form.listaOperacion[t].value.split("|"); 
					operacionLinea = dat[0];
					if (operacionLinea == 'C' || operacionLinea == 'T'){
						monto = monto + (form.listaCantidadCambia[t].value * form.listaPrecioCambia[t].value);
					}
		        }
				montoT = monto;
				
				return monto;
			}

			var valorSaldoProducto;
			
		  	function agregarDetalle(objeto,valor,evt,index){
		    	var keyCode = document.layers ? evt.which : document.all ? evt.keyCode : evt.keyCode;
			 	var form = document.forms[0];
			 	var numPedido = $('#numeroBoletaDespacho').val();
			 	var codigoPaisREC = $('#codigoPais').val();
			 	var codVenta = form.listaCUVDesea[form.listaCUVDesea.length-1].value;

			 	if(keyCode == 13){
					//Validamos si es que la cantidad es obligatoria
			 		var dato = form.listaOperacion[form.listaCUVDesea.length-1].value.split("|");			
					var index = $.inArray(dato[0], arrCodigoOperacion);
					form.listaCantidadDesea[form.listaCantidadDesea.length-1].value = valor;
					
					if(form.listaCantidadDesea[form.listaCantidadDesea.length-1].readOnly)
					{
						//movemos el foco a listamotivo, si el campo esta de solo lectura
						form.listaMotivo[form.listaMotivo.length-1].focus();

						return false;
					}

					if(dato[0] == 'T')//TRUEQUE
					{
						//Verifica que almenos uno de los cuvs y cantidades se haya ingresado
						//Se cambio en RCR-0344 agregue
						if(isBlank(form.listaCUVCambia[form.listaCUVCambia.length-1].value) &amp;&amp; isBlank(form.listaCUVDesea[form.listaCUVDesea.length-1].value))
						{
							form.listaCUVCambia[form.listaCUVCambia.length-1].focus();
							return false;
						}
						if(!isBlank(form.listaCUVCambia[form.listaCUVCambia.length-1].value) &amp;&amp; (isBlank(form.listaCantidadCambia[form.listaCantidadCambia.length-1].value) || parseInt(form.listaCantidadCambia[form.listaCantidadCambia.length-1].value) == 0))
						{
							form.listaCantidadCambia[form.listaCantidadCambia.length-1].focus();
							return false;
						}
						if(!isBlank(form.listaCUVDesea[form.listaCUVDesea.length-1].value) &amp;&amp; (isBlank(form.listaCantidadDesea[form.listaCantidadDesea.length-1].value) || parseInt(form.listaCantidadCambia[form.listaCantidadDesea.length-1].value) == 0))
						{
							form.listaCantidadDesea[form.listaCantidadDesea.length-1].focus();
							return false;
						}
						if(isBlank(form.listaCantidadDesea[form.listaCantidadDesea.length-1].value) &amp;&amp; isBlank(form.listaCUVDesea[form.listaCUVDesea.length-1].value))
						{
							form.listaCUVDesea[form.listaCUVDesea.length-1].focus();
							return false;
						}
						if(!isBlank(form.listaCantidadDesea[form.listaCantidadDesea.length-1].value) &amp;&amp; isBlank(form.listaCUVDesea[form.listaCUVDesea.length-1].value))
						{
							form.listaCUVDesea[form.listaCUVDesea.length-1].focus();
							return false;
						}
						if((!isBlank(form.listaCantidadCambia[form.listaCantidadCambia.length-1].value) &amp;&amp; parseInt(form.listaCantidadCambia[form.listaCantidadCambia.length-1].value) > 0) &amp;&amp; isBlank(form.listaCUVCambia[form.listaCUVCambia.length-1].value))
						{
							form.listaCUVCambia[form.listaCUVCambia.length-1].focus();
							return false;
						}
						//
					}
					
					
					//Evalua parametro que indica si el CUV es obligatorio o no
		      		if(trim(arrIndicadorCUVDeseaObligatorio[index]) == 'SI' &amp;&amp; (isBlank(valor) || parseInt(valor) == 0) ){
		      			alert("Cantidad debe ser mayor a cero");
						return false;
					}else{
						//agregue RCR-0344
						if(trim(arrIndicadorCUVDeseaObligatorio[index]) == 'SI' &amp;&amp; 
							isBlank(form.listaCUVDesea[form.listaCUVDesea.length-1].value) &amp;&amp; dato[0] != 'T')
						{
							form.listaCUVDesea[form.listaCUVDesea.length-1].focus();
							return false;							
						}else
						{
							if(trim(arrIndicadorCUVCambiaObligatorio[index]) == 'SI' &amp;&amp; 
								(isBlank(form.listaCantidadCambia[form.listaCantidadCambia.length-1].value) 
										|| parseInt(form.listaCantidadCambia[form.listaCantidadCambia.length-1].value) == 0)
										 &amp;&amp; dato[0] != 'T' ){
				      			alert("Cantidad a cambiar debe ser mayor a cero");
				      			form.listaCantidadCambia[form.listaCantidadCambia.length-1].focus();
								return false;
							}else
							{
								if(trim(arrIndicadorCUVCambiaObligatorio[index]) == 'SI' &amp;&amp; 
								isBlank(form.listaCUVCambia[form.listaCUVCambia.length-1].value) &amp;&amp; dato[0] != 'T')
								{
									form.listaCUVCambia[form.listaCUVCambia.length-1].focus();
									return false;							
								}else
								{
									if(isBlank(valor))
									{
										objeto.value = '0';
									}
									agregarValorArr();
									getValUnidadDesea(9);
									ajax.getSaldoProducto(numPedido ,codVenta ,codigoPaisREC ,validaSaldoProductoCallBack);	
								}							
							}
						}
			 		}
			 	}
		  	}
		  	
		  	function agregarValorArr(){
		  		arrUnidades.push(unidades);
		 		arrCodigoVenta.push(codigoVentaGlobal);
				arrOperacion.push(codigoOperacionGlobal);
				
				unidades = 0;
		  	}

		  	function validaSaldoProductoCallBack(data){
				var form = document.forms[0];
			 	var indicadorOnline = $('#indicadorOnline').val();

			 	if(indicadorOnline == 'S'){
			 		if(data &lt;= 0){
						if(confirm('#{i18n["mantenimientoRECDigitacionCDRForm.message.listaSTO"]}')==false)
							return false;
					}
				 }
				
			 	var codigo=form.listaCUVCambia[form.listaCUVCambia.length-1].value;
		 		if(!isBlank(codigo)){
			 		//form.listaOperacion[form.listaOperacion.length-1].disabled=true;
			 		form.listaCUVCambia[form.listaCUVCambia.length-1].readOnly=true;
			 		form.listaCantidadCambia[form.listaCantidadCambia.length-1].readOnly=true;
			 		form.listaIgualEnvio[form.listaIgualEnvio.length-1].disabled=true;
			 		//form.listaMotivo[form.listaMotivo.length-1].disabled=true;		 		
			 		form.listaCUVDesea[form.listaCUVDesea.length-1].readOnly=true;
			 		form.listaCantidadDesea[form.listaCantidadDesea.length-1].readOnly=true;
			 		var flagValidarMontoDevolucion = validarMontoDevolucion();
			 		var flagValidarMontoFaltantes = validarMontoFaltantes(); 
			 		var flagValidarMontoCambios = validarMontoCambios();
			 		if(flagValidarMontoDevolucion &amp;&amp; flagValidarMontoFaltantes &amp;&amp; flagValidarMontoCambios){		 		
						addRow('prodList',listaCampos);
						desabilitarFilas();
						esEnterEnCantidadProductoCambia = false;
						esEnterEnCantidadProductoCambiaOnChange = false;
						ejecutarFunciones(1);
			 		}else{
			 			form.listaCUVCambia[form.listaCUVCambia.length-1].readOnly=false;
			 			form.listaCUVCambia[form.listaCUVCambia.length-1].value='';
			 			
				 		form.listaCantidadCambia[form.listaCantidadCambia.length-1].readOnly=false;
				 		form.listaCantidadCambia[form.listaCantidadCambia.length-1].value='';
				 		
				 		form.listaIgualEnvio[form.listaIgualEnvio.length-1].disabled=false;
				 		form.listaIgualEnvio[form.listaIgualEnvio.length-1].checked=false;
				 					 		 		
				 		form.listaCUVDesea[form.listaCUVDesea.length-1].readOnly=false;
				 		form.listaCUVDesea[form.listaCUVDesea.length-1].value='';
				 		
				 		form.listaCantidadDesea[form.listaCantidadDesea.length-1].readOnly=false;
				 		form.listaCantidadDesea[form.listaCantidadDesea.length-1].value='';

				 		form.listaDescripcionCambia[form.listaCantidadDesea.length-1].value='';
				 		form.listaPrecioCambia[form.listaCantidadDesea.length-1].value='';

				 		form.listaIdentSolicPos[form.listaIdentSolicPos.length-1].value='';

				 		if(!flagValidarMontoDevolucion){
				 			alert('#{i18n["message.supera.porcentaje"]}'+ ' ' + porcentajeDevolucion +'%  (Total Pedido :  ' + montoPedido + ' Total Devoluciones :  ' + montoDevolucion + ') '       );
				 		}else{
				 			if(!flagValidarMontoFaltantes){
					 			alert('#{i18n["message.supera.porcentajeFaltantes"]}'+ ' ' + porcentajeFaltantes +'%');
					 		}else{
					 			if(!flagValidarMontoCambios){
						 			alert('#{i18n["message.supera.porcentajeCambios"]}'+ ' ' + porcentajeCambios +'%');
						 		}
						 	}	
					 	}
			 		}

			 			 									
		 		}
		 		else{
		 			//-----
			 		//var index = $.inArray(form.listaOperacion[form.listaCUVCambia.length-1].value,arrCodigoOperacion);
			 		var dato=form.listaOperacion[form.listaCUVCambia.length-1].value.split("|");
					var index = $.inArray(dato[0],arrCodigoOperacion);			
					//Evalua parametro que indica si el CUV es obligatorio o no
					if(arrIndicadorCUVCambiaObligatorio[index] == 'NO' || (arrIndicadorCUVCambiaObligatorio[index] == 'SI' &amp;&amp; dato[0] == 'T')){
						var flagValidarMontoDevolucion = validarMontoDevolucion();
				 		var flagValidarMontoFaltantes = validarMontoFaltantes(); 
				 		var flagValidarMontoCambios = validarMontoCambios();
				 		
						if(flagValidarMontoDevolucion &amp;&amp; flagValidarMontoFaltantes &amp;&amp; flagValidarMontoCambios){
							addRow('prodList',listaCampos);
							desabilitarFilas();
							esEnterEnCantidadProductoCambia = false;
							esEnterEnCantidadProductoCambiaOnChange = false;
							ejecutarFunciones(1);
						}else{
							
				 			form.listaCUVCambia[form.listaCUVCambia.length-1].readOnly=false;
				 			form.listaCUVCambia[form.listaCUVCambia.length-1].value='';
				 			
					 		form.listaCantidadCambia[form.listaCantidadCambia.length-1].readOnly=false;
					 		form.listaCantidadCambia[form.listaCantidadCambia.length-1].value='';
					 		
					 		form.listaIgualEnvio[form.listaIgualEnvio.length-1].disabled=false;
					 		form.listaIgualEnvio[form.listaIgualEnvio.length-1].checked=false;
					 					 		 		
					 		form.listaCUVDesea[form.listaCUVDesea.length-1].readOnly=false;
					 		form.listaCUVDesea[form.listaCUVDesea.length-1].value='';
					 		
					 		form.listaCantidadDesea[form.listaCantidadDesea.length-1].readOnly=false;
					 		form.listaCantidadDesea[form.listaCantidadDesea.length-1].value='';

					 		form.listaDescripcionCambia[form.listaCantidadDesea.length-1].value='';
					 		form.listaPrecioCambia[form.listaCantidadDesea.length-1].value='';

					 		form.listaIdentSolicPos[form.listaIdentSolicPos.length-1].value='';
					 		
					 		if(!flagValidarMontoDevolucion){
					 			alert('#{i18n["message.supera.porcentaje"]}'+ ' ' + porcentajeDevolucion +'%  (Total Pedido :  ' + montoPedido + ' Total Devoluciones :  ' + montoDevolucion + ') '       );
					 		}else{
					 			if(!flagValidarMontoFaltantes){
						 			alert('#{i18n["message.supera.porcentajeFaltantes"]}'+ ' ' + porcentajeFaltantes +'%');
						 		}else{
						 			if(!flagValidarMontoCambios){
							 			alert('#{i18n["message.supera.porcentajeCambios"]}'+ ' ' + porcentajeCambios +'%');
							 		}
							 	}	
						 	}
				 		}	 
					}
			 		//-----
		 		}
		  		x1=form.listaOperacion;
		 		x1[form.listaOperacion.length-1].focus();
				
		  	}
		  	
			function deleteX()
			{
				var form = document.forms[0];
				var checkelimina = form.selectedItems;
				var codVenta = '';
				var codOper = '';
				var valUni = 0;
				var dato='';
				var arrVent = new Array();
				var arrOpe = new Array();
				var arrUni = new Array();
				
				var oidSolPos = '';
				if(checkelimina.length != null) 
				{
		        	if (checkelimina.length>0) 
					{
		        	    if (confirm('#{i18n["mensaje.confirm.eliminarDetalles"]}')==false)
						{
							return false;
						}
							
						cont = 0;
						conta = 0;
						
						var eliminarSeleccionados = true;

						while(eliminarSeleccionados)
						{
							eliminarSeleccionados = false;
							var long1 = checkelimina.length;
							
							for (t=0; t &lt; long1-1; t++){                                         	
								if(checkelimina[t].checked){
									codVenta = 	form.listaCUVCambia[t+1].value;
									dato = form.listaOperacion[t+1].value.split("|");   
									codOper = dato[0];
									valUni = form.listaCantidadCambia[t+1].value;
									
									arrVent.push(codVenta);
									arrOpe.push(codOper);
									arrUni.push(valUni);

									deleteRow('prodList',t+2);
									
									eliminarSeleccionados = true;
									break;
								}
							}
						}
		            }
						
					eliminarArrays(arrVent, arrOpe, arrUni);
						
					for (t=0; t&lt;form.selectedItems.length; t++){
						form.selectedItems[t].checked = false;
					}                                            
				}
			}        	
			
			function eliminarArrays(arrVent, arrOpe, arrUni){
				var eliminarSeleccionados = true;
				var indiceEliminar;
				
				while(eliminarSeleccionados)
				{
					//Buscar el indice a eliminar
					indiceEliminar = -1;
					for(t=0; t&lt; arrCodigoVenta.length ; t++){
						for(x=0; x &lt; arrVent.length; x++){
							if(arrCodigoVenta[t] == arrVent[x] &amp;&amp; arrOperacion[t] == arrOpe[x] &amp;&amp; arrUnidades[t] == arrUni[x]){
								indiceEliminar = t;
								break;
							}
						}

						if(indiceEliminar != -1)
							break;
					}
					//

					if(indiceEliminar == -1)
					{
						eliminarSeleccionados = false;
					}
					else
					{
						//Eliminar
						arrCodigoVenta.splice(indiceEliminar, 1);
						arrOperacion.splice(indiceEliminar, 1);
						arrUnidades.splice(indiceEliminar, 1);
						//
					}
				}
				
				var form = document.forms[0];
					form.listaCUVCambia[form.listaCUVCambia.length-1].value = '';
			    	form.listaDescripcionCambia[form.listaCUVCambia.length-1].value = '';
			    	form.listaPrecioCambia[form.listaCUVCambia.length-1].value = '';
			    	form.listaIdentSolicPos[form.listaIdentSolicPos.length-1].value='';
					form.listaCantidadCambia[form.listaCantidadCambia.length-1].value='';
					form.listaCantidadDesea[form.listaCantidadDesea.length-1].value='';
					form.listaCUVDesea[form.listaCUVDesea.length-1].value='';
					form.listaIgualEnvio[form.listaIgualEnvio.length-1].checked=false;
			}
			
			//============ VARIABLES GLOBALES - VALIDACION GRABAR FINAL - INICIO ============
			var errorValidaGrabarFinal = false;
			var indiceValidaGrabarFinal = '';
			//============ VARIABLES GLOBALES - VALIDACION GRABAR FINAL - FINAL ============

		  	function guardar(){ 		
		    	var form = document.forms[0];

		    	//Validamos que el form, tenga almenos un registro en la grilla y que la ultima fila, este vacia (todos los campos en blanco)
		    	if((form.listaCUVCambia.length - 1) &lt;= 1)
		    	{
		    		alert('Debe de ingresar como mínimo una linea.');
		    		return false;
		        }
		    	else
		    	{
					if(!isBlank(form.listaCUVCambia[form.listaCUVCambia.length-1].value) || 
							!isBlank(form.listaDescripcionCambia[form.listaDescripcionCambia.length-1].value) ||
							!isBlank(form.listaPrecioCambia[form.listaPrecioCambia.length-1].value) ||
							!isBlank(form.listaCantidadCambia[form.listaCantidadCambia.length-1].value) ||
							!isBlank(form.listaCantidadDesea[form.listaCantidadDesea.length-1].value) ||
							!isBlank(form.listaCUVDesea[form.listaCUVDesea.length-1].value))
					{
				    	alert('Debe de completar el registro de la ultima linea.');
			    		return false;
					}
		        }    	
		    	//  
		    	
		    	//=================== VALIDACIONES GRABAR FINAL - INICIO ===================
				for(indiceValidaGrabarFinal = 1; indiceValidaGrabarFinal &lt; form.listaCUVCambia.length-1; indiceValidaGrabarFinal++) {
					//indiceValidaGrabarFinal = i;
					errorValidaGrabarFinal = false;

					//VALIDA COMBO OPERACION
					ejecutarFuncionesGrabarFinal('1', indiceValidaGrabarFinal);
					if(errorValidaGrabarFinal) return false;
					
					//VALIDA CUV CAMBIA
					errorValidaGrabarFinal = false;
					setFocusCUVCambiaGrabarFinal(form.listaCUVCambia[indiceValidaGrabarFinal].value, indiceValidaGrabarFinal);
					if(errorValidaGrabarFinal) return false;
					
					//VALIDA CANTIDAD CAMBIA
					errorValidaGrabarFinal = false;
					seteaFocoUnidadesCambiaGrabarFinal(form.listaCantidadCambia[indiceValidaGrabarFinal].value, indiceValidaGrabarFinal);
					if(errorValidaGrabarFinal) return false;
					
					//VALIDA CUV DESEA
					errorValidaGrabarFinal = false;
					setFocusCUVDeseaGrabarFinal(form.listaCUVDesea[indiceValidaGrabarFinal].value, indiceValidaGrabarFinal);
					if(errorValidaGrabarFinal) return false;
					
					//VALIDA CANTIDAD DESEA
					errorValidaGrabarFinal = false;
					agregarDetalleGrabarFinal(form.listaCantidadDesea[indiceValidaGrabarFinal].value, indiceValidaGrabarFinal);
					if(errorValidaGrabarFinal) return false;
					
					
				}
				//=================== VALIDACIONES GRABAR FINAL - FINAL ===================
		    	
				<c:if test='${mAlias.formBusqueda.muestraIndicador eq 1}'>
					if(document.getElementById("indicadorCDRRechazo_input").checked){
						if(document.getElementById("codigoMotivoRechazoDef_input").value == ""){
							alert('#{i18n["mantenimientoRECDigitacionCDRForm.message.motivo.obligatorio"]}');
							$('#codigoMotivoRechazoDef_input').focus();
							return false;
						}
					}
				</c:if>	
						
				//Validar trueques
				var indicadorLinea18 = document.getElementById("indicadorLinea18").value;
				var valorDesviacionPrecioUnitarioTrueque = document.getElementById("valorDesviacionPrecioUnitarioTrueque").value;
				var indicadorDesviacionPrecioUnitarioTruequeValorAbsoluto = document.getElementById("indicadorDesviacionPrecioUnitarioTruequeValorAbsoluto").value;
				
				if(indicadorLinea18 == '1')
				{
					var valorTruequeCambia = calcularMontoTrueque('CA');
					var valorTruequeDesea = calcularMontoTrueque('DE');
					var diferencia = 0;

					if(indicadorDesviacionPrecioUnitarioTruequeValorAbsoluto == '1')
					{
						//SIN ABS
						diferencia = valorTruequeCambia - valorTruequeDesea;
					}
					else
					{
						//CON ABS
						diferencia = Math.abs(valorTruequeCambia - valorTruequeDesea);
					}

					if(diferencia > valorDesviacionPrecioUnitarioTrueque)
					{
						alert('Diferencia en trueques excede lo permitido ' + valorDesviacionPrecioUnitarioTrueque + ' (Total Cambia: ' + valorTruequeCambia + ' / Total Desea: ' + valorTruequeDesea + ')');
						return false;
					}
				}
				//		
				if(validateMantenimientoRECDigitacionCDRForm(form) &amp;&amp; customValidateMantenimientoRECDigitacionCDRForm(form)){    
		    		$('#numeroCDR').focus();
		    		//restoreEnabled();	
		    		var botonGrabar = document.getElementById("botonGrabar");
		    		$('#botonGrabar').attr('style', 'pointer-events: none;cursor: default; color: gray;');
		    	    
		    	    var alistaOperacion = document.getElementById("alistaOperacion");
		    	    var alistaCUVCambia = document.getElementById("alistaCUVCambia");
		    	    var alistaCantidadCambia = document.getElementById("alistaCantidadCambia");
		    	    var alistaMotivo = document.getElementById("alistaMotivo");
		    	    var alistaCUVDesea = document.getElementById("alistaCUVDesea");
		    	    var alistaCantidadDesea = document.getElementById("alistaCantidadDesea");
		    	    
		    	    alistaOperacion.value = obtenerStringLista("listaOperacion");
		    	    alistaCUVCambia.value = obtenerStringLista("listaCUVCambia");
		    	    alistaCantidadCambia.value = obtenerStringLista("listaCantidadCambia");
		    	    alistaMotivo.value = obtenerStringLista("listaMotivo");
		    	    alistaCUVDesea.value = obtenerStringLista("listaCUVDesea");
		    	    alistaCantidadDesea.value = obtenerStringLista("listaCantidadDesea");
		    	    
		    	    return true;
		    	    //var botonGrabarAux = document.getElementById("botonGrabarAux");
		    	    //botonGrabarAux.click();
		        	
		    	    //actualizarListas(alistaOperacion, alistaCUVCambia, alistaCantidadCambia, alistaMotivo, alistaCUVDesea, alistaCantidadDesea);
		    	      
				   	//form.action='saveMantenimientoRECDigitacionCDR.do';
				   	//form.submit();                
		    	}

		    	return false;
			} 
		  	
		  	function restoreEnabled()	{
		  	    var f = document.forms[0];
		  	    var i = disabledFalseAll(f);
		  	}
		 
		  	function customValidateMantenimientoRECDigitacionCDRForm(form) {                
		  		var form = document.forms[0];
						
				x1=form.listaMotivo;
				//alert($('indicadorHayRegistros').value);
				if($('#indicadorHayRegistros').val()!='1'){
					if(x1.length == 2){
						alert('#{i18n["mensaje.ingresarUnDetalle"]}');	
						return false;
					}
				}

				if(/^\d+$/.test($('#numeroCDR').val())){
					if (!confirm('#{i18n["confirm.save.information"]}'))  {
						return false;
					}
				}
				else{   
					alert('#{i18n["mensaje.numeroCDR.numerico"]}');
					$('#numeroCDR').val('');
					$('#numeroCDR').focus();
					return false;
				} 
				
				if(!validarMontoDevolucion()){
					alert('#{i18n["message.supera.porcentaje"]}'+ ' ' + porcentajeDevolucion +'%  (Total Pedido :  ' + montoPedido + ' Total Devoluciones :  ' + montoDevolucion + ') '       );
					return false;
				}

				if(!validarMontoFaltantes()){
					alert('#{i18n["message.supera.porcentajeFaltantes"]}'+ ' ' + porcentajeFaltantes +'%');
					return false;
				}

				if(!validarMontoCambios()){
					alert('#{i18n["message.supera.porcentajeCambios"]}'+ ' ' + porcentajeCambios +'%');
					return false;
				}

				/* INI JR PER-SiCC-2012-0304 */
				/*var indicadorMuestra = '#{mAlias.formBusqueda.muestraIndicador}';

				if ( indicadorMuestra == '1'){
					if(document.getElementById("indicadorCDRRechazo_input").checked)
			     		//document.getElementById("indicadorCDRRechazo_input").value = '1';
				 		$('#indicadorCDRRechazo_input').val('1');
			     	else
			     		//document.getElementById("indicadorCDRRechazo_input").value = '0';
			     		$('#indicadorCDRRechazo_input').val('0');	
				}*/

			 	/* FIN JR PER-SiCC-2012-0304 */

		    	return true;
		  	}

			//
			function seteaFocoNumeroCDR(textControl, evt){						
				var keyCode = document.layers ? evt.which : document.all ? evt.keyCode : evt.keyCode;
				if (keyCode != 13) {
					var strLen = textControl.value.length;
					var strMaxLen =textControl.maxLength;
					if(strLen == strMaxLen){				
						$('#numeroBoletaDespacho').focus();	        				        	        	        	        
			      		return false;
					}	
		          	return true;
		      	}
		      	else {         		        	
		      		$('#numeroBoletaDespacho').focus();	        				        	        	        	        
		      		return false;
		      	}
			}  	

			// 
			function seteaFocoNumeroBoletaDespacho(textControl, evt){
									
				var keyCode = document.layers ? evt.which : document.all ? evt.keyCode : evt.keyCode;
				if (keyCode != 13) {
					var strLen = textControl.value.length;
					var strMaxLen =textControl.maxLength;
					if(strLen == strMaxLen){
						ajax.getMensajeValidaPedido(textControl.value, loadMensajeBoletaCallBack);
						//setDatos();	        				        	        	        	        
			      		//return false;
					}
					
		          	return true;
		      	}
		      	else {  

		      		if(textControl.value!=''){
		      			ajax.getMensajeValidaPedido(textControl.value, loadMensajeBoletaCallBack);
		      			//setDatos();		        				        	        	        	        
		      			//return false;
		      		}else{
		      			document.getElementById('idRecDocRefPopup:linkPopupInvocarAjax:linkImagen').click();
		      			//openSearchDocumentosReferenciaPopup(); COMENTADOO
		      			return false;
		          	}
		      	}
			}  
			
			function loadMensajeBoletaCallBack(data){
				if(data != null){
					alert(data);
					return true;
				}else{
					setDatos();
					var indicadorPrimerIngreso= document.getElementById("indicadorPrimerIngreso");
					
					if(indicadorPrimerIngreso.value=='S'){
						onFocusOperacionInicio = onFocusOperacion;
						indicadorPrimerIngreso.value = 'N';
					}
		      		return false;
				}
				
			}

			function setDatos(){
				setearConsultora();	
				var form =document.forms[0];
				//x1=form.listaOperacion;
		 		//x1[1].focus();
		 		 ejecutarFunciones(1);
			}

			function esEnterOperacion(textControl, evt){	

				var keyCode = document.layers ? evt.which : document.all ? evt.keyCode : evt.keyCode;
				
				if (keyCode != 13) {		
		          	return true;
		      	}
		      	else {    
		      	
					flagOperacionTrueque = true;
		      		var form =document.forms[0];
		    		x1=form.listaCUVCambia;
		     		x1[form.listaCUVCambia.length-1].focus();  
		      		return false;
		      	}
			}  	

			function seteaFocoCUVCambia(textControl, evt)
			{		
				var keyCode = document.layers ? evt.which : document.all ? evt.keyCode : evt.keyCode;
				if (keyCode != 13) 
				{
					var strLen = textControl.value.length;
					var strMaxLen =textControl.maxLength;

					if(strLen == strMaxLen)
					{		
						var form =document.forms[0];
					 	var codVenta = form.listaCUVCambia[form.listaCUVCambia.length-1].value;
					 	var datoOperacion = form.listaOperacion[form.listaCUVCambia.length-1].value.split("|");
					 	var operacion = datoOperacion[0];
					 	var mensaje = '';
					 	
					 	if(operacion != 'C' &amp;&amp; operacion != 'P')
						{
					 		if(arrCodigoVenta.length>0)
							{
								for (t=0; t &lt; arrCodigoVenta.length; t++)
								{  
						 			if(arrCodigoVenta[t] == codVenta &amp;&amp; arrOperacion[t]==operacion )
									{
						 				mensaje ="CUV ya fue ingresado en el CDR";
						 				form.listaCUVCambia[form.listaCUVCambia.length-1].value='';
						 				break;
						 			}
						 		}
							}
					 	}	
				 				
					 	if(mensaje != '')
						{
					 		alert(mensaje);
					 	}
						else
						{
					 		setFocusCUVCambia(textControl);
					 	}
						
						return false;        	    			 
					}	
			        return true;
				}
				else 
				{    
					var form =document.forms[0];
					var mensaje = '';
					textControl.value = leftpad(textControl.value, '0', textControl.maxLength, '');     	
					var datoOperacion = form.listaOperacion[form.listaCUVCambia.length-1].value.split("|");
					var operacion = datoOperacion[0];
		      		
					if(textControl.value !=null &amp;&amp; textControl.value != '')
					{			 	
					 	if(operacion != 'C' &amp;&amp; operacion != 'P')
						{
					 		if(arrCodigoVenta.length>0)
							{
						 		for (t=0; t &lt; arrCodigoVenta.length; t++)
								{
						 			if(arrCodigoVenta[t] == textControl.value &amp;&amp; arrOperacion[t]==operacion)
									{
						 				mensaje ="CUV ya fue ingresado en el CDR";
						 				form.listaCUVCambia[form.listaCUVCambia.length-1].value='';
						 				break;
						 			}
						 		}
					 		}
					 	}
					 	
			 			if(mensaje != ''){
			 				alert(mensaje);
			 			
			 			}
						else
						{
				 			setFocusCUVCambia(textControl);
			 			}
			 			          				        	        	        	        
						return false;
					}
					else
					{
						//El campo texto esta vacio
						var index = $.inArray(operacion, arrCodigoOperacion);

						// Si es NO obligatorio o si esobligatorio y es trueque y esta vacio, mueve el foco
						if(arrIndicadorCUVCambiaObligatorio[index] == 'NO')
						{
							var x1 = form.listaMotivo;
							x1[form.listaMotivo.length-1].focus();
						}
						else
						{
							if(operacion == 'T')
							{
								if(flagOperacionTrueque)
								{
									flagOperacionTrueque = false;
								}
								else
								{
									var x1 = form.listaMotivo;
									x1[form.listaMotivo.length-1].focus();
								}
							}
						
						}
					}
				}
				return true;
			}  

			function validaCentroServicio(codigoVenta){		
				ajax.getIndicadorCentroServicio(codigoVenta, validaCentroServicioCallback);
			}

			function validaCentroServicioCallback(data){		
				var form =document.forms[0];
				if(data != null) {
					if (data.value == '1') {
						alert('#{i18n["mensaje.garantiaCentroServicio"]}'+' '+data.label);
				    	form.listaCUVCambia[form.listaCUVCambia.length-1].value = '';
				    	
				 		form.listaDescripcionCambia[form.listaCantidadCambia.length-1].value = '';
				 		form.listaPrecioCambia[form.listaCantidadCambia.length-1].value = '';
				 		form.listaIdentSolicPos[form.listaIdentSolicPos.length-1].value='';
				 		
				 		x1=form.listaCUVCambia;
				 		x1[form.listaCUVCambia.length-1].focus();
					}
					else{
						var index = $.inArray(textCodVenta,arrCuvs);
						if(index == -1){		    
							alert('#{i18n["mensaje.codVtaNoExisteCDR"]}');
					    	form.listaCUVCambia[form.listaCUVCambia.length-1].value = '';
					    }
					    else{								
							x1=form.listaCantidadCambia;
					 		x1[form.listaCantidadCambia.length-1].focus();
					 		form.listaDescripcionCambia[form.listaCantidadCambia.length-1].value = arrDesc[index];

					 		var dato = form.listaOperacion[form.listaCUVCambia.length-1].value.split("|");			 		
					 		//if(dato[0] == 'D')
					 		if(dato[0] != 'T')
					 		{
						 		if(arrPrecCata[index] == 0)
						 		{
						 			form.listaPrecioCambia[form.listaCantidadCambia.length-1].value = arrPrecCata[index];
							 	}
						 		else
						 		{
						 			form.listaPrecioCambia[form.listaCantidadCambia.length-1].value = arrPrec[index];
							 	}
						 	}
					 		else
					 		{
					 			form.listaPrecioCambia[form.listaCantidadCambia.length-1].value = arrPrec[index];
						 	}
				 			
					 		form.listaIdentSolicPos[form.listaIdentSolicPos.length-1].value=arrPosic[index];
				 		}
					}	
								
				}			
			}

			function setFocusCUVCambia(textControl){
				var form =document.forms[0];
				var verex = false;
				//true si tiene error
				//false si no tiene error
				if(onFocusOperacion){
						
					form.listaCUVCambia[form.listaCUVCambia.length-1].value = '';
				    form.listaDescripcionCambia[form.listaCUVCambia.length-1].value = '';
				    form.listaPrecioCambia[form.listaCUVCambia.length-1].value = '';
				    form.listaIdentSolicPos[form.listaIdentSolicPos.length-1].value='';
					form.listaCantidadCambia[form.listaCantidadCambia.length-1].value='';
					ejecutarFunciones(1);
		      	}
				else
				{
					//var index = $.inArray(form.listaOperacion[form.listaCUVCambia.length-1].value,arrCodigoOperacion);
					var dato=form.listaOperacion[form.listaCUVCambia.length-1].value.split("|");
					var index = $.inArray(dato[0],arrCodigoOperacion);
					//alert(textControl.value);	
					//Evalua parametro que indica si el CUV es obligatorio o no
					if(arrIndicadorCUVCambiaObligatorio[index] == 'NO' &amp;&amp; dato[0] != 'T')
					{
						x1=form.listaCantidadCambia;
						x1[form.listaCantidadCambia.length-1].focus();

						var index2 = $.inArray(textControl.value,arrCuvs);
						if(index2 != -1)
						{		    
							if(arrDesc[index] != null &amp;&amp; textControl.value != '')
							{
								form.listaDescripcionCambia[form.listaCantidadCambia.length-1].value = arrDesc[index];

						 		//if(dato[0] == 'D')
						 		//{
							 		if(arrPrecCata[index] == 0)
							 		{
							 			form.listaPrecioCambia[form.listaCantidadCambia.length-1].value = arrPrecCata[index];
								 	}
							 		else
							 		{
							 			form.listaPrecioCambia[form.listaCantidadCambia.length-1].value = arrPrec[index];
								 	}
							 	//}
						 		//else
						 		//{
						 		//	form.listaPrecioCambia[form.listaCantidadCambia.length-1].value = arrPrec[index];
							 	//}
								
								form.listaIdentSolicPos[form.listaIdentSolicPos.length-1].value=arrPosic[index];
								codigoVentaGlobal = form.listaCUVCambia[form.listaCUVCambia.length-1].value;
								codigoOperacionGlobal = dato[0];
								//validarException
								verificaExcepcion(form.listaIdentSolicPos[form.listaIdentSolicPos.length-1].value,4);
								verex = true;
							}
						}
					}	
					else{				
						if(textControl.value == '')
						{				
							return false;
						}
						else{
							var index2 = $.inArray(textControl.value,arrCuvs);
							if(index2 != -1)
							{		    
								if(arrDesc[index2] != null &amp;&amp; textControl.value != '')
								{
									form.listaDescripcionCambia[form.listaCantidadCambia.length-1].value = arrDesc[index2];

									if(dato[0] == 'T')
									{
										form.listaPrecioCambia[form.listaCantidadCambia.length-1].value = arrPrecCata[index2];
									} 								
									else
									{
								 		//if(dato[0] == 'D')
								 		//{
									 		if(arrPrecCata[index2] == 0)
									 		{
									 			form.listaPrecioCambia[form.listaCantidadCambia.length-1].value = arrPrecCata[index2];
										 	}
									 		else
									 		{
									 			form.listaPrecioCambia[form.listaCantidadCambia.length-1].value = arrPrec[index2];
										 	}
									 	//}
								 		//else
								 		//{
								 		//	form.listaPrecioCambia[form.listaCantidadCambia.length-1].value = arrPrec[index2];
									 	//}
									}	
									
									form.listaIdentSolicPos[form.listaIdentSolicPos.length-1].value=arrPosic[index2];
									//validarException
									verificaExcepcion(form.listaIdentSolicPos[form.listaIdentSolicPos.length-1].value,4);
									verex = true;
								}
							}
						}
					}			

					//Evalua el tipo de validacion parametrizada para el tipo de operacion seleccionado
					validacionCambia = arrIndicadorValidacionCUVCambia[index];
					if(arrIndicadorValidacionCUVCambia[index] == '')
					{
						x1=form.listaCantidadCambia;
						x1[form.listaCantidadCambia.length-1].focus();
					}
					else
					{
						if(arrIndicadorValidacionCUVCambia[index] == 'PE')
						{
							var index2 = $.inArray(textControl.value,arrCuvs);
							if(index2 == -1)
							{		    
								alert('#{i18n["mensaje.codVtaNoExisteCDR"]}');
								form.listaCUVCambia[form.listaCUVCambia.length-1].value = '';
								form.listaDescripcionCambia[form.listaCUVCambia.length-1].value = '';
								form.listaPrecioCambia[form.listaCUVCambia.length-1].value = '';
								form.listaIdentSolicPos[form.listaIdentSolicPos.length-1].value='';
							}
							else
							{				
								x1=form.listaCantidadCambia;
								x1[form.listaCantidadCambia.length-1].focus();
								form.listaDescripcionCambia[form.listaCantidadCambia.length-1].value = arrDesc[index2];

								if(dato[0] == 'T')
								{
									form.listaPrecioCambia[form.listaCantidadCambia.length-1].value = arrPrecCata[index2];
								} 							
								else
								{
							 		//if(dato[0] == 'D')
							 		//{
								 		if(arrPrecCata[index2] == 0)
								 		{
								 			form.listaPrecioCambia[form.listaCantidadCambia.length-1].value = arrPrecCata[index2];
									 	}
								 		else
								 		{
								 			form.listaPrecioCambia[form.listaCantidadCambia.length-1].value = arrPrec[index2];
									 	}
								 	//}
							 		//else
							 		//{
							 		//	form.listaPrecioCambia[form.listaCantidadCambia.length-1].value = arrPrec[index2];
								 	//}
								}							

								form.listaIdentSolicPos[form.listaIdentSolicPos.length-1].value=arrPosic[index2];
								codigoVentaGlobal = form.listaCUVCambia[form.listaCUVCambia.length-1].value;
								codigoOperacionGlobal = dato[0];
								//validarException
								if(!verex)
									verificaExcepcion(form.listaIdentSolicPos[form.listaIdentSolicPos.length-1].value,4);
							}
						}
						else
						{
							if(arrIndicadorValidacionCUVCambia[index] == 'MF')
							{
								ajax.validarCUVMatrizPreciosPremios(textControl.value,'1',$('#numeroBoletaDespacho').val(), loadProductoCallback);
							}
							else
							{
								if(arrIndicadorValidacionCUVCambia[index] == 'MP')
								{
									ajax.validarCUVMatrizPreciosPremios(textControl.value,'2',$('#numeroBoletaDespacho').val(), loadProductoCallback);
								}
								else
								{
									if(arrIndicadorValidacionCUVCambia[index] == '-')
									{
										x1=form.listaCantidadCambia;
										x1[form.listaCantidadCambia.length-1].focus();
										var index2 = $.inArray(textControl.value,arrCuvs);
										
										if(index2 != -1)
										{		    
											if(arrDesc[index2] != null &amp;&amp; textControl.value != '')
											{
												form.listaDescripcionCambia[form.listaCantidadCambia.length-1].value = arrDesc[index2];

												if(dato[0] == 'T')
												{
													form.listaPrecioCambia[form.listaCantidadCambia.length-1].value = arrPrecCata[index2];
												} 											
												else
												{
											 		//if(dato[0] == 'D')
											 		//{
												 		if(arrPrecCata[index2] == 0)
												 		{
												 			form.listaPrecioCambia[form.listaCantidadCambia.length-1].value = arrPrecCata[index2];
													 	}
												 		else
												 		{
												 			form.listaPrecioCambia[form.listaCantidadCambia.length-1].value = arrPrec[index2];
													 	}
												 	//}
											 		//else
											 		//{
											 		//	form.listaPrecioCambia[form.listaCantidadCambia.length-1].value = arrPrec[index2];
												 	//}
												}											

												form.listaIdentSolicPos[form.listaIdentSolicPos.length-1].value=arrPosic[index2];
												codigoVentaGlobal = form.listaCUVCambia[form.listaCUVCambia.length-1].value;
												codigoOperacionGlobal =dato[0] ;

												//validarException
												if(!verex)
													verificaExcepcion(form.listaIdentSolicPos[form.listaIdentSolicPos.length-1].value,4);
											}
										}
									}		
								}
							}
						}
					}
					//VALIDACION GAR
					if(arrIndicadorValidarCentroServicio[index] == 'SI'){
						textCodVenta = textControl.value;
						validaCentroServicio(textControl.value); 	
					}

		  		}//hasta aqui la val de operacion		      
			}

			function loadProductoCallback(data){
				var form =document.forms[0];
				if(data!=null){
					x1=form.listaCantidadCambia;
					x1[form.listaCantidadCambia.length-1].focus();
			 		form.listaDescripcionCambia[form.listaCantidadCambia.length-1].value = data.label;

			 		//WARN!! No se ha determinado si se hace la validacion por tipoOeracion
			 		//Devolucion, toma CERO si precioCatalogo es CERO y precioFactura en otro caso 
				 	form.listaPrecioCambia[form.listaCantidadCambia.length-1].value = data.value;

				}
				else{				 		
					form.listaDescripcionCambia[form.listaCUVCambia.length-1].value = '';
			    	form.listaPrecioCambia[form.listaCUVCambia.length-1].value = '';
			    	form.listaCUVCambia[form.listaCUVCambia.length-1].value = '';
			    	form.listaCUVCambia[form.listaCUVCambia.length-1].focus();
			    	onFocusOperacion = false;
// 					onFocusCUV=true;
					onFocusCantidad=false;
					if(validacionCambia == 'PE')alert('#{i18n["mensaje.codVtaNoExiste.pedido"]}');
					if(validacionCambia == 'MF')alert('#{i18n["mensaje.codVtaNoExiste.precios"]}');
					if(validacionCambia == 'MP')alert('#{i18n["mensaje.codVtaNoExiste.premios"]}');		
				}
			}

			function seteaFocoUnidadesCambia(textControl, evt){		
				var keyCode = document.layers ? evt.which : document.all ? evt.keyCode : evt.keyCode;
				var form =document.forms[0];
				
				if (keyCode != 13) {				
					return true;
		      	}
		      	else 
				{
		      		esEnterEnCantidadProductoCambiaOnChange = true;
		          	getValUnidadReclamo(5);

				 	//Si tiene errores
				 	if(onFocusCantidad)
					{   
		          		return true;
		          	}
		          	else{  
		      			var dato=form.listaOperacion[form.listaOperacion.length-1].value.split("|");   
		      			var operacion = dato[0];     		
			      		var camObi = dato[4];
			      		var cantidad = form.listaCantidadCambia[form.listaCantidadCambia.length-1].value;
			      		var oidSoliPosi = form.listaIdentSolicPos[form.listaIdentSolicPos.length-1].value;
						var codigo=form.listaCUVCambia[form.listaCUVCambia.length-1].value;

		      			if(trim(camObi) == 'SI' &amp;&amp; (cantidad == '' || parseInt(cantidad) == 0) ){
		      				alert("Cantidad debe ser mayor a cero");
		      				return false;
		      			}

		      			if(trim(camObi) == 'NO' &amp;&amp; (cantidad == '' || parseInt(cantidad) == 0) &amp;&amp; operacion == 'T' &amp;&amp; !isBlank(codigo)){
		      				alert("Cantidad debe ser mayor a cero");
		      				return false;
		      			}

		      			esEnterEnCantidadProductoCambia = true;
		      	
						if(operacion !='G' &amp;&amp; operacion !='F' &amp;&amp; operacion !='H' &amp;&amp; operacion !='F3' &amp;&amp; operacion !='F4' &amp;&amp; operacion !='G3' &amp;&amp; operacion !='G4' &amp;&amp; operacion !='XA' &amp;&amp; operacion !='XI' &amp;&amp; operacion !='XM' &amp;&amp; operacion !='XP')
						{///CAMBIO
			      			if(operacion =='D' &amp;&amp; form.indicadorDevolucionOferta.value == '1')
				      		{
		      					validarOferta(operacion,oidSoliPosi,cantidad);
		          			}
							else
							{
								x1=form.listaMotivo;
								x1[form.listaMotivo.length-1].focus();
							}
						}
						else
						{
				 			x1=form.listaMotivo;
				 			x1[form.listaMotivo.length-1].focus();
						}
							        	        	        	        
		      			return false;
		      		}      	
		      	}
			}
			
			function verificaExcepcionValida(idSoliPosi,variable){
				opcion = variable;
				var form =document.forms[0];
				var dato=form.listaOperacion[form.listaCUVCambia.length-1].value.split("|");
				var codigoVenta = form.listaCUVCambia[form.listaCUVCambia.length-1].value;
				var codigoMotivo = form.listaMotivo[form.listaMotivo.length-1].value;
				if(indicadorOnline == 'S'  &amp;&amp; indicadorValCDRLinea == '1' &amp;&amp; (visualizaRechazo == '0' || visualizaRechazo == '2')){
					if(varCodOperSICC != null &amp;&amp; varCodOperSICC != '' &amp;&amp; dato[3] == 'PE' ) {//IND_CAMB_VALI 
						ajax.getValExcepProduGanador(varOidPeriCDR,codigoVenta,varCodOperSICC , dato[1],idSoliPosi, codigoMotivo, $('#codigoPais').val(),$('#indicadorValorAceptaCDR').val(), $('#indicadorExcluirValidaciones').val(), loadMensajeProduValidaCallBack);
					}
				}
			}
			
			function loadMensajeProduValidaCallBack(data){
				var form = document.forms[0];
				var arrRespuesta = data.split("|");
				data = arrRespuesta[0];
				var reemplazar = arrRespuesta[1];
				var indicadorExcluirValidacionDevolucion= document.getElementById("indicadorExcluirValidacionDevolucion");
				indicadorExcluirValidacionDevolucion.value='N';
				
				if(reemplazar!= 0 )	
				{	
					if(reemplazar == 1)
					{
						indicadorExcluirValidacionDevolucion.value='S';
					}
				}
				
			}

			function verificaExcepcionMotivo(){
				var form = document.forms[0];
				var dato = form.listaOperacion[form.listaCUVCambia.length-1].value.split("|");
				var codigoVenta = form.listaCUVCambia[form.listaCUVCambia.length-1].value;
				var codigoMotivo = form.listaMotivo[form.listaMotivo.length-1].value;
				var idSoliPosi = form.listaIdentSolicPos[form.listaIdentSolicPos.length-1].value;

				if(indicadorOnline == 'S'  &amp;&amp; indicadorValCDRLinea == '1' &amp;&amp; !isBlank(codigoVenta)){
					if(varCodOperSICC != null &amp;&amp; varCodOperSICC != '' &amp;&amp; dato[3] == 'PE' ||
					   (varCodOperSICC != null &amp;&amp; varCodOperSICC != '' &amp;&amp; dato[0] == 'E')  ||
					   (varCodOperSICC != null &amp;&amp; varCodOperSICC != '' &amp;&amp; dato[0] == 'A')) {//IND_CAMB_VALI
						ajax.getValExcepMotivo(varOidPeriCDR, codigoVenta, varCodOperSICC, dato[1], idSoliPosi, codigoMotivo, loadMensajeValExcepMotivoCallBack);
					}
				}
			}

			function loadMensajeValExcepMotivoCallBack(data){
				var form = document.forms[0];
				errorValidacionMotivoCdr = false;
				if(!isBlank(data))
				{
					alert(data);
					errorValidacionMotivoCdr = true;					
				}
			}
						
			function esEnterMotivo(textControl, evt){
				mantenerFocoIgualEnvio = false;
				var keyCode = document.layers ? evt.which : document.all ? evt.keyCode : evt.keyCode;

				var form = document.forms[0];
				var dato = form.listaOperacion[form.listaOperacion.length-1].value.split("|");   
	      		var operacion = dato[0];
				
				if (keyCode != 13) {		
		          	return true;
		      	}
		      	else {         		        	     				        	        	
		      		
		      		if(!isBlank(form.listaIdentSolicPos[form.listaIdentSolicPos.length-1].value) || operacion =='E' || operacion =='A')
		      		{
		      			if(errorValidacionMotivoCdr)
			      			return false;

		      			verificaExcepcionMotivo();

		      			if(errorValidacionMotivoCdr)
			      			return false;		      			
		      			
		      			verificaExcepcionValida(form.listaIdentSolicPos[form.listaIdentSolicPos.length-1].value,4);
		      		}
		      		
		      		 
					if(operacion !='E' &amp;&amp; operacion !='A'){          	       		     		        		      		
						if(operacion !='D' &amp;&amp; operacion !='F' &amp;&amp; operacion !='G' &amp;&amp; operacion !='H' &amp;&amp; operacion !='F3' &amp;&amp; operacion !='F4' &amp;&amp; operacion !='G3' &amp;&amp; operacion !='G4' &amp;&amp; operacion !='XA' &amp;&amp; operacion !='XI' &amp;&amp; operacion !='XM' &amp;&amp; operacion !='XP'
							&amp;&amp; operacion !='J' &amp;&amp; operacion !='K' &amp;&amp; operacion !='R' &amp;&amp; operacion !='H3' &amp;&amp; operacion !='N' &amp;&amp; operacion !='G5'&amp;&amp; operacion !='D2'
							)
						{
							if(operacion == 'C' || operacion == 'P')
							{
								if(!isBlank(form.indicadorProductoCambiaIgualDesea.value) &amp;&amp; form.indicadorProductoCambiaIgualDesea.value == '1')
								{
									//Cargar los mismos valores de producto cambia en producto desea, PRODUCTO Y CANTIDAD, Y LUEGO NUEVA LINEA
									var listaArrIE = form.listaIgualEnvio;
									var checkControl = listaArrIE[form.listaIgualEnvio.length-1];						
									var yC = form.listaCUVCambia;
									var xC = form.listaCantidadCambia;
									var zC = form.listaDescripcionCambia;
									var wC = form.listaPrecioCambia;

									var yD = form.listaCUVDesea;			
									var xD = form.listaCantidadDesea;
									var zD = form.listaDescripcionDesea;
									var wD = form.listaPrecioDesea;

									checkControl.checked = true;
									yD[form.listaCUVCambia.length-1].value = yC[form.listaCUVCambia.length-1].value;
								 	xD[form.listaCantidadCambia.length-1].value = xC[form.listaCantidadDesea.length-1].value;
								 	zD[form.listaDescripcionCambia.length-1].value = zC[form.listaDescripcionDesea.length-1].value;
								 	wD[form.listaPrecioCambia.length-1].value = wC[form.listaPrecioDesea.length-1].value;

								 	//Agregamos la fila
								 	
								 	var numPedido = $('#numeroBoletaDespacho').val();
								 	var codigoPaisREC = $('#codigoPais').val();
								 	var codVenta = form.listaCUVDesea[form.listaCUVDesea.length-1].value;
								 	
									agregarValorArr();

									if(!isBlank(codVenta))
										ajax.getSaldoProducto(numPedido ,codVenta ,codigoPaisREC ,validaSaldoProductoCallBack);								
									//
									form.listaMotivo[form.listaMotivo.length-2].disabled = true;
									
								}
								else
								{
									x1=form.listaIgualEnvio;
									x1[form.listaMotivo.length-1].focus();
									mantenerFocoIgualEnvio = true;
								}
							}
							else
							{
								x1=form.listaCUVDesea;
								x1[form.listaCUVDesea.length-1].focus();
							}
						}
						else{
							var form = document.forms[0];
					 		var codigo = form.listaCUVCambia[form.listaCUVCambia.length-1].value;
					 		if(codigo != ''){
						 		//form.listaOperacion[form.listaOperacion.length-1].disabled=true;
						 		form.listaCUVCambia[form.listaCUVCambia.length-1].readOnly=true;
						 		form.listaCantidadCambia[form.listaCantidadCambia.length-1].readOnly=true;
						 		form.listaIgualEnvio[form.listaIgualEnvio.length-1].disabled=true;
						 		//form.listaMotivo[form.listaMotivo.length-1].disabled=true;		 		
						 		form.listaCUVDesea[form.listaCUVDesea.length-1].readOnly=true;
						 		form.listaCantidadDesea[form.listaCantidadDesea.length-1].readOnly=true;
					 			//seteado
						 		codigoVentaGlobal = form.listaCUVCambia[form.listaCUVCambia.length-1].value;
						 		codigoOperacionGlobal = dato[0] ;
						 		codigoMotivoGlobal = form.listaMotivo[form.listaMotivo.length-1].value
						 		posicionMotivo = form.listaMotivo.length-1;
						 		var camObi = dato[4];
				 	      		var cantidad = form.listaCantidadCambia[form.listaCantidadCambia.length-1].value;
				 	      		var oidSoliPosi = form.listaIdentSolicPos[form.listaIdentSolicPos.length-1].value;

				 	      		var flagValidarMontoDevolucion = validarMontoDevolucion();
						 		var flagValidarMontoFaltantes = validarMontoFaltantes(); 
						 		var flagValidarMontoCambios = validarMontoCambios();
						 			
						 		if(flagValidarMontoDevolucion &amp;&amp; flagValidarMontoFaltantes &amp;&amp; flagValidarMontoCambios)
							 	{	
									agregarValorArr();
						 			if(agregarFilasOferta){
						 				agregarFilasOfertaHTML();
						 			}else{
								 		addRow('prodList',listaCampos);
								 		esEnterEnCantidadProductoCambia = false;
								 		esEnterEnCantidadProductoCambiaOnChange = false;
						 			}
							 		desabilitarFilas();
									ejecutarFunciones(1);
							 	}
						 		else{
						 			
						 			form.listaCUVCambia[form.listaCUVCambia.length-1].readOnly=false;
						 			form.listaCUVCambia[form.listaCUVCambia.length-1].value='';
						 			
							 		form.listaCantidadCambia[form.listaCantidadCambia.length-1].readOnly=false;
							 		form.listaCantidadCambia[form.listaCantidadCambia.length-1].value='';
							 		
							 		form.listaIgualEnvio[form.listaIgualEnvio.length-1].disabled=false;
							 		form.listaIgualEnvio[form.listaIgualEnvio.length-1].checked=false;
							 					 		 		
							 		form.listaCUVDesea[form.listaCUVDesea.length-1].readOnly=false;
							 		form.listaCUVDesea[form.listaCUVDesea.length-1].value='';
							 		
							 		form.listaCantidadDesea[form.listaCantidadDesea.length-1].readOnly=false;
							 		form.listaCantidadDesea[form.listaCantidadDesea.length-1].value='';

							 		form.listaDescripcionCambia[form.listaCantidadDesea.length-1].value='';
							 		form.listaPrecioCambia[form.listaCantidadDesea.length-1].value='';

							 		form.listaIdentSolicPos[form.listaIdentSolicPos.length-1].value='';

							 		if(!flagValidarMontoDevolucion){
							 			alert('#{i18n["message.supera.porcentaje"]}'+ ' ' + porcentajeDevolucion +'%  (Total Pedido :  ' + montoPedido + ' Total Devoluciones :  ' + montoDevolucion + ') '       );
							 		}else{
							 			if(!flagValidarMontoFaltantes){
							 				alert('#{i18n["message.supera.porcentajeFaltantes"]}'+ ' ' + porcentajeFaltantes +'%');
								 		}else{
								 			if(!flagValidarMontoCambios){
								 				alert('#{i18n["message.supera.porcentajeCambios"]}'+ ' ' + porcentajeCambios +'%');
									 		}
									 	}	
								 	}
						 		}	 								
					 		}
					 		x1=form.listaOperacion;
					 		x1[form.listaOperacion.length-1].focus();
						}
					}  
					else{
			    		x1=form.listaCUVDesea;
				 		x1[form.listaCUVDesea.length-1].focus();
					}        	        
		      		return false;
		      	}
			} 

			function seteaFocoCUVDesea(textControl, evt){

				var form = document.forms[0];
				if(form.listaCUVDesea[form.listaCUVDesea.length-1].readOnly)
				{
					//movemos el foco a listamotivo, si el campo esta de solo lectura
					form.listaMotivo[form.listaMotivo.length-1].focus();

					return false;
				}
										
				var keyCode = document.layers ? evt.which : document.all ? evt.keyCode : evt.keyCode;
				if (keyCode != 13) {
					var strLen = textControl.value.length;
					var strMaxLen =textControl.maxLength;
					if(strLen == strMaxLen){				
						setFocusCUVDesea(textControl);        	    			        	        	        	        
			      		return false;
					}	
		          	return true;
		      	}
		      	else {    
		      		textControl.value = leftpad(textControl.value, '0', textControl.maxLength, '');     		        	
		      		setFocusCUVDesea(textControl);      	          				        	        	        	        
		      		return false;
		      	}
			}  

			function setFocusCUVDesea(textControl){
				var form =document.forms[0];		
				var datoOperacion=form.listaOperacion[form.listaCantidadDesea.length-1].value.split("|");
				var index = $.inArray(datoOperacion[0],arrCodigoOperacion);

				//Evalua parametro que indica si el CUV es obligatorio o no
				if(arrIndicadorCUVDeseaObligatorio[index] == 'NO'){
					x1=form.listaCantidadDesea;
			 		//x1[form.listaCantidadDesea.length-1].focus();	 		
				}
				else{			
					if(textControl.value == ''){
						return false;
					}
				}				

				//Evalua el tipo de validacion parametrizada para el tipo de operacion seleccionado
				var index2 = $.inArray(textControl.value,arrCuvs);
				validacionDesea = arrIndicadorValidacionCUVDesea[index];
				if(arrIndicadorValidacionCUVDesea[index] == ''){
					x1=form.listaCantidadDesea;
			 		//x1[form.listaCantidadDesea.length-1].focus();
				}
				else{
					if(arrIndicadorValidacionCUVDesea[index] == 'PE'){				
						if(index2 == -1){
							alert('#{i18n["mensaje.codVtaNoExisteCDR"]}');
					    	form.listaCUVDesea[form.listaCUVDesea.length-1].value = '';			    	
					    }
					    else{
							form.listaDescripcionDesea[form.listaDescripcionDesea.length-1].value = arrDesc[index2];
							x1=form.listaCantidadDesea;
					 		x1[form.listaCantidadDesea.length-1].focus();			 		
				 		}
						
					}
					else{

						if(errorValidacionMotivoCdr)
							return false;
						
						verificaExcepcionDesea(form.listaIdentSolicPos[form.listaIdentSolicPos.length-1].value, 8);

						if(arrIndicadorValidacionCUVDesea[index] == 'MF'){
							ajax.validarCUVMatrizPreciosPremios(textControl.value,'1',$('#numeroBoletaDespacho').val(), loadProductoDeseaCallback);
						}
						else{
							if(arrIndicadorValidacionCUVDesea[index] == 'MP'){
								ajax.validarCUVMatrizPreciosPremios(textControl.value,'2',$('#numeroBoletaDespacho').val(), loadProductoDeseaCallback);
							}
							else{
								if(arrIndicadorValidacionCUVDesea[index] == '-'){
								
									if(index2 != -1)
									{
										form.listaDescripcionDesea[form.listaDescripcionDesea.length-1].value = arrDesc[index2];
										form.listaPrecioDesea[form.listaPrecioDesea.length-1].value = arrPrec[index2];
									}
									
									x1=form.listaCantidadDesea;
							 		//x1[form.listaCantidadDesea.length-1].focus();					 		
								}	
							}
						}
						
					}
					
				}
			}

			function loadProductoDeseaCallback(data){
				var form =document.forms[0];
				var lstPrecio = form.listaPrecioDesea;
				var lstDescri = form.listaDescripcionDesea;
				
				if(data!=null){
					//Ponemos la descripcion
					lstDescri[form.listaDescripcionDesea.length - 1].value = data.label;			
					//

					//Ponemos el precio			
					lstPrecio[form.listaPrecioDesea.length - 1].value = data.value;
					//
					
					x1=form.listaCantidadDesea;
			 		//x1[form.listaCantidadDesea.length-1].focus();
				}
				else{
					lstPrecio[form.listaPrecioDesea.length - 1].value = '';
					lstDescri[form.listaDescripcionDesea.length - 1].value = '';
					
			    	form.listaCUVDesea[form.listaCUVDesea.length-1].value = '';
			    	form.listaCUVDesea[form.listaCUVDesea.length-1].focus();
					if(validacionDesea == 'PE') alert('#{i18n["mensaje.codVtaNoExiste.pedido"]}');
					if(validacionDesea == 'MF') alert('#{i18n["mensaje.codVtaNoExiste.precios"]}');
					if(validacionDesea == 'MP') alert('#{i18n["mensaje.codVtaNoExiste.premios"]}');			
				}
			}
			
			function copiaTexto(checkControl){
				enfocar(7);		
				var form =document.forms[0];
				
				var yC = form.listaCUVCambia;
				var xC = form.listaCantidadCambia;
				var zC = form.listaDescripcionCambia;
				var wC = form.listaPrecioCambia;
				
				var yD = form.listaCUVDesea;			
				var xD = form.listaCantidadDesea;
				var zD = form.listaDescripcionDesea;
				var wD = form.listaPrecioDesea;

		  		var dato = form.listaOperacion[form.listaOperacion.length-1].value.split("|");   
		  		var operacion = dato[0]; 
				if(operacion == 'C')
				{
					if(!isBlank(form.indicadorProductoCambiaIgualDesea.value) &amp;&amp; form.indicadorProductoCambiaIgualDesea.value == '1')
					{
						if(checkControl.checked==true)
						{
							checkControl.checked=false;
							enfocar(7);
							
							return;
						}
					}
				}
				
				if(checkControl.checked==true){
					yD[form.listaCUVCambia.length-1].value = yC[form.listaCUVCambia.length-1].value;
				 	xD[form.listaCantidadCambia.length-1].value = xC[form.listaCantidadDesea.length-1].value;
				 	zD[form.listaDescripcionCambia.length-1].value = zC[form.listaDescripcionDesea.length-1].value;
				 	wD[form.listaPrecioCambia.length-1].value = wC[form.listaPrecioDesea.length-1].value;
				}	
				else{
					yD[form.listaCUVCambia.length-1].value = '';
				 	xD[form.listaCantidadCambia.length-1].value = '';
				 	zD[form.listaDescripcionCambia.length-1].value = '';
				 	wD[form.listaPrecioCambia.length-1].value = '';
				}
			}

			function seteaFocoIgualEnvio(textControl, evt){						
				var keyCode = document.layers ? evt.which : document.all ? evt.keyCode : evt.keyCode;
				if (keyCode != 13) {				
		          	return true;
		      	}
		      	else {    
		      		var form = document.forms[0];
					
		      		var dato = form.listaOperacion[form.listaOperacion.length-1].value.split("|");   
		      		var operacion = dato[0]; 			
					if(operacion == 'C' &amp;&amp; mantenerFocoIgualEnvio)
					{
						textControl.focus();				
						mantenerFocoIgualEnvio = false;
					}
					else
					{
						x1 = form.listaCUVDesea;
						x1[form.listaCUVDesea.length-1].focus();    
					}
					
		      		return false;
		      	}
			}  

			function bloquearComponentes(comboControl){
				
				var arrComboControl=comboControl.value.split("|");
				var codigo = arrComboControl[0];
				var form =document.forms[0];
				desbloquearTodo();

				//Limpiamos todos los valores anteriores
				var i = form.listaIgualEnvio.length-1;
				
				form.listaCUVCambia[i].value = '';
				form.listaDescripcionCambia[i].value = '';
				form.listaPrecioCambia[i].value = '';
			 	form.listaCantidadCambia[i].value = '';
			 	
			 	form.listaMotivo[i].options[0].selected = true;
			 	form.listaIgualEnvio[i].checked = false;	 		

			 	form.listaCUVDesea[i].value = '';
			 	form.listaDescripcionDesea[i].value = '';
			 	form.listaPrecioDesea[i].value = '';
			 	form.listaCantidadDesea[i].value = '';		
			 	//
			 	
			 	//Desabilitamos los demas controles segun el tipo de operacion	 	
				var listaPopupCuvCambia = document.getElementsByName('listaPopupCuvCambia');
				var listaPopupCuvDesea = document.getElementsByName('listaPopupCuvDesea');

				listaPopupCuvDesea[i].style.display = '';
				listaPopupCuvCambia[i].style.display = '';

				if(codigo=='D'){
					form.listaIgualEnvio[form.listaIgualEnvio.length-1].disabled=true;
			 		form.listaCUVDesea[form.listaCUVDesea.length-1].readOnly=true;
			 		form.listaCantidadDesea[form.listaCantidadDesea.length-1].readOnly=true;
			 		listaPopupCuvDesea[i].style.display = 'none';
			 		
			 		validaCodigoResultado= false;
				}
				if(codigo =='G' || codigo =='F' || codigo == 'H' || codigo == 'F3' || codigo == 'F4' || codigo == 'G3' || codigo == 'G4' || codigo == 'XA' || codigo == 'XI' || codigo == 'XM' || codigo == 'XP'){
					form.listaIgualEnvio[form.listaIgualEnvio.length-1].disabled=true;
			 		form.listaCUVDesea[form.listaCUVDesea.length-1].readOnly=true;
			 		form.listaCantidadDesea[form.listaCantidadDesea.length-1].readOnly=true;
			 		listaPopupCuvDesea[i].style.display = 'none';
			 		validaCodigoResultado= true;
				}	
				if(codigo=='E' || codigo=='A'){
					form.listaIgualEnvio[form.listaIgualEnvio.length-1].disabled=true;
					validaCodigoResultado= false;
				}

				//Verificamos si son obligatorios o no los campos, segun eso habilitamos o desabilitamos		
				var index = $.inArray(codigo, arrCodigoOperacion);			

				if(arrIndicadorCUVCambiaObligatorio[index] == 'NO' &amp;&amp; codigo != 'T')
				{
					//Desabilitamos la seleccion del cuv y la cantidad del CAMBIA
			 		form.listaCUVCambia[form.listaCUVCambia.length-1].readOnly = true;
			 		form.listaCantidadCambia[form.listaCantidadCambia.length-1].readOnly = true;
			 		listaPopupCuvCambia[i].style.display = 'none';
			 		//			
				}

				if(arrIndicadorCUVDeseaObligatorio[index] == 'NO' &amp;&amp; codigo != 'T')
				{
					//Desabilitamos la seleccion del cuv y la cantidad del DESEA
			 		form.listaCUVDesea[form.listaCUVDesea.length-1].readOnly = true;
			 		form.listaCantidadDesea[form.listaCantidadDesea.length-1].readOnly = true;
			 		listaPopupCuvDesea[i].style.display = 'none';
			 		form.listaIgualEnvio[form.listaIgualEnvio.length-1].disabled = true;
			 		//
				}
				//
				
			}

			function desbloquearTodo(){
				var form =document.forms[0];
				//form.listaOperacion[form.listaOperacion.length-1].disabled=false;
		 		form.listaCUVCambia[form.listaCUVCambia.length-1].readOnly=false;
		 		form.listaCantidadCambia[form.listaCantidadCambia.length-1].readOnly=false;
		 		//form.listaMotivo[form.listaMotivo.length-1].disabled=false;	
		 		form.listaIgualEnvio[form.listaIgualEnvio.length-1].disabled=false;
		 		form.listaCUVDesea[form.listaCUVDesea.length-1].readOnly=false;
		 		form.listaCantidadDesea[form.listaCantidadDesea.length-1].readOnly=false;
		 		validaCodigoResultado= false;
			}
			
			// Oculta el menu al ingresar al sistema
			function ocultarMenu(){
				try {
				if(top.menuHidden != true){
			  		parent.frames(0).resizeMenu();	  		
			  		//$('numeroCDR').focus();	
			  	}
				}catch(e) {}
			}	

			function borrarExistentes(){
				var form =document.forms[0];
				var cont = 0;
				var selectedItems = document.getElementsByName("selectedItemsDelete");
				if(selectedItems!= null){
					if(selectedItems.length > 0) {
			            for(i = 0; i &lt; selectedItems.length; i++) {
			            	if(form.selectedItemsDelete[i].checked == true)
			             	   cont++;             
			            }
					}    
				}				
				if(cont != 0){
					if (confirm('#{i18n["mensaje.confirm.eliminarDetalles"]}')==false)	
						return false;
					form.action='deleteMantenimientoRECDigitacionCDR.do';
				   	form.submit();
				}		
			}

			function limpiarChecksDelete(){	
				var selectedItems = document.getElementsByName("selectedItemsDelete");
				if(selectedItems!= null){
					if(selectedItems.length > 0) {
			            for(i = 0; i &lt; selectedItems.length; i++) {
			                if(selectedItems[i].type == "checkbox" &amp;&amp; selectedItems[i].checked ) 
			                    selectedItems[i].checked = false;	                
			            }
					}    
				}
			}
			
			function openSearchDocumentosReferenciaPopup(){
			  var f    = document.forms[0];
			  var codigoCliente = $('#codigoClienteDocumentoReferencia').val();
			  
			  var win  = window.open("viewRECDocumentoReferencia.do?codigoCliente="+codigoCliente,"_blank",
			  "dependent=yes,status=no,scrollbars=no,toolbar=no,menubar=no,location=no,directories=no,resizable=no,width=840 height=664,top=100,left=100");
			    f.target = "_self";  
			}

			function openSearchDocumentosReferenciaSTOPopup(){
				var pagina = '#{facesContext.externalContext.requestContextPath}/pages/spusicc/reclamos/busquedaSTODocumentoReferenciaSearchForm.xhtml';
				var nombre = "DocumentosReferenciaSTO";

				  var win  = window.open(pagina, nombre,
				        "dependent=yes,status=0,scrollbars=no,toolbar=0,menubar=0,location=0,directories=0,resizable=0,width=840 height=614,top=50,left=100");
		 	}
			
			function openCodigoVentaPopupCambia(){		
				var form =document.forms[0];		
				var dato=form.listaOperacion[form.listaCUVCambia.length-1].value.split("|");
				var index = $.inArray(dato[0],arrCodigoOperacion);
				if(arrPopupCambia[index]=='P1')
					openCodigoVentaPedidoPopup('listaCUVCambia');
				else	
					openCodigoVentaMatrizPopup('listaCUVCambia');
			}

			function openCodigoVentaPopupDesea(){		
				var form =document.forms[0];
				var dato=form.listaOperacion[form.listaCUVCambia.length-1].value.split("|");
				var index = $.inArray(dato[0],arrCodigoOperacion);
				if(arrPopupDesea[index]=='P1')
					openCodigoVentaPedidoPopup('listaCUVDesea');
				else	
					openCodigoVentaMatrizPopup('listaCUVDesea');
			}

			function openCodigoVentaPedidoPopup(caja){
				var numeroCruce = document.getElementById("numeroCruce");
				var f    = document.forms[0];
				var indice = f.listaCUVCambia.length-1;
				
				numeroCruce.value = $('#numeroBoletaDespacho').val()+'|'+indice+'|'+caja;
				var boton = document.getElementById("botonCodigoVentaPopup:linkAjax");
				boton.click();
		    }

		    function openCodigoVentaMatrizPopup(caja){
		    	var numeroCruce = document.getElementById("numeroCruce");
		    	var f    = document.forms[0];
		    	var indice = f.listaCUVCambia.length-1;

		    	numeroCruce.value = $('#numeroBoletaDespacho').val()+'|'+indice+'|'+caja;
				var boton = document.getElementById("botonCodigoMatrizPopup:linkAjax");
				boton.click();

		    }
		    
			/*function openCodigoVentaPedidoPopup(caja){
				var f    = document.forms[0];
				var indice = f.listaCUVCambia.length-1;
			    var win  = window.open("viewRECCodigoVentaPedido.do?numeroCruce="+$('#numeroBoletaDespacho').val()+'|'+indice+'|'+caja,"_blank",
			    "dependent=yes,status=no,scrollbars=yes,toolbar=no,menubar=no,location=no,directories=no,resizable=no,width=850 height=600,top=100,left=100");
				f.target = "_self";  

		    }
		    function openCodigoVentaMatrizPopup(caja){
		    	var f    = document.forms[0];
		    	var indice = f.listaCUVCambia.length-1;
			    var win  = window.open("viewRECCodigoVentaMatriz.do?numeroCruce="+$('#numeroBoletaDespacho').val()+'|'+indice+'|'+caja,"_blank",
			    "dependent=yes,status=no,scrollbars=yes,toolbar=no,menubar=no,location=no,directories=no,resizable=no,width=840 height=600,top=100,left=100");
				f.target = "_self";  

		    }*/
		     
		    function setearDescPrec(cuv){ 
				//true si tiene error
				//false si no tiene error
				if(onFocusOperacion){
		      		
		      	}else{
		        
		    	var form = document.forms[0]; 
		    	
			 	var codVenta = cuv;
			 	var datoOperacion = form.listaOperacion[form.listaCUVCambia.length-1].value.split("|");
			 	var operacion = datoOperacion[0];
			 	var mensaje = '';
			 	
			 	if(operacion != 'C' &amp;&amp; operacion != 'P'){
						if(arrCodigoVenta.length>0){
			 			for (t=0; t &lt; arrCodigoVenta.length; t++){  
			 				if(arrCodigoVenta[t] == codVenta &amp;&amp; arrOperacion[t]==operacion){
			 					mensaje ="CUV ya fue ingresado en el CDR";
			 					form.listaCUVCambia[form.listaCUVCambia.length-1].value='';
			 					break;
				 				}
				 			}
						}
			 	}
		 				if(mensaje != ''){
		 					alert(mensaje);
		 					
		 				return true;
		 				}else{
		 					
		 					//Aplica un trim
		 			    	cuv =  cuv.replace(/^\s*|\s*$/g,"");   
		 			    	var indice = $.inArray(cuv,arrCuvs);    	   	
		 			    	if(indice != -1){
		 				    	form.listaDescripcionCambia[form.listaCantidadCambia.length-1].value = arrDesc[indice];

		 				 		//if(operacion == 'D')
		 				 		if(operacion != 'T')
		 				 		{
		 					 		if(arrPrecCata[indice] == 0)
		 					 		{
		 					 			form.listaPrecioCambia[form.listaCantidadCambia.length-1].value = arrPrecCata[indice];
		 						 	}
		 					 		else
		 					 		{
		 					 			form.listaPrecioCambia[form.listaCantidadCambia.length-1].value = arrPrec[indice];
		 						 	}
		 					 	}
		 				 		else
		 				 		{
		 				 			form.listaPrecioCambia[form.listaCantidadCambia.length-1].value = arrPrec[indice];
		 					 	}
		 				    	
		 						form.listaIdentSolicPos[form.listaIdentSolicPos.length-1].value=arrPosic[indice];
		 					
		 			    	}
		 			    	else{
		 			    		form.listaDescripcionCambia[form.listaCantidadCambia.length-1].value = '';
		 						form.listaPrecioCambia[form.listaCantidadCambia.length-1].value = '';
		 						form.listaIdentSolicPos[form.listaIdentSolicPos.length-1].value='';
		 			    	}
		 			    	return false;
		 				}
		      		}
		    }

		    function limpiar(){
				var form =document.forms[0];
				var codigoCliente = $('#codigoClienteDocumentoReferencia').val();
				var indicadorPrimerIngreso= document.getElementById("indicadorPrimerIngreso");
				indicadorPrimerIngreso.value = 'S';
				onFocusOperacionInicio = false;
			   	form.submit(); 
		    }

		 	function openSearchHistoricoSolicitudPopup(){
				  var f    = document.forms[0];
				  var pagina = '#{facesContext.externalContext.requestContextPath}/pages/spusicc/reclamos/consultaRECHistoricoSolicitudAprobadosForm.xhtml';
				  var nombre = "consultaRECHistoricoSolicitudAprobados";

				  if(f.codigoConsejera.value != ''){
					  var win  = window.open(pagina, nombre,
				        "dependent=yes,status=0,scrollbars=1,toolbar=0,menubar=0,location=0,directories=0,resizable=0,width=840 height=614,top=50,left=100");
				}   
		 	}	
		 	

			//Ini PER-SiCC-2012-0416 

			function indicadorExpressEstado(){
				if(document.getElementById('indicadorExpress_input').checked){
					return '1';
				}else{
					return '0';
				}
			}

			function setearPeriodoCDR(codigoCliente){
				var indicador = indicadorExpressEstado();
				ajax.getPeriodoCDR(codigoCliente,indicador, loadPeriodoCDRCallBack);
			}

			function loadPeriodoCDRCallBack(data){
				if(data != null) {

					if(data == '0'){
						alert("Error en periodo del Pedido");
					}else{
					$('#periodoCDR').val(data.value);
					//llena variable global			 
					varOidPeriCDR = data.label;
					}
				}	
			}
			
			
			function ejecutarFunciones(variable){
				opcion = variable; // puede ser operacion, cuv, motivo		
				var form =document.forms[0];
				var datoCompuesto=form.listaOperacion[form.listaOperacion.length-1].value;
				var codigoMotivo = form.listaMotivo[form.listaMotivo.length-1].value;
				var indicadorExpress = indicadorExpressEstado();
				var numeroPedido = $('#numeroBoletaDespacho').val();
				var codigoPais = $('#codigoPais').val();
				var usuario = $('#usuario').val();

				if(indicadorOnline == 'S'  &amp;&amp; indicadorValCDRLinea == '1' &amp;&amp; varOidPeriCDR != '' &amp;&amp; (visualizaRechazo == '0' || visualizaRechazo == '2')){
			
					if(onFocusOperacion &amp;&amp; opcion != 1){

						//operaciones
				 		form.listaOperacion[form.listaOperacion.length-1].focus();
					}else if(onFocusMotivo &amp;&amp; opcion != 3){
						//alert("ejecutarFunciones onFocusMotivo "+onFocusMotivo);
						//motivo

						form.listaMotivo[form.listaMotivo.length-1].focus();
					}else{
						//alert(" datoCompuesto "+datoCompuesto+" codigoMotivo "+codigoMotivo+" indicadorExpress "+indicadorExpress);

						ajax.getCodigoOperacionCorrecto(datoCompuesto,codigoMotivo,indicadorExpress, codigoPais,numeroPedido,varOidPeriCDR,usuario, $('#indicadorExcluirValidaciones').val(), loadgetCodigoOperacionCorrectoCallBack);
					}
				}

				bloquearComponentes(form.listaOperacion[form.listaOperacion.length-1]);
			}

			function loadgetCodigoOperacionCorrectoCallBack(data){
				var form =document.forms[0];

				if(data !=null){

				if(data.label != null){
					

					$('#codigoOperacionCorrecto').val(data.label);

				    //llena variable global			 
					varCodOperSICC  = data.label;
				}
				
				if(data.value != null){
					alert(data.value);

						if(opcion == 1){
							//operaciones
					 		form.listaOperacion[form.listaOperacion.length-1].focus();
					 		onFocusOperacion = true;
						}
					}else{
						if(opcion == 1){
							//operaciones
					 		onFocusOperacion = false;
						}
					}
				}
			}

			function verificaExcepcion(idSoliPosi,variable){
				opcion = variable;
				var form =document.forms[0];
				var dato=form.listaOperacion[form.listaCUVCambia.length-1].value.split("|");
				var codigoVenta = form.listaCUVCambia[form.listaCUVCambia.length-1].value;
				var codigoMotivo = form.listaMotivo[form.listaMotivo.length-1].value;
				if(indicadorOnline == 'S'  &amp;&amp; indicadorValCDRLinea == '1' &amp;&amp; (visualizaRechazo == '0' || visualizaRechazo == '2')){
					if(varCodOperSICC != null &amp;&amp; varCodOperSICC != '' &amp;&amp; dato[3] == 'PE' ) {//IND_CAMB_VALI 
						ajax.getValExcepProduGanador(varOidPeriCDR,codigoVenta,varCodOperSICC , dato[1],idSoliPosi, codigoMotivo, $('#codigoPais').val(),$('#indicadorValorAceptaCDR').val(), $('#indicadorExcluirValidaciones').val(), loadMensajeProduCallBack);
					}
				}
			}
			
			function verificaExcepcionDesea(idSoliPosi,variable){
				opcion = variable;
				var form =document.forms[0];			
				var dato=form.listaOperacion[form.listaCUVDesea.length-1].value.split("|");	
				var codigoVenta = form.listaCUVDesea[form.listaCUVDesea.length-1].value;		
				var codigoMotivo = form.listaMotivo[form.listaMotivo.length-1].value;
				var numeroBoletaDespacho = document.getElementById("numeroBoletaDespacho");
					
				if(indicadorOnline == 'S'  &amp;&amp; indicadorValCDRLinea == '1' &amp;&amp; (visualizaRechazo == '0' || visualizaRechazo == '2')){	
					if(varCodOperSICC != null &amp;&amp; varCodOperSICC != '' &amp;&amp; dato[5] != ''  &amp;&amp; dato[5] != null) {//IND_CAMB_VALI 
						ajax.getValExcepProduDesea(campanaCDR, codigoVenta,varCodOperSICC , dato[1],idSoliPosi, codigoMotivo, 
								$('#indicadorExcluirValidaciones').val(), numeroBoletaDespacho.value, loadMensajeDeseaCallBack);
					}
				}
			}

			function getValUnidadReclamo(variable){
				opcion = variable;
				var form =document.forms[0];
				var dato=form.listaOperacion[form.listaCUVCambia.length-1].value.split("|");
				var cantidad = form.listaCantidadCambia[form.listaCantidadCambia.length-1].value;
				
				var idSoliPosi = form.listaIdentSolicPos[form.listaIdentSolicPos.length-1].value;
				var codigoCliente=$('#codigoConsejera').val();
				var codigoPais = $('#codigoPais').val();
				var indCamVali = dato[3];
				var varTipoOperSICC = dato[1];
				var codVenta = form.listaCUVCambia[form.listaCUVCambia.length-1].value;
				var sumCantidad =0;
				//setea cantidad
				unidades = cantidad;
			 	if(arrUnidades.length > 0){
			 		for(i=0; i &lt; arrUnidades.length ; i++){
			 			if(arrCodigoVenta[i] == codVenta){
			 				if(!isBlank(arrUnidades[i]))
								sumCantidad += parseInt(arrUnidades[i]);
			 			}
			 		}
			 	}

			 	if(sumCantidad == 0){
			 		sumCantidad = parseInt(cantidad);
			 	}else{
			 		sumCantidad += parseInt(cantidad);
			 	}

			 	if(indicadorOnline == 'S' &amp;&amp; indicadorValCDRLinea == '1' &amp;&amp; (visualizaRechazo == '0' || visualizaRechazo == '2'))
				{ 
					if(indCamVali == 'PE')
					{ 
						if(cantidad !=null &amp;&amp; cantidad != '' &amp;&amp; idSoliPosi != null &amp;&amp; idSoliPosi != '' ) 
						{	
							return	ajax.getValUnidadReclamo(codigoPais,codigoCliente,idSoliPosi ,sumCantidad, varCodOperSICC, varTipoOperSICC, $('#indicadorExcluirValidaciones').val(), loadMensajeCallBack);
						}
					}
					else
					{
						onFocusCantidad = false;
					}
				}	
				
			}
			
			function getValUnidadDesea(variable){
				opcion = variable;
				var form =document.forms[0];
				var dato=form.listaOperacion[form.listaCUVDesea.length-1].value.split("|");
				var cantidad = form.listaCantidadDesea[form.listaCantidadDesea.length-1].value;
				
				var idSoliPosi = form.listaIdentSolicPos[form.listaIdentSolicPos.length-1].value;
				var codigoCliente=$('#codigoConsejera').val();
				var codigoPais = $('#codigoPais').val();
				var indCamVali = dato[5];
				var varTipoOperSICC = dato[1];
				var codVenta = form.listaCUVDesea[form.listaCUVDesea.length-1].value;
			
				var sumCantidad =0;
				
				if(indicadorOnline == 'S' &amp;&amp; indicadorValCDRLinea == '1' &amp;&amp; (visualizaRechazo == '0' || visualizaRechazo == '2'))
				{
			 		
			 		//setea cantidad
					for(i=0; i &lt; form.listaCUVDesea.length ; i++){
			 			if(form.listaCUVDesea[i].value == codVenta){
			 				if(!isBlank(form.listaCantidadDesea[i].value))
								sumCantidad += parseInt(form.listaCantidadDesea[i].value);
			 			}
			 		}
					
					if(indCamVali != '')
					{
						if(cantidad !=null &amp;&amp; cantidad != '' ) 
						{
							
							return	ajax.getValUnidadDesea(codigoPais,codigoCliente,idSoliPosi ,sumCantidad, varCodOperSICC, varTipoOperSICC, $('#indicadorExcluirValidaciones').val(), loadMensajeDeseaCallBack);
						}
					}
					else
					{
						onFocusCantidad = false;
					}
				}	
				
			}
			

			function loadMensajeCallBack(data){
				var form = document.forms[0];
				if(data != null){
					alert(data);
					if(opcion == 4){
						//operaciones
				 		form.listaCUVCambia[form.listaCUVCambia.length-1].focus();
				 		onFocusCUV = true;
					}else if(opcion == 5){
						//unidades
						form.listaCantidadCambia[form.listaCantidadCambia.length-1].focus();
						onFocusCantidad = true;
					}
				}else{

					if(opcion == 4){
						//operaciones
				 		onFocusCUV = false;
					}else if(opcion == 5){
						//unidades
						//arrUnidades.push(unidades);
						onFocusCantidad = false;
					}
				}

				
			}

			function loadMensajeProduCallBack(data){
				var form = document.forms[0];
				var arrRespuesta = data.split("|");
				data = arrRespuesta[0];
				
				if(data != null &amp;&amp; data != 'null'){
					alert(data);
					if(opcion == 4){
						//operaciones
				 		form.listaCUVCambia[form.listaCUVCambia.length-1].focus();
				 		onFocusCUV = true;
					}else if(opcion == 5){
						//unidades
						form.listaCantidadCambia[form.listaCantidadCambia.length-1].focus();
						onFocusCantidad = true;
					}
				}else{
					if(opcion == 4){
						//operaciones
				 		onFocusCUV = false;
					}else if(opcion == 5){
						//unidades
						//arrUnidades.push(unidades);
						onFocusCantidad = false;
					}
				}
				var reemplazar = arrRespuesta[1];
				var indicadorExcluirValidacionDevolucion= document.getElementById("indicadorExcluirValidacionDevolucion");
				indicadorExcluirValidacionDevolucion.value='N';
				
				if(reemplazar!= 0 )	
				{	
					if(reemplazar == 1)
					{
						indicadorExcluirValidacionDevolucion.value='S';
					}
				}
				
			}
			
			function loadMensajeDeseaCallBack(data){
				var form = document.forms[0];
				form.listaCUVDesea[form.listaCUVDesea.length-1].disabled = false;
				form.listaCantidadDesea[form.listaCantidadDesea.length-1].disabled = false;
				if(data != null){
					alert(data);
					if(opcion == 8){
						//operaciones
				 		//form.listaCUVDesea[form.listaCUVDesea.length-1].focus();
				 		onFocusCUVDesea = true;
						onFocusCantidadDesea = false;
						form.listaCantidadDesea[form.listaCantidadDesea.length-1].disabled = true;
					}else if(opcion == 9){
						//unidades
						//form.listaCantidadDesea[form.listaCantidadDesea.length-1].focus();
						onFocusCUVDesea = false;
						onFocusCantidadDesea = true;
						form.listaCUVDesea[form.listaCUVDesea.length-1].disabled = true;
					}
				}
				else {
					if(opcion == 8){
						form.listaCantidadDesea[form.listaCantidadDesea.length-1].focus();
					}
				}
				onFocusCUV = false;
				onFocusCantidad = false;
			}


			function enfocar(caso){
				
				var form = document.forms[0];
				var indicadorExcluirValidaciones= document.getElementById("indicadorExcluirValidaciones");

				if(indicadorOnline == 'S' &amp;&amp; indicadorValCDRLinea == '1' ){
					////poner foco a la caja q esta con error	

					if(errorValidacionMotivoCdr)
					{
						form.listaMotivo[form.listaMotivo.length-1].focus();
					}
					else if(onFocusOperacion){//1
					//	alert("onFocusOperacion "+onFocusOperacion);
						//operaciones
				 		form.listaOperacion[form.listaOperacion.length-1].focus();

					}else if(onFocusCUV){//4
						if(caso=='1'){
							onFocusCUV = false;
							form.listaOperacion[form.listaOperacion.length-1].focus();
						}else{
						//codigo venta cuv
							form.listaCUVCambia[form.listaCUVCambia.length-1].focus();
						}
					}else if(onFocusCantidad){//5
						//Enfocar hacia atras
						if(caso=='1'){
							onFocusCUV = false;
							form.listaOperacion[form.listaOperacion.length-1].focus();
						}else if(caso == '2'){
							onFocusCUV = false;
							form.listaCUVCambia[form.listaCUVCambia.length-1].focus();
						}else{
							form.listaCantidadCambia[form.listaCantidadCambia.length-1].focus();
						}
				 	}else if(onFocusCUVDesea){
						onFocusCUVDesea = false;
						form.listaCUVDesea[form.listaCUVDesea.length-1].focus();
						return;
				
					}else if(onFocusCantidadDesea){
						onFocusCUVDesea = false;
						onFocusCantidadDesea = false
						form.listaCantidadDesea[form.listaCantidadDesea.length-1].focus();
						return false;
				 	}
				}

				//Verificamos la operacion
				var indiceActual = form.listaOperacion.length-1;
				var dato = form.listaOperacion[indiceActual].value.split("|");   
		      	var operacion = dato[0];

				if(operacion == 'C')
				{	
					if(!isBlank(form.indicadorProductoCambiaIgualDesea.value) &amp;&amp; form.indicadorProductoCambiaIgualDesea.value == '1')
					{
						if(caso == '6' || caso == '7'|| caso == '8' || caso == '9')
						{
							//Mover el Foco segun las condiciones
							if(isBlank(form.listaCUVCambia[indiceActual].value))
							{
								form.listaCUVCambia[indiceActual].focus();
							}
							else
							{
								if(isBlank(form.listaCantidadCambia[indiceActual].value))
								{
									form.listaCantidadCambia[indiceActual].focus();
								}
								else
								{
									if(esEnterEnCantidadProductoCambia)
										form.listaMotivo[indiceActual].focus();
									else
										form.listaCantidadCambia[indiceActual].focus();								
								}
							}
						}
					}
				}
				// agregue RCR-0344
				var index = $.inArray(dato[0],arrCodigoOperacion);
				
				if(arrIndicadorCUVCambiaObligatorio[index] == 'SI' &amp;&amp; dato[0] != 'T'  &amp;&amp; operacion != 'C')
				{
					if(caso == '6')
					{
						if(isBlank(form.listaCUVCambia[indiceActual].value))
						{
							form.listaCUVCambia[indiceActual].focus();
						}						
					}					
				}
			}
			
			//Fin PER-SiCC-2012-0416	
			
			//Inicio PER-SiCC-2012-0642_001
			function inicializaIndicadorRechazo(){
				var indicadorExcluirValidaciones= document.getElementById("indicadorExcluirValidaciones");

				<c:if test='${mAlias.formBusqueda.muestraIndicador eq 1}'>
					if(document.getElementById("indicadorCDRRechazo_input").checked){
						//document.getElementById('codigoMotivoRechazoDef').disabled=false; COMENTADOO
						PF('widget_codigoMotivoRechazoDef').enable();
						document.getElementById('observacionCDR').disabled=false;
						//document.getElementById('codigoMotivoRechazoDef_input').selectedIndex = 1;
						indicadorExcluirValidaciones.value='S';
						onFocusOperacion = false;
						borrarTodo();
						existeFlagRechazo();
						
			     	}else{
			     		//document.getElementById('codigoMotivoRechazoDef').disabled=true; COMENTADOO
			     		PF('widget_codigoMotivoRechazoDef').disable();
			     		document.getElementById('observacionCDR').disabled=true;
						//$('#codigoMotivoRechazoDef_input').val('');
						$('#observacionCDR').val('');
						indicadorExcluirValidaciones.value='N';
						onFocusOperacion = onFocusOperacionInicio;
						borrarTodo();
						existeFlagRechazo();
						
					}
					
				</c:if>	
			}
			//Fin PER-SiCC-2012-0642_001
			
			function existeFlagRechazo(){

				var indicadorMuestra = '#{mAlias.formBusqueda.muestraIndicador}';

				if ( indicadorMuestra == '1'){
					if(document.getElementById("indicadorCDRRechazo_input").checked){
				 		//$('#indicadorCDRRechazo_input').val('1');
				 		visualizaRechazo = 1;
					}else{
			     		//$('#indicadorCDRRechazo_input').val('0');
			     		visualizaRechazo = 2;
					}
					
				}else{
					visualizaRechazo = 0;
				}
			}
			
		  	function deshabilitarTab(evt, obj){
		  		
		  		var keyCode = evt.keyCode ? evt.keyCode : evt.which ? evt.which : evt.charCode;

			 	if(keyCode == 9){
				 	return false;
			 	}
			 	return true;
		  	}
			
			function borrarTodo(){

					var form =document.forms[0];
					var checkelimina = form.selectedItems;
					var codVenta = '';
					var codOper = '';
					var dato='';
					var arrVent = new Array();
					var arrOpe = new Array();
					var arrUni = new Array();
					if(checkelimina.length != null) {
			        	if (checkelimina.length>0) {             	                  
			            	cont = 0;
			            	var long = checkelimina.length;
			                for (t=0; t &lt; long-1; t++){                                         	
			                	                   	      
			                		codVenta = 	form.listaCUVCambia[t+2-cont-1].value;
			                		dato=form.listaOperacion[t+2-cont-1].value.split("|");   
			                  		codOper = dato[0];
			                  		valUni = form.listaCantidadCambia[t+2-cont-1].value;
									//alert("t+2-cont-1 "+(t+2-cont-1)+" codVenta "+codVenta+ " codOper "+codOper);
									arrVent.push(codVenta);
									arrOpe.push(codOper);
									arrUni.push(valUni);
									deleteRow('prodList',t+2-cont);
			                	    cont = cont + 1;
			                   	                   	
			                }
			                eliminarArrays(arrVent,arrOpe,arrUni);
			                for (t=0; t &lt; form.selectedItems.length; t++){
			                	form.selectedItems[t].checked = false;
			                }                                            
			            }
			        }        
			}
			
			function validarOferta(operacion,oidSoliPosi, cantidad){
				voperacion = operacion;
				voidSoliPosi = oidSoliPosi;
				if(operacion == 'D' &amp;&amp; indicadorOnline == 'S' &amp;&amp; indicadorValCDRLinea == '1'){ //descomentar y cambiar a == 'S'
					ajax.ofertaDevolucion(oidSoliPosi,cantidad, validarOfertaCallback);
				}
				else
				{
					var form = document.forms[0];
					var y1 = form.listaMotivo;
					y1[y1.length-1].focus();
				}
			}
			
			function validarOfertaCallback(data){
				
				var form   = document.forms[0];
				var arrRespuesta = data.split("|");
				var muestraOferta = arrRespuesta[0];
				var mensajeError = arrRespuesta[1];
				
				if(!isBlank(mensajeError)){
					alert(mensajeError);
					if(muestraOferta > 0)
					{
						//Error en cantidad
						onFocusCantidad = true;
						openSearchOfertaPopup();
					}
				}else{
					if(muestraOferta == 0)
					{
						//poner foco en listamotivo
						var y1=form.listaMotivo;
						y1[y1.length-1].focus();
					}
					else
					{
						//Validar cada registro de la tabla GTT
						var montoDevolucionActual = calcularMontoDevolucionActual();
						var dato = form.listaOperacion[form.listaCUVCambia.length-1].value.split("|");
						var codigoMotivo = form.listaMotivo[form.listaMotivo.length-1].value;
						var tipoOperacionSic = dato[1];
						
						//Indica donde valida el codigo de venta [PE]:en el pedido [MF]:en la matriz de facturacion [MP]:en la matriz de premios [ ]:no se valida
						//Para este caso debe de ser PE
						var indCamVali = dato[3]; 
						var cantidades = calcularCantidadesPorCUV();
						
						ajax.validarProductosOferta(
							$('#codigoPais').val(),	//UR
							$('#codigoConsejera').val(),	//UR
							cantidades,	//UR
							porcentajeDevolucion, //PD
							montoDevolucionActual, //PD
							montoDevolucion,	//PD
							montoPedido,	//PD
							varOidPeriCDR, //PROD_GANA
							varCodOperSICC, //PROD_GANA 
							tipoOperacionSic,  //PROD_GANA
							indCamVali,  //PROD_GANA
							codigoMotivo, //PROD_GANA
							validarProductosOfertaCallBack);
					}
				}
			}
			
			function validarProductosOfertaCallBack(data)
			{
				if(data == '1') //ERROR
				{
					alert('Oferta no puede ser ingresada.');
					onFocusCantidad = true;
					openSearchOfertaPopup();
				}
				else
				{
					//Salvamos la data en variables globales
					var valoresOferta = data.split("|");

					if(valoresOferta.length > 0)
					{
						valoresOfertaPOSBUSC = valoresOferta[0].split(";");
						valoresOfertaPOSOFER = valoresOferta[1].split(";");				
						valoresOfertaCUV = valoresOferta[2].split(";");  
						valoresOfertaUNI = valoresOferta[3].split(";");
						valoresOfertaDESPRO = valoresOferta[4].split(";");
						valoresOfertaPREPRO = valoresOferta[5].split(";");
					}
						
					var form = document.forms[0];
					var x1 = form.listaMotivo;
					x1[form.listaMotivo.length-1].focus();
					
					agregarFilasOferta = true;
				}
			}
			
			function openSearchOfertaPopup(){
				  var f    = document.forms[0];
				  var pagina = '#{facesContext.externalContext.requestContextPath}/pages/spusicc/reclamos/busquedaRECOfertaSearchForm.xhtml';
				  
				  var w = window.open(pagina,"_blank",
				  "dependent=yes,status=no,scrollbars=no,toolbar=no,menubar=no,location=no,directories=no,resizable=no,width=840 height=664,top=100,left=100");
			} 
			
			function agregarFilasOfertaHTML(){
				
				var listaCamposs = new Array();
				var form = document.forms[0];
				
				//Seteamos el ID del Padre

					var x1 = form.listaIdentFilaPadre;
					var x2 = form.listaIdentFila;
					
					x1[form.listaIdentFilaPadre.length-1].value = valoresOfertaPOSBUSC[0];
					x2[form.listaIdentFila.length-1].value = valoresOfertaPOSBUSC[0];
				//
				
				for(var i=0; i &lt; valoresOfertaPOSBUSC.length-1 ; i++){
					listaCamposs[0] = "&lt;input type='checkbox' class='selectedItemsOferta' style='border: none;' name='selectedItems' id='selectedItems' onKeyDown='return deshabilitarTab(event, this);' value='D'/>";
					listaCamposs[1] = $('#strComboOperacionDeuda').val();
					listaCamposs[2] = "&lt;input type='text' value='" + valoresOfertaCUV[i] + "' style='font-family: Tahoma; font-size: 11px;' size='4' maxlength='5' onkeyup='seteaFocoCUVCambia(this, event);' onchange='completarCUV(this, 1);' onFocus='enfocar(2);' onkeypress='return jsEsNumero(event); ' name='listaCUVCambia' id='listaCUVCambia' onKeyDown='return deshabilitarTab(event, this);'/> &lt;img id='listaPopupCuvCambia' name='listaPopupCuvCambia' src='#{facesContext.externalContext.requestContextPath}/resources/images/lupa_16.png' title='Buscar' style='cursor: pointer; cursor: hand'  onclick='javascript:openCodigoVentaPopupCambia(); return false;' />"	
					listaCamposs[3] = "&lt;input type='text' value='" + valoresOfertaDESPRO[i] + "' size='26' maxlength='30' style='border: 0; background-color: transparent; font-family: Tahoma; font-size: 10px; color: #355A8F' readonly='true' name='listaDescripcionCambia' id='listaDescripcionCambia' onFocus='enfocar(3);' onKeyDown='return deshabilitarTab(event, this);'/>"
					listaCamposs[4] = "&lt;input type='text' value='" + valoresOfertaPREPRO[i] +  "' size='3' maxlength='4' style='border: 0; background-color: transparent; font-family: Tahoma; font-size: 10px; color: #355A8F; text-align:right' readonly='true' name='listaPrecioCambia' id='listaPrecioCambia' onFocus='enfocar(4);' onKeyDown='return deshabilitarTab(event, this);' />"	
					listaCamposs[5] = "&lt;input type='text' value='" + valoresOfertaUNI[i] + "' style='font-family: Tahoma; font-size: 11px;' size='3' maxlength='4' onkeyup='seteaFocoUnidadesCambia(this, event)' onchange='forzarENTER(this);' onFocus='enfocar(5);'  onkeypress='return jsEsNumero(event);' name='listaCantidadCambia' id='listaCantidadCambia' onKeyDown='return deshabilitarTab(event, this);'/>"
					listaCamposs[6] = $('#strComboMotivo').val();
					listaCamposs[7] = "&lt;input type='checkbox' onclick='copiaTexto(this);' onkeyup='seteaFocoIgualEnvio(this, event)' style='border: none;' name='listaIgualEnvio' id='listaIgualEnvio' disabled = 'true'  />";
					listaCamposs[8] = "&lt;input type='text' size='4' maxlength='5' style='font-family: Tahoma; font-size: 11px;' onkeyup='seteaFocoCUVDesea(this, event)' onchange='completarCUV(this, 2);' onkeypress='return jsEsNumero(event); ' name='listaCUVDesea' id='listaCUVDesea' onFocus='enfocar(8);' onKeyDown='return deshabilitarTab(event, this);'/> &lt;img id='listaPopupCuvDesea' name='listaPopupCuvDesea' src='#{facesContext.externalContext.requestContextPath}/resources/images/lupa_16.png' title='Buscar' style='cursor: pointer; cursor: hand' onclick='javascript:openCodigoVentaPopupDesea(); return false;'/>"
					listaCamposs[9] = "&lt;input type='text' size='26' maxlength='30' style='border: 0; background-color: transparent; font-family: Tahoma; font-size: 10px; color: #355A8F' readonly='true' name='listaDescripcionDesea' id='listaDescripcionDesea' onKeyDown='return deshabilitarTab(event, this);'/>"	
					listaCamposs[10] = "&lt;input type='text' size='3' maxlength='4' style='border: 0; background-color: transparent; font-family: Tahoma; font-size: 10px; color: #355A8F; text-align:right' readonly='true' name='listaPrecioDesea' id='listaPrecioDesea' onKeyDown='return deshabilitarTab(event, this);'/>"
					listaCamposs[11] = "&lt;input type='text' size='3' maxlength='4' style='font-family: Tahoma; font-size: 11px;' name='listaCantidadDesea' id='listaCantidadDesea' onkeypress='return jsEsNumero(event); ' onkeyup='agregarDetalle(this,this.value,event,this.parentNode.parentNode.rowIndex);' onFocus='enfocar(9);' onKeyDown='return deshabilitarTab(event, this);'/>"	
					listaCamposs[12]= "&lt;input type='hidden' name='listaIdentSolicPos' id='listaIdentSolicPos' />";

					//TENER CUIDADO AL MODIFICAR ESTAS LINEAS, SOBRE TODO LOS INDICES
					listaCamposs[13]= "&lt;input type='hidden' name='listaIdentFilaPadre' id='listaIdentFilaPadre' value='"+valoresOfertaPOSBUSC[i]+"'/>";
					listaCamposs[14]= "&lt;input type='hidden' name='listaIdentFila' id='listaIdentFila' value='"+valoresOfertaPOSOFER[i]+"'/>";
								
					addRow('prodList',listaCamposs);
					
					form.listaMotivo[posicionMotivo+i+1].value = codigoMotivoGlobal;
					
					desabilitarFilas();
					esEnterEnCantidadProductoCambia = false;
					esEnterEnCantidadProductoCambiaOnChange = false;
					
					unidades = valoresOfertaUNI[i];
					codigoVentaGlobal = valoresOfertaCUV[i];
					
					agregarValorArr();
					
				}
				//adherir 1 vacio
				addRow('prodList',listaCampos);
				desabilitarFilas();
				
				esEnterEnCantidadProductoCambia = false;
				esEnterEnCantidadProductoCambiaOnChange = false;
				
				//Reiniciamos los valores
				valoresOfertaPOSBUSC = new Array();
				valoresOfertaPOSOFER = new Array();				
				valoresOfertaCUV = new Array();
				valoresOfertaUNI = new Array();
				valoresOfertaDESPRO = new Array();
				valoresOfertaPREPRO = new Array();
				codigoMotivoGlobal = '';
				posicionMotivo = 0;
				//
			}
			
			function calcularMontoDevolucionActual()
			{
				var dat;
				var operacionLinea;
				var monto = 0;
				var form = document.forms[0];
				
				for (t=1; t &lt; form.listaCUVCambia.length; t++){
					dat = form.listaOperacion[t].value.split("|"); 
					operacionLinea = dat[0];
					if (operacionLinea == 'D'){
						monto = monto + (form.listaCantidadCambia[t].value * form.listaPrecioCambia[t].value);
					}
		        }
				montoT = monto;
				
				return monto;
			}
			
			function calcularCantidadesPorCUV()
			{
				//Calcula todas las cantidades de todos los CUV' ingresados
				var productosCantidades = new Object();
				var lista = "";
				
				for(i=0; i &lt; arrCodigoVenta.length; i++)
				{
					var cv = arrCodigoVenta[i];
					var pc = productosCantidades[cv];
					
					if(pc == null)
					{
						productosCantidades[cv] = parseInt(arrUnidades[i]);
					}
					else
					{
						pc += parseInt(arrUnidades[i]);
						productosCantidades[cv] = pc;
					}
				}
				
				for(producto in productosCantidades)
				{
					lista = lista + producto + '|' + productosCantidades[producto] + ";";
				}
				
				return lista.substring(0, lista.length-1);
			}

			$(document).on("click", "#prodList .selectedItemsOferta",
				function () {
					//13-padre
					//14-hijo
					var idPadre = this.parentNode.parentNode.children[13].children[0].value;
					
					if(!isBlank(idPadre))
					{
						var form = document.forms[0];
						//Poner check a todos los que tienen el mismo padre
						for(i=1; i &lt; form.listaIdentFilaPadre.length; i++)
						{
							if(form.listaIdentFilaPadre[i].value == idPadre)
							{
								form.selectedItems[i-1].checked = this.checked;
							}
						}
					}
				}
			);	
			
			function calcularMontoTrueque(columna)
			{
				var dat;
				var operacionLinea;
				var monto = 0;
				var form = document.forms[0];
				
				//Cambia
				if(columna == 'CA')
				{
					for (t=1; t &lt; form.listaCUVCambia.length; t++){
						dat = form.listaOperacion[t].value.split("|"); 
						operacionLinea = dat[0];
						if (operacionLinea == 'T'){
							monto = monto + (form.listaCantidadCambia[t].value * form.listaPrecioCambia[t].value);
						}
					}
				}
				else if(columna == 'DE')
				{
					for (t=1; t &lt; form.listaCUVCambia.length; t++){
						dat = form.listaOperacion[t].value.split("|"); 
						operacionLinea = dat[0];
						if (operacionLinea == 'T'){
							monto = monto + (form.listaCantidadDesea[t].value * form.listaPrecioDesea[t].value);
						}
					}
				}
						
				return monto;
			}
			function _CloseOnEsc() 
			{ 
			    if (event.keyCode == 27) 
			    { 
			        window.close(); 
			        return; 
			    } 
			} 

			function InitESC() 
			{ 
			    document.body.onkeypress = _CloseOnEsc; 
			}

			function desabilitarFilas()
			{
				var form = document.forms[0];		
				var listaPopupCuvCambia = document.getElementsByName('listaPopupCuvCambia');
				var listaPopupCuvDesea = document.getElementsByName('listaPopupCuvDesea');

				for(i=0; i &lt; form.listaCUVCambia.length-1; i++)
				{
					form.listaOperacion[i].disabled = true;
					form.listaCUVCambia[i].readOnly = true;
			 		form.listaCantidadCambia[i].readOnly = true;
			 		form.listaMotivo[i].disabled = true;
			 		form.listaIgualEnvio[i].disabled = true;	 		
			 		form.listaCUVDesea[i].readOnly = true;	 		
			 		form.listaCantidadDesea[i].readOnly = true;

			 		listaPopupCuvCambia[i].style.display = 'none';
			 		listaPopupCuvDesea[i].style.display = 'none';
				}
			}

			function completarCUV(txt, tipo)
			{
				txt.value = leftpad(txt.value, '0', 5, ''); 

				var e = jQuery.Event("keypress");
				e.which = 13; 
				e.keyCode = 13;

				if(tipo == '1') //Cambia
				{
					seteaFocoCUVCambia(txt, e);
				}			
				else if(tipo == '2') //Desea
				{
					seteaFocoCUVDesea(txt, e);
				}
			}

			function forzarENTER(txt)
			{
				var e = jQuery.Event("keypress");
				e.which = 13; 
				e.keyCode = 13;

				if(!esEnterEnCantidadProductoCambiaOnChange)
					seteaFocoUnidadesCambia(txt, e)
				
				esEnterEnCantidadProductoCambiaOnChange = false;	
			}
			
			
			//====================== VALIDACIONES GRABAR FINAL - INICIO ==========================
			
			//======== VALIDA COMBO OPERACION - INICIO ========
			function ejecutarFuncionesGrabarFinal(variable, indice){
				opcion = variable; // puede ser operacion, cuv, motivo
				
				var form = document.forms[0];
				var datoCompuesto = form.listaOperacion[indice].value;
				var codigoMotivo = form.listaMotivo[indice].value;
				var indicadorExpress = indicadorExpressEstado();
				var numeroPedido = $('#numeroBoletaDespacho').val();
				var codigoPais = $('#codigoPais').val();
				var usuario = $('#usuario').val();

				if(indicadorOnline == 'S'  &amp;&amp; indicadorValCDRLinea == '1' &amp;&amp; varOidPeriCDR != '' &amp;&amp; (visualizaRechazo == '0' || visualizaRechazo == '2')){		
					ajax.getCodigoOperacionCorrecto(datoCompuesto, codigoMotivo, indicadorExpress, codigoPais, numeroPedido, varOidPeriCDR, usuario, $('#indicadorExcluirValidaciones').val(),
													loadgetCodigoOperacionCorrectoGrabarFinalCallBack);
				}
			}
			
			function loadgetCodigoOperacionCorrectoGrabarFinalCallBack(data){
				var form = document.forms[0];

				if(data != null){
					if(data.label != null){
						$('#codigoOperacionCorrecto').val(data.label);
						//llena variable global			 
						varCodOperSICC = data.label;
					}
					
					if(data.value != null){
						alert(data.value);
						errorValidaGrabarFinal = true;
					}
				}
			}
			//======== VALIDA COMBO OPERACION - FINAL ========
			
			
			function seteaFocoCUVCambiaGrabarFinal(textControl, indice){

					var form =document.forms[0];
					var mensaje = '';

					var datoOperacion = form.listaOperacion[indice].value.split("|");
					var operacion = datoOperacion[0];
		      		
					if(textControl !=null &amp;&amp; textControl != ''){
					 	if(operacion != 'C' &amp;&amp; operacion != 'P'){
					 		if(arrCodigoVenta.length>0){
						 		for (t=0; t &lt; arrCodigoVenta.length; t++){
						 			if(arrCodigoVenta[t] == textControl &amp;&amp; arrOperacion[t]==operacion){
						 				mensaje ="CUV ya fue ingresado en el CDR";
						 				form.listaCUVCambia[indice].value='';
						 				break;
						 			}
						 		}
					 		}
					 	}
					 	
			 			if(mensaje != ''){
			 				alert(mensaje);
			 			}else{
			 				setFocusCUVCambiaGrabarFinal(textControl);
			 			}
			 			          				        	        	        	        
						return false;
					}
				return true;
			}


			//======== VALIDA CUV CAMBIA - INICIO ========
			function setFocusCUVCambiaGrabarFinal(textControl, indice){
				var form = document.forms[0];
				var verex = false;
				//true si tiene error
				//false si no tiene error
				
				//var index = $.inArray(form.listaOperacion[form.listaCUVCambia.length-1].value,arrCodigoOperacion);
				var dato = form.listaOperacion[indice].value.split("|");
				var index = $.inArray(dato[0], arrCodigoOperacion);
				//alert(textControl.value);	
				//Evalua parametro que indica si el CUV es obligatorio o no
				if(arrIndicadorCUVCambiaObligatorio[index] == 'NO' &amp;&amp; dato[0] != 'T'){
					/*x1=form.listaCantidadCambia;
					x1[form.listaCantidadCambia.length-1].focus();*/

					var index2 = $.inArray(textControl,arrCuvs);
					if(index2 != -1){		    
						if(arrDesc[index] != null &amp;&amp; textControl != ''){
							
							form.listaIdentSolicPos[indice].value = arrPosic[index];
							codigoVentaGlobal = form.listaCUVCambia[indice].value;
							codigoOperacionGlobal = dato[0];
							verificaExcepcionGrabarFinal(form.listaIdentSolicPos[indice].value, 4, indice);
							verex = true;
						}
					}
				}else{
					if(textControl == ''){				
						return false;
					}else{
						var index2 = $.inArray(textControl,arrCuvs);
						if(index2 != -1){		    
							if(arrDesc[index2] != null &amp;&amp; textControl != ''){
							form.listaIdentSolicPos[indice].value = arrPosic[index2];
								//validarException
								verificaExcepcionGrabarFinal(form.listaIdentSolicPos[indice].value, 4, indice);
								verex = true;
							}
						}
					}
				}			

				//Evalua el tipo de validacion parametrizada para el tipo de operacion seleccionado
				validacionCambia = arrIndicadorValidacionCUVCambia[index];
				if(arrIndicadorValidacionCUVCambia[index] == ''){
					/*x1=form.listaCantidadCambia;
					x1[form.listaCantidadCambia.length-1].focus();*/
				}else{
					if(arrIndicadorValidacionCUVCambia[index] == 'PE'){
						var index2 = $.inArray(textControl, arrCuvs);
						if(index2 == -1){
							alert('#{i18n["mensaje.codVtaNoExisteCDR"]}');
							form.listaCUVCambia[indice].value = '';
							form.listaDescripcionCambia[indice].value = '';
							form.listaPrecioCambia[indice].value = '';
							form.listaIdentSolicPos[indice].value ='';
						}else{				
							form.listaIdentSolicPos[indice].value = arrPosic[index2];
							codigoVentaGlobal = form.listaCUVCambia[indice].value;
							codigoOperacionGlobal = dato[0];
							if(!verex)
								verificaExcepcionGrabarFinal(form.listaIdentSolicPos[indice].value, 4, indice);
						}
					}else{
						if(arrIndicadorValidacionCUVCambia[index] == 'MF'){
							ajax.validarCUVMatrizPreciosPremios(textControl, '1', $('#numeroBoletaDespacho').val(), loadProductoGrabarFinalCallback);
						}else{
							if(arrIndicadorValidacionCUVCambia[index] == 'MP'){
								ajax.validarCUVMatrizPreciosPremios(textControl, '2', $('#numeroBoletaDespacho').val(), loadProductoGrabarFinalCallback);
							}else{
								if(arrIndicadorValidacionCUVCambia[index] == '-'){
									/*x1=form.listaCantidadCambia;
									x1[form.listaCantidadCambia.length-1].focus();*/
									var index2 = $.inArray(textControl, arrCuvs);
									
									if(index2 != -1){		    
										if(arrDesc[index2] != null &amp;&amp; textControl != ''){
			
											form.listaIdentSolicPos[indice].value = arrPosic[index2];
											codigoVentaGlobal = form.listaCUVCambia[indice].value;
											codigoOperacionGlobal = dato[0] ;

											//validarException
											if(!verex)
												verificaExcepcionGrabarFinal(form.listaIdentSolicPos[indice].value, 4, indice);
										}
									}
								}		
							}
						}
					}
				}
				//VALIDACION GAR
				if(arrIndicadorValidarCentroServicio[index] == 'SI'){
					textCodVenta = textControl;
					//validaCentroServicioGrabarFinal(textControl); 	
				}
				
				//hasta aqui la val de operacion		      
			}

			function verificaExcepcionGrabarFinal(idSoliPosi, variable, indice){
				opcion = variable;
				
				var form = document.forms[0];
				var dato = form.listaOperacion[indice].value.split("|");
				var codigoVenta = form.listaCUVCambia[indice].value;
				var codigoMotivo = form.listaMotivo[indice].value;
				if(indicadorOnline == 'S'  &amp;&amp; indicadorValCDRLinea == '1' &amp;&amp; (visualizaRechazo == '0' || visualizaRechazo == '2')){
					if(varCodOperSICC != null &amp;&amp; varCodOperSICC != '' &amp;&amp; dato[3] == 'PE' ) {//IND_CAMB_VALI 
						ajax.getValExcepProduGanador(varOidPeriCDR, codigoVenta, varCodOperSICC, dato[1], idSoliPosi, codigoMotivo, $('#codigoPais').val(),$('#indicadorValorAceptaCDR').val(), $('#indicadorExcluirValidaciones').val(), loadMensajeGrabarFinalProduCallBack);
					}
				}
			}
			
			function verificaExcepcionMotivoGrabarFinal(idSoliPosi, variable, indice){
				opcion = variable;
				
				var form = document.forms[0];
				var dato = form.listaOperacion[indice].value.split("|");
				var codigoVenta = form.listaCUVCambia[indice].value;
				var codigoMotivo = form.listaMotivo[indice].value;
				if(indicadorOnline == 'S'  &amp;&amp; indicadorValCDRLinea == '1' &amp;&amp; !isBlank(codigoVenta)){
					if((varCodOperSICC != null &amp;&amp; varCodOperSICC != '' &amp;&amp; dato[3] == 'PE') ||
					   (varCodOperSICC != null &amp;&amp; varCodOperSICC != '' &amp;&amp; dato[0] == 'E')  ||
					   (varCodOperSICC != null &amp;&amp; varCodOperSICC != '' &amp;&amp; dato[0] == 'A')) {//IND_CAMB_VALI
						ajax.getValExcepMotivo(varOidPeriCDR, codigoVenta, varCodOperSICC, dato[1], idSoliPosi, codigoMotivo, loadMensajeValExcepMotivoGrabarFinalCallBack);
					}
				}
			}
			
			function verificaExcepcionDeseaFinal(idSoliPosi, variable, indice){
				opcion = variable;
				
				var form = document.forms[0];
				var dato = form.listaOperacion[indice].value.split("|");
				var codigoVenta = form.listaCUVDesea[indice].value;
				var codigoMotivo = form.listaMotivo[indice].value;
				var numeroBoletaDespacho = document.getElementById("numeroBoletaDespacho");
				
				if(indicadorOnline == 'S'  &amp;&amp; indicadorValCDRLinea == '1' &amp;&amp; (visualizaRechazo == '0' || visualizaRechazo == '2')){
					if(varCodOperSICC != null &amp;&amp; varCodOperSICC != '' &amp;&amp; dato[5] != ''  &amp;&amp; dato[5] != null) {//IND_CAMB_VALI 
						ajax.getValExcepProduDesea(campanaCDR, codigoVenta, varCodOperSICC, dato[1], idSoliPosi, codigoMotivo, 
								$('#indicadorExcluirValidaciones').val(), numeroBoletaDespacho.value, loadMensajeGrabarFinalCallBack);
					}
				}
			}

			function loadMensajeGrabarFinalCallBack(data){
				var form = document.forms[0];
				
				if(data != null){
					alert(data);
					errorValidaGrabarFinal = true;
				}
			}

			function loadMensajeGrabarFinalProduCallBack(data){
				var form = document.forms[0];
				var arrRespuesta = data.split("|");
				data = arrRespuesta[0];
				
				if(data != null &amp;&amp; data != 'null'){
					alert(data);
					errorValidaGrabarFinal = true;
				}
				var reemplazar = arrRespuesta[1];
				var indicadorExcluirValidacionDevolucion= document.getElementById("indicadorExcluirValidacionDevolucion");
				var devolucionEspecial= document.getElementById("devolucionEspecial");
				indicadorExcluirValidacionDevolucion.value='N';
				
				if(reemplazar!= 0 )	
				{
					var dato = form.listaOperacion[indiceValidaGrabarFinal].value.split("|");
					if(dato[0]== 'D'){
						form.listaOperacion[indiceValidaGrabarFinal].value = devolucionEspecial.value;
						arrOperacion[indiceValidaGrabarFinal-1] = 'N';
					}	
					if(reemplazar == 1)
					{
						form.listaMotivo[indiceValidaGrabarFinal].value = arrRespuesta[2];
						indicadorExcluirValidacionDevolucion.value='S';
					}
				}
			}

			function loadMensajeValExcepMotivoGrabarFinalCallBack(data){
				if(data != null &amp;&amp; data != 'null'){
					alert(data);
					errorValidaGrabarFinal = true;
				}
			}
			
			function loadProductoGrabarFinalCallback(data){
				var form = document.forms[0];
				
				if(data != null){
					/*x1=form.listaCantidadCambia;
			 		x1[form.listaCantidadCambia.length-1].focus();*/
			 		//form.listaDescripcionCambia[form.listaCantidadCambia.length-1].value = data.label;

			 		//WARN!! No se ha determinado si se hace la validacion por tipoOeracion
			 		//Devolucion, toma CERO si precioCatalogo es CERO y precioFactura en otro caso 
				 	//form.listaPrecioCambia[form.listaCantidadCambia.length-1].value = data.value;

				}else{				 		
					/*form.listaDescripcionCambia[form.listaCUVCambia.length-1].value = '';
			    	form.listaPrecioCambia[form.listaCUVCambia.length-1].value = '';
			    	form.listaCUVCambia[form.listaCUVCambia.length-1].value = '';
			    	form.listaCUVCambia[form.listaCUVCambia.length-1].focus();
			    	onFocusOperacion = false;
					onFocusCUV = true;
					onFocusCantidad = false;*/
					if(validacionCambia == 'PE')alert('#{i18n["mensaje.codVtaNoExiste.pedido"]}');
					if(validacionCambia == 'MF')alert('#{i18n["mensaje.codVtaNoExiste.precios"]}');
					if(validacionCambia == 'MP')alert('#{i18n["mensaje.codVtaNoExiste.premios"]}');

					errorValidaGrabarFinal = true;
				}
			}
			
			/*function validaCentroServicioGrabarFinal(codigoVenta){
				ajax.getIndicadorCentroServicio(codigoVenta, validaCentroServicioGrabarFinalCallback);
			}
			
			function validaCentroServicioGrabarFinalCallback(data){
				var form = document.forms[0];
				
				if(data != null) {
					if (data.value == '1') {
						alert('#{i18n["mensaje.garantiaCentroServicio"]}'+' '+data.label);
				    	form.listaCUVCambia[form.listaCUVCambia.length-1].value = '';
				    	
				 		form.listaDescripcionCambia[form.listaCantidadCambia.length-1].value = '';
				 		form.listaPrecioCambia[form.listaCantidadCambia.length-1].value = '';
				 		form.listaIdentSolicPos[form.listaIdentSolicPos.length-1].value='';
				 		
				 		x1=form.listaCUVCambia;
				 		x1[form.listaCUVCambia.length-1].focus();
					}else{
						var index = $.inArray(textCodVenta,arrCuvs);
						if(index == -1){
							alert('#{i18n["mensaje.codVtaNoExisteCDR"]}');
					    	form.listaCUVCambia[form.listaCUVCambia.length-1].value = '';
					    }else{
							x1=form.listaCantidadCambia;
					 		x1[form.listaCantidadCambia.length-1].focus();
					 		form.listaDescripcionCambia[form.listaCantidadCambia.length-1].value = arrDesc[index];

					 		var dato = form.listaOperacion[form.listaCUVCambia.length-1].value.split("|");			 		
					 		//if(dato[0] == 'D'){
					 		if(dato[0] != 'T'){
						 		if(arrPrecCata[index] == 0){
						 			form.listaPrecioCambia[form.listaCantidadCambia.length-1].value = arrPrecCata[index];
							 	}else{
						 			form.listaPrecioCambia[form.listaCantidadCambia.length-1].value = arrPrec[index];
							 	}
						 	}else{
					 			form.listaPrecioCambia[form.listaCantidadCambia.length-1].value = arrPrec[index];
						 	}
				 			
					 		form.listaIdentSolicPos[form.listaIdentSolicPos.length-1].value=arrPosic[index];
				 		}
					}
				}
			}*/
			//======== VALIDA CUV CAMBIA - FINAL ========
			
			
			//======== VALIDA CANTIDAD CAMBIA - INICIO ========
			function seteaFocoUnidadesCambiaGrabarFinal(textControl, indice){
				//var keyCode = document.layers ? evt.which : document.all ? evt.keyCode : evt.keyCode;
				var form = document.forms[0];
				
				/*if (keyCode != 13) {				
					return true;
		      	}else{*/

		      		esEnterEnCantidadProductoCambiaOnChange = true;
		      		getValUnidadReclamoGrabarFinal(5, indice);

				 	//Si tiene errores
				 	/*if(onFocusCantidad){
		          		return true;
		          	}else{*/
		      			var dato = form.listaOperacion[indice].value.split("|");
		      			var operacion = dato[0];
			      		var camObi = dato[4];
			      		var cantidad = form.listaCantidadCambia[indice].value;
			      		var oidSoliPosi = form.listaIdentSolicPos[indice].value;
						var codigo = form.listaCUVCambia[indice].value;

						if(!isBlank(codigo))
						{
			      			if(trim(camObi) == 'SI' &amp;&amp; (cantidad == '' || parseInt(cantidad) == 0) ){
			      				alert("Cantidad debe ser mayor a cero");
			      				errorValidaGrabarFinal = true; 
			      				return false;
			      			}

			      			if(trim(camObi) == 'NO' &amp;&amp; (cantidad == '' || parseInt(cantidad) == 0) &amp;&amp; operacion == 'T' &amp;&amp; !isBlank(codigo)){
			      				alert("Cantidad debe ser mayor a cero");
			      				errorValidaGrabarFinal = true;      				
			      				return false;
			      			}

			      			esEnterEnCantidadProductoCambia = true;
			      		
							if(operacion !='G' &amp;&amp; operacion !='F' &amp;&amp; operacion !='H' &amp;&amp; operacion !='F3' &amp;&amp; operacion !='F4' &amp;&amp; operacion !='G3' &amp;&amp; operacion !='G4' &amp;&amp; operacion !='XA' &amp;&amp; operacion !='XI' &amp;&amp; operacion !='XM' &amp;&amp; operacion !='XP'){///CAMBIO
				      			if(operacion =='D' &amp;&amp; form.indicadorDevolucionOferta.value == '1'){

					      			// En este caso solo valida el primer registro, los demas que fueron agregados en forma automatica ya no se validan
					      			if(!isBlank(form.listaIdentFila[indice].value) &amp;&amp; !isBlank(form.listaIdentFilaPadre[indice].value) &amp;&amp; (form.listaIdentFila[indice].value == form.listaIdentFilaPadre[indice].value))
				      					validarOfertaGrabarFinal(operacion, oidSoliPosi, cantidad);
			          			}
							}
						}

		      			return false;
		      		//}      	
		      	//}
			}
			
			function getValUnidadReclamoGrabarFinal(variable, indice){
				opcion = variable;
			
				var form = document.forms[0];
				var dato = form.listaOperacion[indice].value.split("|");
				var cantidad = form.listaCantidadCambia[indice].value;
				
				var idSoliPosi = form.listaIdentSolicPos[indice].value;
				var codigoCliente = $('#codigoConsejera').val();
				var codigoPais = $('#codigoPais').val();
				var indCamVali = dato[3];
				var varTipoOperSICC = dato[1];
				var codVenta = form.listaCUVCambia[indice].value;
				var sumCantidad = 0;
				//setea cantidad
				unidades = cantidad;
				
			 	if(arrUnidades.length > 0){
			 		for(i=0; i &lt; arrUnidades.length ; i++){
			 			if(arrCodigoVenta[i] == codVenta){
			 				if(!isBlank(arrUnidades[i]))
								sumCantidad += parseInt(arrUnidades[i]);
			 			}
			 		}
			 	}
		    	if(indicadorOnline == 'S' &amp;&amp; indicadorValCDRLinea == '1' &amp;&amp; (visualizaRechazo == '0' || visualizaRechazo == '2')){
			 		if(indCamVali == 'PE'){
						if(cantidad !=null &amp;&amp; cantidad != '' &amp;&amp; idSoliPosi != null &amp;&amp; idSoliPosi != '' ) {
							return	ajax.getValUnidadReclamo(codigoPais,codigoCliente,idSoliPosi ,sumCantidad, varCodOperSICC, varTipoOperSICC, $('#indicadorExcluirValidaciones').val(), loadMensajeGrabarFinalCallBack);
						}
					}
				}
			}
			
			
			function getValUnidadDeseaGrabarFinal(variable, indice){
				opcion = variable;
				
				var form = document.forms[0];
				var dato = form.listaOperacion[indice].value.split("|");
				var cantidad = form.listaCantidadDesea[indice].value;
				
				var idSoliPosi = form.listaIdentSolicPos[indice].value;
				var codigoCliente = $('#codigoConsejera').val();
				var codigoPais = $('#codigoPais').val();
				var indCamVali = dato[5];
				var varTipoOperSICC = dato[1];
				var codVenta = form.listaCUVDesea[indice].value;
				var sumCantidad = 0;
			
		    	if(indicadorOnline == 'S' &amp;&amp; indicadorValCDRLinea == '1' &amp;&amp; (visualizaRechazo == '0' || visualizaRechazo == '2')){
		    		
		    		//setea cantidad
					for(i=0; i &lt; form.listaCUVDesea.length ; i++){
			 			if(form.listaCUVDesea[i].value == codVenta){
			 				if(!isBlank(form.listaCantidadDesea[i].value))
								sumCantidad += parseInt(form.listaCantidadDesea[i].value);
			 			}
			 		}
			 		if(indCamVali != ''){
						if(cantidad !=null &amp;&amp; cantidad != '' ) {
							return	ajax.getValUnidadDesea(codigoPais,codigoCliente,idSoliPosi ,sumCantidad, varCodOperSICC, varTipoOperSICC, $('#indicadorExcluirValidaciones').val(), loadMensajeGrabarFinalCallBack);
						}
					}
				}
			}


			function validarOfertaGrabarFinal(operacion, oidSoliPosi, cantidad){
				voperacion = operacion;
				voidSoliPosi = oidSoliPosi;
				
				if(operacion == 'D' &amp;&amp; indicadorOnline == 'S' &amp;&amp; indicadorValCDRLinea == '1'){ //descomentar y cambiar a == 'S'
					ajax.ofertaDevolucion(oidSoliPosi, cantidad, validarOfertaGrabarFinalCallback);
				}
			}
			
			function calcularMontoDevolucionActualGrabarFinal(indice){
				var dat;
				var operacionLinea;
				var monto = 0;
				var form = document.forms[0];

				for (t=1; t &lt;= indice; t++){
					dat = form.listaOperacion[t].value.split("|"); 
					operacionLinea = dat[0];
					if (operacionLinea == 'D'){				
						if(!isBlank(form.listaIdentFila[indice].value) &amp;&amp; !isBlank(form.listaIdentFilaPadre[indice].value) &amp;&amp; (form.listaIdentFila[indice].value == form.listaIdentFilaPadre[indice].value))				
							monto = monto + (form.listaCantidadCambia[t].value * form.listaPrecioCambia[t].value);
					}
		        }
				
				montoT = monto;
				
				return monto;
			}
			
			function calcularCantidadesPorCUVGrabarFinal(){
				//Calcula todas las cantidades de todos los CUV' ingresados
				var productosCantidades = new Object();
				var lista = "";
				
				for(i=0; i &lt; arrCodigoVenta.length; i++){
					var cv = arrCodigoVenta[i];
					var pc = productosCantidades[cv];
					
					if(pc == null){
						productosCantidades[cv] = parseInt(arrUnidades[i]);
					}else{
						pc += parseInt(arrUnidades[i]);
						productosCantidades[cv] = pc;
					}
				}
				
				for(producto in productosCantidades){
					lista = lista + producto + '|' + productosCantidades[producto] + ";";
				}
				
				return lista.substring(0, lista.length-1);
			}
			
			function validarOfertaGrabarFinalCallback(data){
				var form   = document.forms[0];
				var arrRespuesta = data.split("|");
				var muestraOferta = arrRespuesta[0];
				var mensajeError = arrRespuesta[1];
				
				if(!isBlank(mensajeError)){
					alert(mensajeError);
					errorValidaGrabarFinal = true;
					/*if(muestraOferta > 0){
						//Error en cantidad
						onFocusCantidad = true;
						openSearchOfertaPopup();
					}*/
				}else{
					if(muestraOferta == 0){
						//poner foco en listamotivo
						/*var y1=form.listaMotivo;
						y1[y1.length-1].focus();*/
					}else{
						//Validar cada registro de la tabla GTT
						var montoDevolucionActual = calcularMontoDevolucionActualGrabarFinal(indiceValidaGrabarFinal);
						var dato = form.listaOperacion[indiceValidaGrabarFinal].value.split("|");
						var codigoMotivo = form.listaMotivo[indiceValidaGrabarFinal].value;
						var tipoOperacionSic = dato[1];
						
						//Indica donde valida el codigo de venta [PE]:en el pedido [MF]:en la matriz de facturacion [MP]:en la matriz de premios [ ]:no se valida
						//Para este caso debe de ser PE
						var indCamVali = dato[3];
						var cantidades = calcularCantidadesPorCUVGrabarFinal();
						
						ajax.validarProductosOferta(
							$('#codigoPais').val(),	//UR
							$('#codigoConsejera').val(),	//UR
							cantidades,	//UR
							porcentajeDevolucion, //PD
							montoDevolucionActual, //PD
							montoDevolucion,	//PD
							montoPedido,	//PD
							varOidPeriCDR, //PROD_GANA
							varCodOperSICC, //PROD_GANA 
							tipoOperacionSic,  //PROD_GANA
							indCamVali,  //PROD_GANA
							codigoMotivo, //PROD_GANA
							validarProductosOfertaGrabarFinalCallBack);
					}
				}
			}
			
			function validarProductosOfertaGrabarFinalCallBack(data){
				if(data == '1'){ //ERROR
					alert('Oferta no puede ser ingresada.');
					errorValidaGrabarFinal = true;
					/*onFocusCantidad = true;
					openSearchOfertaPopup();*/
				}else{
					//Salvamos la data en variables globales
					var valoresOferta = data.split("|");

					if(valoresOferta.length > 0){
						valoresOfertaPOSBUSC = valoresOferta[0].split(";");
						valoresOfertaPOSOFER = valoresOferta[1].split(";");				
						valoresOfertaCUV = valoresOferta[2].split(";");  
						valoresOfertaUNI = valoresOferta[3].split(";");
						valoresOfertaDESPRO = valoresOferta[4].split(";");
						valoresOfertaPREPRO = valoresOferta[5].split(";");
					}
						
					/*var form = document.forms[0];
					var x1 = form.listaMotivo;
					x1[form.listaMotivo.length-1].focus();*/
					
					agregarFilasOferta = true;
				}
			}
			//======== VALIDA CANTIDAD CAMBIA - FINAL ========
			
			
			//======== VALIDA CUV DESEA - INICIO ========
			function setFocusCUVDeseaGrabarFinal(textControl, indice){
				var form = document.forms[0];		
				var datoOperacion = form.listaOperacion[indice].value.split("|");

				var index = $.inArray(datoOperacion[0],arrCodigoOperacion);
				
				//Evalua el tipo de validacion parametrizada para el tipo de operacion seleccionado
				var index2 = $.inArray(textControl,arrCuvs);
				validacionDesea = arrIndicadorValidacionCUVDesea[index];
			
				if(arrIndicadorValidacionCUVDesea[index] == 'PE'){
					if(index2 == -1){
						alert('#{i18n["mensaje.codVtaNoExisteCDR"]}');
				    	form.listaCUVDesea[indice].value = '';
				    }
					else {

						verificaExcepcionMotivoGrabarFinal(form.listaIdentSolicPos[indice].value, 8, indice)

// 						if(!errorValidaGrabarFinal);
// 						verificaExcepcionDeseaFinal(form.listaIdentSolicPos[indice].value, 8, indice);
					}
					
				}else{
					if(arrIndicadorValidacionCUVDesea[index] == 'MF'){
						ajax.validarCUVMatrizPreciosPremios(textControl,'1',$('#numeroBoletaDespacho').val(), loadProductoDeseaGrabarFinalCallback);
					}else{
						if(arrIndicadorValidacionCUVDesea[index] == 'MP'){
							ajax.validarCUVMatrizPreciosPremios(textControl,'2',$('#numeroBoletaDespacho').val(), loadProductoDeseaGrabarFinalCallback);
						}
					}
					
					verificaExcepcionMotivoGrabarFinal(form.listaIdentSolicPos[indice].value, 8, indice)

					if(!errorValidaGrabarFinal);
					verificaExcepcionDeseaFinal(form.listaIdentSolicPos[indice].value, 8, indice);
				}
		    }
			
			function loadProductoDeseaGrabarFinalCallback(data){
				var form = document.forms[0];
				
				var lstPrecio = form.listaPrecioDesea;
				var lstDescri = form.listaDescripcionDesea;
				
				if(data!=null){
					//Ponemos la descripcion
					//lstDescri[indiceValidaGrabarFinal].value = data.label;			
					//

					//Ponemos el precio			
					//lstPrecio[indiceValidaGrabarFinal].value = data.value;
					//
					
					//x1=form.listaCantidadDesea;
			 		//x1[form.listaCantidadDesea.length-1].focus();
				}else{
					/*lstPrecio[form.listaPrecioDesea.length - 1].value = '';
					lstDescri[form.listaDescripcionDesea.length - 1].value = '';
					
			    	form.listaCUVDesea[form.listaCUVDesea.length-1].value = '';
			    	form.listaCUVDesea[form.listaCUVDesea.length-1].focus();*/
					if(validacionDesea == 'PE') alert('#{i18n["mensaje.codVtaNoExiste.pedido"]}');
					if(validacionDesea == 'MF') alert('#{i18n["mensaje.codVtaNoExiste.precios"]}');
					if(validacionDesea == 'MP') alert('#{i18n["mensaje.codVtaNoExiste.premios"]}');
					
					errorValidaGrabarFinal = true;
				}
			}
			//======== VALIDA CUV DESEA - FINAL ========
			
			
			//======== VALIDA CANTIDAD DESEA - INICIO ========
			function agregarDetalleGrabarFinal(valor, indice){
		    	//var keyCode = document.layers ? evt.which : document.all ? evt.keyCode : evt.keyCode;
			 	var form = document.forms[0];
			 	var numPedido = $('#numeroBoletaDespacho').val();
			 	var codigoPaisREC = $('#codigoPais').val();
			 	var codVenta = form.listaCUVDesea[indice].value;

			 	//if(keyCode == 13){
					//Validamos si es que la cantidad es obligatoria
			 		var dato = form.listaOperacion[indice].value.split("|");			
					var index = $.inArray(dato[0], arrCodigoOperacion);
							
					//Evalua parametro que indica si el CUV es obligatorio o no
		      		if(trim(arrIndicadorCUVDeseaObligatorio[index]) == 'SI' &amp;&amp; (isBlank(valor) || parseInt(valor) == 0) ){
		      			alert("Cantidad debe ser mayor a cero");
						return false;
					}else{
						getValUnidadDeseaGrabarFinal(9, indice);
						ajax.getSaldoProducto(numPedido, codVenta, codigoPaisREC, validaSaldoProductoGrabarFinalCallBack);	
						
					}
			 	//}
		  	}
			
		  	/*function agregarValorArrGrabarFinal(){
		  		arrUnidades.push(unidades);
		 		arrCodigoVenta.push(codigoVentaGlobal);
				arrOperacion.push(codigoOperacionGlobal);
		  	}*/
		  	
		  	function validaSaldoProductoGrabarFinalCallBack(data){
				var form = document.forms[0];
			 	var indicadorOnline = $('#indicadorOnline').val();

			 	/*if(indicadorOnline == 'S'){
			 		if(data &lt;= 0){
						if(confirm('#{i18n["mantenimientoRECDigitacionCDRForm.message.listaSTO"]}')==false)
							return false;
					}
				}*/

				var codigo = form.listaCUVCambia[indiceValidaGrabarFinal].value;
				
		 		if(!isBlank(codigo)){
			 		/*//form.listaOperacion[form.listaOperacion.length-1].disabled=true;
			 		form.listaCUVCambia[indiceValidaGrabarFinal].readOnly=true;
			 		form.listaCantidadCambia[indiceValidaGrabarFinal].readOnly=true;
			 		form.listaIgualEnvio[indiceValidaGrabarFinal].disabled=true;
			 		//form.listaMotivo[form.listaMotivo.length-1].disabled=true;		 		
			 		form.listaCUVDesea[indiceValidaGrabarFinal].readOnly=true;
			 		form.listaCantidadDesea[indiceValidaGrabarFinal].readOnly=true;*/

			 		if(validarMontoDevolucionGrabarFinal(indiceValidaGrabarFinal)){
						//addRow('prodList',listaCampos);
						//desabilitarFilas();
						esEnterEnCantidadProductoCambia = false;
						esEnterEnCantidadProductoCambiaOnChange = false;
						//ejecutarFunciones(1); PENDIENTE
			 		}else{
			 			form.listaCUVCambia[indiceValidaGrabarFinal].readOnly=false;
			 			form.listaCUVCambia[indiceValidaGrabarFinal].value='';
			 			
				 		form.listaCantidadCambia[indiceValidaGrabarFinal].readOnly=false;
				 		form.listaCantidadCambia[indiceValidaGrabarFinal].value='';
				 		
				 		form.listaIgualEnvio[indiceValidaGrabarFinal].disabled=false;
				 		form.listaIgualEnvio[indiceValidaGrabarFinal].checked=false;
				 					 		 		
				 		form.listaCUVDesea[indiceValidaGrabarFinal].readOnly=false;
				 		form.listaCUVDesea[indiceValidaGrabarFinal].value='';
				 		
				 		form.listaCantidadDesea[indiceValidaGrabarFinal].readOnly=false;
				 		form.listaCantidadDesea[indiceValidaGrabarFinal].value='';

				 		form.listaDescripcionCambia[indiceValidaGrabarFinal].value='';
				 		form.listaPrecioCambia[indiceValidaGrabarFinal].value='';

				 		form.listaIdentSolicPos[indiceValidaGrabarFinal].value='';
				 		
				 		alert('#{i18n["message.supera.porcentaje"]}'+ ' ' + porcentajeDevolucion +'%  (Total Pedido :  ' + montoPedido + ' Total Devoluciones :  ' + montoDevolucion + ') '       );
			 		}	 									
		 		}else{
		 			//-----
			 		//var index = $.inArray(form.listaOperacion[form.listaCUVCambia.length-1].value,arrCodigoOperacion);
			 		var dato=form.listaOperacion[indiceValidaGrabarFinal].value.split("|");
					var index = $.inArray(dato[0],arrCodigoOperacion);
					//Evalua parametro que indica si el CUV es obligatorio o no
					if(arrIndicadorCUVCambiaObligatorio[index] == 'NO' || (arrIndicadorCUVCambiaObligatorio[index] == 'SI' &amp;&amp; dato[0] == 'T')){
						
						if(validarMontoDevolucionGrabarFinal(indiceValidaGrabarFinal)){
							//addRow('prodList',listaCampos);
							//desabilitarFilas();
							esEnterEnCantidadProductoCambia = false;
							esEnterEnCantidadProductoCambiaOnChange = false;
							//ejecutarFunciones(1); PENDIENTE
						}else{
				 			form.listaCUVCambia[indiceValidaGrabarFinal].readOnly=false;
				 			form.listaCUVCambia[indiceValidaGrabarFinal].value='';
				 			
					 		form.listaCantidadCambia[indiceValidaGrabarFinal].readOnly=false;
					 		form.listaCantidadCambia[indiceValidaGrabarFinal].value='';
					 		
					 		form.listaIgualEnvio[indiceValidaGrabarFinal].disabled=false;
					 		form.listaIgualEnvio[indiceValidaGrabarFinal].checked=false;
					 					 		 		
					 		form.listaCUVDesea[indiceValidaGrabarFinal].readOnly=false;
					 		form.listaCUVDesea[indiceValidaGrabarFinal].value='';
					 		
					 		form.listaCantidadDesea[indiceValidaGrabarFinal].readOnly=false;
					 		form.listaCantidadDesea[indiceValidaGrabarFinal].value='';

					 		form.listaDescripcionCambia[indiceValidaGrabarFinal].value='';
					 		form.listaPrecioCambia[indiceValidaGrabarFinal].value='';

					 		form.listaIdentSolicPos[indiceValidaGrabarFinal].value='';	
					 		
					 		alert('#{i18n["message.supera.porcentaje"]}'+ ' ' + porcentajeDevolucion +'%  (Total Pedido :  ' + montoPedido + ' Total Devoluciones :  ' + montoDevolucion + ') '       );
				 		}	 
					}
			 		//-----
		 		}
		 		
		 		/*x1=form.listaOperacion;
		 		x1[form.listaOperacion.length-1].focus();*/
		  	}
		  	
		  	function validarMontoDevolucionGrabarFinal(indice){
				var indicadorOnline = '#{mAlias.formBusqueda.indicadorOnline}';

				//Solo aplica la logica para la pantalla de callcenter
				if (indicadorOnline != 'S')
					return true;
				//Solo aplica la logica si esta encendido el indicador
				if ($('#indicadorValidaDevolucion').val() == '0')
					return true;
				//alert('va a validar');
				var form =document.forms[0];
				var dato=form.listaOperacion[indice].value.split("|");   
		  		var operacion = dato[0]; 
				//var operacion=form.listaOperacion[form.listaOperacion.length-1].value;

				//Solo se realiza la validacion si la opercacione es de devolucion
				if (operacion != 'D')
					return true;

				var monto = calcularMontoDevolucionActualGrabarFinal(indice);
				var aux = ((monto + montoDevolucion)/montoPedido)*100;
				
				if (aux > porcentajeDevolucion)
					return false;
				else
					return true;
			}	
		  
			//======== VALIDA CANTIDAD DESEA - FINAL ========
		
			//====================== VALIDACIONES GRABAR FINAL - FINAL ==========================
		  	function keyDownOperacion(evt, obj){
		  		
		  		var keyCode = evt.keyCode ? evt.keyCode : evt.which ? evt.which : evt.charCode;

			 	if(keyCode == 9){
				 	return false;
			 	}

			 	return esEnterOperacion(evt, obj);
		  	}

			function keyDownMotivo(obj, evt){
		  		
		  		var keyCode = evt.keyCode ? evt.keyCode : evt.which ? evt.which : evt.charCode;

			 	if(keyCode == 9){
				 	return false;
			 	}

			 	return esEnterMotivo(obj, evt);
		  	}
		  	
		  	function addRow(idTabla,listaCampos){   
		  		var tblBody = document.getElementById(idTabla).tBodies[0];
		  		var newRow = tblBody.insertRow(-1);
		  		for(i=0; i &lt; listaCampos.length;i++){
		  			var newCell = newRow.insertCell(i);
		  			newCell.innerHTML = listaCampos[i];
		  		}
		  	}

		  	function deleteRow(idTabla,i){
		  	    document.getElementById(idTabla).deleteRow(i)
		  	}

		  	function trim(str) { 
		  	    if (str != null) {
		  	        var i; 
		  	        for (i=0; i &lt; str.length; i++) {
		  	            if (str.charAt(i)!=" ") {
		  	                str=str.substring(i,str.length); 
		  	                break;
		  	            } 
		  	        } 
		  	    
		  	        for (i=str.length-1; i>=0; i--) {
		  	            if (str.charAt(i)!=" ") {
		  	                str=str.substring(0,i+1); 
		  	                break;
		  	            } 
		  	        } 
		  	        
		  	        if (str.charAt(0)==" ") {
		  	            return ""; 
		  	        } else {
		  	            return str; 
		  	        }
		  	    }
		  	}

		  	function isBlank(val){
		  		if(val==null){return true;}
		  		for(var i=0;i &lt; val.length;i++) {
		  			if ((val.charAt(i)!=' ')&amp;&amp;(val.charAt(i)!="\t")&amp;&amp;(val.charAt(i)!="\n")&amp;&amp;(val.charAt(i)!="\r")){return false;}
		  			}
		  		return true;
		  	}

		  	function leftpad(theItem, thePad, minSize, thePrefix) {
		  		newItem = new String(theItem);
		  		if(newItem.length > 0) {
		  			newPrefix = new String(thePrefix);
		  			
		  			if(newItem.length &lt; minSize) {
		  				if(newPrefix.length > 0) {
		  					minSize = minSize - newPrefix.length
		  				}
		  				while (newItem.length &lt; minSize) {
		  			        newItem = thePad + newItem;
		  			    }
		  			    newItem = newPrefix + newItem;
		  			}
		  		}
		  	    return newItem;
		  	}

		     function validateMantenimientoRECDigitacionCDRForm(form) {          
			     var codigoPais = document.getElementById("codigoPais");  
			     var numeroCDR = document.getElementById("numeroCDR"); 
			     var numeroBoletaDespacho = document.getElementById("numeroBoletaDespacho"); 
			     var codigoConsejera = document.getElementById("codigoConsejera"); 
			     var periodo = document.getElementById("periodo"); 

				 if(codigoPais.value == '') {
					 alert("'Pais' es un campo requerido.");
					 codigoPais.focus();
					 return false;
				 }

				 if(numeroCDR.value == '') {
					 alert("'Numero de CDR' es un campo requerido.");
					 numeroCDR.focus();
					 return false;
				 }

				 if(numeroBoletaDespacho.value == '') {
					 alert("'Nº Pedido' es un campo requerido.");
					 numeroBoletaDespacho.focus();
					 return false;
				 }

				 if(codigoConsejera.value == '') {
					 alert("'Codigo consejera' es un campo requerido.");
					 codigoConsejera.focus();
					 return false;
				 }

				 if(periodo.value == '') {
					 alert("'Periodo' es un campo requerido.");
					 periodo.focus();
					 return false;
				 }

				 return true;
		     } 

		     function obtenerStringLista(nombre) {
		    	 var elementos = document.getElementsByName(nombre);
		    	 
		    	  var texto = "";
		    	 
		    	  for (x=0;x &lt; elementos.length;x++) {
			    	  if(x==0)
		    	    	texto = elementos[x].value;
			    	  else
				    	texto = texto + "__" + elementos[x].value;
		    	  }
		    	  
		    	  return texto;  
			 }

		     function confirmFunction(){
			        if(!confirm("Are you sure you want to login?"))
			            return false;
			        return true;
			    }	

		     $(window).load(function() {
					inicializa();
					existeFlagRechazo();
					inicializaIndicadorRechazo();
		    	});   

		</script>
		</ui:define>

	</ui:composition>
</body>
</html>