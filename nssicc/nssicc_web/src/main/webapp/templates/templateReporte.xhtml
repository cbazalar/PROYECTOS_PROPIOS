<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:h="http://java.sun.com/jsf/html" 
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"      
      xmlns:p="http://primefaces.org/ui"  
      xmlns:pe="http://primefaces.org/ui/extensions"    
      xmlns:ssicc="http://java.sun.com/jsf/composite/componentes/ssicc"
      >

<body>
<ui:composition template="/templates/templateBodyCenter.xhtml">
  	 
  <ui:define name="icono_Pantalla"> 
		<p:graphicImage value="#{resource['images:report-icon3.png']}" width="40" height="40" style="border:0px; vertical-align:top;" /> 
		
  </ui:define>
  
  <!-- Botones de la Pantalla Superior Principal -->
  <ui:define name="body_toolbar_principal">

      <f:facet name="left" >  
            <c:if test="${mAlias.mostrarBotonBuscar}">
                  <span class="ui-separator">
	                <span class="ui-icon ui-icon-grip-dotted-vertical" />
	              </span>
		          <ssicc:linkBuscarAjax id="idBuscarMantenimientoSeach"
				            manage="#{mAlias}" 
				            limpiarDatatable = "#{mAlias.limpiarFindDatatable}"
			        		update=":principalForm:listaBusquedaForm, :principalForm:panelFiltroReporte, 
			        				:principalForm:mensajesGrowl"
			        		 />   
			      
            </c:if>

            <span class="ui-separator">
	                <span class="ui-icon ui-icon-grip-dotted-vertical" />
	        </span>
	    	<ssicc:linkGenerarReportePDFAjax manage="#{mAlias}" 
	    	    update=":principalForm:idReporteEnEjecucion, :principalForm:idFormatoExportacion, :principalForm:idValidacionPrevia, 
				        :principalForm:panelFiltroReporte, :principalForm:panelReportePDFMedia, 
				        :principalForm:panelReportesMailEjecutado" 
				onclick="setFormatoExportPDF();"   />            		
				                
			<ssicc:linkGenerarReporteXLSAjax manage="#{mAlias}" 
			    update=":principalForm:idReporteEnEjecucion, 
			            :principalForm:idFormatoExportacion, :principalForm:idValidacionPrevia, 
				        :principalForm:panelFiltroReporte, :principalForm:panelReportePDFMedia,
				        :principalForm:panelReportesMailEjecutado" 
				onclick="setFormatoExportXLS();"   />
				
			<ssicc:linkGenerarReporteXLSXAjax manage="#{mAlias}" 
			    update=":principalForm:idReporteEnEjecucion, 
			            :principalForm:idFormatoExportacion, :principalForm:idValidacionPrevia, 
				        :principalForm:panelFiltroReporte, :principalForm:panelReportePDFMedia,
				        :principalForm:panelReportesMailEjecutado" 
				onclick="setFormatoExportXLSX();"   />
			
			<ssicc:linkGenerarReporteCSVAjax manage="#{mAlias}" 
                update=":principalForm:idReporteEnEjecucion, 
                        :principalForm:idFormatoExportacion, :principalForm:idValidacionPrevia, 
				        :principalForm:panelFiltroReporte, :principalForm:panelReportePDFMedia,
				        :principalForm:panelReportesMailEjecutado"	
				onclick="setFormatoExportCSV();"  />   
							
		    <ssicc:linkGenerarReporteOCSVAjax manage="#{mAlias}" 
		         update=":principalForm:idReporteEnEjecucion, :principalForm:idFormatoExportacion, 
		                 :principalForm:idValidacionPrevia, 
				         :principalForm:panelFiltroReporte, :principalForm:panelReportePDFMedia,
				         :principalForm:panelReportesMailEjecutado"	
				 onclick="setFormatoExportOCSV();"   />   
			
			<ssicc:linkGenerarReporteOTXTAjax manage="#{mAlias}" 
			    update=":principalForm:idReporteEnEjecucion, 
			            :principalForm:idFormatoExportacion, :principalForm:idValidacionPrevia, 
				        :principalForm:panelFiltroReporte, :principalForm:panelReportePDFMedia,
				        :principalForm:panelReportesMailEjecutado" 
				onclick="setFormatoExportOTXT();"   />
			
			<ssicc:linkGenerarReporteOJXLSXAjax manage="#{mAlias}" 
			     update=":principalForm:idReporteEnEjecucion, 
			             :principalForm:idFormatoExportacion, :principalForm:idValidacionPrevia, 
				         :principalForm:panelFiltroReporte, :principalForm:panelReportePDFMedia,
				         :principalForm:panelReportesMailEjecutado"	
				 onclick="setFormatoExportOJXLSX();"   />
			
			<ssicc:linkGenerarReporteZIPAjax manage="#{mAlias}" 
                update=":principalForm:idReporteEnEjecucion, 
                        :principalForm:idFormatoExportacion, :principalForm:idValidacionPrevia, 
				        :principalForm:panelFiltroReporte, :principalForm:panelReportePDFMedia,
				        :principalForm:panelReportesMailEjecutado"	
				onclick="setFormatoExportZIP();"  />   
							
		    <ssicc:linkGenerarReporteOZIPAjax manage="#{mAlias}" 
		         update=":principalForm:idReporteEnEjecucion, :principalForm:idFormatoExportacion, 
		                 :principalForm:idValidacionPrevia, 
				         :principalForm:panelFiltroReporte, :principalForm:panelReportePDFMedia,
				         :principalForm:panelReportesMailEjecutado"	
				 onclick="setFormatoExportOZIP();"   />   
			
			
			<ssicc:linkGenerarReporteOOXLSXAjax manage="#{mAlias}" 
			     update=":principalForm:idReporteEnEjecucion, 
			             :principalForm:idFormatoExportacion, :principalForm:idValidacionPrevia, 
				         :principalForm:panelFiltroReporte, :principalForm:panelReportePDFMedia,
				         :principalForm:panelReportesMailEjecutado"	
				 onclick="setFormatoExportOOXLSX();"   />
				 
			<ssicc:linkEnviarReporteMailAjax id="idLinkEnviarReporteMailAjax" 
									manage="#{mAlias}" 
									update=":principalForm:idReporteEnEjecucion, 
											:principalForm:idFormatoExportacion, 
											:principalForm:idValidacionPrevia, 
											:principalForm:panelFiltroReporte,
											:principalForm:panelReportePDFMedia,
											:principalForm:panelReportesMailEjecutado"	
									onclick="setFormatoExportPDF();"   />
			
			<ssicc:linkReporteExecuteMailXLSAjax id="idlinkReporteExecuteMailXLSAjax"
												icon="#{mAlias.iconPersonalExcel}"
												manage="#{mAlias}" 
												update=":principalForm:idReporteEnEjecucion, 
														:principalForm:idFormatoExportacion, 
														:principalForm:idValidacionPrevia,
														:principalForm:panelFiltroReporte,
														:principalForm:panelReportePDFMedia,
														:principalForm:panelReportesMailEjecutado"	
												onclick="setFormatoExportXLS();" />
												
			<ssicc:linkReporteExecuteMailPDFAjax id="idlinkReporteExecuteMailPDFAjax"
												icon="#{mAlias.iconPersonalPdf}"
												manage="#{mAlias}" 
												update=":principalForm:idReporteEnEjecucion, 
														:principalForm:idFormatoExportacion, 
														:principalForm:idValidacionPrevia,
														:principalForm:panelFiltroReporte,
														:principalForm:panelReportePDFMedia,
														:principalForm:panelReportesMailEjecutado"	
												onclick="setFormatoExportPDF();" />
	        <ui:insert name="body_toolbar_adicionales">
										 
			</ui:insert>
			<ssicc:linkLimpiar
					manage="#{mAlias}" 
					visible="#{mAlias.mostrarBotonLimpiar}" />
	        				
            
            <ssicc:linkAuditoriaAjax manage="#{mAlias}" visible="false"/> 
            <ssicc:linkAgregarFavoritos manage="#{mAlias}" visible="false"/>  
        </f:facet>  
    
  </ui:define>
  
  <ui:define name="body_cabecera_fija">
  
		<!-- Panel con los Criterios de Busqueda --> 
		<c:if test="${mAlias.mostrarCabeceraFija}">
			<br/> 
			<!-- Panel con los Criterios de Busqueda -->  
			<p:panelGrid id="panelFiltroReporte" columns="1"  widgetVar="panelFiltroReporte">
			     <f:facet name="header">  
			        <ssicc:cabeceraFieldset value="#{msg['sistema.filtros.reporte']}" icon="#{resource['images:buscar_on.png']}" />
			        &nbsp;
			        <c:if test="${mAlias.mostrarBotonBuscar}">
			   	        <ssicc:linkBuscarAjax id="idBuscarMantenimientoSeach"
						            manage="#{mAlias}" 
						            update=":principalForm:listaBusquedaForm, 
						            		:principalForm:panelFiltroReporte, 
					        				:principalForm:mensajesGrowl"/> 
					
				    </c:if>				 
		         </f:facet> 
			     
			     <h:panelGrid columns="1"> 
			  	 	 <ui:insert name="body_filtro_reporte">
			
								 
					 </ui:insert>
			     </h:panelGrid>
				 
			</p:panelGrid>
			
			<h:outputScript>
   					activarEnterCriteriosBusqueda('idBuscarMantenimientoSeach:linkBuscarAjax:linkAjax');
		    </h:outputScript>
		 </c:if>
							  		
  </ui:define> 
  
  <ui:define name="body_center">     
  

   
    <c:if test="${not mAlias.mostrarCabeceraFija}">
		<!-- Panel con los Criterios de Busqueda -->  
		<p:panel id="panelFiltroReporte" toggleable="true" toggleSpeed="300" widgetVar="panelFiltroReporte">
			     <f:facet name="header">  
			        <ssicc:cabeceraFieldset value="#{msg['sistema.filtros.reporte']}" icon="#{resource['images:buscar_on.png']}" />
			        &nbsp;
	             </f:facet> 
			     <br/><br/><br/>	 
			     <h:panelGrid columns="1"> 
			  	 	 <ui:insert name="body_filtro_reporte">
			
								 
					 </ui:insert>
			     </h:panelGrid>
				 
				 <h:outputScript>
   					activarEnterCriteriosBusqueda('idBuscarMantenimientoSeach:linkBuscarAjax:linkAjax');
		        </h:outputScript>
		 </p:panel>
		 
		 
	</c:if>
	<c:if test="${mAlias.mostrarListaBusqueda}">
	   <br/>
    </c:if>
    <p:panelGrid id="listaBusquedaForm" rendered="#{mAlias.mostrarListaBusqueda}" columns="1" style="width:100%">	
           
           <ssicc:dataTable id="dataTableBusqueda" 
		          toggleable = "false"
		          draggableColumns = "true"
		          exportable="#{mAlias.exportarDataTableBusqueda}"
		          titulo="#{msg['dataTable.resultadoBusqueda']}"
		          value="#{mAlias.datatableBusqueda}"
		          fileExport="dataBusqueda"
		          width="98%"
		          mostrarNroFila="true"
		          rows = "#{mAlias.cantidadRowsDefaultDatatable}"
		          rendered="#{not empty mAlias.listaBusqueda}"
		          resizableColumns="true" 
		          seleccionable = "false">
		          
				  <ui:insert name="body_columna_datatable_busqueda">
									 
				  </ui:insert>
		   </ssicc:dataTable>
    </p:panelGrid>
	
	
    <h:panelGroup id="panelReportePDFMedia">    		
		<c:if test="#{mAlias.viewReporteMedia}">
		  <c:if test="#{not empty mAlias.outfileMedia}">
			<br/>
	    	<p:panelGrid id="panelReporte" columns="1" style="width:100%">
		    	<f:facet name="header">  
		        	<ssicc:cabeceraFieldset value="#{msg['sistema.reporte.view.media.title']}"  icon="#{resource['images:report_icon.png']}"/>  
		        	&nbsp;
		        	<ssicc:linkAumentarSizeAjax manage="#{mAlias}" update=":principalForm:panelReportePDFMedia" />         
				    <ssicc:linkReducirSizeAjax manage="#{mAlias}" update=":principalForm:panelReportePDFMedia" />  
				    &nbsp;
				  
				    <h:outputLink  
				       styleClass="clsBotonLink2"
                       value="#{request.contextPath}/javax.faces.resource/documentviewer/viewer.html.jsf?ln=primefaces-extensions&amp;v=3.0.0-SNAPSHOT&amp;file=#{pe:encodeURL(request.contextPath)}%2F#{mAlias.outfileMedia}"  
                       target="_blank">  
				        
				        <p:graphicImage 
				                 value="/resources/images/ipForm.png" 
				                 width="28" height="28" 
				                 title="Pantalla Completa"
					             styleClass="clsImagenLink"  
					             style="vertical-align:middle"/>
				        
				    </h:outputLink>      		
		     	</f:facet>		    
		     	<pe:documentViewer id="idPdfMedia"  height="#{mAlias.sizeReport}"  locale="es" url="#{mAlias.outfileMedia}"/> 
		  	</p:panelGrid>
    	   </c:if>
    	</c:if>
    </h:panelGroup>	
    
	
	<h:panelGroup id="panelReportesMailEjecutado">
	     
		<p:panel id="idPanelGridLisReporLog" rendered ="#{mAlias.viewListaEnviadosMail}"  columns="1" style="width:100%" toggleable="true" toggleSpeed="300" >	
		   <f:facet name="header">  
		        	<ssicc:cabeceraFieldset value="Log de Mail Enviados"  icon="#{resource['images:report_icon.png']}"/>  
		   </f:facet>    
		   <br/><br/><br/>
           <p:dataTable id="dataTableLog" 
		          var = "lista"
		          rowIndexVar = "rowIndex"
		          draggableColumns = "true"
		          value="#{mAlias.listaReportesMail}"
		          width="98%"
		          emptyMessage="#{msg['dataTable.noExistenRegistrosFiltro']}"
		          rendered="#{not empty mAlias.listaReportesMail}"
		          resizableColumns="true" >
		          
		         <p:column width="10" >  
			         <f:facet name="header">
		            		<h:outputText value="Nro" />
		             </f:facet>     
			         <h:outputText value="#{rowIndex + 1}" />              
			     </p:column>

		         <p:column width="80" style="text-align:center;"> 
		            <f:facet name="header">
		               <h:outputText value="#{msg['reportesEnviados.mail.lista.reporte.nombre']}" />
		            </f:facet> 
		            <h:outputText value="#{lista.nombreReporte}" />  
		        </p:column> 
			      
		        <p:column width="60" > 
		            <f:facet name="header">
		               <h:outputText value="#{msg['reportesEnviados.mail.lista.reporte.valorFiltro']}" />
		            </f:facet> 
		            <h:outputText value="#{lista.valorFiltro}" />  
		        </p:column>  

		        <p:column width="250" > 
		            <f:facet name="header">
		               <h:outputText value="#{msg['reportesEnviados.mail.lista.reporte.descripcion']}" />
		            </f:facet> 
		            <h:outputText value="#{lista.descripcionLog}" />  
		        </p:column> 
		        
		        <p:column width="30" style="text-align:center;"> 
				        	<f:facet name="header">
				               <h:outputText value="#{msg['reportesEnviados.mail.lista.reporte.estado']}" />
				            </f:facet> 	
				      <p:graphicImage value="#{resource['images:yes.gif']}" 
		                          style="border:0px; vertical-align:middle;" rendered="#{lista.indicadorLog eq '0'}"/>
		              <p:graphicImage value="#{resource['images:unchek.gif']}" 
		                          style="border:0px; vertical-align:middle;" rendered="#{lista.indicadorLog eq '1'}"/>		              
				 </p:column> 
				 
				  
		   </p:dataTable>
       </p:panel>

	
	</h:panelGroup>
	
	
	<h:inputHidden value="#{mAlias.reporteEnEjecucion}"  id="idReporteEnEjecucion"/>	
	<h:inputHidden value="#{mAlias.formatoExportacion}"  id="idFormatoExportacion"/>
	<h:inputHidden value="#{mPantallaPrincipalBean.viewPDFMedia}"  id="idViewPDFMedia"/>
	<h:inputHidden value="#{mAlias.formReporte.envioEmail}"  id="idEnvioEmail"/>
	<h:inputHidden value="#{mAlias.validacionPrevia}"  id="idValidacionPrevia"/>
    
    
    <ssicc:confirmDialogGenerarReporteNoJASPER id="confirmDialogGenerarReporteNoJASPER" manage="#{mAlias}" 
	  update=":principalForm:idReporteEnEjecucion, :principalForm:idFormatoExportacion, 
	          :principalForm:messagesPrincipalForm, :principalForm:mensajesGrowl
	          :principalForm:panelReportesMailEjecutado"
	  />
    
	<ssicc:confirmDialogGenerarReporte id="confirmDialogGenerarReporte" manage="#{mAlias}" 
	  update=":principalForm:idReporteEnEjecucion, :principalForm:idFormatoExportacion, 
	  		  :principalForm:messagesPrincipalForm, :principalForm:mensajesGrowl
	  		  :principalForm:panelReportesMailEjecutado"
	  />
	
	<ssicc:confirmDialogGenerarReportePDF id="confirmDialogGenerarReportePDF" manage="#{mAlias}" 
		  oncomplete="PF('panelFiltroReporte').toggle();"
		  update=":principalForm:idReporteEnEjecucion, :principalForm:idFormatoExportacion, 
		  :principalForm:messagesPrincipalForm, :principalForm:mensajesGrowl, 
		  :principalForm:panelReportePDFMedia
		  :principalForm:panelReportesMailEjecutado"
		  viewPDFMedia="#{mPantallaPrincipalBean.viewPDFMedia}"/>
		
	<ssicc:confirmDialogGenerarReportBachMultiMail id="confirmDialogGrabarReporte" 
			manage="#{mAlias}"
			update=":principalForm:idReporteEnEjecucion, 
					:principalForm:idFormatoExportacion,
					:principalForm:messagesPrincipalForm
					:principalForm:idPanelGridLisReporLog
					:principalForm:panelReportesMailEjecutado"/>
	   
	<!-- Parte donde se incluyen los Javascript respectivos -->
	<script type="text/javascript">
			
			function setFormatoExportPDF(){
				var formatoExportacion = document.getElementById("idFormatoExportacion");
				var viewPDFMedia = document.getElementById("idViewPDFMedia");
				formatoExportacion.value = "PDF";
				viewPDFMedia.value = true;
			}

			function setFormatoExportXLS(){
				var formatoExportacion = document.getElementById("idFormatoExportacion");
				var viewPDFMedia = document.getElementById("idViewPDFMedia");
				formatoExportacion.value = "XLS";
				viewPDFMedia.value = false;
			}
			
			function setFormatoExportXLSX(){
				var formatoExportacion = document.getElementById("idFormatoExportacion");
				var viewPDFMedia = document.getElementById("idViewPDFMedia");
				formatoExportacion.value = "XLSX";
				viewPDFMedia.value = false;
			}
			
			function setFormatoExportCSV(){
				var formatoExportacion = document.getElementById("idFormatoExportacion");
				var viewPDFMedia = document.getElementById("idViewPDFMedia");
				formatoExportacion.value = "CSV";
				viewPDFMedia.value = false;
			}

			function setFormatoExportOCSV(){
				var formatoExportacion = document.getElementById("idFormatoExportacion");
				var viewPDFMedia = document.getElementById("idViewPDFMedia");
				formatoExportacion.value = "OCSV";
				viewPDFMedia.value = false;
			}

			function setFormatoExportOTXT(){
				var formatoExportacion = document.getElementById("idFormatoExportacion");
				var viewPDFMedia = document.getElementById("idViewPDFMedia");
				formatoExportacion.value = "OTXT";
				viewPDFMedia.value = false;
			}

			function setFormatoExportOJXLSX(){
				var formatoExportacion = document.getElementById("idFormatoExportacion");
				var viewPDFMedia = document.getElementById("idViewPDFMedia");
				formatoExportacion.value = "OJXLSX";
				viewPDFMedia.value = false;
			}

			function setFormatoExportZIP(){
				var formatoExportacion = document.getElementById("idFormatoExportacion");
				var viewPDFMedia = document.getElementById("idViewPDFMedia");
				formatoExportacion.value = "ZIP";
				viewPDFMedia.value = false;
			}

			function setFormatoExportOZIP(){
				var formatoExportacion = document.getElementById("idFormatoExportacion");
				var viewPDFMedia = document.getElementById("idViewPDFMedia");
				formatoExportacion.value = "OZIP";
				viewPDFMedia.value = false;
			}
			
			function setFormatoExportOOXLSX(){
				var formatoExportacion = document.getElementById("idFormatoExportacion");
				var viewPDFMedia = document.getElementById("idViewPDFMedia");
				formatoExportacion.value = "OOXLSX";
				viewPDFMedia.value = false;
			}
					
		
	
		
	</script>
		
  </ui:define>
         
</ui:composition>
</body>
</html>