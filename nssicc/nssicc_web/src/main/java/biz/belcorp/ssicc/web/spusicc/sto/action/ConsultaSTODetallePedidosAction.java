package biz.belcorp.ssicc.web.spusicc.sto.action;import java.util.HashMap;import java.util.List;import java.util.Map;import javax.faces.bean.ManagedBean;import javax.faces.bean.SessionScoped;import javax.faces.context.ExternalContext;import javax.faces.context.FacesContext;import javax.faces.event.ActionEvent;import org.apache.commons.collections.MapUtils;import org.apache.commons.lang.StringUtils;import biz.belcorp.ssicc.service.scsicc.ConsultaHIPDatosClienteService;import biz.belcorp.ssicc.service.spusicc.sto.ProcesoSTOService;import biz.belcorp.ssicc.web.framework.base.action.BasePopupAbstractAction;import biz.belcorp.ssicc.web.framework.base.form.BaseSearchForm;import biz.belcorp.ssicc.web.spusicc.sto.form.ConsultaSTODetallePedidosForm;@SuppressWarnings({ "rawtypes", "unchecked" })@ManagedBean@SessionScopedpublic class ConsultaSTODetallePedidosAction extends BasePopupAbstractAction {	private List stoListaDetallePEdidoGPI1GP2;	private List stoListaDetallePEdidoGPI3GP4GP5;	private static final long serialVersionUID = 1L;	/**	 * Consultar principal	 */	public void consultarPrincipal() {		try {			ProcesoSTOService procesoSTOService = (ProcesoSTOService) getBean("spusicc.procesoSTOService");			ConsultaSTODetallePedidosForm f = (ConsultaSTODetallePedidosForm) this.formBusqueda;			Map criteria = new HashMap();			criteria.put("codigoCliente", f.getCodigoConsultora());			criteria.put("codigoVenta", f.getCodigoVenta());			List listaDetallePedidoGP1_GP2 = null;			List listaDetallePedidoGP3_GP4_GP5 = null;			if (StringUtils.equals(f.getTipo(), "GP1")) {				listaDetallePedidoGP1_GP2 = procesoSTOService						.getConsultaDetallePedidoGP1_GP2(criteria);				this.stoListaDetallePEdidoGPI1GP2 = listaDetallePedidoGP1_GP2;			} else {				listaDetallePedidoGP3_GP4_GP5 = procesoSTOService						.getConsultaDetallePedidoGP3_GP4_GP5(criteria);				this.stoListaDetallePEdidoGPI3GP4GP5 = listaDetallePedidoGP3_GP4_GP5;			}			if ((listaDetallePedidoGP1_GP2 == null || listaDetallePedidoGP1_GP2					.size() == 0)					&& (listaDetallePedidoGP3_GP4_GP5 == null || listaDetallePedidoGP3_GP4_GP5							.size() == 0)) {				this.addError("Error ", this						.getResourceMessage("errors.datos.fuentes.busqueda"));			}		} catch (Exception e) {			this.addError("Error ", this.obtieneMensajeErrorException(e));		}	}	/**	 * @param evt	 */	public void buscar(ActionEvent evt) {		if (log.isDebugEnabled()) {			log.debug("Entering 'buscar' method");		}		try {			this.consultarPrincipal();		} catch (Exception e) {			this.addError("Error ", this.obtieneMensajeErrorException(e));		}	}	// metodo que sale del popup	public void salirPopup(ActionEvent event) {		try {			if (log.isDebugEnabled()) {				log.debug("Entering my method 'salirUA'");			}			String ventana = "PF('dialogConsultaSTOPedidosForm').hide()";			this.getRequestContext().execute(ventana);			// this.mostrarBotonSalir = true;		} catch (Exception e) {			this.addError("Error: ", this.obtieneMensajeErrorException(e));		}	}	/**	 * 	 */	public void inicializarValores() {		try {			ProcesoSTOService procesoSTOService = (ProcesoSTOService) getBean("spusicc.procesoSTOService");			ConsultaHIPDatosClienteService service = (ConsultaHIPDatosClienteService) getBean("scsicc.consultaHIPDatosClienteService");			ConsultaSTODetallePedidosForm f = (ConsultaSTODetallePedidosForm) this.formBusqueda;			Map criteria = new HashMap();			ExternalContext externalContext = FacesContext.getCurrentInstance()					.getExternalContext();			String codigoConsultora = externalContext.getRequestParameterMap()					.get("codigoCliente");			String codigoCampanya = externalContext.getRequestParameterMap()					.get("codigoCampanya");			String tipoConsulta = externalContext.getRequestParameterMap().get(					"tipo");						String secuencia = externalContext.getRequestParameterMap().get(					"secuencia").toString();			criteria.put("codigoCliente", codigoConsultora);			criteria.put("secuencia", secuencia);			List datosCabeceraSTO = service					.getDatosCabeceraDetallePedidoSolicitado(secuencia);			if (datosCabeceraSTO != null && datosCabeceraSTO.size() > 0) {				Map datosSTO = (HashMap) datosCabeceraSTO.get(0);				f.setCodigoRegion(MapUtils.getString(datosSTO, "codigoRegion",						""));				f.setCodigoZona(MapUtils.getString(datosSTO, "codigoZona", ""));			}			f.setCodigoConsultora(codigoConsultora);			f.setCodigoCampanya(codigoCampanya);			f.setTipo(tipoConsulta);			f.setCodigoVenta(null);			if (StringUtils.equals(f.getTipo(), "GP1")) {				List listaDetallePedidoGP1_GP2 = procesoSTOService						.getConsultaDetallePedidoGP1_GP2(criteria);				this.stoListaDetallePEdidoGPI1GP2 = listaDetallePedidoGP1_GP2;			} else {				List listaDetallePedidoGP3_GP4_GP5 = procesoSTOService						.getConsultaDetallePedidoGP3_GP4_GP5(criteria);				this.stoListaDetallePEdidoGPI3GP4GP5 = listaDetallePedidoGP3_GP4_GP5;			}			// String ventanaConfirmar =			// "PF('principalFormAlert_alertDialog').show()";			// this.getRequestContext().execute(ventanaConfirmar);			// this.getRequestContext().execute(ventana);		} catch (Exception e) {			this.addError("Error : ", this.obtieneMensajeErrorException(e));		}	}	/*	 * (non-Javadoc)	 * 	 * @see biz.belcorp.ssicc.web.framework.base.action.	 * BaseMantenimientoSearchAbstractAction#devuelveFormBusqueda()	 */	@Override	protected BaseSearchForm devuelveFormBusqueda() throws Exception {		ConsultaSTODetallePedidosForm form = new ConsultaSTODetallePedidosForm();		return form;	}	/*	 * (non-Javadoc)	 * 	 * @see biz.belcorp.ssicc.web.framework.base.action.	 * BaseMantenimientoSearchAbstractAction#setFindAttributes()	 */	@Override	protected List setFindAttributes() throws Exception {		return null;	}	/*	 * (non-Javadoc)	 * 	 * @see biz.belcorp.ssicc.web.framework.base.action.MBaseSistemaAbstractJSF#	 * setViewAtributes()	 */	@Override	protected void setViewAtributes() throws Exception {	}	/**	 * @return the stoListaDetallePEdidoGPI1GP2	 */	public List getStoListaDetallePEdidoGPI1GP2() {		return stoListaDetallePEdidoGPI1GP2;	}	/**	 * @param stoListaDetallePEdidoGPI1GP2	 *            the stoListaDetallePEdidoGPI1GP2 to set	 */	public void setStoListaDetallePEdidoGPI1GP2(			List stoListaDetallePEdidoGPI1GP2) {		this.stoListaDetallePEdidoGPI1GP2 = stoListaDetallePEdidoGPI1GP2;	}	/**	 * @return the stoListaDetallePEdidoGPI3GP4GP5	 */	public List getStoListaDetallePEdidoGPI3GP4GP5() {		return stoListaDetallePEdidoGPI3GP4GP5;	}	/**	 * @param stoListaDetallePEdidoGPI3GP4GP5	 *            the stoListaDetallePEdidoGPI3GP4GP5 to set	 */	public void setStoListaDetallePEdidoGPI3GP4GP5(			List stoListaDetallePEdidoGPI3GP4GP5) {		this.stoListaDetallePEdidoGPI3GP4GP5 = stoListaDetallePEdidoGPI3GP4GP5;	}}